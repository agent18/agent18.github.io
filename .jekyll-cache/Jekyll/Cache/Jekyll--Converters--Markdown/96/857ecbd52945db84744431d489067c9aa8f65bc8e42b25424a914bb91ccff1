I"æ8<h2 id="fastai-alternatives">fastai alternatives</h2>

<p>https://www.fast.ai/2017/04/06/alternatives/</p>

<h2 id="resources">Resources</h2>

<p>2018 Lesson 1 wiki: https://forums.fast.ai/t/wiki-thread-lesson-1/6825</p>

<p>course 2018: https://course18.fast.ai/lessonsml1/lesson1.html</p>

<p>2020 setup help: https://forums.fast.ai/t/setup-help/65529</p>

<p>Ubuntu setup help used:</p>

<ul>
  <li>
    <p>https://forums.fast.ai/t/pytorch-installation-in-conda-environment-failing/6703/19</p>
  </li>
  <li>
    <p>https://forums.fast.ai/t/platform-local-server-ubuntu/65851</p>
  </li>
</ul>

<p>updates 2020:
https://forums.fast.ai/t/official-part-1-2020-updates-and-resources-thread/63376</p>

<blockquote>
  <p>^^ Has all the code pictures and text</p>
</blockquote>

<p>2020 book:https://github.com/fastai/fastbook/blob/master/01_intro.ipynb</p>

<p>2020 software fastai repo: https://github.com/fastai/fastai</p>

<blockquote>
  <p>^^ this is fastai v2 written from scratch</p>
</blockquote>

<p>2020 course nbs: https://github.com/fastai/fastbook/tree/master/clean</p>

<p>2020 readme page fastai: https://course.fast.ai/#How-do-I-get-started?</p>

<p>2020 lesson 1 wiki: https://forums.fast.ai/t/lesson-1-official-topic/65626</p>

<p>forums: https://forums.fast.ai/</p>

<p>Lesson 1 wiki: https://forums.fast.ai/t/lesson-1-official-topic/65626</p>

<p>Help with setup: https://forums.fast.ai/t/setup-help/65529</p>

<p><strong>Old</strong></p>

<p>fastiai2 - https://github.com/fastai/fastai2 
coursev4 - https://github.com/fastai/course-v4 
fastbook - https://github.com/fastai/fastbook</p>

<h2 id="prepping-ubuntu">Prepping ubuntu</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get upgrade
</code></pre></div></div>

<p>Software and updates also does the above. But you see errors with
<a href="https://itsfoss.com/ppa-guide/">ppa</a> with <code class="language-plaintext highlighter-rouge">sudo apt-get update</code> <a href="https://askubuntu.com/questions/362872/is-using-software-updater-the-same-thing-as-running-apt-get-update-and-apt-get-u">it seems</a>.</p>

<p>If PPA seems not necessary anymore: Fixing errors with <code class="language-plaintext highlighter-rouge">sudo apt-get
update</code> ‚Äì&gt; fixed with <code class="language-plaintext highlighter-rouge">#</code> in the <code class="language-plaintext highlighter-rouge">ppa</code> directory (source: <a href="https://itsfoss.com/ppa-guide/">here</a>).</p>

<p>Had errors in ppa from opencpu, seems to be used for R but I don‚Äôt
know if there is even a point in maintaining the ppa. For later. For
now <code class="language-plaintext highlighter-rouge">#</code>.</p>

<h2 id="changing-ubuntu-desktop">changing ubuntu desktop</h2>

<p>All the info you need about environments is <a href="https://askubuntu.com/questions/65083/what-kinds-of-desktop-environments-and-shells-are-available">here</a>. There is unity,
there is gnome there is kde‚Ä¶</p>

<p>Unity is default till 16.</p>

<p>Info about <a href="https://unix.stackexchange.com/a/485056/267853">systemctl-suspend and pm-suspend</a></p>

<h2 id="installing-fastai">Installing fastai</h2>

<p><strong>Resources</strong></p>

<p>How to install nvidia drivers is <a href="https://www.cyberciti.biz/faq/ubuntu-linux-install-nvidia-driver-latest-proprietary-driver/">here</a> and <a href="https://askubuntu.com/a/851144/443958">here</a> and <a href="https://askubuntu.com/questions/61396/how-do-i-install-the-nvidia-drivers">here</a>.</p>

<h3 id="question-no-answer-on-stack-archive">question (no answer on stack) (archive)</h3>

<p><a href="https://askubuntu.com/questions/1276660/identify-and-install-the-latest-nvidia-driver-for-ubuntu-16">Stack link</a></p>

<p><strong>Goal</strong></p>

<p>I somehow installed the driver 3 years back and want to check if I
have the latest ones and if they are upgraded.</p>

<p><strong>Status</strong></p>

<p><code class="language-plaintext highlighter-rouge">Additional drivers</code> in <code class="language-plaintext highlighter-rouge">Software &amp; Updates</code> shows a bunch of
NVIDIA graphics drivers. And currently <code class="language-plaintext highlighter-rouge">390</code> has been installed and I
see it working with the processes using the GPU, with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nvidia-smi
</code></pre></div></div>

<p>I dont think I have added repos ever, (like <a href="https://askubuntu.com/a/851144/443958">this</a>):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo add-apt-repository ppa:graphics-drivers/ppa
sudo apt update 
</code></pre></div></div>

<p>I know this because I don‚Äôt see the <code class="language-plaintext highlighter-rouge">graphics-drivers</code> PPA‚Äôs in</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>grep ^ /etc/apt/sources.list /etc/apt/sources.list.d/*
</code></pre></div></div>

<p><strong>Question</strong></p>

<ol>
  <li>
    <p>When I look in Nvidia website there is a higher proprietary version
<a href="https://www.nvidia.com/Download/driverResults.aspx/163238/en-us">450</a>, based on the official <a href="https://www.nvidia.com/Download/index.aspx?lang=en-us">Nvidia driver finder</a>. When I look in launchpad it says <a href="https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa"><code class="language-plaintext highlighter-rouge">430</code></a> is the current supported version, but<code class="language-plaintext highlighter-rouge">450</code>
is not shown in <code class="language-plaintext highlighter-rouge">additional drivers</code>. Why? What am I missing?</p>
  </li>
  <li>
    <p>I want to go to the latest driver available. Is <code class="language-plaintext highlighter-rouge">390</code> the latest
stable release for Ubuntu 16.04? How do I figure this out?</p>
  </li>
  <li>
    <p>There are many ways to install <code class="language-plaintext highlighter-rouge">450</code> (I am afraid of conflicts or my
system breaking). Which should I prefer now that I have <code class="language-plaintext highlighter-rouge">390</code> via
<code class="language-plaintext highlighter-rouge">additional drivers</code>?</p>

    <ul>
      <li>download from <a href="https://www.nvidia.com/Download/driverResults.aspx/135161/en-us">Nvidia site</a> and install</li>
      <li>apt-get has it‚Äôs own install <code class="language-plaintext highlighter-rouge">sudo apt-get nvidia-\*\*450\*\*</code>,
once I have the <code class="language-plaintext highlighter-rouge">graphics-drivers</code> PPA‚Äôs.</li>
      <li>add PPAs and install from <code class="language-plaintext highlighter-rouge">additional drivers</code></li>
    </ul>
  </li>
  <li>
    <p>Should I uninstall <code class="language-plaintext highlighter-rouge">390</code> so I can install <code class="language-plaintext highlighter-rouge">450</code> and if so how? (there is no option in
<code class="language-plaintext highlighter-rouge">additional drivers</code> to unselect all options). Is the following ok?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ sudo apt purge nvidia-390 -y
 $ sudo apt autoremove -y
 $ sudo apt autoclean
</code></pre></div>    </div>
  </li>
  <li>
    <p>Should I <a href="https://askubuntu.com/a/937898/443958">disable</a> <code class="language-plaintext highlighter-rouge">secure boot</code> before installing and enable it afterwards?</p>
  </li>
</ol>

<p><strong>Current Config</strong></p>

<ul>
  <li>Ubuntu 16.04 LTS &amp; Windows 10 dual boot</li>
  <li>8 gb ram</li>
  <li>
    <p>Nvidia GeForce GTX 1050/PCIe/SSE2</p>

  </li>
</ul>

<h2 id="installing-fastai-with-dependencies">Installing fastai with dependencies</h2>

<p><strong>Packages to be installed</strong> can be found in the <a href="https://github.com/fastai/fastai/blob/master/environment.yml"><code class="language-plaintext highlighter-rouge">environment.yml</code></a></p>

<p><strong>What seems to work (period)</strong>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create --name fastaiclean 

conda install -c fastai -c pytorch -c anaconda fastai 

conda install -c fastai -c pytorch -c anaconda gh

conda install -c conda-forge notebook
</code></pre></div></div>

<p>Yes to all the disclaimers such as additional packages to be
installed. <strong>Checked as of jan 18 2021. STILL WORKS GREAT.  :)</strong></p>

<p>Based on <a href="https://stackoverflow.com/a/64056681/5986651">this stack answer</a>: We don‚Äôt need to install anaconda
package as the miniconda install doesn‚Äôt seem to require it.</p>

<p><strong>What doens‚Äôt work</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`conda create --name fastai --clone base`
</code></pre></div></div>

<p><a href="https://docs.fast.ai/#Installing">Man page</a> instructions and directly into existing anaconda setup
leads to conflicts (not sure how to solve):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install -c fastai -c pytorch -c anaconda fastai gh anaconda
</code></pre></div></div>

<p><strong>Error</strong> seems to be some <a href="https://forums.fast.ai/t/pytorch-installation-in-conda-environment-failing/6703">HTTPS error with Pytorch</a>.</p>

<p><strong>What else seems to work (but didn‚Äôt try)</strong></p>

<p><strong>Source:</strong> <a href="https://forums.fast.ai/t/platform-local-server-ubuntu/65851/22">forums of fastai</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/fastai/fastai2
cd fastai2
conda env create -f environment.yml
conda activate fastai2

+other things based on errors you get
</code></pre></div></div>

<p><strong>Another source</strong>: <a href="https://forums.fast.ai/t/platform-local-server-ubuntu/65851">Forums of fast ai</a></p>

<p><strong>Note about Pip</strong></p>

<blockquote>
  <p>Just in case you haven‚Äôt found that one. They can coexist, but maybe
not in a way you‚Äôd expect. Pip can easily be run inside conda. You
can use conda to manage python versions, install some libraries and
then use pip for the rest. That will totally work. What will not
work are packages you installed before installing conda, but that‚Äôs
because the python you run after that (installed by conda) does not
have the same site-packages directory in sys.path. Ofc, you can
install them again after installing conda, but they will be
downloaded, unpacked, and possibly compiled (in case they do not
have wheels) again. ‚Äî<a href="https://forums.fast.ai/t/installing-fastai-on-ubuntu-using-pip-and-virtualenv/38356/3?u=thetj09">fastaiforum</a></p>
</blockquote>

<h3 id="gpu-not-working-running-intropynb">GPU not working (running intro.pynb)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ImportError</span><span class="p">:</span> <span class="n">IProgress</span> <span class="ow">not</span> <span class="n">found</span><span class="p">.</span> <span class="n">Please</span> <span class="n">update</span> <span class="n">jupyter</span> <span class="ow">and</span> <span class="n">ipywidgets</span><span class="p">.</span> <span class="n">See</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ipywidgets</span><span class="p">.</span><span class="n">readthedocs</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">en</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">user_install</span><span class="p">.</span><span class="n">html</span>
</code></pre></div></div>

<p>Fix from this <a href="https://ipywidgets.readthedocs.io/en/stable/user_install.html">link</a>,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install -c conda-forge ipywidgets
</code></pre></div></div>

<p><strong>FASTAI works.</strong> Somehow the GPU was not used, and what took 1 min
for the lecturer in lesson 1 took me 15 mins (atleast that‚Äôs what it
said).</p>

<h3 id="fixing-slow-computer-swap">Fixing slow computer (swap)</h3>

<ul>
  <li>Swap occupied and reverting back from swap</li>
</ul>

<p>Based on this <a href="https://askubuntu.com/a/756409/443958">stack answer</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo swapoff -a
sudo swapon -a
</code></pre></div></div>

<h2 id="fixing-gpu-not-working">Fixing GPU not working</h2>

<h3 id="installing-the-right-drivers">Installing the right drivers</h3>

<p><strong>Basically</strong>: <code class="language-plaintext highlighter-rouge">Additional drivers</code> tab in <code class="language-plaintext highlighter-rouge">Softwares &amp; Updates</code> does it for you.</p>

<p>Check which drivers are installed?</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dpkg --get-selections | grep nvidia</code></p>
  </li>
  <li>
    <p>Go to <code class="language-plaintext highlighter-rouge">Additional drivers</code> and see what is selected</p>
  </li>
</ul>

<p><strong>Identify the latest stable driver</strong> for Ubuntu 16 and GTX 10 series
GeForce 1050 by:</p>

<ul>
  <li>
    <p>Highest in <code class="language-plaintext highlighter-rouge">Additional drivers</code></p>
  </li>
  <li>
    <p>Launchpad (graphics drivers ppa basically)</p>
  </li>
  <li>
    <p><a href="https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa"><strong>launchpad</strong></a> says <code class="language-plaintext highlighter-rouge">430</code> (430.40)</p>

    <ul>
      <li>Also the version names contained in the table below show 16.04
for <code class="language-plaintext highlighter-rouge">430</code>.</li>
    </ul>
  </li>
</ul>

<p><strong>Uninstall and Re-install</strong></p>

<p>Add PPA.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo add-apt-repository ppa:graphics-drivers/ppa
</code></pre></div></div>

<p><strong>Don‚Äôt uninstall</strong>! Just change on <code class="language-plaintext highlighter-rouge">additional drivers</code> and
rebooted and see that <code class="language-plaintext highlighter-rouge">nvidia-smi</code> shows <code class="language-plaintext highlighter-rouge">430</code>.</p>

<p><strong>Note</strong>: <code class="language-plaintext highlighter-rouge">dpkg --get-selections | grep nvidia</code> now shows <code class="language-plaintext highlighter-rouge">nvidia-390
deinstall</code> and <code class="language-plaintext highlighter-rouge">nvidia-430 install</code>. This doesn‚Äôt matter.</p>

<p><strong>Note</strong>: It also says it is <strong>open source</strong> in my <code class="language-plaintext highlighter-rouge">addtional driver</code>
tab. This looks like a <a href="https://askubuntu.com/questions/1185924/nvidia-vs-nouveau-drivers">bug</a>. It is <strong>proprietary</strong> as fuck.</p>

<p><strong>Resources on Nvidia graphics card</strong></p>

<ul>
  <li><a href="https://askubuntu.com/a/61433/443958">Stack detailed resource</a></li>
</ul>

<p>These are some ofthe links I looked into:</p>

<p><a href="https://askubuntu.com/a/851144/443958">1</a> ‚Äì&gt; https://askubuntu.com/a/851144/443958<br />
  <a href="https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa">2</a> ‚Äì&gt; https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa<br />
  <a href="https://askubuntu.com/a/937898/443958">3</a> ‚Äì&gt; https://askubuntu.com/a/937898/443958<br />
  [4] ‚Äì&gt; https://askubuntu.com/questions/1045241/ubuntu-18-04-how-do-i-install-drivers-for-my-nvidia-geforce-gtx-1050<br />
[5] ‚Äì&gt; https://askubuntu.com/questions/61396/how-do-i-install-the-nvidia-drivers?noredirect=1&amp;lq=1</p>

<h3 id="what-nvidia-driver-should-i-install-for-ubuntu-1604">What Nvidia driver should I install for Ubuntu 16.04</h3>

<p>My question on <a href="https://askubuntu.com/questions/1277947/what-are-the-latest-stable-proprietary-drivers-for-ubuntu-16-04-and-nvidia-gefor">AskUbuntu</a>:</p>

<p>Which is the <strong>LATEST STABLE proprietary drivers</strong> for UBUNTU <strong>16.04</strong> and NVIDIA
Geforce <strong>GTX 1050</strong> (4gb)? There are simply too many answers which I have compiled below:</p>

<ol>
  <li>
    <p><strong>Nvidia site</strong> says <a href="https://www.nvidia.com/Download/driverResults.aspx/163238/en-us">450</a>(450.66) is the latest for GTX 1050 (not
ubuntu version specific)</p>

    <ul>
      <li>download from <a href="https://www.nvidia.com/Download/driverResults.aspx/135161/en-us">Nvidia site</a> and install</li>
      <li>apt-get has it‚Äôs own install <code class="language-plaintext highlighter-rouge">sudo apt-get nvidia-\*\*450\*\*</code>,</li>
    </ul>
  </li>
  <li>
    <p><strong>Additional drivers</strong> tab in <code class="language-plaintext highlighter-rouge">Software and Updates</code> only shows version
<code class="language-plaintext highlighter-rouge">390</code></p>

    <ul>
      <li><strong>Note:</strong> <code class="language-plaintext highlighter-rouge">graphics-drivers</code> PPA‚Äôs have not been added yet.</li>
    </ul>
  </li>
  <li>
    <p><a href="https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa"><strong>launchpad</strong></a> says <code class="language-plaintext highlighter-rouge">430</code> (430.40)</p>

    <blockquote>
      <p>Current long-lived branch release: <code class="language-plaintext highlighter-rouge">nvidia-430</code> (430.40) Dropped
support for Fermi series
(https://nvidia.custhelp.com/app/answers/detail/a_id/4656)</p>
    </blockquote>
  </li>
  <li>
    <p><a href="https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa"><strong>Launchpad</strong></a> also says old branch for GeForce 10 series (1050) is
390.129</p>

    <blockquote>
      <p>Old long-lived branch release: <code class="language-plaintext highlighter-rouge">nvidia-390</code> (390.129)
For GF1xx GPUs use <code class="language-plaintext highlighter-rouge">nvidia-390</code> (390.129)</p>
    </blockquote>
  </li>
  <li>
    <p><a href="https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa">Launchpad here</a> shows overview of packages (scroll down).</p>

    <p>Here the version names contain 16.04 for <code class="language-plaintext highlighter-rouge">430</code>.</p>
  </li>
  <li>
    <p><a href="https://help.ubuntu.com/community/BinaryDriverHowto/Nvidia#NVIDIA_drivers_provided_by_the_Ubuntu_repositories">Ubuntu recommended drivers</a> shows different version for
ubuntu. If I go by this then only <code class="language-plaintext highlighter-rouge">384</code> has supported versions for
16.04 (Xenial Xerus)</p>
  </li>
</ol>

<p>These are some ofthe links I looked into:</p>

<p><a href="https://askubuntu.com/a/851144/443958">1</a> ‚Äì&gt; https://askubuntu.com/a/851144/443958<br />
  <a href="https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa">2</a> ‚Äì&gt; https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa<br />
  <a href="https://askubuntu.com/a/937898/443958">3</a> ‚Äì&gt; https://askubuntu.com/a/937898/443958<br />
  [4] ‚Äì&gt; https://askubuntu.com/questions/1045241/ubuntu-18-04-how-do-i-install-drivers-for-my-nvidia-geforce-gtx-1050<br />
[5] ‚Äì&gt; https://askubuntu.com/questions/61396/how-do-i-install-the-nvidia-drivers?noredirect=1&amp;lq=1</p>

<h3 id="answer-to-nvidia-driver-to-be-used">Answer to NVIDIA driver to be used</h3>

<p><strong>Plan</strong></p>

<blockquote>
  <p>The key to success is simply to go with the Additional Drivers tab
recommendations. The Ubuntu Developers worked really hard to make
that tab trustworthy and reliable. It only shows options that are
compatible with your hardware from sources that you already
subscribe to. After you add the PPA, then go with the Additional
Drivers tab (#2 / 430). If you encounter problems, downgrade to 410
or 390. ‚Äî<a href="https://askubuntu.com/q/1277947/443958">my post on stack</a></p>
</blockquote>

<h2 id="fixing-issues-with-cuda">Fixing issues with Cuda</h2>

<p><code class="language-plaintext highlighter-rouge">pytorch</code> needs to be compiled with the right cuda. If you look on
<code class="language-plaintext highlighter-rouge">pytorch</code>‚Äôs website it is always installed with torchvision and cuda
version.</p>

<p>CUDA version needs to be matched by the nvidia drivers as per <a href="https://docs.nvidia.com/deploy/cuda-compatibility/index.HTML">table 1</a>.</p>

<p><a href="https://pytorch.org/get-started/previous-versions/">pytorch</a> will use it‚Äôs own cuda (looks like). External CUDA driver from
NVIDIA website not required.</p>

<h3 id="multiple-versions-of-cuda-in-the-system">Multiple versions of cuda in the system</h3>

<p><a href="https://stackoverflow.com/questions/64089854/pytorch-detection-of-cuda">Stack question by me</a>.</p>

<p>I have Nvidia driver <code class="language-plaintext highlighter-rouge">430</code> on Ubuntu 16.04 with Geforce 1050. It comes
with <code class="language-plaintext highlighter-rouge">libcuda1-430</code> when I installed the driver from <code class="language-plaintext highlighter-rouge">additional
drivers</code> tab in ubuntu (<code class="language-plaintext highlighter-rouge">Software and Updates</code>). I installed <code class="language-plaintext highlighter-rouge">pytorch</code>
with <code class="language-plaintext highlighter-rouge">conda</code> which also installed the <code class="language-plaintext highlighter-rouge">cudatoolkit</code>.</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">nvidia-smi</code> says I have cuda version <code class="language-plaintext highlighter-rouge">10.1</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">conda list</code> tells me cudatoolkit version is <code class="language-plaintext highlighter-rouge">10.2.89</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">print(torch.cuda.current_device())</code>, I get <code class="language-plaintext highlighter-rouge">10.0.10</code>? (it
looks like):</p>

    <blockquote>
      <p>AssertionError: The NVIDIA driver on your system is too old
     (found version 10010)</p>
    </blockquote>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">print(torch._C._cuda_getCompiledVersion(), 'cuda compiled
version')</code> tells me my version is <code class="language-plaintext highlighter-rouge">10.0.20</code>?</p>

    <blockquote>
      <p>10020 cuda compiled version</p>
    </blockquote>
  </li>
</ol>

<p>What am I missing? What version of CUDA is my torch actually looking
at? Why are there so many different versions?</p>

<!-- Based on [Nvidias site](https://docs.nvidia.com/deploy/cuda-compatibility/index.html) I know I need to have <=`CUDA 10.1 -->
<!-- (10.1.105)`. -->

<h3 id="what-is-your-version-of-cuda">what is your version of cuda</h3>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">nvidia-smi</code> is just showing version it can handle according to
<a href="https://stackoverflow.com/q/64089854/5986651">Berriel from stack</a></p>
  </li>
  <li>
    <p>Using <code class="language-plaintext highlighter-rouge">torch.version.cuda</code> we can find out which version pytorch
was built with. this was found to be 10.2 (as was <code class="language-plaintext highlighter-rouge">cudatoolkit
version</code>)</p>
  </li>
  <li>
    <p>&amp; 4. forget it.</p>
  </li>
</ol>

<p>Suggestion was to remove pytorch torchvision and cudatoolkit</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda remove pytorch torchvision cudatoolkit
</code></pre></div></div>

<h3 id="does-your-cuda-work">Does your cuda work?</h3>

<p><a href="https://chrisalbon.com/deep_learning/pytorch/basics/check_if_pytorch_is_using_gpu/">Source 1</a>, <a href="https://stackoverflow.com/questions/48152674/how-to-check-if-pytorch-is-using-the-gpu">Stack</a></p>

<p><strong>If testing goes well</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">torch</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">current_device</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">device</span> <span class="n">at</span> <span class="mh">0x7efce0b03be0</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">device_count</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">get_device_name</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s">'GeForce GTX 950M'</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="bp">True</span>
</code></pre></div></div>
<p><strong>If wrong version of cuda</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print(torch.cuda.device_count())
0
print(torch.cuda.current_device())

AssertionError: 
The NVIDIA driver on your system is too old (found version 10010).
</code></pre></div></div>

<p>Looking the assertion error on google points to <a href="https://github.com/pytorch/pytorch/issues/4546">github pytorch
issues</a> where they talk about versions not matching of the driver
and the CUDA version. Digging a bit deeper you see the NVIDIA website
regarding cuda and driver version numbers <a href="https://docs.nvidia.com/deploy/cuda-compatibility/index.html">Table 1: Nvidia site</a>.</p>

<h3 id="downgrading-cudatoolkit-without-conflicts">Downgrading cudatoolkit without conflicts</h3>

<p>Current version of cuda:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>torch.version.cuda

10.2
</code></pre></div></div>

<p>Version corresponding to NVIDIA driver (in this case 430)</p>

<ul>
  <li>nvidia-smi says 10.1</li>
  <li><a href="https://docs.nvidia.com/deploy/cuda-compatibility/index.html">Table 1: Nvidia site</a> also says 10.1 and below (roughly).</li>
</ul>

<p><strong>What doesn‚Äôt work?</strong></p>

<p>In the current conda installing with <code class="language-plaintext highlighter-rouge">cudatoolkit</code> <code class="language-plaintext highlighter-rouge">pytorch</code> and
<code class="language-plaintext highlighter-rouge">torchvision</code> gives tons of <a href="https://pastebin.com/WPJRDwBw">errors</a>.</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">conda install pytorch==1.6.0 torchvision==0.7.0 cudatoolkit=10.1.168
-c pytorch
</span></code></pre></div></div>

<p><strong>What works</strong></p>

<p>Pytorch installation seems to be paired with pytorch torchvision and
cudatoolkit according to <a href="https://pytorch.org/get-started/previous-versions/">official website</a>.</p>

<p>Remove pytorch torchvision cudatoolkit:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda remove pytorch torchvision cudatoolkit

conda install pytorch==1.6.0 torchvision==0.7.0 cudatoolkit=10.1.168 -c pytorch
</code></pre></div></div>

<p>Again it asks for several things I say yes blindly but 	seemingly <strong>NO
CONFLICTS</strong></p>

<p>check what torch.version.cuda is: <code class="language-plaintext highlighter-rouge">10.1</code>. GREAT we have successfully downgraded.</p>

<p><strong>Checking seems successful</strong> based on <a href="https://stackoverflow.com/a/48152675/5986651">SO answer</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">torch</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">current_device</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">## previously this gave "old driver error"
</span><span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">device</span> <span class="n">at</span> <span class="mh">0x7efce0b03be0</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">device_count</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">get_device_name</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s">'GeForce GTX 950M'</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="bp">True</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">torch.cuda.device(0)</code> previously gave the assertion error that Nvidia
driver was too old. Now I have the value as 0 which seems to be
expected as per: <a href="https://stackoverflow.com/a/48152675/5986651">SO answer</a>.</p>

<p><strong>Fresh error:</strong> Now fastai is missing probably got removed when I
removed pytorch or re-installed pytorch.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install -c pytorch -c fastai fastai
</code></pre></div></div>

<p>So far so good. Testing again:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">eghx@eghx-nitro:~$</span><span class="w"> </span>conda activate fastaiclean
<span class="gp">(fastaiclean) eghx@eghx-nitro:~$</span><span class="w"> </span>python
<span class="go">Python 3.8.5 (default, Sep  4 2020, 07:30:14) 
[GCC 7.3.0] :: Anaconda, Inc. on linux
Type "help", "copyright", "credits" or "license" for more information.
</span><span class="gp">&gt;</span><span class="o">&gt;&gt;</span> import torch
<span class="gp">&gt;</span><span class="o">&gt;&gt;</span> torch.cuda.current_device<span class="o">()</span>
<span class="go">0
</span><span class="gp">&gt;</span><span class="o">&gt;&gt;</span> torch.cuda.device<span class="o">(</span>0<span class="o">)</span>
<span class="gp">&lt;torch.cuda.device object at 0x7f14de991d30&gt;</span><span class="w">
</span><span class="gp">&gt;</span><span class="o">&gt;&gt;</span> torch.cuda.device_count<span class="o">()</span>
<span class="go">1
</span><span class="gp">&gt;</span><span class="o">&gt;&gt;</span> torch.cuda.get_device_name<span class="o">()</span>
<span class="go">'GeForce GTX 1050'
</span><span class="gp">&gt;</span><span class="o">&gt;&gt;</span> torch.cuda.is_available<span class="o">()</span>
<span class="go">True
</span><span class="gp">&gt;</span><span class="o">&gt;&gt;</span> print<span class="o">(</span>torch.rand<span class="o">(</span>2,3<span class="o">)</span>.cuda<span class="o">())</span>
<span class="go">+tensor([[0.2424, 0.8397, 0.6206],
        [0.0982, 0.4568, 0.3958]], device='cuda:0')
</span><span class="gp">&gt;</span><span class="o">&gt;&gt;</span> print<span class="o">(</span>torch.rand<span class="o">(</span>2,3<span class="o">)</span>.cuda<span class="o">())</span>
<span class="go">tensor([[0.8775, 0.8157, 0.1333],
        [0.6189, 0.9641, 0.5741]], device='cuda:0')
</span><span class="gp">&gt;</span><span class="o">&gt;&gt;</span> 
<span class="go">
</span></code></pre></div></div>

<p>For the first time I saw another process on nvidia-smi</p>

<p>+‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äì+
| Processes:                                                       GPU Memory   |
| GPU       PID   Type   Process name                             Usage         |
| ============================================================================= |
| 0      1164      G   /usr/lib/xorg/Xorg                           293MiB      |
| 0      2252      G   compiz                                       114MiB      |
| 0     22866      C   python                                       431MiB      |
+‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äì+</p>

<p><strong>Other tools</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	conda search -c pytorch cudatoolkit ## searching for available version
	
	conda list pytorch ## current version installed
</code></pre></div></div>

<h2 id="making-gpu-work-faster">Making GPU work faster</h2>

<p>So 2 things I can do. Install libraries that do faster work and then
remove all other processes on the gpu except cuda.</p>

<p><strong>Resources</strong></p>

<p><a href="https://forums.fast.ai/t/successful-ubuntu-18-04-with-igpu-for-xserver-and-nvidia-gpu-for-cuda-work-setup/20128/2">fastaiforum</a></p>

<p><a href="https://askubuntu.com/questions/980875/isolate-integrated-intel-igpu-from-nvidia-gpu">Isolate integrated intel (igpu) from Nvidia (gpu)</a></p>

<p><a href="https://askubuntu.com/questions/1061551/how-to-configure-igpu-for-xserver-and-nvidia-gpu-for-cuda-work">How to configure iGPU for xserver and nvidia GPU for CUDA work</a> BY
FASTI STASON</p>

<p><a href="https://askubuntu.com/a/995125/443958">How to configure igpu for xserver and nvidia gpu for cuda?</a> by
simple solution guy</p>

<p><strong>Removing xorg processes</strong></p>

<ol>
  <li>
    <p>change intel graphics card on <code class="language-plaintext highlighter-rouge">nvidia settings</code></p>

    <p>or <code class="language-plaintext highlighter-rouge">prime-select intel</code></p>
  </li>
  <li>
    <p>added the</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> export LD_LIBRARY_PATH=/usr/lib/nvidia-430:$LD_LIBRARY_PATH
</code></pre></div>    </div>
  </li>
</ol>

<p>and then restarted‚Ä¶.</p>

<ul>
  <li>Put command in ‚Äò2‚Äô in .bashrc to work with every terminal
open‚Ä¶ <code class="language-plaintext highlighter-rouge">LD_Library_path</code> loses its value after terminal session</li>
</ul>

<p><strong>Result</strong></p>

<ul>
  <li>visibly no difference in speed</li>
  <li>you only save 11% of the gpu.</li>
  <li>second screen doesn‚Äôt work</li>
  <li>need to spend even more and more time to fix it.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>¬†</th>
      <th>time1</th>
      <th>time2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>xorg running on Nvidia</td>
      <td>1:56</td>
      <td>1.19</td>
    </tr>
    <tr>
      <td>no processes and missing screen</td>
      <td>2.03</td>
      <td>1.15</td>
    </tr>
    <tr>
      <td>Reverting back</td>
      <td>2.10</td>
      <td>1.18</td>
    </tr>
    <tr>
      <td>adding the lib stuff</td>
      <td>1.11</td>
      <td>1.19</td>
    </tr>
    <tr>
      <td>second time</td>
      <td>0.58</td>
      <td>1.17</td>
    </tr>
  </tbody>
</table>

<p>We can pursue this later if required.</p>

<p><strong>Going back to xorg and all the same way</strong></p>

<p><a href="https://forums.developer.nvidia.com/t/nvidia-settings-error-unable-to-load-info-from-any-available-system/60804/5">Nvidia forums</a>: <code class="language-plaintext highlighter-rouge">prime-select nvidia</code></p>

<p>works.</p>

<p><strong>Next: So</strong> let‚Äôs add the xconf file back and see what it does. or
modify it ..</p>

<p>If this allows monitor to work, we keep it otherwise we go back with
<code class="language-plaintext highlighter-rouge">prime-select nvidia</code></p>

<p>I want to check out the xconf solution without even modifying any
xconf process.</p>

<p><a href="https://en.wikipedia.org/wiki/Display_server">components of a GUI</a></p>

<p>It‚Äôs too complicated to get other screen to work and get cuda to
run.. Especially for the complete lack of progress I got. so screw
that.</p>

<p><code class="language-plaintext highlighter-rouge">sudo prime-select nvidia</code></p>

<p><strong>Making GPU work faster with libraries</strong></p>

<p>Don‚Äôt know what this does. Blindly followed it</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda uninstall --force jpeg libtiff -y	
conda install -c conda-forge libjpeg-turbo 

CC="cc -mavx2" pip install --no-cache-dir -U --force-reinstall --no-binary :all: --compile pillow-simd
</code></pre></div></div>

<ul>
  <li>
    <p>step 3 in the <a href="https://forums.fast.ai/t/platform-local-server-ubuntu/65851?u=thetj09">link</a></p>
  </li>
  <li>
    <p><a href="https://medium.com/@JamesDietle/install-fast-ai-with-ubuntu-18-04-d92c0bc460bd#id_token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjJjNmZhNmY1OTUwYTdjZTQ2NWZjZjI0N2FhMGIwOTQ4MjhhYzk1MmMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJuYmYiOjE2MDEwMDI0MjEsImF1ZCI6IjIxNjI5NjAzNTgzNC1rMWs2cWUwNjBzMnRwMmEyamFtNGxqZGNtczAwc3R0Zy5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjExMDA3ODMxNzc3MzIxMDQ5MzYyNyIsImVtYWlsIjoidGhldGowOUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiYXpwIjoiMjE2Mjk2MDM1ODM0LWsxazZxZTA2MHMydHAyYTJqYW00bGpkY21zMDBzdHRnLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwibmFtZSI6IlRoZWogS2lyYW4iLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EtL0FPaDE0R2dzVWZyNFFLSk44WEx3ZnEwUXhPOHFRdFhZWlZYRUgwbjBEX0xjMGc9czk2LWMiLCJnaXZlbl9uYW1lIjoiVGhlaiIsImZhbWlseV9uYW1lIjoiS2lyYW4iLCJpYXQiOjE2MDEwMDI3MjEsImV4cCI6MTYwMTAwNjMyMSwianRpIjoiNTUzNTA4YzBjMGU3MWY3M2I1MjJiYjY1ZWRmYTE0MmJlYmU1ZmRiMCJ9.hkA7m2I80iCb5PRQJYxaRfAZ5IjeRgbICbAMHN237J_aVwm4C_mBXfSkp6tFpgqp4JqOMCI_FetqEmlXlimKDvoH1Hfd5hpJ2wmqcs9E1FsLYqQ5nv7ff4RdAHcViJQtSS4ikhTEXNn-s4JkPDNP7FZ70_30Do3A0XOJNAxqUvG-xX2xvgJ56xPAK0sN8FPY6wbhM_y0spvE9r8SDtIsodx3NClzJ9asNjFQqnsjOQjIv3C-46qzSgZQpXIn5mQZSSAzfQYsZOJHQQfQ7ECWjKSZxycCegLlF_cy4L5OtEYYC4aSyrJpmNDh0ylbPtSCaUPq9ELXY81Vc4lcxabxdg">medium post</a> also has the same thing.</p>
  </li>
</ul>

<h3 id="unable-to-reproduce-the-faster-libraries-in-another-env">Unable to reproduce the ‚Äúfaster libraries‚Äù in another env</h3>

<p>Unable to reproduce this in other python environment for
some reason. Don‚Äôt know why‚Ä¶</p>

<p>Based on <a href="conda list -n python3 --export &gt; python3-packages.txt
conda list -n pytorch_p36 --export &gt; pytorch_p36-packages.txt
diff python3-packages.txt pytorch_p36-packages.txt">stack</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda activate fastaicleantest
conda list --json --export &gt; agent18/DS-2020/fastaicleantest.json
conda deactivate

conda actiavte fasaiclean
conda list --json --export &gt; agen18/DS-2020/fasaiclean.json

cd agent18/DS-2020/

diff fastaicleantest.json fastaiclean.jsonw 
</code></pre></div></div>

<p>0 differences found, even with manual conda list. don‚Äôt know where I
screwed up the installation‚Ä¶ or what to do to rectify it.</p>

<h3 id="pil-error">PIL error</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ImportError</span><span class="p">:</span> <span class="n">The</span> <span class="n">_imaging</span> <span class="n">extension</span> <span class="n">was</span> <span class="n">built</span> <span class="k">for</span> <span class="n">another</span> <span class="n">version</span> <span class="n">of</span> <span class="n">Pillow</span> <span class="ow">or</span> <span class="n">PIL</span><span class="p">:</span>
<span class="n">Core</span> <span class="n">version</span><span class="p">:</span> <span class="mf">7.0</span><span class="p">.</span><span class="mf">0.</span><span class="n">post3</span>
<span class="n">Pillow</span> <span class="n">version</span><span class="p">:</span> <span class="mf">7.2</span><span class="p">.</span><span class="mi">0</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda list pil
</code></pre></div></div>

<p>Apparently, ‚ÄúThis is only an installation issue.‚Äù‚Äî<a href="https://stackoverflow.com/a/27804221/5986651">stack</a>.</p>

<p><strong>Uninstalling pillow and pillow-simd</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda uninstall pillow
</code></pre></div></div>

<p>Said yes to everything</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda uninstall pillow-simd
</code></pre></div></div>

<p>Doesn‚Äôt work. It says no:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">(fastaiclean) eghx@eghx-nitro:~/agent18/DS-2020$</span><span class="w"> </span>conda uninstall pillow pillow-smd
<span class="go">Collecting package metadata (repodata.json): done
Solving environment: failed

PackagesNotFoundError: The following packages are missing from the target environment:
  - pillow-smd
</span></code></pre></div></div>

<p>Open jupyter notebook and do the <a href="https://stackoverflow.com/a/60492355/5986651">following</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!pip uninstall -y pillow-simd
</code></pre></div></div>

<p>check with</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda list pil
</code></pre></div></div>

<p>now reinstall it‚Ä¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CC="cc -mavx2" pip install --no-cache-dir -U --force-reinstall --no-binary :all: --compile pillow-simd
</code></pre></div></div>

<p>Was I supposed to install pillow first?</p>

<p>now somehow fastai is missing. :(</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install -c pytorch -c fastai fastai
</code></pre></div></div>

<p>yes to all</p>

<p>OK that nonsense works.</p>

<p><strong>BTW pillow is currently not installed‚Ä¶</strong></p>

<p>Checked timings with the standard file and all seems well.</p>

<h3 id="other-sources-regarding-installation">Other sources regarding installation</h3>

<ul>
  <li>
    <p><a href="https://medium.com/@JamesDietle/install-fast-ai-with-ubuntu-18-04-d92c0bc460bd#id_token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjJjNmZhNmY1OTUwYTdjZTQ2NWZjZjI0N2FhMGIwOTQ4MjhhYzk1MmMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJuYmYiOjE2MDEwMDI0MjEsImF1ZCI6IjIxNjI5NjAzNTgzNC1rMWs2cWUwNjBzMnRwMmEyamFtNGxqZGNtczAwc3R0Zy5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjExMDA3ODMxNzc3MzIxMDQ5MzYyNyIsImVtYWlsIjoidGhldGowOUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiYXpwIjoiMjE2Mjk2MDM1ODM0LWsxazZxZTA2MHMydHAyYTJqYW00bGpkY21zMDBzdHRnLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwibmFtZSI6IlRoZWogS2lyYW4iLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EtL0FPaDE0R2dzVWZyNFFLSk44WEx3ZnEwUXhPOHFRdFhZWlZYRUgwbjBEX0xjMGc9czk2LWMiLCJnaXZlbl9uYW1lIjoiVGhlaiIsImZhbWlseV9uYW1lIjoiS2lyYW4iLCJpYXQiOjE2MDEwMDI3MjEsImV4cCI6MTYwMTAwNjMyMSwianRpIjoiNTUzNTA4YzBjMGU3MWY3M2I1MjJiYjY1ZWRmYTE0MmJlYmU1ZmRiMCJ9.hkA7m2I80iCb5PRQJYxaRfAZ5IjeRgbICbAMHN237J_aVwm4C_mBXfSkp6tFpgqp4JqOMCI_FetqEmlXlimKDvoH1Hfd5hpJ2wmqcs9E1FsLYqQ5nv7ff4RdAHcViJQtSS4ikhTEXNn-s4JkPDNP7FZ70_30Do3A0XOJNAxqUvG-xX2xvgJ56xPAK0sN8FPY6wbhM_y0spvE9r8SDtIsodx3NClzJ9asNjFQqnsjOQjIv3C-46qzSgZQpXIn5mQZSSAzfQYsZOJHQQfQ7ECWjKSZxycCegLlF_cy4L5OtEYYC4aSyrJpmNDh0ylbPtSCaUPq9ELXY81Vc4lcxabxdg">medium post</a> by some pisth</p>
  </li>
  <li>
    <p><a href="https://askubuntu.com/q/1077061/443958">Stack</a>: How do I install NVIDIA and CUDA drivers into Ubuntu?</p>
  </li>
</ul>

<h2 id="power-off-when-sleep-when-gpu-is-full-recovery">power off when sleep when GPU is full (recovery)</h2>

<p><strong>What seems to work with existing config</strong>:</p>

<ul>
  <li>
    <p>sleep/wakeup and shutdown normally</p>
  </li>
  <li>
    <p>If I shut down the gpu by closing the jupyter kernel then all is
good.</p>
  </li>
  <li>
    <p>whether I shutdown the gpu or not I can still shutdown.</p>
  </li>
</ul>

<p><strong>What doesn‚Äôt work with existing config</strong>:</p>

<ul>
  <li>
    <p>when Jupyter finishes running and the gpu is full sleep doesn‚Äôt work</p>
  </li>
  <li>
    <p>It hangs (<code class="language-plaintext highlighter-rouge">C-M-F7/F1</code>) doesn‚Äôt work. It‚Äôs hung I think.</p>
  </li>
</ul>

<h3 id="what-all-i-attempted-before-screwing-up-the-system">What all I attempted before screwing up the system.</h3>

<p>I am tempted to try the following:</p>

<ol>
  <li>
    <p><a href="https://askubuntu.com/questions/1032633/18-04-screen-remains-blank-after-wake-up-from-suspend">18.04 Screen remains blank after wake up from suspend</a></p>

    <ul>
      <li>look into kernels</li>
      <li>remove gdm and go to lightdm? (but I seem to already have lightdm)</li>
      <li>hybrid settings in bios</li>
      <li>install unity-ubuntu-desktop</li>
      <li>nouveau.modeset=0 (but i am not even using nouveau)</li>
    </ul>
  </li>
  <li>
    <p><a href="https://askubuntu.com/questions/882843/system-freeze-after-suspend">System freeze after suspend</a></p>

    <ul>
      <li>switch to lightdm</li>
      <li>do I have hybrid graphics?</li>
    </ul>
  </li>
  <li>
    <p><a href="https://forums.developer.nvidia.com/t/solved-suspend-resuming-and-wakeup-with-nvidia370-28/45282/10">suspend, hibernate issues issues with nvidia</a></p>

    <ul>
      <li>5 steps to do. Maybe try this as it is from nvidia. Doens‚Äôt work
for 18 but might work for 16 I guess.</li>
    </ul>
  </li>
  <li>
    <p>trying to perhaps see the error</p>

    <ul>
      <li>remove quiet splash to see <a href="https://ubuntuforums.org/showthread.php?t=2329042">where the error is</a></li>
    </ul>
  </li>
  <li>
    <p>other blind guesses</p>

    <ul>
      <li><a href="https://askubuntu.com/q/970880/443958">reinstall the driver</a> (Not sure but it is in comments)
        <ul>
          <li>downgrade perhaps (really not sure if this is the direction)</li>
          <li>suggestion of using 390 and 16 seems to work for <a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/69">this
guy</a> (with instructions)</li>
        </ul>
      </li>
      <li>adding no modeset in grub screen?</li>
      <li>changing kernel?</li>
      <li>resetting <a href="https://askubuntu.com/a/804831/443958">monitors before sleeping</a>? <code class="language-plaintext highlighter-rouge">xrandr -s 0</code></li>
    </ul>
  </li>
</ol>

<p>This is ubuntu 16 pertinent.</p>

<ol>
  <li>
    <p><a href="https://stackoverflow.com/questions/54393074/black-screen-after-waking-from-suspend-ubuntu-budgie-18-10">Almost same issue</a></p>

    <ul>
      <li>change powermizer to adaptive is one solution (change it back later)</li>
      <li>
        <p>other unaccepted solution of the same question in <a href="https://askubuntu.com/a/1114748/443958">ask
ubuntu</a> is to change grub to something else‚Ä¶</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  GRUB_CMDLINE_LINUX_DEFAULT="quiet acpi_rev_override=1 acpi_osi=Linux scsi_mod.use_blk_mq=1 nouveau.modeset=0 nouveau.runpm=0 mem_sleep_default=deep"
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p><a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/61">Updating kernel</a> to 4.17?</p>

    <ul>
      <li>update kernel to next version?</li>
      <li>kernel apparently didn‚Äôt do it all for <a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/69">this guy</a> with ubuntu
16 and 4.15 kernel
 -<a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/77"> Another user</a> reporting this is not working for them :(
kernel 4.17</li>
    </ul>
  </li>
</ol>

<p><strong>What all I did:</strong></p>

<ol>
  <li>
    <p>Based on <a href="https://forums.developer.nvidia.com/t/solved-suspend-resuming-and-wakeup-with-nvidia370-28/45282">Nvidia forum</a> added the following to grub and updated grub (sudo grub-update)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> GRUB_CMDLINE_LINUX_DEFAULT="quiet acpi_rev_override=1
 acpi_osi=Linux scsi_mod.use_blk_mq=1 nouveau.modeset=0
 nouveau.runpm=0 mem_sleep_default=deep"
	
 sudo update-grub
	
 sudo gedit /etc/initramfs-tools/modules
	
 nvidia
 nvidia_modeset
 nvidia_uvm
 nvidia_drm
	
 sudo update-initramfs -u -k all
</code></pre></div>    </div>

    <p>Got some warning for this but apprently it doesn‚Äôt mean anything as
 I have an i5 system ‚Äî<a href="https://askubuntu.com/a/832528/443958">Stack</a></p>
  </li>
  <li>
    <p>Didn‚Äôt change kernel as there was no evidence towards it. People
changed to 4.17. Ming is currently 4.15</p>

    <ul>
      <li><a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/63">4.17 but it didn‚Äôt work</a></li>
      <li><a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/77">Another user</a></li>
      <li><a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/69">this guy</a></li>
    </ul>
  </li>
  <li>
    <p>Tried different suspends (<a href="https://askubuntu.com/a/1795/443958">Suspend</a>)</p>
  </li>
  <li>
    <p>Tried downgrading.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo add-apt-repository ppa:graphics-drivers/ppa
 sudo apt update 
</code></pre></div>    </div>

    <p>Selected 384 version.</p>

    <p>It didn‚Äôt allow me to work with pytorch 1.6 so I wanted to go
 back.</p>
  </li>
  <li>
    <p>Tried upgrading back to 430</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo apt-get purge nvidia*
</code></pre></div>    </div>

    <p>Additional drivers tab was all greyed out.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo apt remove nvidia-*  
 sudo apt autoremove  
	
 sudo ubuntu-drivers autoinstall
</code></pre></div>    </div>

    <p>Rebooted to black screen of death (tried <a href="https://askubuntu.com/a/1096038/443958">this</a>) but all seemed
 ok. Added <code class="language-plaintext highlighter-rouge">nomodeset</code> to grub (In hindsight I could have done:
 <code class="language-plaintext highlighter-rouge">nouveau.modeset=0</code> I think).</p>

    <p>As a last step went to <code class="language-plaintext highlighter-rouge">prime select intel</code> and it finally allowed
 me to boot with just intel graphics card. Despite having 430
 installed nothing works with it‚Ä¶</p>

    <p>Again blank screen and then <code class="language-plaintext highlighter-rouge">noveau.modeset=0</code> did the trick</p>
  </li>
  <li>
    <p>did complete re-install of xserver, unity, lightdm and the nvidia drivers</p>
  </li>
</ol>

<p>So far I have one screen working and the gpu not being NVIDIA.</p>

<p>that‚Äôs when I gave up‚Ä¶ Now god forbid I had to recover.</p>

<h3 id="learning-about-the-linux-architechture">Learning about the linux architechture</h3>

<p><strong>What is x-server? X11 Xclient</strong></p>

<p>https://medium.com/mindorks/x-server-client-what-the-hell-305bd0dc857f</p>

<p>https://askubuntu.com/a/264411/443958</p>

<p>Graphical interface/ Display manager:  Unity, Gnome</p>

<p>Protocol between GI and DS: X11, wayland etc‚Ä¶</p>

<p>Display Server: Xorg | window manager: Compiz (resize or postion
window, close minimize etc‚Ä¶)</p>

<p>xorg packages :
https://packages.ubuntu.com/search?keywords=xserver-xorg</p>

<p><code class="language-plaintext highlighter-rouge">sudo apt-get install</code> installs packages and dependences and
recommended.</p>

<p>To remove package we do <code class="language-plaintext highlighter-rouge">sudo apt-get purge</code> or <code class="language-plaintext highlighter-rouge">sudo apt-get remove
--purge</code></p>

<p><strong>Should we use purge or remove ‚Äìpurge or remove</strong></p>

<p>https://askubuntu.com/a/231565/443958</p>

<p><a href="https://askubuntu.com/q/1032633/443958">18.04 Screen remains blank after wake up from suspend</a></p>

<p><strong>What is nomodeset quiet and splash</strong></p>

<p>https://askubuntu.com/questions/1024895/why-do-i-need-to-replace-quiet-splash-with-nomodeset</p>

<p>https://askubuntu.com/questions/747314/is-nomodeset-still-required</p>

<h3 id="recovering-linux-system-from-said-fatality">Recovering linux system from said fatality</h3>

<p><strong>‚Äúre-installing‚Äù xorg, lightdm, unity and then nvidia</strong></p>

<p><strong>Graphical interface/<del>Display manager</del>/Desktop environments</strong>:  Unity, Gnome</p>

<p>Protocol between GI and DS: X11, wayland etc‚Ä¶</p>

<p><strong>Display Server</strong>: Xorg | window manager: Compiz (resize or postion
window, close minimize etc‚Ä¶)</p>

<p><strong>Display manager</strong>: Lightdm or gdm etc‚Ä¶ (starting your login screen)</p>

<p>This has to be my best recovery so far. It took so much time to prep
know the details. But I can say I did it STM. I think I can. Usually I
was so afraid of screwing up the system (rightly so), but now I read
and read and read, see what other‚Äôs advice is, know ‚Äúroughly what the
commands mean‚Äù. And then plan out the commands and jump into it.</p>

<p>Based mainly on <a href="https://askubuntu.com/questions/61396/how-do-i-install-the-nvidia-drivers">How to install Nvidia drivers</a>, <a href="https://askubuntu.com/a/760935/443958">Graphics issues
in 16.04</a> and <a href="https://www.computersnyou.com/4945/re-install-xorg-xserver-completely-ubuntu/">re-installing xorg and xserver</a>, <a href="https://askubuntu.com/a/829110/443958">What is gdm3,
kdm, lightdm? How to install and remove them?</a>.</p>

<p>Went to TTY screen which I invoked before logging in:</p>

<p><strong>X-server and Xorg and Lightdm</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get purge xorg-* "xserver-*"
sudo apt-get purge lightdm
</code></pre></div></div>

<p>Removing dependencies and recommended packages of the purged packages
(if installed with them),</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get auroremove 

sudo apt-get install xorg xserver-xorg
sudo dpkg-reconfigure xorg
</code></pre></div></div>

<p>Configuring lightdm means selecting lightdm instead of gdm</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get lightdm
sudo dpkg-reconfigure lightdm
</code></pre></div></div>

<p>Now unity. So in my system ubuntu-desktop was not installed, instead
only unity was installed but everywhere I found ubuntu-desktop being
included so just added it. A quick search showed that ubuntu-desktop
has it‚Äôs own unity.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get purge ubuntu-desktop
sudo apt-get purge unity

sudo apt-get autoremove

sudo apt-get install unity ubuntu-desktop
</code></pre></div></div>

<p>Re-installing nvidia</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get purge nvidia-*
sudo add-apt-repository ppa:graphics-drivers/ppa

sudo apt-get update
</code></pre></div></div>

<p>To see the recognized drivers and what is the recommended driver etc‚Ä¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu-drivers devices
</code></pre></div></div>

<p>Installs the recommended drivers also can be done manually with <code class="language-plaintext highlighter-rouge">sudo
apt-get install nvidia-430</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo ubuntu-drivers autoinstall
</code></pre></div></div>

<p>We can go and check in the <code class="language-plaintext highlighter-rouge">additional drivers tab</code> later.</p>

<p>The last step I did and probably the most important was to make an
<code class="language-plaintext highlighter-rouge">xorg.conf</code> file. This I somehow had in the previous installation and
<code class="language-plaintext highlighter-rouge">nvidia-xconfig</code> didn‚Äôt bring it back. So I literally copied a back up
and pasted it.</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Section</span> <span class="s2">"ServerLayout"</span>
    <span class="n">Identifier</span> <span class="s2">"layout"</span>
    <span class="n">Screen</span> <span class="m">0</span> <span class="s2">"nvidia"</span>
    <span class="n">Inactive</span> <span class="s2">"intel"</span>
<span class="n">EndSection</span>

<span class="n">Section</span> <span class="s2">"Device"</span>
    <span class="n">Identifier</span> <span class="s2">"intel"</span>
    <span class="n">Driver</span> <span class="s2">"modesetting"</span>
    <span class="n">BusID</span> <span class="s2">"PCI:0@0:2:0"</span>
    <span class="n">Option</span> <span class="s2">"AccelMethod"</span> <span class="s2">"None"</span>
<span class="n">EndSection</span>

<span class="n">Section</span> <span class="s2">"Screen"</span>
    <span class="n">Identifier</span> <span class="s2">"intel"</span>
    <span class="n">Device</span> <span class="s2">"intel"</span>
<span class="n">EndSection</span>

<span class="n">Section</span> <span class="s2">"Device"</span>
    <span class="n">Identifier</span> <span class="s2">"nvidia"</span>
    <span class="n">Driver</span> <span class="s2">"nvidia"</span>
    <span class="n">BusID</span> <span class="s2">"PCI:1@0:0:0"</span>
    <span class="n">Option</span> <span class="s2">"ConstrainCursor"</span> <span class="s2">"off"</span>
<span class="n">EndSection</span>

<span class="n">Section</span> <span class="s2">"Screen"</span>
    <span class="n">Identifier</span> <span class="s2">"nvidia"</span>
    <span class="n">Device</span> <span class="s2">"nvidia"</span>
    <span class="n">Option</span> <span class="s2">"AllowEmptyInitialConfiguration"</span> <span class="s2">"on"</span>
    <span class="n">Option</span> <span class="s2">"IgnoreDisplayDevices"</span> <span class="s2">"CRT"</span>
<span class="n">EndSection</span>
</code></pre></div></div>

<p>That was it. I didn‚Äôt put anything in grub I think.</p>

<p><strong>Check with</strong></p>

<p><code class="language-plaintext highlighter-rouge">nvidia-smi</code></p>

<p>&amp;</p>

<p><code class="language-plaintext highlighter-rouge">nvidia-settings</code></p>

<p>&amp; <code class="language-plaintext highlighter-rouge">aditional drivers tab</code></p>

<p><strong>Result</strong></p>

<p>System works like in the past. the issue with not being able to sleep
when GPU is full is still pending.</p>

<p>There are <a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/2">many people</a>who were not able to solve this on their
system. For some users it was concluded that it was a BIOS issue with
their ASUS systems. Read this entire thread <a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/2">here</a>. So if you can‚Äôt
get it to work. It‚Äôs ok. It‚Äôs alright. We‚Äôre the same and there is no
need to cry.</p>

<h2 id="fastai-functions-not-working">fastai functions not working</h2>

<p>NameError: name ‚Äòwidgets‚Äô is not defined</p>

<p>Is it supposed to be in fastbook?</p>

<p>Why do we need fastbook? What‚Äôs happening?</p>

<p><strong>Where are these functions?</strong></p>

<p><strong>Is it in fastbook</strong></p>

<p>Seems like it‚Ä¶ tried it out on Gradient and I am certain it is this
lack of <code class="language-plaintext highlighter-rouge">fastbook</code> and <code class="language-plaintext highlighter-rouge">graphviz</code></p>

<p><strong>Re-installing until fastai fresh env</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install -c fastai -c pytorch fastai cudatoolkit=10.1.243 gh

conda install -c conda-forge ipywidgets

didn't help
</code></pre></div></div>

<p><strong>Unable to install fastbook via conda install</strong></p>

<p>Also python version seesm to have downgraded to python 3.7 (in
fastaicleantest alone)</p>

<p>It seems like a known issue that <code class="language-plaintext highlighter-rouge">conda instal</code> doesn‚Äôt work whereas
pip works WTF.</p>

<p>1: https://github.com/conda/conda/issues/9868</p>

<p>2: https://github.com/KevinMusgrave/pytorch-metric-learning/issues/55</p>

<p>pip install seems to be the way to go‚Ä¶</p>

<p>Testing‚Ä¶</p>

<p>clean test seems to be distroyed. Won‚Äôt install graphviz</p>

<h2 id="fastai-cuda-not-working-again-">Fastai cuda not working AGAIN :(</h2>

<h2 id="quick-reinstall">Quick reinstall</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install -c fastai -c pytorch fastai cudatoolkit=10.1.243 gh
</code></pre></div></div>

<p>ends up downgrading 3 packages including pythiath</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install -c conda-forge ipywidgets
</code></pre></div></div>

<p>ends up installing new packages</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install -Uqq fastbook
</code></pre></div></div>

<p>0 output</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install graphviz
</code></pre></div></div>

<p>Not tested the last part with <code class="language-plaintext highlighter-rouge">graphviz</code>. While installing
fastaiclean4 I installed graphviz after <code class="language-plaintext highlighter-rouge">gh</code>. And then had problems
with fasiai recognizing that I had installed graphviz. Removed and
reinstalled and all seemed to be goo.</p>

<p>fastaiclean is ok with libtiff steffs</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sometimes I get the fastbook.setup_book() error related to
graphviz... I don't why I get it sometimes and not someother
times. Jesus
</code></pre></div></div>

<p>fastaiclean test is ruined (can‚Äôt recover)</p>

<p>fastaiclean4 is a fresh install without the libtiff steffs.</p>

<p>graphviz still causing issues‚Ä¶ I don‚Äôt know why? it is not
displaying hte pictures via gv‚Ä¶</p>

<h2 id="kaggle-and-tabular-stuff">Kaggle and tabular stuff</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install kaggle -c conda-forge
</code></pre></div></div>

<p>You will need a json file according to the api github‚Ä¶</p>

<blockquote>
  <p>To use the Kaggle API, sign up for a Kaggle account at https://www.kaggle.com. Then go to the ‚ÄòAccount‚Äô tab of your user profile (https://www.kaggle.com/<username>/account) and select 'Create API Token'. This will trigger the download of kaggle.json, a file containing your API credentials. Place this file in the location ~/.kaggle/kaggle.json (on Windows in the location C:\Users\<Windows-username>\.kaggle\kaggle.json - you can check the exact location, sans drive, with echo %HOMEPATH%). You can define a shell environment variable KAGGLE_CONFIG_DIR to change this location to $KAGGLE_CONFIG_DIR/kaggle.json (on Windows it will be %KAGGLE_CONFIG_DIR%\kaggle.json).</Windows-username></username></p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">Create API token</code> in kaggle gives the json file to put in <code class="language-plaintext highlighter-rouge">~/.kaggle/kaggle.json</code>.</p>

<blockquote>
  <p>For your security, ensure that other users of your computer do not
have read access to your credentials. On Unix-based systems you can
do this with the following command:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod 600 ~/.kaggle/kaggle.json
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">dtreeviz</code> package.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install dtreeviz -c conda-forge
</code></pre></div></div>

<h2 id="gpu-full">GPU full</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">RuntimeError</span><span class="p">:</span> <span class="n">CUDA</span> <span class="n">out</span> <span class="n">of</span> <span class="n">memory</span><span class="p">.</span> <span class="n">Tried</span> <span class="n">to</span> <span class="n">allocate</span> <span class="mf">22.00</span> <span class="n">MiB</span> <span class="p">(</span><span class="n">GPU</span> <span class="mi">0</span><span class="p">;</span>
<span class="mf">3.95</span> <span class="n">GiB</span> <span class="n">total</span> <span class="n">capacity</span><span class="p">;</span> <span class="mf">3.01</span> <span class="n">GiB</span> <span class="n">already</span> <span class="n">allocated</span><span class="p">;</span> <span class="mf">19.50</span> <span class="n">MiB</span> <span class="n">free</span><span class="p">;</span>
<span class="mf">3.10</span> <span class="n">GiB</span> <span class="n">reserved</span> <span class="ow">in</span> <span class="n">total</span> <span class="n">by</span> <span class="n">PyTorch</span><span class="p">)</span>
</code></pre></div></div>
<p>Tried changing batch size (bs) as suggested by Jeremy but reducing it
to 32 and 16 didn‚Äôt yield any results.</p>

<p>A possibility could be to try and free up the space in the GPU used by
compiz and Xorg. But it sounds like a bad idea, as it will take tons
of time. I have already spent 1-2 full days on it without any
results. My dual screen wont work and I don‚Äôt know how to get it to
work.</p>

<p>While using the system and the GPU it is impossible to do any work
despite the ram being completely free.</p>

<p>Considering all this, it seems wise to move to paper space. It seems
faster maybe I might have to end up paying money. But that is a choice
i think I can figure out later if necessary.</p>

<p>Sometimes cuda memory becomes full while running the cells fresh‚Ä¶ It
also takes a long time. Unsure how to reduce it at the cost of
accuracy.</p>

<p>So I think for now as paperspace is faster and freer and I don‚Äôt use
emacs anyways‚Ä¶ So I don‚Äôt see the value of trying to get it to work
in my pc. Let‚Äôs move to paperspace. the error I see that made me do
this is:</p>

<h2 id="lesson-1">Lesson 1</h2>

<ol class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Let‚Äôs setup a gpu online first: https://course.fast.ai/start_gradient</p>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Look for GPU usage on PC: https://forums.fast.ai/t/wiki-thread-lesson-1/6825</p>
  </li>
</ol>

<h3 id="resources-1">Resources</h3>

<ul>
  <li>
    <p><a href="https://forums.fast.ai/t/wiki-thread-lesson-1/6825">Lesson wiki</a></p>
  </li>
  <li>
    <p><a href="https://medium.com/@hiromi_suenaga/machine-learning-1-lesson-1-84a1dc2b5236">course notes</a> by someone on medium</p>
  </li>
</ul>

<h3 id="jupiter">Jupiter</h3>

<ul>
  <li>Jupiter with crestle</li>
  <li>aws or PC</li>
  <li>paperspace (have )</li>
</ul>

<h3 id="jupyter-in-emacs">Jupyter in emacs</h3>

<p>https://tkf.github.io/emacs-ipython-notebook/</p>

<h3 id="todo">todo</h3>

<p>setup jupyter on emacs and browser to see how different it is‚Ä¶.</p>

<ul>
  <li>clone fast ai <a href="https://github.com/fastai/fastai">repo</a>, instructions on website‚Ä¶</li>
</ul>

<p>finish this course lecture 1 atleast. seeing it</p>

<ul>
  <li>
    <p>followed by assignmets</p>
  </li>
  <li>
    <p><strong>figure out how to use fast ai (pc or aws or whatever) with
jupyter</strong></p>
  </li>
</ul>

<h2 id="other-useful-links">Other useful links</h2>

<p><a href="https://towardsdatascience.com/managing-project-specific-environments-with-conda-406365a539ab">Managing your data science project environments with Conda</a></p>

<h2 id="question">Question</h2>

<p><strong>Suspend not working after GPU is full</strong></p>

<p>On normal occasions when <code class="language-plaintext highlighter-rouge">xorg</code> and <code class="language-plaintext highlighter-rouge">compiz</code> is running in my gpu, I
can <code class="language-plaintext highlighter-rouge">Suspend</code> peacefully. However if I run some <strong>intense</strong> (90% GPU
in use) training (via jupyter) related to <code class="language-plaintext highlighter-rouge">pytorch</code>, and subsequently
suspend after the processes are over, it refuses to sleep/wakeup.</p>

<p>I am positive GPU being full or not empty is causing the issue. I
don‚Äôt know why ‚Äúsome process‚Äù possibly related to the GPU is not
Suspending. When I run <code class="language-plaintext highlighter-rouge">jupyter</code> and run <code class="language-plaintext highlighter-rouge">1+1</code> (or a simple process)
and <code class="language-plaintext highlighter-rouge">Suspend</code>, then also no issues.</p>

<p><strong>Question</strong></p>

<p>Kernlog shows me nothing ‚Äúfishy‚Äù. I have tried a bunch of online
remedies. Now at a dead end.</p>

<p>How do I identify what is happening? any ideas?</p>

<p><strong>Other symptoms</strong></p>

<p>It sort-of sleeps but I still hear some sound from the laptop when I
hit a key (it sounds as if it is booting up). And then blank screen
after that. Sometimes I get to go to the TTY but can‚Äôt type anything.</p>

<p><strong>What all I tried to rectify this issue?</strong></p>

<p>Spent a good 5 full days understanding and searching and re-installing
etc‚Ä¶ Now at a dead end.</p>

<ol>
  <li>
    <p>Checked the <a href="https://pastebin.com/B1TNtKPt">kern logs (pastebin link)</a> but didn‚Äôt see anything
‚Äúfishy‚Äù. (at <code class="language-plaintext highlighter-rouge">02:08</code> I start sleeping and at <code class="language-plaintext highlighter-rouge">10:21</code> I hit hard
reset).</p>

    <p>Here is a tiny exerpt:</p>
  </li>
</ol>

<pre><code class="language-log">Oct  2 02:08:06 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597286.6443] manager: sleep requested (sleeping: no  enabled: yes)
Oct  2 02:08:06 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597286.6443] manager: sleeping...
Oct  2 02:08:06 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597286.6447] manager: NetworkManager state is now ASLEEP
Oct  2 02:08:06 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597286.6453] device (wlp2s0): state change: activated -&gt; deactivating (reason 'sleeping') [100 110 37]
Oct  2 02:08:06 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597286.8169] device (wlp2s0): state change: deactivating -&gt; disconnected (reason 'sleeping') [110 30 37]
Oct  2 02:08:06 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597286.8356] dhcp4 (wlp2s0): canceled DHCP transaction, DHCP client pid 8328
Oct  2 02:08:06 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597286.8356] dhcp4 (wlp2s0): state changed bound -&gt; done
Oct  2 02:08:06 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597286.8363] dns-mgr: Writing DNS information to /sbin/resolvconf
Oct  2 02:08:06 eghx-nitro kernel: [24100.153393] wlp2s0: deauthenticating from e8:cc:18:41:3c:15 by local choice (Reason: 3=DEAUTH_LEAVING)
Oct  2 02:08:07 eghx-nitro NetworkManager[8152]: &lt;warn&gt;  [1601597287.0509] sup-iface[0xb4a6f0,wlp2s0]: connection disconnected (reason -3)
Oct  2 02:08:07 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597287.0511] device (wlp2s0): supplicant interface state: completed -&gt; disconnected
Oct  2 02:08:07 eghx-nitro NetworkManager[8152]: &lt;info&gt;  [1601597287.0525] device (wlp2s0): state change: disconnected -&gt; unmanaged (reason 'sleeping') [30 10 37]
Oct  2 02:08:08 eghx-nitro kernel: [24101.983885] PM: suspend entry (deep)
Oct  2 02:08:09 eghx-nitro kernel: [24101.983888] PM: Syncing filesystems ... done.
Oct  2 10:21:32 eghx-nitro kernel: [24103.953554] Freezing user space
processes ... (elapsed 0.002 seconds) done.
</code></pre>
<ol>
  <li>
    <p>Based on <a href="https://forums.developer.nvidia.com/t/solved-suspend-resuming-and-wakeup-with-nvidia370-28/45282">Nvidia forum</a> added the following to grub and updated.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> GRUB_CMDLINE_LINUX_DEFAULT="quiet acpi_rev_override=1
 acpi_osi=Linux scsi_mod.use_blk_mq=1 nouveau.modeset=0
 nouveau.runpm=0 mem_sleep_default=deep"
</code></pre></div>    </div>

    <p>Added the following to iniramfs-tools/modules and updated.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> nvidia
 nvidia_modeset
 nvidia_uvm
 nvidia_drm
</code></pre></div>    </div>
  </li>
  <li>
    <p>Didn‚Äôt change kernel as there was no evidence towards it. People
changed to 4.17. Mine is currently 4.15.</p>

    <ul>
      <li><a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/63">4.17 but it didn‚Äôt work</a></li>
      <li><a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/77">Another user</a></li>
      <li><a href="https://forums.developer.nvidia.com/t/problem-with-resume-from-suspend-ubuntu-16-04-gt-940mx/51410/69">this guy</a></li>
    </ul>
  </li>
  <li>
    <p>Blind try: Trying different (<a href="https://askubuntu.com/a/1795/443958">Suspend</a>)s</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> systemctl suspend
   
 pm-suspend
</code></pre></div>    </div>
  </li>
  <li>
    <p>Tried downgrading the drivers to 384 from 430 with changing it at
<code class="language-plaintext highlighter-rouge">additional drivers</code>. This was not useful as this was not capable
of co-existing with <code class="language-plaintext highlighter-rouge">pytorch=1.6.0</code></p>
  </li>
  <li>
    <p>Complete remove and re-install of <code class="language-plaintext highlighter-rouge">nvdia-430</code> as per <a href="https://askubuntu.com/a/760935/443958">here</a>: <br />
<code class="language-plaintext highlighter-rouge">purge</code>, <code class="language-plaintext highlighter-rouge">add-apt-repository ppa:graphics-drivers/ppa</code>, <code class="language-plaintext highlighter-rouge">update</code>
and <code class="language-plaintext highlighter-rouge">autoinstall</code>.</p>

    <p>This ended in the black screen of death. Recovered it with
<code class="language-plaintext highlighter-rouge">noveau.modeset=0</code>. Somehow GPU was not working anymore.</p>
  </li>
  <li>
    <p>At this point did a <a href="https://askubuntu.com/a/760935/443958">complete re-install</a> of <code class="language-plaintext highlighter-rouge">xserver</code>,<code class="language-plaintext highlighter-rouge">unity</code>,
<code class="language-plaintext highlighter-rouge">lightdm</code> and <code class="language-plaintext highlighter-rouge">nvidia-430</code> over tty terminal before login screen.</p>

    <p>This recovered the system to it‚Äôs previous state i.e., <code class="language-plaintext highlighter-rouge">suspend</code>
when GPU full hangs the system.</p>
  </li>
</ol>

<p><strong>My system</strong></p>

<ul>
  <li>Ubuntu 16.04</li>
  <li>Nvidia 1050 GeForce</li>
</ul>
:ET