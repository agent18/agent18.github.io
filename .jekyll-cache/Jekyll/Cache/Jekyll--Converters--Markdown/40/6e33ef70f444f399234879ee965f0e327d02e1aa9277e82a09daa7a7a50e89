I"Ó%<h2 id="r-on-emacs">R on emacs</h2>

<p>Look <a href="/R-installation.html">here for the installation and setup of R on Emacs</a>.</p>

<h3 id="using-r-basics">Using R basics</h3>

<p>To get a console simply do:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M-x R
</code></pre></div></div>

<p>The setup we now want to have is R editor on the left and R console on
the right. Create <code class="language-plaintext highlighter-rouge">testing.R</code> file. Run <code class="language-plaintext highlighter-rouge">C-x 3</code> to split the
window. Go to the other window (<code class="language-plaintext highlighter-rouge">C-x 0</code>). Open the console using <code class="language-plaintext highlighter-rouge">M-x
R</code>. The <a href="https://stats.blogoverflow.com/2011/08/using-emacs-to-work-with-r/">following command</a> will run the file in the console:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C-c C-l
</code></pre></div></div>

<p>Some more helpful configuration things are given in
<a href="https://stats.blogoverflow.com/2011/08/using-emacs-to-work-with-r/">here</a>. This shall be taken into account later if needed.</p>

<p><code class="language-plaintext highlighter-rouge">_</code> key is bound to <code class="language-plaintext highlighter-rouge">&lt;-</code> by default in the <code class="language-plaintext highlighter-rouge">ESS</code>
mode. <code class="language-plaintext highlighter-rouge">ESS-smart-underscore</code> tries to overcome this issue (I have not
yet tested how).</p>

<p>https://stackoverflow.com/questions/15289995/how-to-get-help-in-r</p>

<h3 id="useful-keybindings-shortcuts">Useful Keybindings, shortcuts</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C-c C-v Help for object
</code></pre></div></div>

<p><a href="http://ess.r-project.org/refcard.pdf">Source</a> has lots of other R ESS Emacs Key bindings</p>

<h2 id="r-packages-and-needed-installation">R packages and needed installation</h2>

<p>When R is downloaded from CRAN we get the ‚Äúbase‚Äù R system. Primary
location to obtain</p>

<h3 id="installing-r-packages-required">Installing R packages required</h3>

<p>Packages are usually found on CRAN or Bioconductor Project. More info
on <code class="language-plaintext highlighter-rouge">c1-w2-installing-R-packages</code> file. To install a package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>install.packages("package-name1")
</code></pre></div></div>

<p>It also installs the dependencies automatically.</p>

<p>In case you want to use Bio conductor:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source("http://bioconductor.org/biocLite.R")
biocLite()

biocLite(c("package-name1","package-name2"))
</code></pre></div></div>

<p>You can also install packages directly on RStudio. <code class="language-plaintext highlighter-rouge">Tools --&gt; install
R package</code>.</p>

<p>To load a library use:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(package-name)
</code></pre></div></div>

<p>To look at what functions are there in the library:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>search() ### Installing xlsx 
</code></pre></div></div>

<p>This is particularly painful to get, considering something about my R
version being 3.5.</p>

<p><code class="language-plaintext highlighter-rouge">install.packages(xlsx)</code> will give an error saying you have error with
rJava. In order to install rJava follow the procedure below:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install default-jdk
sudo R CMD javareconf

sudo apt-get install r-cran-rjava
</code></pre></div></div>

<p>This is where you will have more errors something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>the following packages have unmet dependencies:
r-cran-rjava : Depends: r-api-3.4
E: Unable to correct problems, you have held broken packages.
</code></pre></div></div>

<p>So I followed this answer from <a href="https://stackoverflow.com/a/51267282/5986651">stack</a>. Which would the following
on the terminal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo add-apt-repository ppa:marutter/c2d4u3.5
sudo apt-get update
</code></pre></div></div>

<p>Then coming back to the rjava installation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install libgdal-dev libproj-dev
</code></pre></div></div>

<p>And finally in your R console (Rstudio or terminal)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>install.packages("rJava")
</code></pre></div></div>

<p>This followed by <code class="language-plaintext highlighter-rouge">install.packages("xlsx")</code> should do the trick. For
the main installation of <code class="language-plaintext highlighter-rouge">rJava</code> I looked <a href="https://github.com/hannarud/r-best-practices/wiki/Installing-RJava-(Ubuntu)">here</a>.</p>

<h3 id="installing-xml">installing XML</h3>

<p>From <a href="https://stackoverflow.com/a/7765470/5986651">Stack-answer here</a>, Go to terminalR* and do:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get install libxml2-dev
</code></pre></div></div>

<p>followed by <code class="language-plaintext highlighter-rouge">install.packages("XML")</code>. It works!</p>

<p>Sometimes <code class="language-plaintext highlighter-rouge">RCurl</code> might also be needed.</p>

<p>Looks like I broke my R installaiton or 3.5 is unstable?</p>

<h3 id="installing-rcurl">installing RCurl</h3>

<p>from <a href="https://github.com/sagemath/cloud/issues/114#issuecomment-230481254">this answer </a>, go to terminal and do:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install libcurl4-openssl-dev
</code></pre></div></div>

<p>It works! after this.</p>

<h3 id="installing-mysql">installing MySQL</h3>

<p>According to <a href="http://dev.mysql.com/doc/refman/5.7/en/installing.html">here, we can use APT to install</a>, nothing more is
given. So I try based on <a href="https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-16-04">digitalocean</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install mysql-server
</code></pre></div></div>

<p>Running security script,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql_secure_installation
</code></pre></div></div>

<blockquote>
  <p>This will prompt you for the root password you created in Step 1. You
can press Y and then ENTER to accept the defaults for all the
subsequent questions, with the exception of the one that asks if
you‚Äôd like to change the root password. You just set it in Step 1, so
you don‚Äôt have to change it now.</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql_install_db    # before 5.7.6
mysqld --initialize #for 5.7.6
</code></pre></div></div>

<p>You are supposed to get this error:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2016-03-07T20:11:15.998193Z 0 [ERROR] --initialize specified but
the data directory has files in it. Aborting.
</code></pre></div></div>

<p>But I got this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).
</code></pre></div></div>

<p>According to <a href="https://www.fromdual.com/node/1279">fromdual</a>, the suggestion is to just follow the
advice of the error. Some functionality is being deprecated.</p>

<blockquote>
  <p>Our advice is to enable the variable explicit_defaults_for_timestamp
now on your testing systems so you can see if your application behave
well and then you are prepared for the next release when this feature
will become the default.</p>
</blockquote>

<blockquote>
  <p>In short term this warning is NOT dangerous. In the long term you
have to be prepared for the deprecated functionality. You get rid of
the warning my setting explicit_defaults_for_timestamp = 1 in your
my.cnf [mysqld] section.</p>
</blockquote>

<p>You can <a href="https://stackoverflow.com/a/2485758/5986651">find the <code class="language-plaintext highlighter-rouge">my.cnf</code></a> file in the following locations, and in
this order the values override each other:</p>

<ul>
  <li>/etc/my.cnf</li>
  <li>/etc/mysql/my.cnf</li>
  <li>$MYSQL_HOME/my.cnf</li>
  <li>[datadir]/my.cnf</li>
  <li>~/.my.cnf</li>
</ul>

<p>You can also <a href="https://stackoverflow.com/a/2482474/5986651">find your file</a> by</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / -name my.cnf
</code></pre></div></div>

<p>I added the following in /etc/mysql/my.cnf</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[mysqld]
explicit_defaults_for_timestamp = 1
</code></pre></div></div>

<p>Now try</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqld --initialize
</code></pre></div></div>

<p>And I got a reduced error without Timestamp stuff</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqld: Can't create directory '/var/lib/mysql/' (Errcode: 17 - File exists)
2018-11-12T20:13:45.024116Z 0 [ERROR] Aborting
</code></pre></div></div>

<p>Is this good? Not sure so I look deeper. According to this <a href="https://askubuntu.com/a/797696/443958">accepted stack
answer for the error</a> you need to</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -i #log into root
cd /var/lib/mysql
rm -r *

su username  # get back to the original user

mysqld --initialize 
</code></pre></div></div>

<p>This, still gave me the exact same error.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqld: Can't create directory '/var/lib/mysql/' (Errcode: 17 - File exists)
2018-11-12T20:13:45.024116Z 0 [ERROR] Aborting
</code></pre></div></div>

<p>I am not sure the accepted answer helped at all with the removing the
<code class="language-plaintext highlighter-rouge">/var/lib/mysql</code>, but <code class="language-plaintext highlighter-rouge">sudo</code> helped:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mysqld --initialize
</code></pre></div></div>

<p>worked‚Ä¶ No error at all!</p>

<p>Testing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status mysql.service
</code></pre></div></div>

<p>additional check:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqladmin -p -u root version
</code></pre></div></div>

<p>In R,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>install.packages("RMySQL")
</code></pre></div></div>

<h3 id="installing-for-hdf5">installing for hdf5</h3>

<p>This will install packages from Bioconductor http://bioconductor.org/,
primarily used for genomics but also has good ‚Äúbig data‚Äù packages Can
be used to interface with hdf5 data sets.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source("http://bioconductor.org/biocLite.R")
biocLite("rhdf5")
</code></pre></div></div>

<p><a href="https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/02_02_readingHDF5/index.md">Source:jtleek github</a></p>

<h3 id="other-packages-installed">other packages installed</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"plyr", "Hmisc", "reshape","jpeg", "stringr", "lubridate",
"quantmod", "reader", "rafalib","kernlab", "rmarkdown"
</code></pre></div></div>

<h2 id="learning-r">Learning R</h2>

<p>I am currently doing the Data Science Specialization at 40‚Ç¨/month on
Coursera (Course 2: R Programming).</p>

<p>My <a href="https://github.com/agent18/data-science-coursera">DS repository</a> is on github.</p>

<h3 id="r-commands-that-might-be-useful">R commands that might be useful</h3>

<ul>
  <li>
    <p>Useful for discovering new commands</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  help.search("concatenate")
</code></pre></div>    </div>
  </li>
  <li>
    <p>syntax of new commands</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  str(function)
</code></pre></div>    </div>
  </li>
  <li>
    <p>DATE</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  as.Date(Sys.time())
</code></pre></div>    </div>

    <p>Unclass removes all the formatting and stores the date as an
  integer from 1970-01-01.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  unclass(as.Date(Sys.time())
</code></pre></div>    </div>
  </li>
  <li>
    <p>TIME</p>

    <p>Used for storing in data frames</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  p &lt;- as.POSIXct(Sys.time())
  ## [1] "2013-01-24 22:04:14 EST"
  y &lt;- as.POSIXct("2012-10-25 06:00:00", tz = "GMT")
</code></pre></div>    </div>

    <p>Used for getting difference.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  p &lt;- as.POSIXlt(Sys.time())
  p$sec
</code></pre></div>    </div>
  </li>
  <li>
    <p>strptime</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  x &lt;- strptime(datestring, "%B %d, %Y %H:%M")
</code></pre></div>    </div>
  </li>
  <li>
    <p>factor, table, attr</p>
  </li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"yes"</span><span class="p">,</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">,</span><span class="w"> </span><span class="s2">"no"</span><span class="p">,</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">,</span><span class="w"> </span><span class="s2">"no"</span><span class="p">))</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="n">yes</span><span class="w"> </span><span class="n">yes</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">yes</span><span class="w"> </span><span class="n">no</span><span class="w">
</span><span class="n">Levels</span><span class="o">:</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></code></pre></div></div>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">attr</span><span class="p">(,</span><span class="s2">"levels"</span><span class="p">)</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"no"</span><span class="w"> </span><span class="s2">"yes"</span><span class="w">
</span></code></pre></div></div>
<ul>
  <li>
    <p>Missing values</p>

    <ul>
      <li>is.na(); could be integer NA or character NA</li>
      <li>is.nan(); NA is not NAN, but Nan is also NA</li>
    </ul>
  </li>
  <li>
    <p>clear variable space based on <a href="https://stackoverflow.com/questions/11579765/how-to-clean-up-r-memory-without-the-need-to-restart-my-pc">this stack question</a></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  rm(list=ls())
</code></pre></div>    </div>
  </li>
  <li>
    <p>str</p>

    <p>Gives one line info about a function. Compactly displaying large lists</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  str(x)
  num [1:100] -1.87 -2.51 7.07 -1.93 3.53 ...

  &gt; f &lt;- gl(40,10)
  &gt; str(f)
  Factor w/ 40 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1
</code></pre></div>    </div>

    <p>str is really useful to get quick info on structure of object.</p>
  </li>
  <li>
    <p>summary</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  summary(x)
  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  -8.560  -1.445   1.225   1.583   4.454  13.904 
</code></pre></div>    </div>
  </li>
  <li>
    <p>loading and unloading libraries (<a href="https://stackoverflow.com/a/38416975/5986651">source)</a></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  library(library_name_not_in_courts)
  detach("package:RMySQL", unload=TRUE)
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="calculating-memory">Calculating memory</h3>

<p>According to <a href="https://stackoverflow.com/a/25675555/5986651">stack and the coursera course</a>,</p>

<blockquote>
  <p>memory required = no. of column * no. of rows * 8 bytes/numeric</p>

  <p>so for example if you have 1,500,00 rows and 120 column you will
need more than 1.34 GB of spare memory required</p>
</blockquote>

<h3 id="loop-functions">Loop functions</h3>

<ul>
  <li>
    <p>apply</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  rowSums = apply(x, 1, sum)
  rowMeans = apply(x, 1, mean)
  colSums = apply(x, 2, sum)
  colMeans = apply(x, 2, mean)
</code></pre></div>    </div>
  </li>
  <li>
    <p>lapply (list): takes a list and applies a function over every element. Example to get the first column of each matrix in the list:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  lapply(x, function(elt) elt[,1])
</code></pre></div>    </div>
  </li>
  <li>sapply: simplifying output of lapply</li>
  <li>mapply (list): <code class="language-plaintext highlighter-rouge">mapply(fun,variable_1_range,variable_2_range,...)</code></li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="n">mapply</span><span class="p">(</span><span class="n">rnorm</span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">))</span><span class="w">
</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="m">3.310842</span><span class="w">

</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="m">3.369922</span><span class="w"> </span><span class="m">3.665328</span><span class="w">

</span><span class="p">[[</span><span class="m">3</span><span class="p">]]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="m">3.917087</span><span class="w"> </span><span class="m">4.670286</span><span class="w"> </span><span class="m">3.666672</span><span class="w">
</span></code></pre></div></div>
<ul>
  <li>
    <p>tapply (list) : X has to be a vector; be careful</p>

    <p><code class="language-plaintext highlighter-rouge">tapply(X, level&amp;index, function)</code>/ <code class="language-plaintext highlighter-rouge">lapply(split(x,
f), mean)</code></p>
  </li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">),</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">10</span><span class="p">),</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gl</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="p">[</span><span class="m">24</span><span class="p">]</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="n">Levels</span><span class="o">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="m">1</span><span class="w">
</span><span class="m">2</span><span class="w">
</span><span class="m">3</span><span class="w">
</span><span class="m">0.1144464</span><span class="w"> </span><span class="m">0.5163468</span><span class="w"> </span><span class="m">1.2463678</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>
    <p>split: <code class="language-plaintext highlighter-rouge">split(dataframe, dataframe$month)</code></p>

    <ul>
      <li>
        <p>Splitting more than one level can be done using interaction</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  interaction(gl(2,5), gl(5,2))
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h3 id="examples-using-loop-functions">Examples using Loop functions</h3>

<ol>
  <li>
    <p>There will be an object called ‚Äòiris‚Äô in your workspace. In this
dataset, what is the mean of ‚ÄòSepal.Length‚Äô for the species virginica?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> library(datasets)
 data(iris)
</code></pre></div>    </div>

    <p>The answer is got by:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> iris$Sepal.Length[iris$Sp=="virginica"]
	
 mean(iris$Sepal.Length[101:150])
	
 s &lt;- split(iris,iris$Speci)
 lappy(s,function(x) mean(x[,"Sepal.Length"]))
</code></pre></div>    </div>

    <p>sapply will simplify the results into a data frame which is cool</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> s &lt;- split(iris,iris$Speci)
 sapply(s,function(x) mean(x[,"Sepal.Length"]))
</code></pre></div>    </div>

    <p>tapply cannot be used as X needs to be an atomic vector, not
 DataFrame, not list, but an <a href="http://arrgh.tim-smith.us/atomic.html">atomic vector</a>. But you can use it
 like this:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> tapply(iris$Sepal.Length,iris$Sp,mean)
</code></pre></div>    </div>

    <p>with <code class="language-plaintext highlighter-rouge">with</code>: Need to use full names of columns!</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> with(iris,tapply(Sepal.Length,Species,mean))
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="debugging">Debugging</h3>

<p>Mostly you wont need them or you can get much far without using them</p>

<blockquote>
  <p>Actually, I was using R for 6 years and didn‚Äôt know about any of
these functions - the teacher from Coursera</p>
</blockquote>

<ul>
  <li>
    <p>traceback: Which function call you are in and where error occured</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  traceback()
</code></pre></div>    </div>
  </li>
  <li>
    <p>debug: You say <code class="language-plaintext highlighter-rouge">debug(mean)</code> in your code and any time <code class="language-plaintext highlighter-rouge">mean()</code> is
executed, it will stop at the first line and allow you to go line by
line in a <code class="language-plaintext highlighter-rouge">browser</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  debug(mean)
</code></pre></div>    </div>
  </li>
  <li>
    <p>browser: In the console window you get this browser which doesn‚Äôt
need much explanation</p>
  </li>
  <li>
    <p>trace : allows you to insert debugging code into a function a specific places</p>
  </li>
  <li>
    <p>recover : allows you to modify the error behavior so that you can
browse the function call stack <em>at the actual point of the error
happening</em>. More importantly,</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  options(error=recover)
  options(error=NULL)
</code></pre></div>    </div>

    <p>This will get you to the line just before the error gets
  triggered, and you can do somethings from there, what exactly you
  can do is not fully clear.</p>
  </li>
</ul>

<h3 id="functions">Functions</h3>

<ul>
  <li>
    <p>Lazy evaluation happens with functions where it returns and prints
the last line, i.e.,</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  f &lt;- function(a, b) {
      a^2
  }
  f(2)    
</code></pre></div>    </div>

    <p>In case you don‚Äôt want to print the returned value then use
  <code class="language-plaintext highlighter-rouge">invisible(a^2)</code> for example.</p>
  </li>
  <li>
    <p>Argument matching happens based on</p>

    <ul>
      <li>Check for exact match for a named argument</li>
      <li>Check for a partial match</li>
      <li>Check for a positional match</li>
    </ul>
  </li>
  <li>
    <p>you can also pass <code class="language-plaintext highlighter-rouge">...</code> as arguments, which will be passed on!</p>
  </li>
</ul>

<h3 id="static-or-lexical-scoping">Static or lexical scoping</h3>

<ul>
  <li>Basically it looks for the variable in the environment in which the
function was defined. functions can be defined in either the global
environment or the function environment.</li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w">
	</span><span class="n">y</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>f(3) is 34.</p>

<p>As explained <a href="https://darrenjw.wordpress.com/2011/11/23/lexical-scope-and-function-closures-in-r/">here</a> in better detail. Consider:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="w">
</span><span class="n">b</span><span class="o">=</span><span class="m">2</span><span class="w">
</span><span class="n">f</span><span class="o">&lt;-</span><span class="k">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">g</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Here <code class="language-plaintext highlighter-rouge">g=f(2,1)</code> <strong>returns</strong> a function which looks like:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">

	</span><span class="m">2</span><span class="o">*</span><span class="n">x</span><span class="m">+1</span><span class="w">
	
	</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This is what happens in Lexical scoping.</p>

<h3 id="-">‚Äù¬´-‚Äú</h3>

<p>Apparently <code class="language-plaintext highlighter-rouge">&lt;&lt;-</code> this is used:</p>

<blockquote>
  <p>The operators ‚Äò¬´-‚Äô and ‚Äò-¬ª‚Äô are normally only used in functions,
and cause a search to be made through parent environments for an
existing definition of the variable being assigned.  If such a
variable is found (and its binding is not locked) then its value
is redefined, otherwise assignment takes place in the global
environment. ‚Äìfrom the help</p>
</blockquote>

<p>As said above, which is absolutely not clear, unless you read the
greatest explanation of all time, i.e., the man page. The basics of
Lexical scoping is fine. So when you have a function(parent) inside a
function(child), then the child inherits the variables defined in the
parent. <a href="https://darrenjw.wordpress.com/2011/11/23/lexical-scope-and-function-closures-in-r/">I.e.</a>,</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="w">
</span><span class="n">b</span><span class="o">=</span><span class="m">2</span><span class="w">
</span><span class="n">f</span><span class="o">&lt;-</span><span class="k">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">g</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>But, say you want to modify the parent variables from within the child
function, then you have to use <code class="language-plaintext highlighter-rouge">&lt;&lt;-</code> to gain access to modify the
parent variables. I.e., the example below from the R man page on
Scope. Excellent example, and description. Copied verbatim for future
direct reference.</p>

<blockquote>
  <p>The special assignment operator, ¬´-, is used to change the value
associated with total. This operator looks back in enclosing
environments for an environment that contains the symbol total and
when it finds such an environment it replaces the value, in that
environment, with the value of right hand side. If the global or
top-level environment is reached without finding the symbol total
then that variable is created and assigned to there. For most users
¬´- creates a global variable and assigns the value of the right hand
side to it23. Only when ¬´- has been used in a function that was
returned as the value of another function will the special behavior
described here occur.</p>
</blockquote>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">open.account</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nf">list</span><span class="p">(</span><span class="w">
    </span><span class="n">deposit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="k">if</span><span class="p">(</span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
        </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Deposits must be positive!\n"</span><span class="p">)</span><span class="w">
      </span><span class="n">total</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">amount</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="s2">"deposited.  Your balance is"</span><span class="p">,</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n\n"</span><span class="p">)</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="n">withdraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="k">if</span><span class="p">(</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w">
        </span><span class="n">stop</span><span class="p">(</span><span class="s2">"You don't have that much money!\n"</span><span class="p">)</span><span class="w">
      </span><span class="n">total</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">amount</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="s2">"withdrawn.  Your balance is"</span><span class="p">,</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n\n"</span><span class="p">)</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Your balance is"</span><span class="p">,</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n\n"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">ross</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">open.account</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">robert</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">open.account</span><span class="p">(</span><span class="m">200</span><span class="p">)</span><span class="w">

</span><span class="n">ross</span><span class="o">$</span><span class="n">withdraw</span><span class="p">(</span><span class="m">30</span><span class="p">)</span><span class="w">
</span><span class="n">ross</span><span class="o">$</span><span class="n">balance</span><span class="p">()</span><span class="w">
</span><span class="n">robert</span><span class="o">$</span><span class="n">balance</span><span class="p">()</span><span class="w">

</span><span class="n">ross</span><span class="o">$</span><span class="n">deposit</span><span class="p">(</span><span class="m">50</span><span class="p">)</span><span class="w">
</span><span class="n">ross</span><span class="o">$</span><span class="n">balance</span><span class="p">()</span><span class="w">
</span><span class="n">ross</span><span class="o">$</span><span class="n">withdraw</span><span class="p">(</span><span class="m">500</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<p>The following example shows more meaning about <code class="language-plaintext highlighter-rouge">&lt;&lt;-</code> from <a href="https://stackoverflow.com/a/2630222/5986651">this </a>
stack answer.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">new_counter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># do something useful, then ...</span><span class="w">
    </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w">
    </span><span class="n">i</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">counter_one</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">new_counter</span><span class="p">()</span><span class="w">
</span><span class="n">counter_two</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">new_counter</span><span class="p">()</span><span class="w">

</span><span class="n">counter_one</span><span class="p">()</span><span class="w"> </span><span class="c1"># -&gt; [1] 1</span><span class="w">
</span><span class="n">counter_one</span><span class="p">()</span><span class="w"> </span><span class="c1"># -&gt; [1] 2</span><span class="w">
</span><span class="n">counter_two</span><span class="p">()</span><span class="w"> </span><span class="c1"># -&gt; [1] 1</span><span class="w">
</span></code></pre></div></div>

<h3 id="probability-distributions">Probability distributions</h3>

<blockquote>
  <p>Every distribution that R handles has four functions. There is a root
name, for example, the root name for the normal distribution is
norm. This root is prefixed by one of the letters</p>
</blockquote>

<blockquote>
  <ul>
    <li>p for ‚Äúprobability‚Äù, the cumulative distribution function (c. d. f.)</li>
    <li>q for ‚Äúquantile‚Äù, the inverse c. d. f.</li>
    <li>d for ‚Äúdensity‚Äù, the density function (p. f. or p. d. f.)</li>
    <li>r for ‚Äúrandom‚Äù, a random variable having the specified distribution
‚Äî <a href="http://www.stat.umn.edu/geyer/old/5101/rlook.html">Random website</a></li>
  </ul>
</blockquote>

<blockquote>
  <p>For the normal distribution, these functions are pnorm, qnorm, dnorm,
and rnorm. For the binomial distribution, these functions are pbinom,
qbinom, dbinom, and rbinom. And so forth.</p>

  <p>For a continuous distribution (like the normal), the most useful
functions for doing problems involving probability calculations are
the ‚Äúp‚Äù and ‚Äúq‚Äù functions (c. d. f. and inverse c. d. f.), because
the the density (p. d. f.) calculated by the ‚Äúd‚Äù function can only
be used to calculate probabilities via integrals and R doesn‚Äôt do
integrals.</p>

  <p>For a discrete distribution (like the binomial), the ‚Äúd‚Äù function
calculates the density (p. f.), which in this case is a probability</p>

  <p>f(x) = P(X = x) and hence is useful in calculating probabilities.
‚Äî <a href="http://www.stat.umn.edu/geyer/old/5101/rlook.html">Random website</a></p>
</blockquote>

<p>Distributions‚Äô are Normal, Poisson, binomial etc‚Ä¶</p>

<ul>
  <li>
    <p>dnorm: gives the <a href="https://www.khanacademy.org/math/statistics-probability/random-variables-stats-library/random-variables-continuous/v/probability-density-functions">probability density function</a>, i.e., p.d.f,
which is the value of probability for a given range of x, in P(~x)=F(x)</p>
  </li>
  <li>
    <p>pnorm: gives F(x) in P(X&lt;=x)=F(x) i.e., c.d.f cumulative
distribution function</p>
  </li>
  <li>
    <p>qnorm: gives x for a given P. based on x=F(P)^(-1) i.e., i.c.d.f,
inverse cumulative distribution function</p>
  </li>
  <li>
    <p>rnorm: gives random variables in that distribution for given mean
and standard deviation.</p>
  </li>
</ul>

<h3 id="lists">Lists</h3>
<p><strong>Quick aside - lists</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mylist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="nb">letters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">),</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$letters
[1] "A" "b" "c"

$numbers
[1] 1 2 3

[[3]]
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    6   11   16   21
[2,]    2    7   12   17   22
[3,]    3    8   13   18   23
[4,]    4    9   14   19   24
[5,]    5   10   15   20   25
</code></pre></div></div>

<p><a href="http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%203.pdf">http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%203.pdf</a></p>

<p><strong>Quick aside - lists</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mylist</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$letters
[1] "A" "b" "c"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mylist</span><span class="o">$</span><span class="nb">letters</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "A" "b" "c"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mylist</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "A" "b" "c"
</code></pre></div></div>

<p><a href="http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%203.pdf">http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%203.pdf</a></p>

<p><a href="https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/04_01_editingTextVariables/index.md">Source</a></p>

<h3 id="dataframe">Dataframe</h3>

<ul>
  <li>
    <p>reading data with header column (default)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  outcome &lt;- read.csv("outcome-of-care-measures.csv", colClasses
  = "character")
  head(outcome)
</code></pre></div>    </div>
  </li>
  <li>
    <p>quick look at data</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  str(outcome[,11:16])
  head(outcome[,11])
  nrow(outcome)
  ncol(coucome)
  names(outcome)
</code></pre></div>    </div>
  </li>
  <li>
    <p>important need to actively remove NA if doing something like this:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  dim(data[data$val==24,1])
</code></pre></div>    </div>
  </li>
</ul>

<p>otherwise NA is also counted for some stupid reason!</p>

<h3 id="datatable">DataTable</h3>

<ul>
  <li>
    <p>Much, <strong>much faster</strong> at creating sub-setting, group, and updating
than DataFrame it appears.</p>
  </li>
  <li>
    <p>All functions that accept data.frame work on data.table</p>
  </li>
  <li>
    <p>creation (simple installation)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  library(data.table)
  DT =
  data.table(x=rnorm(9),y=rep(c("a","b","c"),each=3),z=rnorm(9))
</code></pre></div>    </div>
  </li>
  <li>
    <p>read and write table</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  write.table(big_df, file=file, row.names=FALSE, col.names=TRUE, sep="\t", quote=FALSE)
  system.time(fread(file))
</code></pre></div>    </div>
  </li>
  <li>
    <p>Sub-setting columns</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DT[,c(2,3)]
</code></pre></div>    </div>
  </li>
  <li>
    <p>subsetting rows</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DT[c(2,3),]
  DT[c(2,3),]
</code></pre></div>    </div>
  </li>
  <li>
    <p>and difference between DF and DT</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DF[c(2,3)]!=DT[c(2,3)]
</code></pre></div>    </div>

    <ul>
      <li>If only the first argument is present <code class="language-plaintext highlighter-rouge">DF[c(2,3)]</code> gives
columns. <strong>and <code class="language-plaintext highlighter-rouge">DT[c(2,3)]</code> gives ROWS</strong></li>
    </ul>
  </li>
  <li>
    <p>Functions on columns</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DT[,list(mean(x), sum(z))]
</code></pre></div>    </div>

    <p>Result is still a DT.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DT[,table(y)]
</code></pre></div>    </div>
  </li>
  <li>
    <p>Adding new columns</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DT[,w:=z^2]
  DT[,m:= {tmp &lt;- (x+z); log2(tmp+5)}]
  DT[,a:=x&gt;0]
</code></pre></div>    </div>

    <ul>
      <li>
        <p>function <code class="language-plaintext highlighter-rouge">by</code>/based the column ‚Äòa‚Äô. A can be boolean, character
  (these make most sense, but probably even number can be used)</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DT[,b:= mean(x+w),by=a]
</code></pre></div>        </div>
      </li>
      <li>
        <p>counting elements based on a factor</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DT[,.N, by=x]
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>setting key helps in merging</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DT1 &lt;- data.table(x=c('a', 'a', 'b', 'dt1'), y=1:4)
  DT2 &lt;- data.table(x=c('a', 'b', 'dt2'), z=5:7)
  setkey(DT1, x); setkey(DT2, x)
  merge(DT1, DT2)
</code></pre></div>    </div>

    <p>Merge happens based on X</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     x y z
  1: a 1 5
  2: a 2 5
  3: b 3 6
</code></pre></div>    </div>
  </li>
  <li>
    <p>help</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  The latest development version contains new functions like melt and dcast for data.tables https://r-forge.r-project.org/scm/viewvc.php/pkg/NEWS?view=markup&amp;root=datatable Here is a list of differences between data.table and data.frame http://stackoverflow.com/questions/13618488/what-you-can-do-with-data-frame-that-you-cant-in-data-table Notes based on Raphael Gottardo's notes https://github.com/raphg/Biostat-578/blob/master/Advanced_data_manipulation.Rpres, who got them from Kevin Ushey.
</code></pre></div>    </div>
  </li>
</ul>

<p>^^copied from
<a href="https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/01_09_dataTable/index.md">https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/01_09_dataTable/index.md</a></p>

<h3 id="expressions">expressions</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
x = 1
y = 2
}
k = {print(10); 5}
print(k)

[1] 10
[2] 5
</code></pre></div></div>

<h2 id="handling-different-data">Handling different Data</h2>

<ul>
  <li>popular databases where data is stored SQL, MongoDB.</li>
</ul>

<h3 id="file-downloading-directory">file, downloading, directory</h3>
<ul>
  <li>
    <p>geting and setting working directory</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  getwd() 
  setwd()
</code></pre></div>    </div>
  </li>
  <li>
    <p>does file exist or not</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  file.exists("directoryName")
  dir.create("directoryName")

  if (!file.exists("data")){
      dir.create("data")
      }
</code></pre></div>    </div>
  </li>
  <li>
    <p>downloading a file from the internet</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  download.file(fileUrl, destfile="./data/camera.csv", method="curl")
  list.files("./data")
</code></pre></div>    </div>
  </li>
  <li>
    <p>keep track of dateDownloaded</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  dateDownloaded &lt;- date()
</code></pre></div>    </div>
  </li>
  <li>
    <p>tab separated files or just normal text files with data are very
well automatically loaded with this command.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  read.table("") 
</code></pre></div>    </div>
  </li>
  <li>
    <p>comma separated with <code class="language-plaintext highlighter-rouge">header=true</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  read.csv("")
  read.table("", sep="", header=TRUE)
</code></pre></div>    </div>

    <ul>
      <li>
        <p>other parameters that might be useful:</p>

        <ul>
          <li>
            <p>quote: tell r whetehre there are quoted values <code class="language-plaintext highlighter-rouge">quote=""</code>
means no quotes</p>
          </li>
          <li>na.strings: set character that represents a missing value</li>
          <li>nrows: how many rows to read from the top</li>
          <li>skip: how many rows to skip from the top</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="read-and-write-text-files-large-files-small-files">Read and write text files large files small files</h3>

<p>https://rpubs.com/msundar/large_data_analysis</p>

<p>Have a look!</p>

<h3 id="fixed-width-files-fwf">fixed width files fwf</h3>
<p>According to this <a href="https://stackoverflow.com/questions/14383710/read-fixed-width-text-file">stack which is a question directly from
coursera</a>, <code class="language-plaintext highlighter-rouge">read.fwf</code> is a function used to clean a fixed width
file.</p>

<p>The same thing can be done in several ways:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w">

</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_fwf</span><span class="p">(</span><span class="w">
  </span><span class="n">file</span><span class="o">=</span><span class="s2">"http://www.cpc.ncep.noaa.gov/data/indices/wksst8110.for"</span><span class="p">,</span><span class="w">   
  </span><span class="n">skip</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w">
  </span><span class="n">fwf_widths</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.fwf</span><span class="p">(</span><span class="w">
  </span><span class="n">file</span><span class="o">=</span><span class="n">url</span><span class="p">(</span><span class="s2">"http://www.cpc.ncep.noaa.gov/data/indices/wksst8110.for"</span><span class="p">),</span><span class="w">
  </span><span class="n">skip</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w">
  </span><span class="n">widths</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>‚Äô-‚Äò in -1 removes the columns quickly.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.fwf</span><span class="p">(</span><span class="w">
  </span><span class="n">file</span><span class="o">=</span><span class="n">url</span><span class="p">(</span><span class="s2">"http://www.cpc.ncep.noaa.gov/data/indices/wksst8110.for"</span><span class="p">),</span><span class="w">
  </span><span class="n">widths</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">-5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">-5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">-5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">-5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w">
  </span><span class="n">skip</span><span class="o">=</span><span class="m">4</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readLines</span><span class="p">(</span><span class="n">con</span><span class="o">=</span><span class="n">url</span><span class="p">(</span><span class="s2">"http://www.cpc.ncep.noaa.gov/data/indices/wksst8110.for"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Skip 4 lines</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)]</span><span class="w">

</span><span class="n">mydata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w">
                     </span><span class="n">var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="m">19</span><span class="p">),</span><span class="w">
                     </span><span class="n">var3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">23</span><span class="p">),</span><span class="w">
                     </span><span class="n">var4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">29</span><span class="p">,</span><span class="w"> </span><span class="m">32</span><span class="p">)</span><span class="w">  </span><span class="c1"># and so on and so on</span><span class="w">
                     </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>However, having the header is a problem. Accorrding to <code class="language-plaintext highlighter-rouge">?read.fwf</code>
when using the <code class="language-plaintext highlighter-rouge">header</code> argument, you also need the <code class="language-plaintext highlighter-rouge">sep</code> argument.</p>

<p>The problem is discussed <a href="https://stackoverflow.com/questions/21592616/error-in-read-fwf-when-header-true">here</a>. If necessary the header and the content
can be separately attached. or go to the extent of modifying the data
to have useless delimiters.</p>

<h3 id="excel">Excel</h3>

<ul>
  <li>installation was fucking intense. Look in the above sections for it.</li>
  <li>
    <p>reading excel files uses package <code class="language-plaintext highlighter-rouge">xlsx</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  library(xlsx)
  read.xlsx("./data.xlsx", sheetIndex=1,
  header=TRUE,colIndex=7:15, rowIndex=18:23)
</code></pre></div>    </div>
  </li>
  <li>
    <p>writing</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  write.xlsx
</code></pre></div>    </div>
  </li>
  <li>
    <p>tips</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">read.xlsx2</code> faster but unstable for subsets than <code class="language-plaintext highlighter-rouge">read.xlsx</code></p>
      </li>
      <li>
        <p>XLConnect package has more options for manipulating Excel data.</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="xml">XML</h3>

<ul>
  <li>example of XML <a href="www.w3schools.com/xml/simple.xml">from w3schools</a></li>
</ul>

<pre><code class="language-XML">&lt;breakfast_menu&gt;
&lt;food&gt;
&lt;name&gt;Belgian Waffles&lt;/name&gt;
&lt;price&gt;$5.95&lt;/price&gt;
&lt;description&gt;
Two of our famous Belgian Waffles with plenty of real maple syrup
&lt;/description&gt;
&lt;calories&gt;650&lt;/calories&gt;
&lt;/food&gt;
&lt;food&gt;
&lt;name&gt;Strawberry Belgian Waffles&lt;/name&gt;
&lt;price&gt;$7.95&lt;/price&gt;
&lt;description&gt;
Light Belgian waffles covered with strawberries and whipped cream
&lt;/description&gt;
&lt;calories&gt;900&lt;/calories&gt;
&lt;/food&gt;
</code></pre>
<ul>
  <li>
    <p>for installation look in above sections on installing
packages. Some work needs to be done for this package and it takes
10-15 mins to install!</p>
  </li>
  <li>
    <p>Reding the file library is <code class="language-plaintext highlighter-rouge">XML</code>. The following <strong>does not work</strong>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  library(XML)
  fileUrl &lt;- "http://www.w3schools.com/xml/simple.xml"
  doc &lt;- xmlTreeParse(fileUrl,useInternal=TRUE)
  rootNode &lt;- xmlRoot(doc)
  xmlName(rootNode)
	
  [1] "breakfast_menu"

  names(rootNode)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Reading the file; file library is ‚ÄòXML‚Äô, from 
<a href="https://stackoverflow.com/a/23584617/5986651">this stack answer </a> and not the DSS course from coursera!</p>
  </li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">XML</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RCurl</span><span class="p">)</span><span class="w">
</span><span class="n">fileURL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://www.w3schools.com/xml/simple.xml"</span><span class="w">
</span><span class="n">xData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getURL</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span><span class="w">
</span><span class="n">doc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xmlParse</span><span class="p">(</span><span class="n">xData</span><span class="p">)</span><span class="w">
</span><span class="n">rootNode</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">xmlRoot</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Also this works from the discussion formus of Coursera</li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="w"> </span><span class="p">(</span><span class="n">XML</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span><span class="w">
</span><span class="n">fileUrl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"http://www.w3schools.com/xml/simple.xml"</span><span class="w">
</span><span class="n">doc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xmlTreeParse</span><span class="p">(</span><span class="n">GET</span><span class="p">(</span><span class="n">fileUrl</span><span class="p">),</span><span class="n">useInternal</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">rootNode</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xmlRoot</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">doc</code> variable has all the text in the xml file. <code class="language-plaintext highlighter-rouge">rootNode</code> has only the relevant XML info.</p>

<ul>
  <li>
    <p>extracting info from <code class="language-plaintext highlighter-rouge">rootNode</code> or <code class="language-plaintext highlighter-rouge">xmlRoot(doc)</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  xmlName(rootNode)

  names(rootNode)

	
  rootNode[[1]]

	
  &lt;food&gt;
  &lt;name&gt;Belgian Waffles&lt;/name&gt;
  &lt;price&gt;$5.95&lt;/price&gt;
  &lt;description&gt;Two of our famous Belgian Waffles with plenty of real maple syrup&lt;/description&gt;
  &lt;calories&gt;650&lt;/calories&gt;
  &lt;/food&gt; 

  rootNode[[1]][[1]]


  &lt;name&gt;Belgian Waffles&lt;/name&gt; 
	
  xmlSApply(rootNode,xmlValue)
	
	
  "Belgian Waffles$5.95Two of our famous Belgian Waffle ...
</code></pre></div>    </div>
  </li>
  <li>
    <p>XPath is the language of XML or something like that. The following
can be used to extract info from <code class="language-plaintext highlighter-rouge">rootNode</code>:</p>

    <ul>
      <li>/node Top level node</li>
      <li>//node Node at any level</li>
      <li>node[@attr-name] Node with an attribute name</li>
      <li>
        <p>node[@attr-name=‚Äôbob‚Äô] Node with attribute name attr-name=‚Äôbob‚Äô</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  xpathSApply(rootNode,"//price",xmlValue)
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>Another example for XPath extraction based on
[http://espn.go.com/nfl/team/<em>/name/bal/baltimore-ravens](http://espn.go.com/nfl/team/</em>/name/bal/baltimore-ravens)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  fileUrl &lt;-
  "http://espn.go.com/nfl/team/_/name/bal/baltimore-ravens"
  doc &lt;- htmlTreeParse(rawToChar(GET(url)$content),
  useInternalNodes = TRUE)
  xpathSApply(doc, "//title", xmlValue)
  xpathSApply(doc,"//div[@class='score']",xmlValue)
  teams &lt;- xpathSApply(doc,"//div[@class='team-name']",xmlValue)
</code></pre></div>    </div>
  </li>
</ul>

<p>Even if http moved to https it can handle. Another example is as
follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(XML)
library(httr)
url &lt;- "http://scholar.google.com/citations?user=HI-I6C0AAAAJ&amp;hl=en"
html &lt;- htmlTreeParse(rawToChar(GET(url)$content), useInternalNodes = TRUE)
xpathSApply(html, "//title", xmlValue)
xpathSApply(html, "//td[@class='gsc_a_c']", xmlValue)
</code></pre></div></div>

<p>Another way to do it is:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span><span class="w">
</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"http://scholar.google.com/citations?user=HI-I6C0AAAAJ&amp;hl=en"</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">);</span><span class="w"> </span><span class="n">html2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GET</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">
</span><span class="n">content2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">content</span><span class="p">(</span><span class="n">html2</span><span class="p">,</span><span class="n">as</span><span class="o">=</span><span class="s2">"text"</span><span class="p">)</span><span class="w">
</span><span class="n">parsedHtml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htmlParse</span><span class="p">(</span><span class="n">content2</span><span class="p">,</span><span class="n">asText</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsedHtml</span><span class="p">,</span><span class="w"> </span><span class="s2">"//title"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This shit doesn‚Äôt work <code class="language-plaintext highlighter-rouge">doc &lt;-
htmlTreeParse(getURL(fileUrl),useInternal=TRUE)</code>.<br />
You are able to extract the elements in <strong>tags</strong> <code class="language-plaintext highlighter-rouge">div</code> of <strong>class</strong>
i.e., the teams and scores from the website. <em>The team-name doens‚Äôt
work anymore as it is not a class anymore</em></p>

<ul>
  <li>
    <p>help</p>

    <ul>
      <li>
        <p><a href="https://www.stat.berkeley.edu/~statcur/Workshop2/Presentations/XML.pdf">outstanding link to XML</a></p>
      </li>
      <li>
        <p><a href="https://web.archive.org/web/20140906181450/http://www.omegahat.org/RSXML/shortIntro.pdf">short link (wayback machine)</a></p>
      </li>
      <li>
        <p><a href="https://web.archive.org/web/20141113153333/http://www.omegahat.org/RSXML/Tour.pdf">long link (wayback machine)</a></p>
      </li>
    </ul>
  </li>
</ul>

<h4 id="things-that-dont-work-with-xml-and-html-parsing">Things that don‚Äôt work with XML and html parsing</h4>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">url</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getURL</span><span class="p">(</span><span class="s2">"http://scholar.google.com/citations?user=HI-I6C0AAAAJ&amp;hl=en"</span><span class="p">,</span><span class="w"> </span><span class="n">ssl.verifyPeer</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">html</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">htmlTreeParse</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">useInternalNodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">doc</span><span class="o">&lt;-</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//title"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">)</span><span class="w">
</span><span class="n">doc</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"302 Moved"</span><span class="w">
</span></code></pre></div></div>

<h3 id="json">JSON</h3>

<ul>
  <li>
    <p>Similar to XML but different in syntax and format.</p>
  </li>
  <li>
    <p>Simple installation in R using <code class="language-plaintext highlighter-rouge">install.packages()</code>. Has `curl‚Äô
dependency though.</p>
  </li>
  <li>
    <p>It is a text file consisting of dataframes, each cell in the DF can
also be a DF!</p>
  </li>
  <li>
    <p>getting data</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  library(jsonlite)
  jsonData &lt;-
  fromJSON("https://api.github.com/users/jtleek/repos")
</code></pre></div>    </div>
  </li>
  <li>
    <p>getting the ‚Äúcolumn‚Äù names</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  names(jsonData)
</code></pre></div>    </div>
  </li>
  <li>
    <p>getting certain ‚Äúcolumns‚Äù from the data</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  jsonData$id
  jsonData$column_name
</code></pre></div>    </div>
  </li>
  <li>
    <p>accessing jsondata nested data across all rows</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  jsonData$owner$login
</code></pre></div>    </div>
  </li>
  <li>
    <p>Writing DF to json</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  myjson &lt;- toJSON(iris, pretty=TRUE)
  cat(myjson)
</code></pre></div>    </div>
  </li>
  <li>
    <p>help or further resources</p>

    <ul>
      <li>http://www.json.org/</li>
      <li>
        <p>a good tutorial on jsonlite -
<a href="http://www.r-bloggers.com/new-package-jsonlite-a-smarter-json-encoderdecoder/">http://www.r-bloggers.com/new-package-jsonlite-a-smarter-json-encoderdecoder/</a></p>
      </li>
      <li><a href="https://cran.r-project.org/web/packages/jsonlite/vignettes/json-mapping.pdf">json cran page</a></li>
    </ul>
  </li>
</ul>

<h3 id="mysql">MySQL</h3>

<p>MySQL is a type of database software. Frequently used in internet
based applications. You need to install MySQL and install RMySQL for this.</p>

<blockquote>
  <p>The MySQL‚Ñ¢ software delivers a very fast, multithreaded, multi-user,
and robust SQL (Structured Query Language) database server.
‚Äî <a href="https://dev.mysql.com/doc/refman/5.7/en/introduction.html">Source</a></p>
</blockquote>

<p>Anyways, it looks like you need a server and client way of work. So
databases are stored in the server and accessed by the client. Still
very vague. but moving on.</p>

<p>So I think what we are doing is we are running the server from within
out pc and that is what the installation of the server was all about.</p>

<ul>
  <li>mysqld is the server executable (one of them)</li>
  <li>mysql is the command line client</li>
  <li>mysqladmin is a maintainance or administrative utility</li>
</ul>

<h4 id="basics">Basics</h4>

<p>Starting and stopping and checking status</p>

<p>Status:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status mysql.service
</code></pre></div></div>

<p>Start:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo service mysql start
</code></pre></div></div>

<p>or</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /etc/init.d/mysql start
</code></pre></div></div>

<p>Stop:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo service mysql stop
</code></pre></div></div>

<p>Accessing as the client once the terminal once the server is running is done by:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p
</code></pre></div></div>

<h4 id="connecting-to-servers-online-and-using-their-stuff">Connecting to servers online and using their stuff</h4>

<p><a href="http://genome.ucsc.edu/">UCSC server</a> and instructions are <a href="http://genome.ucsc.edu/goldenPath/help/mysql.html">here</a>.</p>

<p><strong>Library</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library("RMySQL")
</code></pre></div></div>

<p><strong>Connecting:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ucscDb &lt;- dbConnect(MySQL(),user="genome", 
                host="genome-mysql.cse.ucsc.edu")
result &lt;- dbGetQuery(ucscDb,"show databases;");
dbDisconnect(ucscDb);

[1] TRUE
</code></pre></div></div>

<p>Result contains list of all databases.  <strong>You can connect to a
particular database and extract its info.</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hg19 &lt;- dbConnect(MySQL(),user="genome", db="hg19",
                host="genome-mysql.cse.ucsc.edu")
allTables &lt;- dbListTables(hg19)
length(allTables)
</code></pre></div></div>

<p>Gives a list of tables in this database.</p>

<p>Identifying info about the table in a particular database.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dbListFields(hg19,"affyU133Plus2")
dbGetQuery(hg19, "select count(*) from affyU133Plus2")
</code></pre></div></div>

<p><strong>Reading the table:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>affyData &lt;- dbReadTable(hg19, "affyU133Plus2")
</code></pre></div></div>

<p><strong>Getting a subset</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>query &lt;- dbSendQuery(hg19, "select * from affyU133Plus2 where misMatches between 1 and 3")
affyMis &lt;- fetch(query); quantile(affyMis$misMatches)
</code></pre></div></div>

<p><strong>Not accidentally getting a ton of data</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>affyMisSmall &lt;- fetch(query,n=10); dbClearResult(query);

dbDisconnect(hg19)
</code></pre></div></div>

<p><strong>SQL commands</strong></p>

<p><a href="http://www.pantz.org/software/mysql/mysqlcommands.html">List of mysql commands</a>, <a href="http://www.r-bloggers.com/mysql-and-r/">blog of other commands</a>.</p>

<h4 id="sql-withing-r-without-mysql">SQL withing R without MySQL</h4>

<p><code class="language-plaintext highlighter-rouge">sqldf</code> library is used for the purpose of using sql on R data frames
directly.</p>

<p>According to this stack question, <code class="language-plaintext highlighter-rouge">sqldf</code> has to use a driver given by
the argument <code class="language-plaintext highlighter-rouge">drv</code>. If nothing is specified it looks for some other
libraries loaded and tries to use their driver, which is when for a
command like <code class="language-plaintext highlighter-rouge">sqldf("select * from df limit 6", drv="SQLite")</code> you get
errors reagarding driver.</p>

<p>So do one of the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>detach("package:RMySQL", unload=TRUE)
options(sqldf.driver = "SQLite")
sqldf("select * from df limit 6", drv="SQLite")
</code></pre></div></div>

<p><a href="https://stackoverflow.com/a/49431382/5986651">Source</a></p>

<h4 id="sql-queries">SQL queries</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqldf("select distinct AGEP from acs")
sqldf("select pwgtp1 from acs where AGEP &lt; 50")
</code></pre></div></div>

<h3 id="hdf5">HDF5</h3>

<p>Hierarchical data format.</p>

<p>This lecture is modeled very closely on the rhdf5 tutorial that can be
found here:
<a href="http://www.bioconductor.org/packages/release/bioc/vignettes/rhdf5/inst/doc/rhdf5.pdf">http://www.bioconductor.org/packages/release/bioc/vignettes/rhdf5/inst/doc/rhdf5.pdf</a></p>

<p><strong>Start</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(rhdf5)
created = h5createFile("example.h5")
</code></pre></div></div>

<p><strong>Create groups</strong></p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h5createGroup</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"foo"</span><span class="p">)</span><span class="w">
</span><span class="n">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h5createGroup</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"baa"</span><span class="p">)</span><span class="w">
</span><span class="n">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h5createGroup</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"foo/foobaa"</span><span class="p">)</span><span class="w">
</span><span class="n">h5ls</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">)</span><span class="w"> </span><span class="c1"># list groups in the table</span><span class="w">
</span></code></pre></div></div>

<p><strong>Write groups</strong></p>

<p>Write matrix directly</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="n">nr</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="n">nc</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">h5write</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"foo/A"</span><span class="p">)</span><span class="w">
</span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">2.0</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="m">0.1</span><span class="p">),</span><span class="n">dim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="nf">attr</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="s2">"scale"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"liter"</span><span class="w">
</span><span class="n">h5write</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"foo/foobaa/B"</span><span class="p">)</span><span class="w">
</span><span class="n">h5ls</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        group   name       otype  dclass       dim
0           /    baa   H5I_GROUP                  
1           /    foo   H5I_GROUP                  
2        /foo      A H5I_DATASET INTEGER     5 x 2
3        /foo foobaa   H5I_GROUP                  
4 /foo/foobaa      B H5I_DATASET   FLOAT 5 x 2 x 2
</code></pre></div></div>

<p><strong>Write data sets</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="m">1L</span><span class="o">:</span><span class="m">5L</span><span class="p">,</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">5</span><span class="p">),</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ab"</span><span class="p">,</span><span class="s2">"cde"</span><span class="p">,</span><span class="s2">"fghi"</span><span class="p">,</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"s"</span><span class="p">),</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">h5write</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"df"</span><span class="p">)</span><span class="w">
</span><span class="n">h5ls</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        group   name       otype   dclass       dim
0           /    baa   H5I_GROUP                   
1           /     df H5I_DATASET COMPOUND         5
2           /    foo   H5I_GROUP                   
3        /foo      A H5I_DATASET  INTEGER     5 x 2
4        /foo foobaa   H5I_GROUP                   
5 /foo/foobaa      B H5I_DATASET    FLOAT 5 x 2 x 2
</code></pre></div></div>

<p><strong>Reading data</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">readA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h5read</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"foo/A"</span><span class="p">)</span><span class="w">
</span><span class="n">readB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h5read</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"foo/foobaa/B"</span><span class="p">)</span><span class="w">
</span><span class="n">readdf</span><span class="o">=</span><span class="w"> </span><span class="n">h5read</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"df"</span><span class="p">)</span><span class="w">
</span><span class="n">readA</span><span class="w">
</span></code></pre></div></div>

<p><strong>Writing and reading chunks</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">h5write</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">14</span><span class="p">),</span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"foo/A"</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">h5read</span><span class="p">(</span><span class="s2">"example.h5"</span><span class="p">,</span><span class="s2">"foo/A"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Notes and further resources</strong></p>

<ul>
  <li>hdf5 can be used to optimize reading/writing from disc in R</li>
  <li>The rhdf5 tutorial:
    <ul>
      <li><a href="http://www.bioconductor.org/packages/release/bioc/vignettes/rhdf5/inst/doc/rhdf5.pdf">http://www.bioconductor.org/packages/release/bioc/vignettes/rhdf5/inst/doc/rhdf5.pdf</a></li>
    </ul>
  </li>
  <li>The HDF group has informaton on HDF5 in general <a href="http://www.hdfgroup.org/HDF5/">http://www.hdfgroup.org/HDF5/</a>
    <h3 id="webscraping-html-reading">Webscraping html reading</h3>
  </li>
</ul>

<p><a href="https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/02_03_readingFromTheWeb/index.md">Source-jtleek</a></p>

<p><strong>Webscraping</strong>: Programatically extracting data from the HTML code of websites.</p>

<ul>
  <li>It can be a great way to get data <a href="http://www.theatlantic.com/technology/archive/2014/01/how-netflix-reverse-engineered-hollywood/282679/">How Netflix reverse engineered Hollywood</a></li>
  <li>Many websites have information you may want to programaticaly read</li>
  <li>In some cases this is against the terms of service for the website</li>
  <li>Attempting to read too many pages too quickly can get your IP address blocked</li>
</ul>

<p><a href="http://en.wikipedia.org/wiki/Web_scraping">http://en.wikipedia.org/wiki/Web_scraping</a></p>

<p><strong>Getting data off webpages - readLines()</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">(</span><span class="s2">"http://scholar.google.com/citations?user=HI-I6C0AAAAJ&amp;hl=en"</span><span class="p">)</span><span class="w">
</span><span class="n">htmlCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readLines</span><span class="p">(</span><span class="n">con</span><span class="p">)</span><span class="w">
</span><span class="n">close</span><span class="p">(</span><span class="n">con</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Jeff Leek - Google Scholar
Citations&lt;/title&gt;&lt;meta name=\"robots\" content=\"noarchive\"&gt;&lt;meta
http-equiv=\"Content-Type\"
content=\"text/html;charset=ISO-8859-1\"&gt;&lt;meta
http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\"&gt;&lt;meta
name=\"format-detection\" content=\"telephone=no\"&gt;&lt;link
rel=\"canonical\"
href=\"http://scholar.google.com/citations?user=HI-I6C0AAAAJ&amp;amp;hl=en\"&gt;&lt;style
type=\"text/css\" media=\"screen, 
</code></pre></div></div>

<p><strong>Parsing with XML</strong></p>

<p>The actual lecture notes is sooooooooooo wrong.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">	</span><span class="n">library</span><span class="p">(</span><span class="n">XML</span><span class="p">)</span><span class="w">
	</span><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span><span class="w">
	</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"http://scholar.google.com/citations?user=HI-I6C0AAAAJ&amp;hl=en"</span><span class="w">
	</span><span class="n">html</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">htmlTreeParse</span><span class="p">(</span><span class="n">rawToChar</span><span class="p">(</span><span class="n">GET</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">$</span><span class="n">content</span><span class="p">),</span><span class="w"> </span><span class="n">useInternalNodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
	</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//title"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Jeff Leek - Google Scholar Citations"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xpathSApply</span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//td[@class='gsc_a_c']"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] "Cited by" "397"      "259"      "237"      "172"      "138"      "125"      "122"     
 [9] "109"      "101"      "34"       "26"       "26"       "24"       "19"       "13"      
[17] "12"       "10"       "10"       "7"        "6"       
</code></pre></div></div>

<p><strong>GET from the httr package</strong></p>

<p>Somehow this works in the first try.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span><span class="w">
</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"http://scholar.google.com/citations?user=HI-I6C0AAAAJ&amp;hl=en"</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">);</span><span class="w"> </span><span class="n">html2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GET</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">
</span><span class="n">content2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">content</span><span class="p">(</span><span class="n">html2</span><span class="p">,</span><span class="n">as</span><span class="o">=</span><span class="s2">"text"</span><span class="p">)</span><span class="w">
</span><span class="n">parsedHtml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htmlParse</span><span class="p">(</span><span class="n">content2</span><span class="p">,</span><span class="n">asText</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsedHtml</span><span class="p">,</span><span class="w"> </span><span class="s2">"//title"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">)</span><span class="w">
</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsedHtml</span><span class="p">,</span><span class="w"> </span><span class="s2">"//td[@class='gsc_a_c']"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Jeff Leek - Google Scholar Citations"
</code></pre></div></div>

<p><strong>Accessing websites with passwords</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GET</span><span class="p">(</span><span class="s2">"http://httpbin.org/basic-auth/user/passwd"</span><span class="p">)</span><span class="w">
</span><span class="n">pg1</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Response [http://httpbin.org/basic-auth/user/passwd]
  Status: 401
  Content-type: application/json
{
  "authenticated": true,
  "user": "user"
} 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">pg2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "url"         "handle"      "status_code" "headers"     "cookies"     "content"    
[7] "times"       "config"     
</code></pre></div></div>

<p><a href="http://cran.r-project.org/web/packages/httr/httr.pdf">http://cran.r-project.org/web/packages/httr/httr.pdf</a></p>

<hr />

<p><strong>Using handles</strong></p>

<p>handles are used when you want to authenticate once and leave every
other time to use the same authentication.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">google</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle</span><span class="p">(</span><span class="s2">"http://google.com"</span><span class="p">)</span><span class="w">
</span><span class="n">pg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GET</span><span class="p">(</span><span class="n">handle</span><span class="o">=</span><span class="n">google</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s2">"/"</span><span class="p">)</span><span class="w">
</span><span class="n">pg2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GET</span><span class="p">(</span><span class="n">handle</span><span class="o">=</span><span class="n">google</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s2">"search"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><a href="http://cran.r-project.org/web/packages/httr/httr.pdf">http://cran.r-project.org/web/packages/httr/httr.pdf</a></p>

<p><strong>Notes and further resources</strong></p>

<ul>
  <li>R Bloggers has a number of examples of web scraping <a href="http://www.r-bloggers.com/?s=Web+Scraping">http://www.r-bloggers.com/?s=Web+Scraping</a></li>
  <li>The httr help file has useful examples <a href="http://cran.r-project.org/web/packages/httr/httr.pdf">http://cran.r-project.org/web/packages/httr/httr.pdf</a></li>
  <li>See later lectures on APIs</li>
</ul>

<h3 id="apis">API‚Äôs</h3>

<p><a href="https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/02_04_readingFromAPIs/index.md">Source for API usage when the time is right, not now!</a></p>

<p>Example of making and getting info from github API.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">httpuv</span><span class="p">)</span><span class="w">
</span><span class="c1"># 1. Find OAuth settings for github:</span><span class="w">
</span><span class="c1">#    http://developer.github.com/v3/oauth/</span><span class="w">
</span><span class="n">oauth_endpoints</span><span class="p">(</span><span class="s2">"github"</span><span class="p">)</span><span class="w">

</span><span class="c1"># 2. To make your own application, register at </span><span class="w">
</span><span class="c1">#    https://github.com/settings/developers. Use any URL for the homepage URL</span><span class="w">
</span><span class="c1">#    (http://github.com is fine) and  http://localhost:1410 as the callback url</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#    Replace your key and secret below.</span><span class="w">
</span><span class="n">myapp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oauth_app</span><span class="p">(</span><span class="s2">"github"</span><span class="p">,</span><span class="w">
  </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"56b637a5baffac62cad9"</span><span class="p">,</span><span class="w">
  </span><span class="n">secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"8e107541ae1791259e9987d544ca568633da2ebf"</span><span class="p">)</span><span class="w">

</span><span class="c1"># 3. Get OAuth credentials</span><span class="w">
</span><span class="n">github_token</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oauth2.0_token</span><span class="p">(</span><span class="n">oauth_endpoints</span><span class="p">(</span><span class="s2">"github"</span><span class="p">),</span><span class="w"> </span><span class="n">myapp</span><span class="p">)</span><span class="w">

</span><span class="c1"># 4. Use API</span><span class="w">
</span><span class="n">gtoken</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">config</span><span class="p">(</span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">github_token</span><span class="p">)</span><span class="w">
</span><span class="n">req</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">GET</span><span class="p">(</span><span class="s2">"https://api.github.com/users/jtleek/repos"</span><span class="p">,</span><span class="w"> </span><span class="n">gtoken</span><span class="p">)</span><span class="w">
</span><span class="n">stop_for_status</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="w">
</span><span class="n">lst</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">content</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span><span class="w">

</span><span class="c1"># Convert to a data.frame</span><span class="w">
</span><span class="n">gitDF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fromJSON</span><span class="p">(</span><span class="n">toJSON</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span><span class="w">

</span><span class="c1"># Subset data.frame</span><span class="w">
</span><span class="n">gitDF</span><span class="p">[</span><span class="n">gitDF</span><span class="o">$</span><span class="n">full_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"jtleek/datasharing"</span><span class="p">,</span><span class="w"> </span><span class="s2">"created_at"</span><span class="p">]</span><span class="w">

</span></code></pre></div></div>

<p><strong>Source</strong></p>

<ol>
  <li><a href="https://towardsdatascience.com/accessing-data-from-github-api-using-r-3633fb62cb08">Exact question answered for the Coursera question</a></li>
  <li><a href="https://github.com/r-lib/httr/blob/master/demo/oauth2-github.r">Source given by course era course
question</a></li>
  <li><a href="https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/02_04_readingFromAPIs/index.md">Source given by jtleek</a></li>
</ol>

<h3 id="other-sources">other sources</h3>

<p><strong>There is a package for that</strong></p>

<ul>
  <li>Roger has a nice video on how there are R packages for
most things that you will want to access.</li>
  <li>Here I‚Äôm going to briefly review a few useful packages</li>
  <li>In general the best way to find out if the R package
exists is to Google ‚Äúdata storage mechanism R package‚Äù
    <ul>
      <li>For example: ‚ÄúMySQL R package‚Äù</li>
    </ul>
  </li>
</ul>

<hr />

<p><strong>Interacting more directly with files</strong></p>

<ul>
  <li>file - open a connection to a text file</li>
  <li>url - open a connection to a url</li>
  <li>gzfile - open a connection to a .gz file</li>
  <li>bzfile - open a connection to a .bz2 file</li>
  <li><em>?connections</em> for more information</li>
  <li>
    <redtext>Remember to close connections </redtext>
  </li>
</ul>

<hr />

<p><strong>foreign package</strong></p>

<ul>
  <li>Loads data from Minitab, S, SAS, SPSS, Stata,Systat</li>
  <li>Basic functions <em>read.foo</em>
    <ul>
      <li>read.arff (Weka)</li>
      <li>read.dta (Stata)</li>
      <li>read.mtp (Minitab)</li>
      <li>read.octave (Octave)</li>
      <li>read.spss (SPSS)</li>
      <li>read.xport (SAS)</li>
    </ul>
  </li>
  <li>See the help page for more details <a href="http://cran.r-project.org/web/packages/foreign/foreign.pdf">http://cran.r-project.org/web/packages/foreign/foreign.pdf</a></li>
</ul>

<hr />

<p><strong>Examples of other database packages</strong></p>

<ul>
  <li>RPostresSQL provides a DBI-compliant database connection from R. Tutorial-<a href="https://code.google.com/p/rpostgresql/">https://code.google.com/p/rpostgresql/</a>, help file-<a href="http://cran.r-project.org/web/packages/RPostgreSQL/RPostgreSQL.pdf">http://cran.r-project.org/web/packages/RPostgreSQL/RPostgreSQL.pdf</a></li>
  <li>RODBC provides interfaces to multiple databases including PostgreQL, MySQL, Microsoft Access and SQLite. Tutorial - <a href="http://cran.r-project.org/web/packages/RODBC/vignettes/RODBC.pdf">http://cran.r-project.org/web/packages/RODBC/vignettes/RODBC.pdf</a>, help file - <a href="http://cran.r-project.org/web/packages/RODBC/RODBC.pdf">http://cran.r-project.org/web/packages/RODBC/RODBC.pdf</a></li>
  <li>RMongo <a href="http://cran.r-project.org/web/packages/RMongo/RMongo.pdf">http://cran.r-project.org/web/packages/RMongo/RMongo.pdf</a> (example of Rmongo <a href="http://www.r-bloggers.com/r-and-mongodb/">http://www.r-bloggers.com/r-and-mongodb/</a>) and <a href="http://cran.r-project.org/web/packages/rmongodb/rmongodb.pdf">rmongodb</a> provide interfaces to MongoDb.</li>
</ul>

<hr />

<p><strong>Reading images</strong></p>

<ul>
  <li>jpeg - <a href="http://cran.r-project.org/web/packages/jpeg/index.html">http://cran.r-project.org/web/packages/jpeg/index.html</a></li>
  <li>readbitmap - <a href="http://cran.r-project.org/web/packages/readbitmap/index.html">http://cran.r-project.org/web/packages/readbitmap/index.html</a></li>
  <li>png - <a href="http://cran.r-project.org/web/packages/png/index.html">http://cran.r-project.org/web/packages/png/index.html</a></li>
  <li>EBImage (Bioconductor) - <a href="http://www.bioconductor.org/packages/2.13/bioc/html/EBImage.html">http://www.bioconductor.org/packages/2.13/bioc/html/EBImage.html</a></li>
</ul>

<hr />

<p><strong>Reading GIS data</strong></p>

<ul>
  <li>rgdal - <a href="http://cran.r-project.org/web/packages/rgdal/index.html">http://cran.r-project.org/web/packages/rgdal/index.html</a></li>
  <li>rgeos - <a href="http://cran.r-project.org/web/packages/rgeos/index.html">http://cran.r-project.org/web/packages/rgeos/index.html</a></li>
  <li>raster - <a href="http://cran.r-project.org/web/packages/raster/index.html">http://cran.r-project.org/web/packages/raster/index.html</a></li>
</ul>

<hr />

<p><strong>Reading music data</strong></p>

<ul>
  <li>tuneR - <a href="http://cran.r-project.org/web/packages/tuneR/">http://cran.r-project.org/web/packages/tuneR/</a></li>
  <li>seewave - <a href="http://rug.mnhn.fr/seewave/">http://rug.mnhn.fr/seewave/</a></li>
</ul>

<h3 id="jpeg">jpeg</h3>

<blockquote>
  <p>readJPEG                Read a bitmap image stored in the JPEG format
writeJPEG               Write a bitmap image in JPEG format
‚Äî library(help=jpeg)</p>
</blockquote>

<h2 id="manipulating-data-c3-w3">Manipulating DATA (c3-w3)</h2>
<h3 id="dealing-with-na">dealing with NA</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>final[complete.cases(final), ]
na.omit(your.data.frame)
final &lt;- final[!(is.na(final$rnor)) | !(is.na(rawdata$cfam)),]
</code></pre></div></div>

<p>Also look at imputing where NA is replaced with other things</p>

<h3 id="nas-are-ignored-using-which">NA‚Äôs are ignored using <code class="language-plaintext highlighter-rouge">which</code></h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">var2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">8</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3
4    1   10   11
5    4    9   13
</code></pre></div></div>

<h3 id="dealing-with-blanks">dealing with blanks</h3>
<p>https://stackoverflow.com/questions/12763890/exclude-blank-and-na-in-r
Question</p>

<p>https://stackoverflow.com/a/12764040/5986651 Answer</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo[foo==""] &lt;- NA
foo &lt;- na.omit(foo$column.name) ### Selecting random rows and setting value (Sampling)
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">13435</span><span class="p">)</span><span class="w">
</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="s2">"var1"</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">),</span><span class="s2">"var2"</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="m">6</span><span class="o">:</span><span class="m">10</span><span class="p">),</span><span class="s2">"var3"</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="m">11</span><span class="o">:</span><span class="m">15</span><span class="p">))</span><span class="w">
</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">),];</span><span class="w"> </span><span class="n">X</span><span class="o">$</span><span class="n">var2</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">X</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3
1    2   NA   15
4    1   10   11
2    3   NA   12
3    5    6   14
5    4    9   13
</code></pre></div></div>
<h3 id="subsetting---quick-review-2">Subsetting - quick review (2)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">[,</span><span class="s2">"var1"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="s2">"var2"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p><strong>Subsetting with %in%</strong></p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">restData</span><span class="p">[</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"21212"</span><span class="p">,</span><span class="s2">"21213"</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<h3 id="logicals-ands-and-ors">Logicals and‚Äôs and or‚Äôs</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">[(</span><span class="n">X</span><span class="o">$</span><span class="n">var1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">X</span><span class="o">$</span><span class="n">var3</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">11</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3
1    2   NA   15
2    3   NA   12
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">[(</span><span class="n">X</span><span class="o">$</span><span class="n">var1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">X</span><span class="o">$</span><span class="n">var3</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">15</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3
1    2   NA   15
4    1   10   11
2    3   NA   12
</code></pre></div></div>

<h3 id="sorting">Sorting</h3>

<p><strong>Excludes NA‚Äôs unless an argument is used</strong> If needed then use
<code class="language-plaintext highlighter-rouge">na.last</code>=True</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">var1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2 3 4 5
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">var1</span><span class="p">,</span><span class="n">decreasing</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 5 4 3 2 1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">var2</span><span class="p">,</span><span class="n">na.last</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  6  9 10 NA NA
</code></pre></div></div>
<h3 id="ordering">Ordering</h3>

<p>Different than Sorting in that <strong>in orders the whole DF</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">var1</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3
4    1   10   11
1    2   NA   15
2    3   NA   12
5    4    9   13
3    5    6   14
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">var1</span><span class="p">,</span><span class="n">X</span><span class="o">$</span><span class="n">var3</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3
4    1   10   11
1    2   NA   15
2    3   NA   12
5    4    9   13
3    5    6   14
</code></pre></div></div>

<h3 id="orderarrange-with-some-more-capabilities-plyr">Order(arrange) with some more capabilities (plyr)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">
</span><span class="n">arrange</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">var1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3
1    1   10   11
2    2   NA   15
3    3   NA   12
4    4    9   13
5    5    6   14
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">arrange</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">desc</span><span class="p">(</span><span class="n">var1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3
1    5    6   14
2    4    9   13
3    3   NA   12
4    2   NA   15
5    1   10   11
</code></pre></div></div>

<hr />

<h3 id="adding-rows-and-columns">Adding rows and columns</h3>

<p>Directly add columns</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="o">$</span><span class="n">var4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">X</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3     var4
1    2   NA   15  0.18760
4    1   10   11  1.78698
2    3   NA   12  0.49669
3    5    6   14  0.06318
5    4    9   13 -0.53613
</code></pre></div></div>
<p><strong>or Use cind or rbind</strong></p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">rnorm</span><span class="p">(</span><span class="m">5</span><span class="p">))</span><span class="w">
</span><span class="n">Y</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  var1 var2 var3     var4 rnorm(5)
1    2   NA   15  0.18760  0.62578
4    1   10   11  1.78698 -2.45084
2    3   NA   12  0.49669  0.08909
3    5    6   14  0.06318  0.47839
5    4    9   13 -0.53613  1.00053
</code></pre></div></div>

<h3 id="col-and-row-names">Col and row names</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>names(test) &lt;- c("A","B","C","D","E","F","G","H","I","J","K")
</code></pre></div></div>

<ul>
  <li>
    <p>faster</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  colnames(test) &lt;- c("A","B","C","D","E","F","G","H","I","J","K")
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="using-dictionary-types-in-python-similarplyr">Using dictionary types in python similar(plyr)</h3>
<ul>
  <li>You have a table (activty.names) of 2 columns <code class="language-plaintext highlighter-rouge">$V1</code> and <code class="language-plaintext highlighter-rouge">$V2</code>. V1 with number, V2
with char to be replaced.</li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">
</span><span class="n">traintest</span><span class="o">$</span><span class="n">Activity</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="n">mapvalues</span><span class="p">(</span><span class="n">traintest</span><span class="o">$</span><span class="n">Activity</span><span class="p">,</span><span class="n">activity.names</span><span class="o">$</span><span class="n">V1</span><span class="p">,</span><span class="n">activity.names</span><span class="o">$</span><span class="n">V2</span><span class="p">)</span><span class="c1"># requires `plyr`</span><span class="w">
</span></code></pre></div></div>

<h3 id="notes-and-further-resources">Notes and further resources</h3>

<ul>
  <li>R programming in the Data Science Track</li>
  <li>Andrew Jaffe‚Äôs lecture notes <a href="http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%202.pdf">http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%202.pdf</a></li>
</ul>

<p><a href="https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/03_01_subsettingAndSorting/index.md">Source</a></p>
<h2 id="summarizing-data-c3-w3">Summarizing data (c3-w3)</h2>

<h3 id="using-str-summary-head">Using STR, Summary, HEAD</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="s2">"./data"</span><span class="p">)){</span><span class="n">dir.create</span><span class="p">(</span><span class="s2">"./data"</span><span class="p">)}</span><span class="w">
</span><span class="n">fileUrl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://data.baltimorecity.gov/api/views/k5ry-ef3g/rows.csv?accessType=DOWNLOAD"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">fileUrl</span><span class="p">,</span><span class="n">destfile</span><span class="o">=</span><span class="s2">"./data/restaurants.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">restData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./data/restaurants.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Read first few lines of the DF</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">restData</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">tail</span><span class="p">(</span><span class="n">restData</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><strong>Summary of data</strong></p>

<p>Info about every column based on its class.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">name</span><span class="p">,</span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MCDONALD'S POPEYES FAMOUS FRIED CHICKEN 
                           8                            7 
                      SUBWAY       KENTUCKY FRIED CHICKEN 
                           6                            5 
                     (Other) 
                        1301 
</code></pre></div></div>
<p><strong>In-depth info (STR)</strong></p>

<p><code class="language-plaintext highlighter-rouge">str</code> is more about <em>meta info</em> about the data, like what class is each
column, starting numbers, how many levels if factor etc..</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">restData</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	1327 obs. of  6 variables:
 $ name           : Factor w/ 1277 levels "#1 CHINESE KITCHEN",..: 9 3 992 1 2 4 5 6 7 8 ...
 $ zipCode        : int  21206 21231 21224 21211 21223 21218 21205 21211 21205 21231 ...
 $ neighborhood   : Factor w/ 173 levels "Abell","Arlington",..: 53 52 18 66 104 33 98 133 98 157 ...
 $ councilDistrict: int  2 1 1 14 9 14 13 7 13 1 ...
 $ policeDistrict : Factor w/ 9 levels "CENTRAL","EASTERN",..: 3 6 6 4 8 3 6 4 6 6 ...
 $ Location.1     : Factor w/ 1210 levels "1 BIDDLE ST\nBaltimore, MD\n",..: 835 334 554 755 492 537 505 530 507 569 ...
</code></pre></div></div>

<h3 id="quantile-info">Quantile info</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">quantile</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">councilDistrict</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  0%  25%  50%  75% 100% 
   1    2    9   11   14 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">quantile</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">councilDistrict</span><span class="p">,</span><span class="n">probs</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.75</span><span class="p">,</span><span class="m">0.9</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h3 id="table">table</h3>

<p>Counts the number of times of occurance of one column or even a
combination of columns in X and Y axis.</p>

<p>NA is removed by default.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">table</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">councilDistrict</span><span class="p">,</span><span class="n">useNA</span><span class="o">=</span><span class="s2">"ifany"</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">councilDistrict</span><span class="p">,</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="check-for-missing-values">Check for missing values</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">councilDistrict</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">any</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">councilDistrict</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] FALSE
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">all</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] FALSE
</code></pre></div></div>
<p><strong>Getting info about all columns</strong></p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colSums</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">restData</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           name         zipCode    neighborhood councilDistrict  policeDistrict      Location.1 
              0               0               0               0               0               0 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">all</span><span class="p">(</span><span class="n">colSums</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">restData</span><span class="p">))</span><span class="o">==</span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] TRUE
</code></pre></div></div>

<h3 id="values-with-specific-characteristics">Values with specific characteristics</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">table</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"21212"</span><span class="p">))</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"21212"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FALSE  TRUE 
 1299    28 
</code></pre></div></div>
<p><strong>Subsetting with %in%</strong></p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">restData</span><span class="p">[</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"21212"</span><span class="p">,</span><span class="s2">"21213"</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                     name zipCode                neighborhood councilDistrict
29                      BAY ATLANTIC CLUB   21212                    Downtown              11
39                            BERMUDA BAR   21213               Broadway East              12
92                              ATWATER'S   21212   Chinquapin Park-Belvedere               4
111            BALTIMORE ESTONIAN SOCIET

</code></pre></div></div>

<h3 id="cross-tabs">Cross tabs</h3>

<p><strong>Shows values of Freq in a table of Gender and Admit</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xtabs</span><span class="p">(</span><span class="n">Freq</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Gender</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Admit</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">DF</span><span class="p">)</span><span class="w">
</span><span class="n">xt</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        Admit
Gender   Admitted Rejected
  Male       1198     1493
  Female      557     1278
</code></pre></div></div>

<p><strong>Even for third dimension</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">warpbreaks</span><span class="o">$</span><span class="n">replicate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">54</span><span class="p">)</span><span class="w">
</span><span class="n">xt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xtabs</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">warpbreaks</span><span class="p">)</span><span class="w">
</span><span class="n">xt</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>, , replicate = 1

    tension
wool  L  M  H
   A 26 18 36
   B 27 42 20

, , replicate = 2

    tension
wool  L  M  H
   A 30 21 21
   B 14 26 21
</code></pre></div></div>

<p><strong>With possibility to flatten it out!</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ftable</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h3 id="size-of-data-set">Size of data set</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fakeData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">1e5</span><span class="p">)</span><span class="w">
</span><span class="n">object.size</span><span class="p">(</span><span class="n">fakeData</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>800040 bytes
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">print</span><span class="p">(</span><span class="n">object.size</span><span class="p">(</span><span class="n">fakeData</span><span class="p">),</span><span class="n">units</span><span class="o">=</span><span class="s2">"Mb"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.8 Mb
</code></pre></div></div>

<h2 id="create-new-variables-c3-w3">Create new variables (c3-w3)</h2>

<p><a href="https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/03_03_creatingNewVariables/index.md">Source</a></p>

<h3 id="why-create-new-variables">Why create new variables?</h3>

<ul>
  <li>Often the raw data won‚Äôt have a value you are looking for</li>
  <li>You will need to transform the data to get the values you would like</li>
  <li>Usually you will add those values to the data frames you are working with</li>
  <li>Common variables to create
    <ul>
      <li>Missingness indicators</li>
      <li>‚ÄúCutting up‚Äù quantitative variables</li>
      <li>Applying transforms</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="creating-sequences">Creating sequences</h3>

<p><strong>Sample Data</strong></p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="s2">"./data"</span><span class="p">)){</span><span class="n">dir.create</span><span class="p">(</span><span class="s2">"./data"</span><span class="p">)}</span><span class="w">
</span><span class="n">fileUrl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://data.baltimorecity.gov/api/views/k5ry-ef3g/rows.csv?accessType=DOWNLOAD"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">fileUrl</span><span class="p">,</span><span class="n">destfile</span><span class="o">=</span><span class="s2">"./data/restaurants.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">restData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./data/restaurants.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><em>Sometimes you need an index for your data set</em></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">s1</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 3 5 7 9
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="m">3</span><span class="p">);</span><span class="w"> </span><span class="n">s2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  1.0  5.5 10.0
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">100</span><span class="p">);</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">along</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2 3 4 5
</code></pre></div></div>

<hr />

<h3 id="creating-new-variable-by-subsetting">Creating new variable by subsetting</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">restData</span><span class="o">$</span><span class="n">nearMe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restData</span><span class="o">$</span><span class="n">neighborhood</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Roland Park"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Homeland"</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">nearMe</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
FALSE  TRUE 
 1314    13 
</code></pre></div></div>

<h3 id="creating-binary-variables">Creating binary variables</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">restData</span><span class="o">$</span><span class="n">zipWrong</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipWrong</span><span class="p">,</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       
        FALSE TRUE
  FALSE  1326    0
  TRUE      0    1
</code></pre></div></div>

<h3 id="creating-categorical-variables-cut">Creating categorical variables (CUT)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">restData</span><span class="o">$</span><span class="n">zipGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="p">,</span><span class="n">breaks</span><span class="o">=</span><span class="n">quantile</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="p">))</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipGroups</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(-2.123e+04,2.12e+04]  (2.12e+04,2.122e+04] (2.122e+04,2.123e+04] (2.123e+04,2.129e+04] 
                  337                   375                   282                   332 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">table</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipGroups</span><span class="p">,</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                       
                        -21226 21201 21202 21205 21206 21207 21208 21209 21210 21211 21212 21213
  (-2.123e+04,2.12e+04]      0   136   201     0     0     0     0     0     0     0     0     0
  (2.12e+04,2.122e+04]       0     0     0    27    30     4     1     8    23    41    28    31
  (2.122e+04,2.123e+04]      0     0     0     0     0     0     0     0     0     0     0     0
  (2.123e+04,2.129e+04]      0     0     0     0     0     0     0     0     0     0     0     0
     
</code></pre></div></div>

<h4 id="quiz-question">Quiz question</h4>

<blockquote>
  <p>Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group. How many countries</p>

  <p>are Lower middle income but among the 38 nations with highest GDP?</p>
</blockquote>

<blockquote>
  <p>Answer:5</p>
</blockquote>

<p>pandian2$RankingGroups &lt;- cut(pandian2$Ranking,breaks=quantile(pandian2$Ranking,probs=seq(0,1,0.2)))
table(pandian2$RankingGroups,pandian2$Income.Group)</p>
<h3 id="easier-cutting-libraryhmisc-cut2">Easier cutting library(hmisc) cut2</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">Hmisc</span><span class="p">)</span><span class="w">
</span><span class="n">restData</span><span class="o">$</span><span class="n">zipGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cut2</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipGroups</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
[-21226,21205) [ 21205,21220) [ 21220,21227) [ 21227,21287] 
           338            375            300            314 
</code></pre></div></div>

<hr />

<h3 id="creating-factor-variables">Creating factor variables</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">restData</span><span class="o">$</span><span class="n">zcf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="p">)</span><span class="w">
</span><span class="n">restData</span><span class="o">$</span><span class="n">zcf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="p">)</span><span class="w">
</span><span class="n">restData</span><span class="o">$</span><span class="n">zcf</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] 21206 21231 21224 21211 21223 21218 21205 21211 21205 21231
32 Levels: -21226 21201 21202 21205 21206 21207 21208 21209 21210 21211 21212 21213 21214 ... 21287
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">class</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zcf</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "factor"
</code></pre></div></div>

<h3 id="levels-of-factor-variables">Levels of factor variables</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yesno</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"yes"</span><span class="p">,</span><span class="s2">"no"</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">yesnofac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">yesno</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"yes"</span><span class="p">,</span><span class="s2">"no"</span><span class="p">))</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">yesno</span><span class="p">))</span><span class="w">
</span><span class="n">relevel</span><span class="p">(</span><span class="n">yesnofac</span><span class="p">,</span><span class="n">ref</span><span class="o">=</span><span class="s2">"no"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] "no"  "yes"
 [2] yes yes yes yes no  yes yes yes no  no 
Levels: no yes
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">as.numeric</span><span class="p">(</span><span class="n">yesnofac</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] 1 1 1 1 2 1 1 1 2 2
</code></pre></div></div>

<h3 id="using-the-mutate-function-or-do-it-directly">Using the mutate function or do it directly</h3>

<p>Need both HMISC and plyr.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">Hmisc</span><span class="p">);</span><span class="w"> </span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">
</span><span class="n">restData2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">restData</span><span class="p">,</span><span class="n">zipGroups</span><span class="o">=</span><span class="n">cut2</span><span class="p">(</span><span class="n">zipCode</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="n">restData</span><span class="o">$</span><span class="n">zipGroups</span><span class="w">  </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">cut2</span><span class="p">(</span><span class="n">restData</span><span class="o">$</span><span class="n">zipCode</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="c1"># same result</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">restData2</span><span class="o">$</span><span class="n">zipGroups</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
[-21226,21205) [ 21205,21220) [ 21220,21227) [ 21227,21287] 
           338            375            300            314 
</code></pre></div></div>

<p>This <a href="https://stackoverflow.com/questions/7976001/adding-a-column-of-means-by-group-to-original-data">stack source on different ways of adding columns</a> to the main
data frame but factored:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span><span class="o">$</span><span class="n">Y.New</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ave</span><span class="p">(</span><span class="n">df1</span><span class="o">$</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">df1</span><span class="o">$</span><span class="n">X</span><span class="p">)</span><span class="w">

</span><span class="c1">## or</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">df1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Y.new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span><span class="w">
  
</span></code></pre></div></div>

<h3 id="common-transforms">Common transforms</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">abs(x)</code> absolute value</li>
  <li><code class="language-plaintext highlighter-rouge">sqrt(x)</code> square root</li>
  <li><code class="language-plaintext highlighter-rouge">ceiling(x)</code> ceiling(3.475) is 4</li>
  <li><code class="language-plaintext highlighter-rouge">floor(x)</code> floor(3.475) is 3</li>
  <li><code class="language-plaintext highlighter-rouge">round(x,digits=n)</code> round(3.475,digits=2) is 3.48</li>
  <li><code class="language-plaintext highlighter-rouge">signif(x,digits=n)</code> signif(3.475,digits=2) is 3.5</li>
  <li><code class="language-plaintext highlighter-rouge">cos(x), sin(x)</code> etc.</li>
  <li><code class="language-plaintext highlighter-rouge">log(x)</code> natural logarithm</li>
  <li><code class="language-plaintext highlighter-rouge">log2(x)</code>, <code class="language-plaintext highlighter-rouge">log10(x)</code> other common logs</li>
  <li><code class="language-plaintext highlighter-rouge">exp(x)</code> exponentiating x</li>
</ul>

<p><a href="http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%202.pdf">http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%202.pdf</a>
<a href="http://statmethods.net/management/functions.html">http://statmethods.net/management/functions.html</a></p>

<hr />

<h3 id="notes-and-further-reading">Notes and further reading</h3>

<ul>
  <li>A tutorial from the developer of plyr - <a href="http://plyr.had.co.nz/09-user/">http://plyr.had.co.nz/09-user/</a></li>
  <li>Andrew Jaffe‚Äôs R notes <a href="http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%202.pdf">http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%202.pdf</a></li>
  <li>A nice lecture on categorical and factor variables <a href="http://www.stat.berkeley.edu/classes/s133/factors.html">http://www.stat.berkeley.edu/classes/s133/factors.html</a></li>
</ul>

<h2 id="reshaping-data-c3-w3">Reshaping data (c3-w3)</h2>
<h3 id="the-goal-is-tidy-data">The goal is tidy data</h3>

<ol>
  <li>Each variable forms a column</li>
  <li>Each observation forms a row</li>
  <li>Each table/file stores data about one kind of observation (e.g. people/hospitals).</li>
</ol>

<p><a href="http://vita.had.co.nz/papers/tidy-data.pdf">http://vita.had.co.nz/papers/tidy-data.pdf</a></p>

<p><a href="http://www.plosone.org/article/info%3Adoi%2F10.1371%2Fjournal.pone.0026895">Leek, Taub, and Pineda 2011 PLoS One</a></p>

<hr />

<h3 id="melting-dataframes">Melting dataframes</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mtcars</span><span class="o">$</span><span class="n">carname</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)</span><span class="w">
</span><span class="n">carMelt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="n">id</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"carname"</span><span class="p">,</span><span class="s2">"gear"</span><span class="p">,</span><span class="s2">"cyl"</span><span class="p">),</span><span class="n">measure.vars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"mpg"</span><span class="p">,</span><span class="s2">"hp"</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">carMelt</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        carname gear cyl variable value
1     Mazda RX4    4   6      mpg  21.0
2 Mazda RX4 Wag    4   6      mpg  21.0
3    Datsun 710    4   4      mpg  22.8
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tail</span><span class="p">(</span><span class="n">carMelt</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         carname gear cyl variable value
62  Ferrari Dino    5   6       hp   175
63 Maserati Bora    5   8       hp   335
64    Volvo 142E    4   4       hp   109
</code></pre></div></div>
<p><a href="http://www.statmethods.net/management/reshape.html">http://www.statmethods.net/management/reshape.html</a></p>

<h3 id="dcasting-data-frames">dCasting data frames</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cylData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dcast</span><span class="p">(</span><span class="n">carMelt</span><span class="p">,</span><span class="w"> </span><span class="n">cyl</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span><span class="w">
</span><span class="n">cylData</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cyl mpg hp
1   4  11 11
2   6   7  7
3   8  14 14
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cylData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dcast</span><span class="p">(</span><span class="n">carMelt</span><span class="p">,</span><span class="w"> </span><span class="n">cyl</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">cylData</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cyl   mpg     hp
1   4 26.66  82.64
2   6 19.74 122.29
3   8 15.10 209.21
</code></pre></div></div>

<p><a href="http://www.statmethods.net/management/reshape.html">http://www.statmethods.net/management/reshape.html</a></p>

<h3 id="averaging-values">Averaging values</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">InsectSprays</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```   count spray 1    10     A 2     7     A 3    20     A 4    14     A 5    14     A 6    12     A ```
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tapply</span><span class="p">(</span><span class="n">InsectSprays</span><span class="o">$</span><span class="n">count</span><span class="p">,</span><span class="n">InsectSprays</span><span class="o">$</span><span class="n">spray</span><span class="p">,</span><span class="n">sum</span><span class="p">)</span><span class="w">

</span><span class="c1">#or</span><span class="w">
</span><span class="n">spIns</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">split</span><span class="p">(</span><span class="n">InsectSprays</span><span class="o">$</span><span class="n">count</span><span class="p">,</span><span class="n">InsectSprays</span><span class="o">$</span><span class="n">spray</span><span class="p">)</span><span class="w">
</span><span class="n">sprCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">spIns</span><span class="p">,</span><span class="n">sum</span><span class="p">)</span><span class="w">
</span><span class="n">unlist</span><span class="p">(</span><span class="n">sprCount</span><span class="p">)</span><span class="w"> </span><span class="c1"># to make it a table</span><span class="w">

</span><span class="c1">#or</span><span class="w">
</span><span class="n">sapply</span><span class="p">(</span><span class="n">spIns</span><span class="p">,</span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="c1"># directly a table</span><span class="w">

</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  A   B   C   D   E   F 
174 184  25  59  42 200 
</code></pre></div></div>

<p><a href="http://www.r-bloggers.com/a-quick-primer-on-split-apply-combine-problems/">http://www.r-bloggers.com/a-quick-primer-on-split-apply-combine-problems/</a></p>

<h3 id="averaging-across-multiple-variables">Averaging across multiple variables</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">balt.NEI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">NEI</span><span class="p">,</span><span class="n">fips</span><span class="o">==</span><span class="m">24510</span><span class="p">)</span><span class="w">

</span><span class="n">mn2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">with</span><span class="p">(</span><span class="n">balt.NEI</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">Emissions</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">type</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">))</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">mn20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">balt.NEI</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarise</span><span class="p">(</span><span class="n">Pandian</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">Emissions</span><span class="p">))</span><span class="w"> </span><span class="c1"># result in clean format</span><span class="w">
	
</span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">

</span><span class="n">mn21</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">balt.NEI</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="n">year</span><span class="p">),</span><span class="w"> </span><span class="n">summarize</span><span class="p">,</span><span class="n">Pandian</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">Emissions</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<p><strong>Note:</strong> Summarize and Summarise perform the same function.</p>

<p><strong>Warning:</strong> loading plyr masks the Summarise of dplyr! You need to
detach plyr before using functions like Summarize again.</p>

<p>https://stackoverflow.com/a/27407856/5986651</p>

<h3 id="another-way---plyr-package">Another way - plyr package</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="n">InsectSprays</span><span class="p">,</span><span class="n">.</span><span class="p">(</span><span class="n">spray</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">sum</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">count</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  spray sum
1     A 174
2     B 184
3     C  25
4     D  59
5     E  42
6     F 200
</code></pre></div></div>

<h4 id="summary-average-of-col1-for-factorcol2-quiz">Summary: Average of col1 for factor(col2) (quiz)</h4>

<ul>
  <li>Pre-info</li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="s2">"https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="s2">"./c3-w3.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">gdp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./c3-w3.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">gdp.data</span><span class="p">[</span><span class="n">gdp.data</span><span class="o">==</span><span class="s2">""</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w"> </span><span class="c1"># Make "" --&gt; NA and then...</span><span class="w">
</span><span class="n">gdp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp.data</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">X</span><span class="p">),]</span><span class="w"> </span><span class="c1"># Remove na from one row</span><span class="w">
                                        </span><span class="c1"># alone</span><span class="w">
</span><span class="n">gdp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp.data</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">),]</span><span class="w"> </span><span class="c1"># Remove na from one row</span><span class="w">
                                        </span><span class="c1"># alone</span><span class="w">
</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">X</span><span class="p">)</span><span class="c1"># remove unused levels</span><span class="w">
</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="o">&lt;-</span><span class="n">factor</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">)</span><span class="w"> </span><span class="c1"># remove unused levels</span><span class="w">
</span><span class="nf">is.na</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">)</span><span class="w">
</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">))</span><span class="w">

</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="s2">"https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="s2">"./c3-w3-other.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">edu.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./c3-w3-other.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">


</span><span class="n">pandian</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">gdp.data</span><span class="p">,</span><span class="n">edu.data</span><span class="p">,</span><span class="n">by.x</span><span class="o">=</span><span class="s2">"X"</span><span class="p">,</span><span class="n">by.y</span><span class="o">=</span><span class="s2">"CountryCode"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<ul>
  <li>Finding average of Ranking for different Income groups</li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ave.rank1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">pandian</span><span class="o">$</span><span class="n">Ranking</span><span class="p">,</span><span class="n">pandian</span><span class="o">$</span><span class="n">Income.Group</span><span class="p">,</span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">ave.rank2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">pandian</span><span class="o">$</span><span class="n">Ranking</span><span class="p">,</span><span class="n">pandian</span><span class="o">$</span><span class="n">Income.Group</span><span class="p">),</span><span class="n">mean</span><span class="p">)</span><span class="c1">#simplify=T</span><span class="w">
</span><span class="n">ave.rank3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">pandian</span><span class="o">$</span><span class="n">Ranking</span><span class="p">,</span><span class="n">pandian</span><span class="o">$</span><span class="n">Income.Group</span><span class="p">),</span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">ave.rank3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">ave.rank3</span><span class="p">)</span><span class="w">
</span><span class="n">ave.rank4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">pandian</span><span class="p">,</span><span class="n">.</span><span class="p">(</span><span class="n">Income.Group</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">Ranking</span><span class="p">))</span><span class="w">

</span></code></pre></div></div>

<h3 id="creating-a-new-column-variable">Creating a new column variable</h3>

<ul>
  <li>adding the column to the existing dataframe using <code class="language-plaintext highlighter-rouge">transform</code>
<a href="https://stackoverflow.com/a/7578905/5986651">Transform</a></li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pandian2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">pandian</span><span class="p">,</span><span class="n">.</span><span class="p">(</span><span class="n">Income.Group</span><span class="p">),</span><span class="n">transform</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">Ranking</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">pandian2</span><span class="o">$</span><span class="n">average</span><span class="p">,</span><span class="n">pandian2</span><span class="o">$</span><span class="n">Income.Group</span><span class="p">),</span><span class="n">n</span><span class="o">=</span><span class="m">50</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">ave</code> is not fully understood. but we see the difference. Go deeper if necessary.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spraySums</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">InsectSprays</span><span class="p">,</span><span class="n">.</span><span class="p">(</span><span class="n">spray</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">sum</span><span class="o">=</span><span class="n">ave</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="n">FUN</span><span class="o">=</span><span class="n">sum</span><span class="p">))</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">spraySums</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 72  2
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">spraySums</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  spray sum
1     A 174
2     A 174
3     A 174
4     A 174
5     A 174
6     A 174
</code></pre></div></div>

<hr />

<h3 id="more-information">More information</h3>

<ul>
  <li>A tutorial from the developer of plyr - <a href="http://plyr.had.co.nz/09-user/">http://plyr.had.co.nz/09-user/</a></li>
  <li>A nice reshape tutorial <a href="http://www.slideshare.net/jeffreybreen/reshaping-data-in-r">http://www.slideshare.net/jeffreybreen/reshaping-data-in-r</a></li>
  <li>A good plyr primer - <a href="http://www.r-bloggers.com/a-quick-primer-on-split-apply-combine-problems/">http://www.r-bloggers.com/a-quick-primer-on-split-apply-combine-problems/</a></li>
  <li>See also the functions
    <ul>
      <li>acast - for casting as multi-dimensional arrays</li>
      <li>arrange - for faster reordering without using order() commands</li>
      <li>mutate - adding new variables</li>
    </ul>
  </li>
</ul>

<h2 id="merging-data-c3-w3">Merging data (c3-w3)</h2>

<h3 id="peer-review-experiment-data">Peer review experiment data</h3>

<p><a href="http://www.plosone.org/article/info:doi/10.1371/journal.pone.0026895">http://www.plosone.org/article/info:doi/10.1371/journal.pone.0026895</a></p>

<h3 id="peer-review-data">Peer review data</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="s2">"./data"</span><span class="p">)){</span><span class="n">dir.create</span><span class="p">(</span><span class="s2">"./data"</span><span class="p">)}</span><span class="w">
</span><span class="n">fileUrl1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://dl.dropboxusercontent.com/u/7710864/data/reviews-apr29.csv"</span><span class="w">
</span><span class="n">fileUrl2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://dl.dropboxusercontent.com/u/7710864/data/solutions-apr29.csv"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">fileUrl1</span><span class="p">,</span><span class="n">destfile</span><span class="o">=</span><span class="s2">"./data/reviews.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">fileUrl2</span><span class="p">,</span><span class="n">destfile</span><span class="o">=</span><span class="s2">"./data/solutions.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">reviews</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./data/reviews.csv"</span><span class="p">);</span><span class="w"> </span><span class="n">solutions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./data/solutions.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  id solution_id reviewer_id      start       stop time_left accept
1  1           3          27 1304095698 1304095758      1754      1
2  2           4          22 1304095188 1304095206      2306      1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">solutions</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  id problem_id subject_id      start       stop time_left answer
1  1        156         29 1304095119 1304095169      2343      B
2  2        269         25 1304095119 1304095183      2329      C
</code></pre></div></div>

<h3 id="merging-data---merge">Merging data - merge()</h3>

<ul>
  <li>Merges data frames</li>
  <li>Important parameters: <em>x</em>,<em>y</em>,<em>by</em>,<em>by.x</em>,<em>by.y</em>,<em>all</em></li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "id"          "solution_id" "reviewer_id" "start"       "stop"        "time_left"  
[7] "accept"     
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "id"         "problem_id" "subject_id" "start"      "stop"       "time_left"  "answer"    
</code></pre></div></div>

<p><strong>Example</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mergedData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span><span class="n">solutions</span><span class="p">,</span><span class="n">by.x</span><span class="o">=</span><span class="s2">"solution_id"</span><span class="p">,</span><span class="n">by.y</span><span class="o">=</span><span class="s2">"id"</span><span class="p">,</span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">mergedData</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>If <code class="language-plaintext highlighter-rouge">all=TRUE</code> then for every row that has no match, you will see a row
with corresponding <code class="language-plaintext highlighter-rouge">NA</code>s.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  solution_id id reviewer_id    start.x     stop.x time_left.x accept problem_id subject_id
1           1  4          26 1304095267 1304095423        2089      1        156         29
2           2  6          29 1304095471 1304095513        1999      1        269         25
3           3  1          27 1304095698 1304095758        1754      1         34         22
4           4  2          22 1304095188 1304095206        2306      1         19         23
5           5  3          28 1304095276 1304095320        2192      1        605         26
6           6 16          22 1304095303 1304095471        2041      1        384         27
     start.y     stop.y time_left.y answer
1 1304095119 1304095169        2343      B
2 1304095119 1304095183        2329      C
3 1304095127 1304095146        2366      C
4 1304095127 1304095150        2362      D
5 1304095127 1304095167        2345      A
6 1304095131 1304095270        2242      C
</code></pre></div></div>
<h3 id="default---merge-all-common-column-names">Default - merge all common column names</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">intersect</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">solutions</span><span class="p">),</span><span class="nf">names</span><span class="p">(</span><span class="n">reviews</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "id"        "start"     "stop"      "time_left"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mergedData2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span><span class="n">solutions</span><span class="p">,</span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">mergedData2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  id      start       stop time_left solution_id reviewer_id accept problem_id subject_id answer
1  1 1304095119 1304095169      2343          NA          NA     NA        156         29      B
2  1 1304095698 1304095758      1754           3          27      1         NA         NA   &lt;NA&gt;
3  2 1304095119 1304095183      2329          NA          NA     NA        269         25      C
4  2 1304095188 1304095206      2306           4          22      1         NA         NA   &lt;NA&gt;
5  3 1304095127 1304095146      2366          NA          NA     NA         34         22      C
6  3 1304095276 1304095320      2192           5          28      1         NA         NA   &lt;NA&gt;
</code></pre></div></div>

<hr />

<h3 id="using-join-in-the-plyr-package">Using join in the plyr package</h3>

<p><em>Faster, but less full featured - defaults to left join, see help file for more</em></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">),</span><span class="n">x</span><span class="o">=</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="n">df2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">),</span><span class="n">y</span><span class="o">=</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="n">arrange</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">),</span><span class="n">id</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   id       x       y
1   1  0.2514  0.2286
2   2  0.1048  0.8395
3   3 -0.1230 -1.1165
4   4  1.5057 -0.1121
5   5 -0.2505  1.2124
6   6  0.4699 -1.6038
7   7  0.4627 -0.8060
8   8 -1.2629 -1.2848
9   9 -0.9258 -0.8276
10 10  2.8065  0.5794
</code></pre></div></div>

<hr />

<h3 id="if-you-have-multiple-data-frames">If you have multiple data frames</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">),</span><span class="n">x</span><span class="o">=</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="n">df2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">),</span><span class="n">y</span><span class="o">=</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="n">df3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">),</span><span class="n">z</span><span class="o">=</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="n">dfList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">df3</span><span class="p">)</span><span class="w">
</span><span class="n">join_all</span><span class="p">(</span><span class="n">dfList</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   id        x        y        z
1   6  0.39093 -0.16670  0.56523
2   1 -1.90467  0.43811 -0.37449
3   7 -1.48798 -0.85497 -0.69209
4  10 -2.59440  0.39591 -0.36134
5   3 -0.08539  0.08053  1.01247
6   4 -1.63165 -0.13158  0.21927
7   5 -0.50594  0.24256 -0.44003
8   9 -0.85062 -2.08066 -0.96950
9   2 -0.63767 -0.10069  0.09002
10  8  1.20439  1.29138 -0.88586
</code></pre></div></div>

<hr />

<h3 id="more-on-merging-data">More on merging data</h3>

<ul>
  <li>The quick R data merging page - <a href="http://www.statmethods.net/management/merging.html">http://www.statmethods.net/management/merging.html</a></li>
  <li>plyr information - <a href="http://plyr.had.co.nz/">http://plyr.had.co.nz/</a></li>
  <li>Types of joins - <a href="http://en.wikipedia.org/wiki/Join_(SQL)">http://en.wikipedia.org/wiki/Join_(SQL)</a>
    <h2 id="cleaning-data-na-and---c3-w4">Cleaning data NA and ‚Äú‚Äù &amp; (c3-w4)</h2>
  </li>
</ul>

<h3 id="cleaning-data">Cleaning data</h3>
<p>So usually we have <code class="language-plaintext highlighter-rouge">NA</code> or empty spaces <code class="language-plaintext highlighter-rouge">""</code> which really fuck with
us. Based on which column we are using we skip them either by using
functions or literally just cleaning up things.</p>

<p>This example shows a case of how to deal with <code class="language-plaintext highlighter-rouge">NA</code> or empty spaces
<code class="language-plaintext highlighter-rouge">""</code>, including comments.</p>

<ul>
  <li>data</li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="s2">"https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="s2">"./c3-w3.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">gdp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./c3-w3.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<ul>
  <li>making ‚Äú‚Äù ‚Äì&gt; NA
    <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdp.data</span><span class="p">[</span><span class="n">gdp.data</span><span class="o">==</span><span class="s2">""</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w"> </span><span class="c1"># Make "" --&gt; NA and then...</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>removing NA rows from necessary cols <code class="language-plaintext highlighter-rouge">(numeric and char)</code></li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp.data</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">X</span><span class="p">),]</span><span class="w"> </span><span class="c1"># Remove na from one row</span><span class="w">
                                        </span><span class="c1"># alone</span><span class="w">
</span><span class="n">gdp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp.data</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">),]</span><span class="w"> </span><span class="c1"># Remove na from one row</span><span class="w">
                                        </span><span class="c1"># alone</span><span class="w">
</span></code></pre></div></div>
<h3 id="manipulating-factors-important">Manipulating factors (<strong>Important</strong>)</h3>
<ul>
  <li>
    <p>Manipulating factors is slightly different and <a href="https://stackoverflow.com/a/6980780/5986651">can lead to
errors.</a></p>
  </li>
  <li>
    <p>removing unused levels is forcefully done</p>
  </li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdp.data</span><span class="o">$</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">X</span><span class="p">)</span><span class="c1"># remove unused levels</span><span class="w">
</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="o">&lt;-</span><span class="n">factor</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">)</span><span class="w"> </span><span class="c1"># remove unused levels</span><span class="w">
</span><span class="nf">is.na</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>converting factor to numeric for doing some arithmetic or
arranging. <strong>BE CAREFUL</strong></li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>
    <p>factors and headers (append data)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  header.data &lt;- factor(append(c(subject.header,y.header),as.character(X.header)))
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="q3-question-on-which-reflection-is-done">q3 question on which reflection is done</h4>

<p>Based on q3 coursera question:</p>

<blockquote>
  <p>Load the Gross Domestic Product data for the 190 ranked countries in this data set:</p>

  <p>https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv</p>

  <p>Load the educational data from this data set:</p>

  <p>https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv</p>

  <p>Match the data based on the country shortcode. How many of the IDs match? Sort the data frame in descending order by GDP rank (so United States is last). What is the 13th country in the resulting data frame?</p>

  <p>Original data sources:</p>

  <p>http://data.worldbank.org/data-catalog/GDP-ranking-table</p>

  <p>http://data.worldbank.org/data-catalog/ed-stats</p>
</blockquote>

<ul>
  <li>
    <p>Answer</p>

    <blockquote>
      <p>189 matches, 13th country is St. Kitts and Nevis</p>
    </blockquote>
  </li>
</ul>

<h3 id="cleaning-up-colnames">Cleaning up colnames</h3>

<p><strong>Example - Baltimore camera data</strong></p>

<p><a href="https://data.baltimorecity.gov/Transportation/Baltimore-Fixed-Speed-Cameras/dz54-2aru">https://data.baltimorecity.gov/Transportation/Baltimore-Fixed-Speed-Cameras/dz54-2aru</a></p>

<p><strong>Data</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="s2">"./data"</span><span class="p">)){</span><span class="n">dir.create</span><span class="p">(</span><span class="s2">"./data"</span><span class="p">)}</span><span class="w">
</span><span class="n">fileUrl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://data.baltimorecity.gov/api/views/dz54-2aru/rows.csv?accessType=DOWNLOAD"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">fileUrl</span><span class="p">,</span><span class="n">destfile</span><span class="o">=</span><span class="s2">"./data/cameras.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">cameraData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./data/cameras.csv"</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<p><strong>Removing Capitals tolower(), toupper()</strong></p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">cameraData</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "address"      "direction"    "street"       "crossStreet"  "intersection" "Location.1"  
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">cameraData</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">cameraData</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "address"      "direction"    "street"       "crossstreet"  "intersection" "location.1"  
</code></pre></div></div>

<p><strong>Removing <code class="language-plaintext highlighter-rouge">.</code> and <code class="language-plaintext highlighter-rouge">_</code> strsplit()</strong></p>

<ul>
  <li>Good for automatically splitting variable names</li>
  <li>Important parameters: <em>x</em>, <em>split</em></li>
</ul>

<p>For <code class="language-plaintext highlighter-rouge">.</code> you need to use <code class="language-plaintext highlighter-rouge">\\.</code> as it is the escape character.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">splitNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strsplit</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">cameraData</span><span class="p">),</span><span class="s2">"\\."</span><span class="p">)</span><span class="w">
</span><span class="n">splitNames</span><span class="p">[[</span><span class="m">5</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "intersection"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">splitNames</span><span class="p">[[</span><span class="m">6</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Location" "1"       
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">firstElement</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">]}</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">cameraData</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">splitNames</span><span class="p">,</span><span class="n">firstElement</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "address"      "direction"    "street"       "crossStreet"  "intersection" "Location"    
</code></pre></div></div>
<p><strong>Peer review experiment data</strong></p>

<p><a href="http://www.plosone.org/article/info:doi/10.1371/journal.pone.0026895">http://www.plosone.org/article/info:doi/10.1371/journal.pone.0026895</a></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fileUrl1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://dl.dropboxusercontent.com/u/7710864/data/reviews-apr29.csv"</span><span class="w">
</span><span class="n">fileUrl2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://dl.dropboxusercontent.com/u/7710864/data/solutions-apr29.csv"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">fileUrl1</span><span class="p">,</span><span class="n">destfile</span><span class="o">=</span><span class="s2">"./data/reviews.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">fileUrl2</span><span class="p">,</span><span class="n">destfile</span><span class="o">=</span><span class="s2">"./data/solutions.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">reviews</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./data/reviews.csv"</span><span class="p">);</span><span class="w"> </span><span class="n">solutions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./data/solutions.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  id solution_id reviewer_id      start       stop time_left accept
1  1           3          27 1304095698 1304095758      1754      1
2  2           4          22 1304095188 1304095206      2306      1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">solutions</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  id problem_id subject_id      start       stop time_left answer
1  1        156         29 1304095119 1304095169      2343      B
2  2        269         25 1304095119 1304095183      2329      C
</code></pre></div></div>
<p><strong>replacing char with other chars sub()</strong></p>

<ul>
  <li>Important parameters: <em>pattern</em>, <em>replacement</em>, <em>x</em></li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "id"          "solution_id" "reviewer_id" "start"       "stop"        "time_left"  
[7] "accept"     
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sub</span><span class="p">(</span><span class="s2">"_"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">reviews</span><span class="p">),)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "id"         "solutionid" "reviewerid" "start"      "stop"       "timeleft"   "accept"    
</code></pre></div></div>
<p><strong>Fixing character vectors - gsub()</strong></p>

<p>Removes only one</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">testName</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"this_is_a_test"</span><span class="w">
</span><span class="n">sub</span><span class="p">(</span><span class="s2">"_"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="n">testName</span><span class="p">)</span><span class="w">
</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"_"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="n">testName</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "thisis_a_test"
[2] "thisisatest"
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">gsub</code> removes recursively.</p>

<p><strong>Finding values - grep(),grepl()</strong></p>

<p><code class="language-plaintext highlighter-rouge">grep</code> for location of value. <code class="language-plaintext highlighter-rouge">grepl</code> for true or false which can be
passed as argument.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grep</span><span class="p">(</span><span class="s2">"Alameda"</span><span class="p">,</span><span class="n">cameraData</span><span class="o">$</span><span class="n">intersection</span><span class="p">)</span><span class="w">
</span><span class="n">grep</span><span class="p">(</span><span class="s2">"Alameda"</span><span class="p">,</span><span class="n">cameraData</span><span class="o">$</span><span class="n">intersection</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="n">table</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"Alameda"</span><span class="p">,</span><span class="n">cameraData</span><span class="o">$</span><span class="n">intersection</span><span class="p">))</span><span class="w">
</span><span class="n">cameraData2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cameraData</span><span class="p">[</span><span class="o">!</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"Alameda"</span><span class="p">,</span><span class="n">cameraData</span><span class="o">$</span><span class="n">intersection</span><span class="p">),]</span><span class="w">

</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  4  5 36
[1] "The Alameda  &amp; 33rd St"   "E 33rd  &amp; The Alameda"    "Harford \n &amp; The Alameda"
[2]FALSE  TRUE 
   77     3 
</code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">length</code> to determine if <code class="language-plaintext highlighter-rouge">grep()</code> found something</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grep</span><span class="p">(</span><span class="s2">"JeffStreet"</span><span class="p">,</span><span class="n">cameraData</span><span class="o">$</span><span class="n">intersection</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>integer(0)
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">grep</span><span class="p">(</span><span class="s2">"JeffStreet"</span><span class="p">,</span><span class="n">cameraData</span><span class="o">$</span><span class="n">intersection</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0
</code></pre></div></div>

<p><a href="http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%203.pdf">http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%203.pdf</a></p>

<p><strong>More useful string functions</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">nchar</span><span class="p">(</span><span class="s2">"Jeffrey Leek"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 12
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">substr</span><span class="p">(</span><span class="s2">"Jeffrey Leek"</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Jeffrey"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paste</span><span class="p">(</span><span class="s2">"Jeffrey"</span><span class="p">,</span><span class="s2">"Leek"</span><span class="p">)</span><span class="w">
</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Jeffrey"</span><span class="p">,</span><span class="s2">"Leek"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Jeffrey Leek"
[2] "JeffreyLeek"
</code></pre></div></div>
<p><strong>To trim the empty spaces</strong></p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str_trim</span><span class="p">(</span><span class="s2">"Jeff      "</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Jeff"
</code></pre></div></div>
<p><strong>Important points about text in data sets</strong></p>

<ul>
  <li>Names of variables should be
    <ul>
      <li>All lower case when possible</li>
      <li>Descriptive (Diagnosis versus Dx)</li>
      <li>Not duplicated</li>
      <li>Not have underscores or dots or white spaces</li>
    </ul>
  </li>
  <li>Variables with character values
    <ul>
      <li>Should usually be made into factor variables (depends on application)</li>
      <li>Should be descriptive (use TRUE/FALSE instead of 0/1 and
Male/Female versus 0/1 or M/F)</li>
    </ul>
  </li>
</ul>

<h3 id="identifying-expressions-with-meta-and-literals">Identifying expressions with meta and literals</h3>

<p><strong>Regular expressions</strong></p>

<ul>
  <li>Regular expressions can be thought of as a combination of literals and <em>metacharacters</em></li>
  <li>To draw an analogy with natural language, think of literal text forming the words of this language, and the metacharacters defining its grammar</li>
  <li>Regular expressions have a rich set of metacharacters</li>
</ul>

<p><strong>Literals</strong></p>

<p>Simplest pattern consists only of literals. The literal ‚Äúnuclear‚Äù would match to the following lines:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ooh. I just learned that to keep myself alive after a
nuclear blast! All I have to do is milk some rats
then drink the milk. Aweosme. :}
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">^I think</code> Beginning of line</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>i think we all rule for participating
i think i have been outed
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">morning$</code> end of line</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>well they had something this morning
then had to catch a tram home in the morning
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">[Bb][Uu][Ss][Hh]</code> will find any case combi of <code class="language-plaintext highlighter-rouge">BuSH</code></li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Bush 
BUSH
busHwalking
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">^[Ii]</code> am</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>i am great!
I am mass
</code></pre></div></div>
<p>-<code class="language-plaintext highlighter-rouge">^[0-9][a-zA-Z]</code> starting with number follwed by any character</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>7th inning
2nd half s
</code></pre></div></div>
<ul>
  <li>[^?.]$ Matching characters not <code class="language-plaintext highlighter-rouge">?</code> or <code class="language-plaintext highlighter-rouge">.</code> at the end of the line.</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>i like basketballs
6 and 9
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">9.11</code> any 1 character</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>its stupid the post 9-11 rules
9/11
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">flood|fire|earth|wind|water</code>; flood or fire or ‚Ä¶</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>is firewire like usb on none macs?
the global flood makes sense within the context of the bible
</code></pre></div></div>

<p>-<code class="language-plaintext highlighter-rouge">^[Gg]ood|[Bb]ad</code> Beginning of line with G or g or Bad/bad anywhere
in the sentence</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>good to hear some good knews from someone here
Good afternoon fellow american infidels!
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">^([Gg]ood|[Bb]ad)</code>; for both it is the beginning of the line!</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">[Gg]eorge( [Ww]\.)? [Bb]ush</code>; ? indicated optional characters</p>

    <p>Also here we need to escape <code class="language-plaintext highlighter-rouge">.</code> so we use <code class="language-plaintext highlighter-rouge">\.</code></p>
  </li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>George W. Bush
George Bushless
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">(.*)</code>; brackets with any number of chars</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>anyone wanna chat? (24, m, germany)
hello, 20.m here... ( east area + drives + webcam )
(he means older men)
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">[0-9]+ (.*)[0-9]+</code> ;<code class="language-plaintext highlighter-rouge">*</code> mean none or many of the item and <code class="language-plaintext highlighter-rouge">+</code> means
atleast 1 of the item.</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>working as MP here 720 MP battallion, 42nd birgade
so say 2 or 3 years at colleage and 4 at uni makes us 23 when and if we fin
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">[Bb]ush( +[^ ]+ +){1,5} debate</code>; { and } are referred to as interval quantifiers; the let us specify the minimum and maximum number of matches of an expression</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Bush has historically won all major debates he‚Äôs done.
in my view, Bush doesn‚Äôt need these debates..
</code></pre></div></div>

<ul>
  <li>
    <p>parentheses not only limit the scope of alternatives divided by a
‚Äú|‚Äù, but also can be used to ‚Äúremember‚Äù text matched by the
subexpression enclosed</p>

    <p><code class="language-plaintext highlighter-rouge">+([a-zA-Z]+) +\1 +</code> ; some starting + one character atleast +
somethingelse+ a repitition of the ones in <code class="language-plaintext highlighter-rouge">()</code> + something else</p>
  </li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>time for bed, night night twitter!
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">^s(.*)s</code> matches the longest string starting with s and ending with
s</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sitting at starbucks
setting up mysql and rails
</code></pre></div></div>

<ul>
  <li>
    <p>The greediness of * can be turned off with the ?, as in</p>

    <p><code class="language-plaintext highlighter-rouge">^s(.*?)s$</code></p>
    <h4 id="quiz-q4-grep-question">Quiz q4 grep question</h4>

    <blockquote>
      <p>Load the Gross Domestic Product data for the 190 ranked countries in this data set:</p>

      <p>https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv</p>

      <p>Load the educational data from this data set:</p>

      <p>https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv</p>

      <p>Match the data based on the country shortcode. Of the countries for which the end of the fiscal year is available, how many end in June?</p>

      <p>Original data sources:</p>

      <p>http://data.worldbank.org/data-catalog/GDP-ranking-table</p>

      <p>http://data.worldbank.org/data-catalog/ed-stats</p>
    </blockquote>

    <blockquote>
      <p>Answer: 13</p>
    </blockquote>
  </li>
</ul>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="s2">"https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="s2">"./c3-w3.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">gdp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./c3-w3.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">gdp.data</span><span class="p">[</span><span class="n">gdp.data</span><span class="o">==</span><span class="s2">""</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w"> </span><span class="c1"># Make "" --&gt; NA and then...</span><span class="w">
</span><span class="n">gdp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp.data</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">X</span><span class="p">),]</span><span class="w"> </span><span class="c1"># Remove na from one row</span><span class="w">
                                        </span><span class="c1"># alone</span><span class="w">
</span><span class="n">gdp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp.data</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">),]</span><span class="w"> </span><span class="c1"># Remove na from one row</span><span class="w">
                                        </span><span class="c1"># alone</span><span class="w">
</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">X</span><span class="p">)</span><span class="c1"># remove unused levels</span><span class="w">
</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="o">&lt;-</span><span class="n">factor</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">)</span><span class="w"> </span><span class="c1"># remove unused levels</span><span class="w">
</span><span class="nf">is.na</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">)</span><span class="w">
</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">gdp.data</span><span class="o">$</span><span class="n">Ranking</span><span class="p">))</span><span class="w">

</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="s2">"https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv"</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="s2">"./c3-w3-other.csv"</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">
</span><span class="n">edu.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./c3-w3-other.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">


</span><span class="n">pandian</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">gdp.data</span><span class="p">,</span><span class="n">edu.data</span><span class="p">,</span><span class="n">by.x</span><span class="o">=</span><span class="s2">"X"</span><span class="p">,</span><span class="n">by.y</span><span class="o">=</span><span class="s2">"CountryCode"</span><span class="p">)</span><span class="w">

</span><span class="nf">length</span><span class="p">(</span><span class="n">grep</span><span class="p">(</span><span class="s2">"[Ff]iscal(.*)[Jj]une [0-9]"</span><span class="p">,</span><span class="n">pandian</span><span class="o">$</span><span class="n">Special.Notes</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h3 id="summary">Summary</h3>

<ul>
  <li>Regular expressions are used in many different languages; not unique to R.</li>
  <li>Regular expressions are composed of literals and metacharacters that represent sets or classes of characters/words</li>
  <li>Text processing via regular expressions is a very powerful way to extract data from ‚Äúunfriendly‚Äù sources (not all data comes as a CSV file)</li>
  <li>Used with the functions <code class="language-plaintext highlighter-rouge">grep</code>,<code class="language-plaintext highlighter-rouge">grepl</code>,<code class="language-plaintext highlighter-rouge">sub</code>,<code class="language-plaintext highlighter-rouge">gsub</code> and others that involve searching for text strings
(Thanks to Mark Hansen for some material in this lecture.)</li>
</ul>

<h2 id="dates--times">Dates &amp; Times</h2>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date</span><span class="p">()</span><span class="w"> </span><span class="c1"># class is "char"</span><span class="w">
</span><span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sys.Date</span><span class="p">()</span><span class="w"> </span><span class="c1"># class is "Date"</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Sun Jan 12 17:48:33 2014"
[2] "2014-01-12"
</code></pre></div></div>
<p><strong>Formatting dates</strong></p>

<p><code class="language-plaintext highlighter-rouge">%d</code> = day as number (0-31), <code class="language-plaintext highlighter-rouge">%a</code> = abbreviated weekday,<code class="language-plaintext highlighter-rouge">%A</code> = unabbreviated weekday, <code class="language-plaintext highlighter-rouge">%m</code> = month (00-12), <code class="language-plaintext highlighter-rouge">%b</code> = abbreviated month,
<code class="language-plaintext highlighter-rouge">%B</code> = unabbrevidated month, <code class="language-plaintext highlighter-rouge">%y</code> = 2 digit year, <code class="language-plaintext highlighter-rouge">%Y</code> = four digit year</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">format</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="s2">"%a %b %d"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Sun Jan 12"
</code></pre></div></div>

<p><strong>Creating dates</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"1jan1960"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2jan1960"</span><span class="p">,</span><span class="w"> </span><span class="s2">"31mar1960"</span><span class="p">,</span><span class="w"> </span><span class="s2">"30jul1960"</span><span class="p">);</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s2">"%d%b%Y"</span><span class="p">)</span><span class="w">
</span><span class="n">z</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "1960-01-01" "1960-01-02" "1960-03-31" "1960-07-30"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">z</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">z</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Time difference of -1 days
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">as.numeric</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] -1
</code></pre></div></div>

<p><strong>Converting to Julian</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">weekdays</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Sunday"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">months</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "January"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">julian</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 16082
attr(,"origin")
[1] "1970-01-01"
</code></pre></div></div>

<p><strong>Lubridate</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">);</span><span class="w"> </span><span class="n">ymd</span><span class="p">(</span><span class="s2">"20140108"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "2014-01-08 UTC"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mdy</span><span class="p">(</span><span class="s2">"08/04/2013"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "2013-08-04 UTC"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dmy</span><span class="p">(</span><span class="s2">"03-04-2013"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "2013-04-03 UTC"
</code></pre></div></div>

<p><a href="http://www.r-statistics.com/2012/03/do-more-with-dates-and-times-in-r-with-lubridate-1-1-0/">http://www.r-statistics.com/2012/03/do-more-with-dates-and-times-in-r-with-lubridate-1-1-0/</a></p>

<p><strong>Dealing with times</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ymd_hms</span><span class="p">(</span><span class="s2">"2011-08-03 10:15:03"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "2011-08-03 10:15:03 UTC"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ymd_hms</span><span class="p">(</span><span class="s2">"2011-08-03 10:15:03"</span><span class="p">,</span><span class="n">tz</span><span class="o">=</span><span class="s2">"Pacific/Auckland"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "2011-08-03 10:15:03 NZST"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">Sys.timezone</span><span class="w">
</span></code></pre></div></div>

<p><a href="http://www.r-statistics.com/2012/03/do-more-with-dates-and-times-in-r-with-lubridate-1-1-0/">http://www.r-statistics.com/2012/03/do-more-with-dates-and-times-in-r-with-lubridate-1-1-0/</a></p>

<p><strong>Some functions have slightly different syntax</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dmy</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"1jan2013"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2jan2013"</span><span class="p">,</span><span class="w"> </span><span class="s2">"31mar2013"</span><span class="p">,</span><span class="w"> </span><span class="s2">"30jul2013"</span><span class="p">))</span><span class="w">
</span><span class="n">wday</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wday</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] Tues
Levels: Sun &lt; Mon &lt; Tues &lt; Wed &lt; Thurs &lt; Fri &lt; Sat
</code></pre></div></div>

<h3 id="dates-and-times-from-exploratory-graphs-assignment-learnings-c4">DATES and TIMEs from Exploratory graphs assignment learnings C4</h3>

<p>Mixing Date and Time for graphs. <a href="https://stackoverflow.com/questions/11609252/r-tick-data-merging-date-and-time-into-a-single-object">Source: Stack</a>.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">$</span><span class="n">Date</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Date</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="o">$</span><span class="n">Time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Time</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="o">$</span><span class="n">DateTime</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">Time</span><span class="p">),</span><span class="w">
                          </span><span class="n">format</span><span class="o">=</span><span class="s2">"%d/%m/%Y %H:%M:%S"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="o">$</span><span class="n">Date.Time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dmy_hms</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">Time</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><strong>Notes and further resources</strong></p>

<ul>
  <li>More information in this nice lubridate tutorial <a href="http://www.r-statistics.com/2012/03/do-more-with-dates-and-times-in-r-with-lubridate-1-1-0/">http://www.r-statistics.com/2012/03/do-more-with-dates-and-times-in-r-with-lubridate-1-1-0/</a></li>
  <li>The lubridate vignette is the same content <a href="http://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html">http://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html</a></li>
  <li>Ultimately you want your dates and times as class ‚ÄúDate‚Äù or the classes ‚ÄúPOSIXct‚Äù, ‚ÄúPOSIXlt‚Äù. For more information type <code class="language-plaintext highlighter-rouge">?POSIXlt</code></li>
</ul>

<h4 id="quiz-q-c3-w4">Quiz q c3-w4</h4>

<p>You can use the quantmod (http://www.quantmod.com/) package to get historical stock prices for publicly traded companies on the NASDAQ and NYSE. Use the following code to download data on Amazon‚Äôs stock price and get the times the data was sampled.</p>

<p>
How many values were collected in 2012? How many values were collected on Mondays in 2012?</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">quantmod</span><span class="p">)</span><span class="w">
</span><span class="n">amzn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSymbols</span><span class="p">(</span><span class="s2">"AMZN"</span><span class="p">,</span><span class="n">auto.assign</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">sampleTimes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="p">(</span><span class="n">amzn</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span><span class="n">sampleYears</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">sampleTimes</span><span class="p">)</span><span class="w">
</span><span class="nf">length</span><span class="p">(</span><span class="n">sampleYears</span><span class="p">[</span><span class="n">sampleYears</span><span class="o">==</span><span class="m">2012</span><span class="p">])</span><span class="w">

</span><span class="nf">length</span><span class="p">(</span><span class="n">sampleTimes</span><span class="p">[</span><span class="n">year</span><span class="p">(</span><span class="n">sampleTimes</span><span class="p">)</span><span class="o">==</span><span class="m">2012</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">weekdays</span><span class="p">(</span><span class="n">sampleTimes</span><span class="p">)</span><span class="o">==</span><span class="s2">"maandag"</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<h3 id="working-with-time-difference-str_padstrptime">Working with TIME, difference, str_pad,strptime</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mn1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarize</span><span class="p">(</span><span class="n">num.of.steps.per.day</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span><span class="w">

                                        </span><span class="c1"># convert mn1 interval to DT</span><span class="w">
                                        </span><span class="c1"># subtract!</span><span class="w">

</span><span class="n">mn1</span><span class="o">$</span><span class="n">interval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">mn1.interval</span><span class="p">)</span><span class="w">
</span><span class="n">mn1</span><span class="o">$</span><span class="n">interval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_pad</span><span class="p">(</span><span class="n">mn1</span><span class="o">$</span><span class="n">interval</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">side</span><span class="o">=</span><span class="s2">"left"</span><span class="p">,</span><span class="w"> </span><span class="n">pad</span><span class="o">=</span><span class="s2">"0"</span><span class="p">)</span><span class="w">
</span><span class="n">mn1</span><span class="o">$</span><span class="n">interval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">strptime</span><span class="p">(</span><span class="n">mn1</span><span class="o">$</span><span class="n">interval</span><span class="p">,</span><span class="s2">"%H%M"</span><span class="p">)</span><span class="w">
</span><span class="n">mn1</span><span class="w">
</span><span class="n">mn1</span><span class="o">$</span><span class="n">actualInterval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mn1</span><span class="o">$</span><span class="n">interval</span><span class="o">-</span><span class="n">mn1</span><span class="o">$</span><span class="n">interval</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">mna</span><span class="o">$</span><span class="n">actualInterval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">mn1</span><span class="o">$</span><span class="n">actualInterval</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="data-resources">Data resources</h2>

<p><a href="https://github.com/DataScienceSpecialization/courses/blob/master/03_GettingData/04_05_dataResources/index.md">Source</a></p>

<h3 id="open-government-sites">Open Government Sites</h3>

<ul>
  <li>United Nations <a href="http://data.un.org/">http://data.un.org/</a></li>
  <li>U.S. <a href="http://www.data.gov/">http://www.data.gov/</a>
    <ul>
      <li><a href="http://simplystatistics.org/2012/01/02/list-of-cities-states-with-open-data-help-me-find/">List of cities/states with open data</a></li>
    </ul>
  </li>
  <li>United Kingdom <a href="http://data.gov.uk/">http://data.gov.uk/</a></li>
  <li>France <a href="http://www.data.gouv.fr/">http://www.data.gouv.fr/</a></li>
  <li>Ghana <a href="http://data.gov.gh/">http://data.gov.gh/</a></li>
  <li>Australia <a href="http://data.gov.au/">http://data.gov.au/</a></li>
  <li>Germany <a href="https://www.govdata.de/">https://www.govdata.de/</a></li>
  <li>Hong Kong <a href="http://www.gov.hk/en/theme/psi/datasets/">http://www.gov.hk/en/theme/psi/datasets/</a></li>
  <li>Japan <a href="http://www.data.go.jp/">http://www.data.go.jp/</a></li>
  <li>Many more <a href="http://www.data.gov/opendatasites">http://www.data.gov/opendatasites</a></li>
</ul>

<hr />

<h3 id="gapminder">Gapminder</h3>

<p>&lt;img class=center src=../../assets/img/03_ObtainingData/gapminder.png height=400/&gt;</p>

<p><a href="http://www.gapminder.org/">http://www.gapminder.org/</a></p>

<hr />

<h3 id="survey-data-from-the-united-states">Survey data from the United States</h3>

<p>&lt;img class=center src=../../assets/img/03_ObtainingData/asdfree.png height=400/&gt;</p>

<p><a href="http://www.asdfree.com/">http://www.asdfree.com/</a></p>

<hr />

<h3 id="infochimps-marketplace">Infochimps Marketplace</h3>

<p>&lt;img class=center src=../../assets/img/03_ObtainingData/infochimps.png height=400/&gt;</p>

<p><a href="http://www.infochimps.com/marketplace">http://www.infochimps.com/marketplace</a></p>

<hr />

<h3 id="kaggle">Kaggle</h3>

<p>&lt;img class=center src=../../assets/img/03_ObtainingData/kaggle.png  height=400 /&gt;</p>

<p><a href="http://www.kaggle.com/">http://www.kaggle.com/</a></p>

<hr />

<h3 id="collections-by-data-scientists">Collections by data scientists</h3>

<ul>
  <li>Hilary Mason http://bitly.com/bundles/hmason/1</li>
  <li>Peter Skomoroch https://delicious.com/pskomoroch/dataset</li>
  <li>Jeff Hammerbacher http://www.quora.com/Jeff-Hammerbacher/Introduction-to-Data-Science-Data-Sets</li>
  <li>Gregory Piatetsky-Shapiro http://www.kdnuggets.com/gps.html</li>
  <li><a href="http://blog.mortardata.com/post/67652898761/6-dataset-lists-curated-by-data-scientists">http://blog.mortardata.com/post/67652898761/6-dataset-lists-curated-by-data-scientists</a></li>
</ul>

<hr />

<h3 id="more-specialized-collections">More specialized collections</h3>

<ul>
  <li><a href="http://snap.stanford.edu/data/">Stanford Large Network Data</a></li>
  <li><a href="http://archive.ics.uci.edu/ml/">UCI Machine Learning</a></li>
  <li><a href="http://www.kdnuggets.com/datasets/index.html">KDD Nugets Datasets</a></li>
  <li><a href="http://lib.stat.cmu.edu/datasets/">CMU Statlib</a></li>
  <li><a href="http://www.ncbi.nlm.nih.gov/geo/">Gene expression omnibus</a></li>
  <li><a href="http://arxiv.org/help/bulk_data">ArXiv Data</a></li>
  <li><a href="http://aws.amazon.com/publicdatasets/">Public Data Sets on Amazon Web Services</a></li>
</ul>

<hr />

<h3 id="some-apis-with-r-interfaces">Some API‚Äôs with R interfaces</h3>

<ul>
  <li><a href="https://dev.twitter.com/">twitter</a> and <a href="http://cran.r-project.org/web/packages/twitteR/index.html">twitteR</a> package</li>
  <li><a href="http://api.figshare.com/docs/intro.html">figshare</a> and <a href="http://cran.r-project.org/web/packages/rfigshare/index.html">rfigshare</a></li>
  <li><a href="http://api.plos.org/">PLoS</a> and <a href="http://cran.r-project.org/web/packages/rplos/rplos.pdf">rplos</a></li>
  <li><a href="http://ropensci.org/packages/index.html">rOpenSci</a></li>
  <li><a href="https://developers.facebook.com/">Facebook</a> and <a href="http://cran.r-project.org/web/packages/Rfacebook/">RFacebook</a>
          * <a href="https://developers.google.com/maps/">Google maps</a> and <a href="http://cran.r-project.org/web/packages/RgoogleMaps/index.html">RGoogleMaps</a></li>
</ul>

<h2 id="course4-exploratory-data-analysis">Course4: Exploratory data Analysis</h2>

<h2 id="principles">Principles</h2>

<ul>
  <li>Principle 1: Show comparisons</li>
  <li>Principle 2: Show causality, mechanism, explanation</li>
  <li>Principle 3: Show multivariate data</li>
  <li>Principle 4: Integrate multiple modes of evidence</li>
  <li>Principle 5: Describe and document the evidence</li>
  <li>
    <p>Principle 6: Content is king</p>
  </li>
  <li>
    <p>Principle 1: Show comparisons</p>

    <ul>
      <li>
        <p>Evidence for a hypothesis is always <em>relative</em> to another competing
hypothesis.</p>
      </li>
      <li>
        <p>Always ask ‚ÄúCompared to What?‚Äù</p>
      </li>
    </ul>
  </li>
  <li>Principle 2: Show causality, mechanism, explanation, systematic structure
    <ul>
      <li>What is your causal framework for thinking about a question?</li>
    </ul>
  </li>
  <li>Principle 3: Show multivariate data
    <ul>
      <li>Multivariate = more than 2 variables</li>
      <li>The real world is multivariate</li>
      <li>Need to ‚Äúescape flatland‚Äù</li>
    </ul>
  </li>
  <li>Principle 4: Integration of evidence
    <ul>
      <li>
        <p>Completely integrate words, numbers, images, diagrams</p>
      </li>
      <li>
        <p>Data graphics should make use of many modes of data presentation</p>
      </li>
      <li>
        <p>Don‚Äôt let the tool drive the analysis</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Principle 5: Describe and document the evidence with appropriate
labels, scales, sources, etc.</p>

    <ul>
      <li>A data graphic should tell a complete story that is credible</li>
    </ul>
  </li>
  <li>
    <p>Principle 6: Content is king</p>

    <ul>
      <li>Analytical presentations ultimately stand or fall depending on the
quality, relevance, and integrity of their content</li>
    </ul>
  </li>
</ul>

<h2 id="exploratory-graphics">Exploratory graphics</h2>

<h3 id="air-pollution-in-the-united-states">Air Pollution in the United States</h3>

<ul>
  <li>
    <p>The U.S. Environmental Protection Agency (EPA) sets national ambient
air quality standards for outdoor air pollution</p>

    <ul>
      <li><a href="http://www.epa.gov/air/criteria.html">U.S. National Ambient Air Quality Standards</a></li>
    </ul>
  </li>
  <li>
    <p>For fine particle pollution (PM2.5), the ‚Äúannual mean, averaged over
3 years‚Äù cannot exceed $12~\mu g/m^3$.</p>
  </li>
  <li>
    <p>Data on daily PM2.5 are available from the U.S. EPA web site</p>

    <ul>
      <li><a href="http://www.epa.gov/ttn/airs/airsaqs/detaildata/downloadaqsdata.htm">EPA Air Quality System</a></li>
    </ul>
  </li>
  <li>
    <p><strong>Question</strong>: Are there any counties in the U.S. that exceed that
national standard for fine particle pollution?</p>
  </li>
</ul>

<hr />

<h3 id="data">Data</h3>

<p>Annual average PM2.5 averaged over the period 2008 through 2010 is
available on jtleeks repository <a href="https://github.com/jtleek/modules/blob/master/04_ExploratoryAnalysis/exploratoryGraphs/data/avgpm25.csv">here</a>. The actual csv file can be
accessed from <a href="https://raw.githubusercontent.com/jtleek/modules/master/04_ExploratoryAnalysis/exploratoryGraphs/data/avgpm25.csv">here</a>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fileUrl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
</span><span class="s2">"https://raw.githubusercontent.com/jtleek/modules/master/04_ExploratoryAnalysis/exploratoryGraphs/data/avgpm25.csv"</span><span class="w"> 

</span><span class="n">download.file</span><span class="p">(</span><span class="n">fileUrl</span><span class="p">,</span><span class="w"> </span><span class="n">destfile</span><span class="o">=</span><span class="s2">"./data/avgpm25.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s2">"curl"</span><span class="p">)</span><span class="w">

</span><span class="n">pollution</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"./data/avgpm25.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">colClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="s2">"character"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"factor"</span><span class="p">,</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">pollution</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##     pm25  fips region longitude latitude
## 1  9.771 01003   east    -87.75    30.59
## 2  9.994 01027   east    -85.84    33.27
## 3 10.689 01033   east    -87.73    34.73
## 4 11.337 01049   east    -85.80    34.46
## 5 12.120 01055   east    -86.03    34.02
## 6 10.828 01069   east    -85.35    31.19
</code></pre></div></div>

<p>Do any counties exceed the standard of $12~\mu g/m^3$?</p>

<hr />

<h3 id="summary-of-data-view-data">Summary of data, View data</h3>

<p>One dimension</p>

<ul>
  <li>Five-number summary</li>
  <li>Boxplots</li>
  <li>Histograms</li>
  <li>Density plot</li>
  <li>Barplot</li>
</ul>

<hr />

<h3 id="five-number-summary">Five Number Summary</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    3.38    8.55   10.00    9.84   11.40   18.40
</code></pre></div></div>

<hr />

<h3 id="boxplot">Boxplot</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">boxplot</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><a href="https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51">Nice explanation of box plots</a></p>

<ul>
  <li>
    <p>median (Q2/50th Percentile): the middle value of the dataset.</p>
  </li>
  <li>
    <p>first quartile (Q1/25th Percentile): the middle number between the smallest number (not the ‚Äúminimum‚Äù) and the median of the dataset.</p>
  </li>
  <li>
    <p>third quartile (Q3/75th Percentile): the middle value between the median and the highest value (not the ‚Äúmaximum‚Äù) of the dataset.</p>
  </li>
  <li>
    <p>interquartile range (IQR): 25th to the 75th percentile.</p>
  </li>
  <li>
    <p>whiskers (shown in blue)</p>
  </li>
  <li>
    <p>outliers (shown as green circles)</p>
  </li>
  <li>
    <p>‚Äúmaximum‚Äù: Q3 + 1.5*IQR</p>
  </li>
  <li>
    <p>‚Äúminimum‚Äù: Q1 -1.5*IQR</p>
  </li>
</ul>

<hr />

<h3 id="histogram">Histogram</h3>
<p>Bar plot basically!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hist</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Rug representation roughly informs about density by plotting below
histogram.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hist</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span><span class="n">rug</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">breaks</code> parameter is used for determining the number of segments on
the Histogram.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hist</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">rug</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="overlaying-features">Overlaying Features</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">boxplot</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hist</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">pm25</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"magenta"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="barplot">Barplot</h3>

<p>Barplot is the histogram of text based info but without quantile and
all that shit!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">barplot</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">pollution</span><span class="o">$</span><span class="n">region</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wheat"</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Number of Counties in Each Region"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="what-plots-to-see-2-dimensions">What plots to see &gt;2 dimensions</h3>

<p><strong>Two dimensions</strong></p>

<ul>
  <li>Multiple/overlayed 1-D plots (Lattice/ggplot2)</li>
  <li>Scatterplots</li>
  <li>Smooth scatterplots</li>
</ul>

<p><strong>greater than 2 dimensions</strong></p>

<ul>
  <li>Overlayed/multiple 2-D plots; coplots</li>
  <li>Use color, size, shape to add dimensions</li>
  <li>Spinning plots</li>
  <li>Actual 3-D plots (not that useful)</li>
</ul>

<hr />

<h3 id="multiple-boxplots">Multiple Boxplots</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">boxplot</span><span class="p">(</span><span class="n">pm25</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pollution</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="multiple-histograms">Multiple Histograms</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">pollution</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"east"</span><span class="p">)</span><span class="o">$</span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">pollution</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"west"</span><span class="p">)</span><span class="o">$</span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="scatterplot">Scatterplot</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">with</span><span class="p">(</span><span class="n">pollution</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">pm25</span><span class="p">))</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="scatterplot---using-color">Scatterplot - Using Color</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">with</span><span class="p">(</span><span class="n">pollution</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">region</span><span class="p">))</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="multiple-scatterplots">Multiple Scatterplots</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">pollution</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"west"</span><span class="p">),</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"West"</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">pollution</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"east"</span><span class="p">),</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">pm25</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"East"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="summary-1">Summary</h3>

<ul>
  <li>
    <p>Exploratory plots are ‚Äúquick and dirty‚Äù</p>
  </li>
  <li>
    <p>Let you summarize the data (usually graphically) and highlight any broad features</p>
  </li>
  <li>
    <p>Explore basic questions and hypotheses (and perhaps rule them out)</p>
  </li>
  <li>
    <p>Suggest modeling strategies for the ‚Äúnext step‚Äù</p>
  </li>
</ul>

<hr />

<h3 id="further-resources">Further resources</h3>

<ul>
  <li><a href="http://gallery.r-enthusiasts.com/">R Graph Gallery</a></li>
  <li><a href="http://www.r-bloggers.com/">R Bloggers</a></li>
</ul>

<h2 id="plotting-systems">Plotting systems</h2>
<p>Functions like <code class="language-plaintext highlighter-rouge">plot</code> in base, <code class="language-plaintext highlighter-rouge">xyplot</code> in lattice, or <code class="language-plaintext highlighter-rouge">qplot</code> in
ggplot2 will default to sending a plot to the screen device</p>

<h3 id="the-base-plotting-system">The Base Plotting System</h3>

<ul>
  <li>‚ÄúArtist‚Äôs palette‚Äù model</li>
  <li>Start with blank canvas and build up from there</li>
  <li>
    <p>Start with plot function (or similar)</p>
  </li>
  <li>
    <p>Use annotation functions to add/modify (<code class="language-plaintext highlighter-rouge">text</code>, <code class="language-plaintext highlighter-rouge">lines</code>, <code class="language-plaintext highlighter-rouge">points</code>,
<code class="language-plaintext highlighter-rouge">axis</code>)</p>
  </li>
  <li>
    <p>Convenient, mirrors how we think of building plots and analyzing data</p>
  </li>
  <li>
    <p>** Can‚Äôt go back once** plot has started (i.e. to adjust margins); need
to plan in advance</p>
  </li>
  <li>
    <p>Difficult to ‚Äútranslate‚Äù to others once a new plot has been created
(no graphical ‚Äúlanguage‚Äù)</p>
  </li>
  <li>Plot is just a series of R commands</li>
</ul>

<hr />

<h3 id="base-plot">Base Plot</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">cars</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span><span class="w"> </span><span class="n">dist</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="the-lattice-system">The Lattice System</h3>

<ul>
  <li>
    <p>Plots are created with a single function call (<code class="language-plaintext highlighter-rouge">xyplot</code>, <code class="language-plaintext highlighter-rouge">bwplot</code>,
etc.)</p>
  </li>
  <li>
    <p>Most useful for conditioning types of plots: Looking at how y changes with x across levels of z</p>
  </li>
  <li>
    <p>Things like margins/spacing set automatically because entire plot is
specified at once</p>
  </li>
  <li>
    <p>Good for puttng many many plots on a screen</p>
  </li>
  <li>
    <p>Sometimes awkward to specify an entire plot in a single function call</p>
  </li>
  <li>
    <p>Annotation in plot is not especially intuitive</p>
  </li>
  <li>
    <p>Use of panel functions and subscripts difficult to wield and
requires intense preparation</p>
  </li>
  <li>
    <p>Cannot ‚Äúadd‚Äù to the plot once it is created</p>
  </li>
</ul>

<hr />

<h3 id="lattice-plot">Lattice Plot</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span><span class="w">
</span><span class="n">state</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">state.x77</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.region</span><span class="p">)</span><span class="w">
</span><span class="n">xyplot</span><span class="p">(</span><span class="n">Life.Exp</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-2.png" alt="plot of chunk unnamed-chunk-2" /></p>

<hr />

<h3 id="the-ggplot2-system">The ggplot2 System</h3>

<ul>
  <li>
    <p>Splits the difference between base and lattice in a number of ways</p>
  </li>
  <li>
    <p>Automatically deals with spacings, text, titles but also allows you
to annotate by ‚Äúadding‚Äù to a plot</p>
  </li>
  <li>
    <p>Superficial similarity to lattice but generally easier/more
intuitive to use</p>
  </li>
  <li>
    <p>Default mode makes many choices for you (but you can still customize
to your heart‚Äôs desire)</p>
  </li>
</ul>

<hr />

<h3 id="ggplot2-plot">ggplot2 Plot</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span><span class="w">
</span><span class="n">qplot</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span><span class="w"> </span><span class="n">hwy</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="summary-2">Summary</h3>

<ul>
  <li>
    <p>Base: ‚Äúartist‚Äôs palette‚Äù model</p>
  </li>
  <li>
    <p>Lattice: Entire plot specified by one function; conditioning</p>
  </li>
  <li>
    <p>ggplot2: Mixes elements of Base and Lattice</p>
  </li>
</ul>

<hr />

<h3 id="references">References</h3>

<p>Paul Murrell (2011). <em>R Graphics</em>, CRC Press.</p>

<p>Hadley Wickham (2009). <em>ggplot2</em>, Springer.</p>
<h2 id="what-is-a-graphics-device">What is a Graphics Device?</h2>

<ul>
  <li>
    <p>A graphics device is something where you can make a plot appear</p>

    <ul>
      <li>
        <p>A window on your computer (screen device); Linux <code class="language-plaintext highlighter-rouge">x11()</code></p>
      </li>
      <li>
        <p>A PDF file (file device)</p>
      </li>
      <li>
        <p>A PNG or JPEG file (file device)</p>
      </li>
      <li>
        <p>A scalable vector graphics (SVG) file (file device)</p>
      </li>
    </ul>
  </li>
  <li>
    <p>The most common place for a plot to be ‚Äúsent‚Äù is the <em>screen device</em></p>

    <ul>
      <li>On Unix/Linux the screen device is launched with <code class="language-plaintext highlighter-rouge">x11()</code></li>
    </ul>
  </li>
  <li>
    <p>When making a plot, you need to consider how the plot will be used
to determine what device the plot should be sent to.</p>

    <ul>
      <li>The list of devices is found in <code class="language-plaintext highlighter-rouge">?Devices</code>; there are also devices
created by users on CRAN</li>
    </ul>
  </li>
  <li>
    <p>For quick visualizations and exploratory analysis, usually you want
to use the screen device</p>

    <ul>
      <li>Functions like <code class="language-plaintext highlighter-rouge">plot</code> in base, <code class="language-plaintext highlighter-rouge">xyplot</code> in lattice, or <code class="language-plaintext highlighter-rouge">qplot</code> in
ggplot2 will default to sending a plot to the screen device</li>
    </ul>
  </li>
  <li>
    <p>otherwise use the file device</p>
  </li>
</ul>

<hr />

<h3 id="screen-device">Screen Device</h3>

<ol>
  <li>Call a plotting function like <code class="language-plaintext highlighter-rouge">plot</code>, <code class="language-plaintext highlighter-rouge">xyplot</code>, or <code class="language-plaintext highlighter-rouge">qplot</code></li>
</ol>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">faithful</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">eruptions</span><span class="p">,</span><span class="w"> </span><span class="n">waiting</span><span class="p">))</span><span class="w">  </span><span class="c1">## Make plot appear on screen device</span><span class="w">
</span><span class="n">title</span><span class="p">(</span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Old Faithful Geyser data"</span><span class="p">)</span><span class="w">  </span><span class="c1">## Annotate with a title</span><span class="w">
</span></code></pre></div></div>

<h3 id="file-device">File Device</h3>

<p>The second approach to plotting is most commonly used for file devices:</p>

<ol>
  <li>
    <p>Explicitly launch a graphics device</p>
  </li>
  <li>
    <p>Call a plotting function to make a plot (Note: if you are using a file
device, no plot will appear on the screen)</p>
  </li>
  <li>
    <p>Annotate plot if necessary</p>
  </li>
  <li>
    <p>Explicitly close graphics device with <code class="language-plaintext highlighter-rouge">dev.off()</code> (<strong>this is very important!)</strong></p>
  </li>
</ol>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pdf</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myplot.pdf"</span><span class="p">)</span><span class="w">  </span><span class="c1">## Open PDF device; create 'myplot.pdf' in my working directory</span><span class="w">
</span><span class="c1">## Create plot and send to a file (no plot appears on screen)</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">faithful</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">eruptions</span><span class="p">,</span><span class="w"> </span><span class="n">waiting</span><span class="p">))</span><span class="w">
</span><span class="n">title</span><span class="p">(</span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Old Faithful Geyser data"</span><span class="p">)</span><span class="w">  </span><span class="c1">## Annotate plot; still nothing on screen</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">  </span><span class="c1">## Close the PDF file device</span><span class="w">
</span><span class="c1">## Now you can view the file 'myplot.pdf' on your computer</span><span class="w">
</span></code></pre></div></div>
<p>Another example</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">png</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">"plot1.png"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">480</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">480</span><span class="p">)</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Global_active_power</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">main</span><span class="o">=</span><span class="s2">"Global Active Power"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Global Active Power (kilowatts)"</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="vector-file-devices-types">Vector: File Devices types</h3>

<p>There are two basic types of file devices: <em>vector</em> and <em>bitmap</em>
devices</p>

<p>Vector formats:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pdf</code>: useful for line-type graphics, resizes well, usually
portable, not efficient if a plot has many objects/points</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">svg</code>: XML-based scalable vector graphics; supports animation and
interactivity, potentially useful for web-based plots</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">win.metafile</code>: Windows metafile format (only on Windows)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">postscript</code>: older format, also resizes well, usually portable, can
be used to create encapsulated postscript files; Windows systems
often don‚Äôt have a postscript viewer</p>
  </li>
</ul>

<hr />

<h3 id="bitmap-file-devices">Bitmap: File Devices</h3>

<p>Bitmap formats</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">png</code>: bitmapped format, good for line drawings or images with solid
colors, uses lossless compression (like the old GIF format), most
web browsers can read this format natively, good for plotting many
many many points, does not resize well</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">jpeg</code>: good for photographs or natural scenes, uses lossy
compression, good for plotting many many many points, does not
resize well, can be read by almost any computer and any web browser,
not great for line drawings</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">tiff</code>: Creates bitmap files in the TIFF format; supports lossless
compression</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bmp</code>: a native Windows bitmapped format</p>
  </li>
</ul>

<hr />

<h3 id="multiple-open-graphics-devices">Multiple Open Graphics Devices</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x11</span><span class="p">()</span><span class="w"> </span><span class="c1"># 1st screen</span><span class="w">
</span><span class="n">x11</span><span class="p">()</span><span class="w"> </span><span class="c1"># 2nd screen</span><span class="w">

</span><span class="n">dev.cur</span><span class="p">()</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="n">X11cairo</span><span class="w">
     </span><span class="m">3</span><span class="w">
	
</span><span class="n">dev.set</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="n">X11cairo</span><span class="w">
     </span><span class="m">2</span><span class="w">
</span></code></pre></div></div>

<h3 id="copying-plots-display-and-save-plots">Copying Plots; display and save plots</h3>

<p>Copying a plot to another device can be useful because some plots
require a lot of code and it can be a pain to type all that in again
for a different device.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dev.copy</code>: copy a plot from one device to another</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dev.copy2pdf</code>: specifically copy a plot to a PDF file</p>
  </li>
</ul>

<p>NOTE: Copying a plot is not an exact operation, so the result may not
be identical to the original.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">faithful</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">eruptions</span><span class="p">,</span><span class="w"> </span><span class="n">waiting</span><span class="p">))</span><span class="w">  </span><span class="c1">## Create plot on screen device</span><span class="w">
</span><span class="n">title</span><span class="p">(</span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Old Faithful Geyser data"</span><span class="p">)</span><span class="w">  </span><span class="c1">## Add a main title</span><span class="w">
</span><span class="n">dev.copy</span><span class="p">(</span><span class="n">png</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"geyserplot.png"</span><span class="p">)</span><span class="w">  </span><span class="c1">## Copy my plot to a PNG file</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">  </span><span class="c1">## Don't forget to close the PNG device!</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">with</span><span class="p">(</span><span class="n">faithful</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">eruptions</span><span class="p">,</span><span class="n">waiting</span><span class="p">))</span><span class="w">
</span><span class="n">dev.copy2pdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"pandian"</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="example-multiplot-base-plotting-system-using-legend">Example Multiplot base plotting system using legend</h3>
<p>As part of assignment,</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">DateTime</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">Sub_metering_1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Energy sub metering"</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
	</span><span class="n">lines</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">DateTime</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">Sub_metering_2</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">DateTime</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">Sub_metering_3</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Sub_metering_1"</span><span class="p">,</span><span class="s2">"Sub_metering_2"</span><span class="p">,</span><span class="s2">"Sub_metering_3"</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">),</span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<p>The below <strong>Doesn‚Äôt work</strong>. Spent way too much time on it.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## legend(1, 95,</span><span class="w">
</span><span class="n">legend</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Sub_metering_1"</span><span class="p">,</span><span class="s2">"Sub_metering_2"</span><span class="p">,</span><span class="s2">"Sub_metering_3"</span><span class="p">),</span><span class="w">
</span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">),</span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<h3 id="language-settings-on-plots">Language settings on plots</h3>

<p><a href="https://stackoverflow.com/questions/17031002/get-weekdays-in-english-in-r">Stack Source</a></p>

<p>Do this and all languages will be in english on the plots</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sys.setlocale("LC_TIME", "en_US")
</code></pre></div></div>

<h3 id="summary-3">Summary</h3>

<ul>
  <li>
    <p>Plots must be created on a graphics device</p>
  </li>
  <li>
    <p>The default graphics device is almost always the screen device,
which is most useful for exploratory analysis</p>
  </li>
  <li>
    <p>File devices are useful for creating plots that can be included in
other documents or sent to other people</p>
  </li>
  <li>
    <p>For file devices, there are vector and bitmap formats</p>

    <ul>
      <li>
        <p>Vector formats are good for line drawings and plots with solid
colors using a modest number of points</p>
      </li>
      <li>
        <p>Bitmap formats are good for plots with a large number of points,
natural scenes or web-based plots</p>
        <h2 id="the-lattice-plotting-system">The Lattice Plotting System</h2>
      </li>
    </ul>
  </li>
</ul>

<p>The lattice plotting system is implemented using the following packages:</p>

<ul>
  <li>
    <p><em>lattice</em>: contains code for producing Trellis graphics, which are
 independent of the ‚Äúbase‚Äù graphics system; includes functions like
 <code class="language-plaintext highlighter-rouge">xyplot</code>, <code class="language-plaintext highlighter-rouge">bwplot</code>, <code class="language-plaintext highlighter-rouge">levelplot</code></p>
  </li>
  <li><em>grid</em>: implements a different graphing system independent of the
 ‚Äúbase‚Äù system; the <em>lattice</em> package builds on top of <em>grid</em>
    <ul>
      <li>We seldom call functions from the <em>grid</em> package directly</li>
    </ul>
  </li>
  <li>
    <p>The lattice plotting system does not have a ‚Äútwo-phase‚Äù aspect with
separate plotting and annotation like in base plotting</p>
  </li>
  <li>All plotting/annotation is done at once with a single function call</li>
</ul>

<hr />

<h3 id="lattice-functions">Lattice Functions</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">xyplot</code>: this is the main function for creating scatterplots</li>
  <li><code class="language-plaintext highlighter-rouge">bwplot</code>: box-and-whiskers plots (‚Äúboxplots‚Äù)</li>
  <li><code class="language-plaintext highlighter-rouge">histogram</code>: histograms</li>
  <li><code class="language-plaintext highlighter-rouge">stripplot</code>: like a boxplot but with actual points</li>
  <li><code class="language-plaintext highlighter-rouge">dotplot</code>: plot dots on ‚Äúviolin strings‚Äù</li>
  <li><code class="language-plaintext highlighter-rouge">splom</code>: scatterplot matrix; like <code class="language-plaintext highlighter-rouge">pairs</code> in base plotting system</li>
  <li><code class="language-plaintext highlighter-rouge">levelplot</code>, <code class="language-plaintext highlighter-rouge">contourplot</code>: for plotting ‚Äúimage‚Äù data</li>
</ul>

<p>Lattice functions generally take a formula for their first argument, usually of the form</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xyplot</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>
    <p>We use the <em>formula notation</em> here, hence the <code class="language-plaintext highlighter-rouge">~</code>.</p>
  </li>
  <li>
    <p>On the left of the ~ is the y-axis variable, on the right is the
x-axis variable</p>
  </li>
  <li>f and g are <em>conditioning variables</em> ‚Äî they are optional
    <ul>
      <li>the * indicates an interaction between two variables</li>
    </ul>
  </li>
  <li>
    <p>The second argument is the data frame or list from which the
variables in the formula should be looked up</p>

    <ul>
      <li>If no data frame or list is passed, then the parent frame is used.</li>
    </ul>
  </li>
  <li>If no other arguments are passed, there are defaults that can be used.</li>
</ul>

<hr />
<h3 id="simple-lattice-plot">Simple Lattice Plot</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="w">
</span><span class="c1">## Simple scatterplot.</span><span class="w">
</span><span class="n">xyplot</span><span class="p">(</span><span class="n">Ozone</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Wind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">airquality</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Looking at 3 variables at a time</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span><span class="w">
</span><span class="c1">## Convert 'Month' to a factor variable</span><span class="w">
</span><span class="n">airquality</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">transform</span><span class="p">(</span><span class="n">airquality</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">Month</span><span class="p">))</span><span class="w">
</span><span class="n">xyplot</span><span class="p">(</span><span class="n">Ozone</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Wind</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">airquality</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><strong>transform</strong> can be used or:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">airquality</span><span class="o">$</span><span class="n">Month</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">airquality</span><span class="o">$</span><span class="n">Month</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="lattice-behavior">Lattice Behavior</h3>

<p>Lattice functions behave differently from base graphics functions in
one critical way.</p>

<ul>
  <li>
    <p>Base graphics functions plot data directly to the graphics device
(screen, PDF file, etc.)</p>
  </li>
  <li>
    <p>Lattice graphics functions return an object of class <strong>trellis</strong></p>
  </li>
  <li>
    <p>Lattice functions return ‚Äúplot objects‚Äù that can, in principle, be
stored (but it‚Äôs usually better to just save the code + data).</p>
  </li>
</ul>

<p><strong>You can save the plot to an object and it wont display just like
regular functions.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xyplot</span><span class="p">(</span><span class="n">Ozone</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Wind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">airquality</span><span class="p">)</span><span class="w">  </span><span class="c1">## Nothing happens!</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">  </span><span class="c1">## Plot appears</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xyplot</span><span class="p">(</span><span class="n">Ozone</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Wind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">airquality</span><span class="p">)</span><span class="w">  </span><span class="c1">## Auto-printing</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="lattice-panel-functions">Lattice Panel Functions</h3>

<ul>
  <li>
    <p>Lattice functions have a <strong>panel function</strong> which controls what
happens inside each panel of the plot.</p>
  </li>
  <li>
    <p>The <em>lattice</em> package comes with default panel functions, but you
can supply your own if you want to customize what happens in each
panel</p>
  </li>
  <li>
    <p>Panel functions receive the x/y coordinates of the data points
in their panel (along with any optional arguments)</p>
  </li>
</ul>

<p><strong>Simple XY plots for case with xy related and not related</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Group 1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Group 2"</span><span class="p">))</span><span class="w">
</span><span class="n">xyplot</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">  </span><span class="c1">## Plot with 2 panels</span><span class="w">
</span></code></pre></div></div>

<p><strong>Custom panel function: Each window can have similar features</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Custom panel function</span><span class="w">
</span><span class="n">xyplot</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">panel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">panel.xyplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w">  </span><span class="c1">## First call the default panel function for 'xyplot'</span><span class="w">
    </span><span class="n">panel.abline</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">  </span><span class="c1">## Add a horizontal line at the median</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>Can view large amount of data as shown <a href="https://github.com/jtleek/modules/blob/master/04_ExploratoryAnalysis/PlottingLattice/figure/unnamed-chunk-8.png">here</a></p>

<hr />

<h3 id="lattice-panel-functions-regression-line">Lattice Panel Functions: Regression line</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Custom panel function</span><span class="w">
</span><span class="n">xyplot</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">panel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">panel.xyplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w">  </span><span class="c1">## First call default panel function</span><span class="w">
    </span><span class="n">panel.lmline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">  </span><span class="c1">## Overlay a simple linear regression line</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h3 id="many-panel-lattice-plot-example-from-maacs">Many Panel Lattice Plot: Example from MAACS</h3>

<ul>
  <li>
    <p>Study: Mouse Allergen and Asthma Cohort Study (MAACS)</p>
  </li>
  <li>
    <p>Study subjects: Children with asthma living in Baltimore City, many
allergic to mouse allergen</p>
  </li>
  <li>
    <p>Design: Observational study, baseline home visit + every 3 months for a year.</p>
  </li>
  <li>
    <p>Question: How does indoor airborne mouse allergen vary over time and
across subjects?</p>
  </li>
</ul>

<p><a href="http://www.ncbi.nlm.nih.gov/pubmed/23810154">Ahluwalia et al., <em>Journal of Allergy and Clinical Immunology</em>, 2013</a></p>

<h3 id="summary-4">Summary</h3>

<ul>
  <li>
    <p>Lattice plots are constructed with a single function call to a core
lattice function (e.g. <code class="language-plaintext highlighter-rouge">xyplot</code>)</p>
  </li>
  <li>
    <p>Aspects like margins and spacing are automatically handled and
defaults are usually sufficient</p>
  </li>
  <li>
    <p>The lattice system is ideal for creating conditioning plots where
you examine the same kind of plot under many different conditions</p>
  </li>
  <li>
    <p>Panel functions can be specified/customized to modify what is
plotted in each of the plot panels</p>
    <h2 id="ggplot2---mainly-qplot">GGPlot2 - mainly qplot()</h2>
  </li>
</ul>

<h3 id="what-is-ggplot2">What is ggplot2?</h3>

<ul>
  <li>An implementation of <em>The Grammar of Graphics</em> by Leland Wilkinson</li>
  <li>Written by Hadley Wickham (while he was a graduate student at Iowa State)</li>
  <li>A ‚Äúthird‚Äù graphics system for R (along with <strong>base</strong> and <strong>lattice</strong>)</li>
  <li>Available from CRAN via <code class="language-plaintext highlighter-rouge">install.packages()</code></li>
  <li>Web site: http://ggplot2.org (better documentation)</li>
</ul>

<hr />

<h3 id="what-is-ggplot2-1">What is ggplot2?</h3>

<ul>
  <li>Grammar of graphics represents an abstraction of graphics ideas/objects</li>
  <li>Think ‚Äúverb‚Äù, ‚Äúnoun‚Äù, ‚Äúadjective‚Äù for graphics</li>
  <li>Allows for a ‚Äútheory‚Äù of graphics on which to build new graphics and graphics objects</li>
  <li>‚ÄúShorten the distance from mind to page‚Äù</li>
</ul>

<hr />

<h3 id="grammer-of-graphics">Grammer of Graphics</h3>

<p>‚ÄúIn brief, the grammar tells us that a statistical graphic is a
<strong>mapping</strong> from data to <strong>aesthetic</strong> attributes (colour, shape,
size) of <strong>geometric</strong> objects (points, lines, bars). The plot may
also contain statistical transformations of the data and is drawn on a
specific coordinate system‚Äù</p>

<h3 id="plotting-systems-in-r-base">Plotting Systems in R: Base</h3>

<ul>
  <li>‚ÄúArtist‚Äôs palette‚Äù model</li>
  <li>Start with blank canvas and build up from there</li>
  <li>Start with <code class="language-plaintext highlighter-rouge">plot</code> function (or similar)</li>
  <li>Use annotation functions to add/modify (<code class="language-plaintext highlighter-rouge">text</code>, <code class="language-plaintext highlighter-rouge">lines</code>, <code class="language-plaintext highlighter-rouge">points</code>, <code class="language-plaintext highlighter-rouge">axis</code>)</li>
</ul>

<hr />

<h3 id="plotting-systems-in-r-base-1">Plotting Systems in R: Base</h3>

<ul>
  <li>Convenient, mirrors how we think of building plots and analyzing data</li>
  <li>Can‚Äôt go back once plot has started (i.e. to adjust margins); need to plan in advance</li>
  <li>Difficult to ‚Äútranslate‚Äù to others once a new plot has been created (no graphical ‚Äúlanguage‚Äù)
    <ul>
      <li>Plot is just a series of R commands</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="plotting-systems-in-r-lattice">Plotting Systems in R: Lattice</h3>

<ul>
  <li>Plots are created with a single function call (<code class="language-plaintext highlighter-rouge">xyplot</code>, <code class="language-plaintext highlighter-rouge">bwplot</code>, etc.)</li>
  <li>Most useful for conditioning types of plots: Looking at how $y$ changes with $x$ across levels of $z$</li>
  <li>Things like margins/spacing set automatically because entire plot is specified at once</li>
  <li>Good for putting many many plots on a screen</li>
</ul>

<hr />

<h3 id="plotting-systems-in-r-lattice-1">Plotting Systems in R: Lattice</h3>

<ul>
  <li>Sometimes awkward to specify an entire plot in a single function call</li>
  <li>Annotation in plot is not intuitive</li>
  <li>Use of panel functions and subscripts difficult to wield and requires intense preparation</li>
  <li>Cannot ‚Äúadd‚Äù to the plot once it‚Äôs created</li>
</ul>

<hr />

<h3 id="plotting-systems-in-r-ggplot2">Plotting Systems in R: ggplot2</h3>

<ul>
  <li>Split the difference between base and lattice</li>
  <li>Automatically deals with spacings, text, titles but also allows you to annotate by ‚Äúadding‚Äù</li>
  <li>Superficial similarity to lattice but generally easier/more intuitive to use</li>
  <li>Default mode makes many choices for you (but you <em>can</em> customize!)</li>
</ul>

<hr />

<h3 id="the-basics-qplot">The Basics: <code class="language-plaintext highlighter-rouge">qplot()</code></h3>

<ul>
  <li>Works much like the <code class="language-plaintext highlighter-rouge">plot</code> function in base graphics system</li>
  <li>Looks for data in a data frame, similar to lattice, or in the parent environment</li>
  <li>Plots are made up of <em>aesthetics</em> (size, shape, color) and <em>geoms</em> (points, lines)</li>
</ul>

<hr />

<h3 id="the-basics-qplot-1">The Basics: <code class="language-plaintext highlighter-rouge">qplot()</code></h3>

<ul>
  <li>Factors are important for indicating subsets of the data (if they are to have different properties); they should be <strong>labeled</strong></li>
  <li>The <code class="language-plaintext highlighter-rouge">qplot()</code> hides what goes on underneath, which is okay for most operations</li>
  <li><code class="language-plaintext highlighter-rouge">ggplot()</code> is the core function and very flexible for doing things <code class="language-plaintext highlighter-rouge">qplot()</code> cannot do</li>
</ul>

<hr />

<h3 id="example-dataset">Example Dataset</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	234 obs. of  11 variables:
 $ manufacturer: Factor w/ 15 levels "audi","chevrolet",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ model       : Factor w/ 38 levels "4runner 4wd",..: 2 2 2 2 2 2 2 3 3 3 ...
 $ displ       : num  1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
 $ year        : int  1999 1999 2008 2008 1999 1999 2008 1999 1999 2008 ...
 $ cyl         : int  4 4 4 4 6 6 6 4 4 4 ...
 $ trans       : Factor w/ 10 levels "auto(av)","auto(l3)",..: 4 9 10 1 4 9 1 9 4 10 ...
 $ drv         : Factor w/ 3 levels "4","f","r": 2 2 2 2 2 2 2 1 1 1 ...
 $ cty         : int  18 21 20 21 16 18 18 18 16 20 ...
 $ hwy         : int  29 29 31 30 26 26 27 26 25 28 ...
 $ fl          : Factor w/ 5 levels "c","d","e","p",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ class       : Factor w/ 7 levels "2seater","compact",..: 2 2 2 2 2 2 2 2 2 2 ...
</code></pre></div></div>

<hr />

<h3 id="ggplot2-hello-world">ggplot2 ‚ÄúHello, world!‚Äù</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span><span class="w"> </span><span class="n">hwy</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-2.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" class="plot" /></div>

<hr />

<h3 id="modifying-aesthetics">Modifying aesthetics</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span><span class="w"> </span><span class="n">hwy</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">drv</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="adding-a-geom">Adding a geom</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span><span class="w"> </span><span class="n">hwy</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"point"</span><span class="p">,</span><span class="w"> </span><span class="s2">"smooth"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="histograms">Histograms</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">hwy</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">drv</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-5.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div>

<hr />

<h3 id="facets">Facets</h3>

<p>Splits figure into as many based on the variable, for example months!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span><span class="w"> </span><span class="n">hwy</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">facets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">drv</span><span class="p">)</span><span class="w">
</span><span class="n">qplot</span><span class="p">(</span><span class="n">hwy</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">facets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">drv</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">binwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="maacs-cohort">MAACS Cohort</h3>

<ul>
  <li>Mouse Allergen and Asthma Cohort Study</li>
  <li>Baltimore children (aged 5‚Äî17)</li>
  <li>Persistent asthma, exacerbation in past year</li>
  <li>Study indoor environment and its relationship with asthma morbidity</li>
  <li>Recent publication: http://goo.gl/WqE9j8</li>
</ul>

<hr />

<h3 id="example-maacs">Example: MAACS</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">maacs</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	750 obs. of  5 variables:
 $ id       : int  1 2 3 4 5 6 7 8 9 10 ...
 $ eno      : num  141 124 126 164 99 68 41 50 12 30 ...
 $ duBedMusM: num  2423 2793 3055 775 1634 ...
 $ pm25     : num  15.6 34.4 39 33.2 27.1 ...
 $ mopos    : Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 2 2 2 ...
</code></pre></div></div>

<hr />

<h3 id="histogram-of-eno">Histogram of eNO</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">eno</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-9.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" class="plot" /></div>

<hr />

<h3 id="histogram-by-group">Histogram by Group</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">eno</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mopos</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-10.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" class="plot" /></div>

<hr />

<h3 id="density-smooth">Density Smooth</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">eno</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"density"</span><span class="p">)</span><span class="w">
</span><span class="n">qplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">eno</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"density"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mopos</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-111.png" title="plot of chunk unnamed-chunk-11" alt="plot of chunk unnamed-chunk-11" class="plot" />
<img src="fig/unnamed-chunk-112.png" title="plot of chunk unnamed-chunk-11" alt="plot of chunk unnamed-chunk-11" class="plot" /></div>

<hr />

<h3 id="scatterplots-eno-vs-pm_25">Scatterplots: eNO vs. PM$_{2.5}$</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">pm25</span><span class="p">),</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">eno</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">)</span><span class="w">
</span><span class="n">qplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">pm25</span><span class="p">),</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">eno</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mopos</span><span class="p">)</span><span class="w">
</span><span class="n">qplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">pm25</span><span class="p">),</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">eno</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mopos</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-121.png" title="plot of chunk unnamed-chunk-12" alt="plot of chunk unnamed-chunk-12" class="plot" />
<img src="fig/unnamed-chunk-122.png" title="plot of chunk unnamed-chunk-12" alt="plot of chunk unnamed-chunk-12" class="plot" />
<img src="fig/unnamed-chunk-123.png" title="plot of chunk unnamed-chunk-12" alt="plot of chunk unnamed-chunk-12" class="plot" /></div>

<hr />

<h3 id="scatterplots-eno-vs-pm_25-1">Scatterplots: eNO vs. PM$_{2.5}$</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">pm25</span><span class="p">),</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">eno</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mopos</span><span class="p">,</span><span class="w"> 
      </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"point"</span><span class="p">,</span><span class="w"> </span><span class="s2">"smooth"</span><span class="p">),</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-13.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" class="plot" /></div>

<hr />

<h3 id="scatterplots-eno-vs-pm_25-2">Scatterplots: eNO vs. PM$_{2.5}$</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">pm25</span><span class="p">),</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">eno</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"point"</span><span class="p">,</span><span class="w"> </span><span class="s2">"smooth"</span><span class="p">),</span><span class="w"> 
      </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">facets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">mopos</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-14.png" title="plot of chunk unnamed-chunk-14" alt="plot of chunk unnamed-chunk-14" class="plot" /></div>

<hr />

<h3 id="summary-of-qplot">Summary of qplot()</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">qplot()</code> function is the analog to <code class="language-plaintext highlighter-rouge">plot()</code> but with many built-in features</li>
  <li>Syntax somewhere in between base/lattice</li>
  <li>Produces very nice graphics, essentially publication ready (if you like the design)</li>
  <li>Difficult to go against the grain/customize (don‚Äôt bother; use full ggplot2 power in that case)</li>
</ul>

<hr />

<h3 id="resources">Resources</h3>

<ul>
  <li>The <em>ggplot2</em> book by Hadley Wickham</li>
  <li>The <em>R Graphics Cookbook</em> by Winston Chang (examples in base plots and in ggplot2)</li>
  <li>ggplot2 web site (http://ggplot2.org)</li>
  <li>ggplot2 mailing list (http://goo.gl/OdW3uB), primarily for
developers
    <h2 id="ggplot2-part-2">ggplot2 part 2</h2>
  </li>
</ul>

<h3 id="basic-components-of-a-ggplot2-plot">Basic Components of a ggplot2 Plot</h3>
<ul>
  <li>A <em>data frame</em></li>
  <li><em>aesthetic mappings</em>: how data are mapped to color, size</li>
  <li><em>geoms</em>: geometric objects like points, lines, shapes.</li>
  <li><em>facets</em>: for conditional plots.</li>
  <li><em>stats</em>: statistical transformations like binning, quantiles, smoothing.</li>
  <li><em>scales</em>: what scale an aesthetic map uses (example: male = red, female = blue).</li>
  <li><em>coordinate system</em></li>
</ul>

<hr />

<h3 id="building-plots-with-ggplot2">Building Plots with ggplot2</h3>
<ul>
  <li>When building plots in ggplot2 (rather than using qplot) the ‚Äúartist‚Äôs palette‚Äù model may be the closest analogy</li>
  <li>Plots are built up in layers
    <ul>
      <li>Plot the data</li>
      <li>Overlay a summary</li>
      <li>Metadata and annotation</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="example-bmi-pm_25-asthma">Example: BMI, PM$_{2.5}$, Asthma</h3>
<ul>
  <li>Mouse Allergen and Asthma Cohort Study</li>
  <li>Baltimore children (age 5-17)</li>
  <li>Persistent asthma, exacerbation in past year</li>
  <li>Does BMI (normal vs. overweight) modify the relationship between PM$_{2.5}$ and asthma symptoms?</li>
</ul>

<hr />

<h3 id="basic-plot">Basic Plot</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">qplot</span><span class="p">(</span><span class="n">logpm25</span><span class="p">,</span><span class="w"> </span><span class="n">NocturnalSympt</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">facets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">bmicat</span><span class="p">,</span><span class="w"> 
      </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"point"</span><span class="p">,</span><span class="w"> </span><span class="s2">"smooth"</span><span class="p">),</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="building-up-in-layers">Building Up in Layers</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">maacs</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  logpm25        bmicat NocturnalSympt logno2_new
1  1.5362 normal weight              1      1.299
2  1.5905 normal weight              0      1.295
3  1.5218 normal weight              0      1.304
4  1.4323 normal weight              0         NA
5  1.2762    overweight              8      1.108
6  0.7139    overweight              0      0.837
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">logpm25</span><span class="p">,</span><span class="w"> </span><span class="n">NocturnalSympt</span><span class="p">))</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data: logpm25, bmicat, NocturnalSympt, logno2_new [554x4]
mapping:  x = logpm25, y = NocturnalSympt
faceting: facet_null() 
</code></pre></div></div>

<h3 id="no-plot-yet">No Plot Yet!</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">logpm25</span><span class="p">,</span><span class="w"> </span><span class="n">NocturnalSympt</span><span class="p">))</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: No layers in plot
</code></pre></div></div>

<hr />

<h3 id="first-plot-with-point-layer">First Plot with Point Layer</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">logpm25</span><span class="p">,</span><span class="w"> </span><span class="n">NocturnalSympt</span><span class="p">))</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="adding-more-layers-smooth-geom">Adding More Layers: Smooth geom</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_smooth</span><span class="p">()</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="adding-more-layers-facets">Adding More Layers: Facets</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">bmicat</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="annotation">Annotation</h3>
<ul>
  <li>Labels: <code class="language-plaintext highlighter-rouge">xlab()</code>, <code class="language-plaintext highlighter-rouge">ylab()</code>, <code class="language-plaintext highlighter-rouge">labs()</code>, <code class="language-plaintext highlighter-rouge">ggtitle()</code></li>
  <li>Each of the ‚Äúgeom‚Äù functions has options to modify</li>
  <li>For things that only make sense globally, use <code class="language-plaintext highlighter-rouge">theme()</code>
    <ul>
      <li>Example: <code class="language-plaintext highlighter-rouge">theme(legend.position = "none")</code></li>
    </ul>
  </li>
  <li>Two standard appearance themes are included
    <ul>
      <li><code class="language-plaintext highlighter-rouge">theme_gray()</code>: The default theme (gray background)</li>
      <li><code class="language-plaintext highlighter-rouge">theme_bw()</code>: More stark/plain</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="modifying-aesthetics-1">Modifying Aesthetics</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmicat</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="modifying-labels">Modifying Labels</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmicat</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"MAACS Cohort"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">expression</span><span class="p">(</span><span class="s2">"log "</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PM</span><span class="p">[</span><span class="m">2.5</span><span class="p">]),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Nocturnal Symptoms"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="customizing-the-smooth">Customizing the Smooth</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmicat</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-10.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" class="plot" /></div>

<hr />

<h3 id="changing-the-theme">Changing the Theme</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmicat</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Times"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="rimage center"><img src="fig/unnamed-chunk-11.png" title="plot of chunk unnamed-chunk-11" alt="plot of chunk unnamed-chunk-11" class="plot" /></div>

<hr />

<h3 id="a-note-about-axis-limits">A Note about Axis Limits</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">testdat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">))</span><span class="w">
</span><span class="n">testdat</span><span class="p">[</span><span class="m">50</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">  </span><span class="c1">## Outlier!</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">testdat</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">testdat</span><span class="o">$</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="m">3</span><span class="p">))</span><span class="w">

</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">testdat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="axis-limits">Axis Limits</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylim</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="more-complex-example">More Complex Example</h3>
<ul>
  <li>How does the relationship between PM$_{2.5}$ and nocturnal symptoms vary by BMI and NO$_2$?</li>
  <li>Unlike our previous BMI variable, NO$_2$ is continuous</li>
  <li>We need to make NO$_2$ categorical so we can condition on it in the plotting</li>
  <li>Use the <code class="language-plaintext highlighter-rouge">cut()</code> function for this</li>
</ul>

<hr />

<h3 id="making-no_2-tertiles">Making NO$_2$ Tertiles</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Calculate the tertiles of the data</span><span class="w">
</span><span class="n">cutpoints</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">maacs</span><span class="o">$</span><span class="n">logno2_new</span><span class="p">,</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1">## Cut the data at the tertiles and create a new factor variable</span><span class="w">
</span><span class="n">maacs</span><span class="o">$</span><span class="n">no2tert</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">maacs</span><span class="o">$</span><span class="n">logno2_new</span><span class="p">,</span><span class="w"> </span><span class="n">cutpoints</span><span class="p">)</span><span class="w">

</span><span class="c1">## See the levels of the newly created factor variable</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">maacs</span><span class="o">$</span><span class="n">no2tert</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "(0.378,1.2]" "(1.2,1.42]"  "(1.42,2.55]"
</code></pre></div></div>

<hr />

<h3 id="code-for-final-plot">Code for Final Plot</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Setup ggplot with data frame</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">maacs</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">logpm25</span><span class="p">,</span><span class="w"> </span><span class="n">NocturnalSympt</span><span class="p">))</span><span class="w">

</span><span class="c1">## Add layers</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">bmicat</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">no2tert</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"steelblue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">theme_bw</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Avenir"</span><span class="p">,</span><span class="w"> </span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">expression</span><span class="p">(</span><span class="s2">"log "</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PM</span><span class="p">[</span><span class="m">2.5</span><span class="p">]))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Nocturnal Symptoms"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"MAACS Cohort"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="summary-5">Summary</h3>
<ul>
  <li>ggplot2 is very powerful and flexible if you learn the ‚Äúgrammar‚Äù and the various elements that can be tuned/modified</li>
  <li>Many more types of plots can be made; explore and mess around with
      the package (references mentioned in Part 1 are useful)</li>
</ul>

<h3 id="important-resource-on-legend-legend-order-and-coloring">Important resource on legend, legend order and coloring</h3>
<p>Was trying to change labels of legend. nothing works just like in this
stack question;</p>

<p>https://stackoverflow.com/questions/23635662/editing-legend-text-labels-in-ggplot</p>

<p>http://www.cookbook-r.com/Graphs/</p>

<p><a href="https://stackoverflow.com/a/54079708/5986651">We need to change the order of the factor</a> so that <code class="language-plaintext highlighter-rouge">breaks</code>
corresponds with <code class="language-plaintext highlighter-rouge">values</code> (see below)</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="n">mn5</span><span class="o">$</span><span class="n">fips</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">mn5</span><span class="o">$</span><span class="n">fips</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"24510"</span><span class="p">,</span><span class="s2">"06037"</span><span class="p">))</span><span class="w"> </span><span class="c1"># to change</span><span class="w">
                                        </span><span class="c1"># legend order later!</span><span class="w">
										
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mn5</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">Mean.Emissions</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">fips</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">()</span><span class="w">

</span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"24510"</span><span class="p">,</span><span class="s2">"06037"</span><span class="p">),</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">))</span><span class="w">

</span></code></pre></div></div>
<p><strong>When you have a histogram and 2 vlines, how to add legend</strong></p>

<p>https://stackoverflow.com/questions/37660694/add-legend-to-geom-vline</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">quantile_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">sf</span><span class="o">$</span><span class="n">Unit.Sales</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">)</span><span class="w">
</span><span class="n">quantile_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">sf</span><span class="o">$</span><span class="n">Unit.Sales</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Unit.Sales</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sf</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'black'</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">median</span><span class="p">(</span><span class="n">Unit.Sales</span><span class="p">)),</span><span class="w">
            </span><span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">Unit.Sales</span><span class="p">)),</span><span class="w">
            </span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">quantile_1</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"yellow"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="ggplot-histogram">ggplot histogram</h3>

<p>http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g &lt;- ggplot(data.frame(mn.mat),aes(x=mn.mat))
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">mn.mat</span><span class="p">),</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mn.mat</span><span class="p">))</span><span class="w">

</span><span class="c1">## hist and plots</span><span class="w">

</span><span class="n">g</span><span class="o">+</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">..density..</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s2">"Distribution"</span><span class="p">),</span><span class="n">binwidth</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">"Histogram Legend"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"white"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">mn.sample</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"Sample.mean"</span><span class="p">),</span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">mn.mat</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s2">"Mean.of.distribution"</span><span class="p">),</span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"vLine legend"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="n">Sample.mean</span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">Mean.of.distribution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Sampling distribution of Sample Mean"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Sample Mean, n=40"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"density"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="hierarchical-clustering">Hierarchical Clustering</h2>
<h3 id="can-we-find-things-that-are-close-together">Can we find things that are close together?</h3>

<p>Clustering organizes things that are <strong>close</strong> into groups</p>

<ul>
  <li>How do we define close?</li>
  <li>How do we group things?</li>
  <li>How do we visualize the grouping?</li>
  <li>
    <p>How do we interpret the grouping?</p>
  </li>
  <li>An agglomerative approach
    <ul>
      <li>Find closest two things</li>
      <li>Put them together</li>
      <li>Find next closest</li>
    </ul>
  </li>
  <li>Requires
    <ul>
      <li>A defined distance</li>
      <li>A merging approach</li>
    </ul>
  </li>
  <li>Produces
    <ul>
      <li>A tree showing how close things are to each other</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="how-do-we-define-close">How do we define close?</h3>

<ul>
  <li>Most important step
    <ul>
      <li>Garbage in -&gt; garbage out</li>
    </ul>
  </li>
  <li>Distance or similarity
    <ul>
      <li>Continuous - euclidean distance</li>
      <li>Continuous - correlation similarity</li>
      <li>Binary - manhattan distance</li>
    </ul>
  </li>
  <li>Pick a distance/similarity that makes sense for your problem</li>
</ul>

<hr />

<h3 id="example-distances---euclidean">Example distances - Euclidean</h3>

<p>Point to point</p>

<p>In general:</p>

<p>\(\sqrt{(A_1-A_2)^2 + (B_1-B_2)^2 + \ldots + (Z_1-Z_2)^2}\)
<a href="http://rafalab.jhsph.edu/688/lec/lecture5-clustering.pdf">http://rafalab.jhsph.edu/688/lec/lecture5-clustering.pdf</a></p>

<hr />

<h3 id="example-distances---manhattan">Example distances - Manhattan</h3>

<p>Like moving in a grid</p>

<p>In general:</p>

\[|A_1-A_2| + |B_1-B_2| + \ldots + |Z_1-Z_2|\]

<p><a href="http://en.wikipedia.org/wiki/Taxicab_geometry">http://en.wikipedia.org/wiki/Taxicab_geometry</a></p>

<hr />

<h3 id="hierarchical-clustering---example">Hierarchical clustering - example</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h3 id="hierarchical-clustering---dist">Hierarchical clustering - <code class="language-plaintext highlighter-rouge">dist</code></h3>

<ul>
  <li>Important parameters: <em>x</em>,<em>method</em></li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataFrame</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">dist</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##          1       2       3       4       5       6       7       8       9
## 2  0.34121                                                                
## 3  0.57494 0.24103                                                        
## 4  0.26382 0.52579 0.71862                                                
## 5  1.69425 1.35818 1.11953 1.80667                                        
## 6  1.65813 1.31960 1.08339 1.78081 0.08150                                
## 7  1.49823 1.16621 0.92569 1.60132 0.21110 0.21667                        
## 8  1.99149 1.69093 1.45649 2.02849 0.61704 0.69792 0.65063                
## 9  2.13630 1.83168 1.67836 2.35676 1.18350 1.11500 1.28583 1.76461        
## 10 2.06420 1.76999 1.63110 2.29239 1.23848 1.16550 1.32063 1.83518 0.14090
## 11 2.14702 1.85183 1.71074 2.37462 1.28154 1.21077 1.37370 1.86999 0.11624
## 12 2.05664 1.74663 1.58659 2.27232 1.07701 1.00777 1.17740 1.66224 0.10849
##         10      11
## 2                 
## 3                 
## 4                 
## 5                 
## 6                 
## 7                 
## 8                 
## 9                 
## 10                
## 11 0.08318        
## 12 0.19129 0.20803
</code></pre></div></div>

<hr />

<h3 id="hierarchical-clustering---hclust">Hierarchical clustering - hclust</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataFrame</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">distxy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span><span class="w">
</span><span class="n">hClustering</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hclust</span><span class="p">(</span><span class="n">distxy</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">hClustering</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Plots a dendogram</p>

<hr />

<h3 id="prettier-dendrograms">Prettier dendrograms</h3>

<p>Use this function for prettier dendograms</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">myplclust</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">hclust</span><span class="p">,</span><span class="w"> </span><span class="n">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hclust</span><span class="o">$</span><span class="n">labels</span><span class="p">,</span><span class="w"> </span><span class="n">lab.col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">hclust</span><span class="o">$</span><span class="n">labels</span><span class="p">)),</span><span class="w"> 
    </span><span class="n">hang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1">## modifiction of plclust for plotting hclust objects *in colour*!  Copyright</span><span class="w">
    </span><span class="c1">## Eva KF Chan 2009 Arguments: hclust: hclust object lab: a character vector</span><span class="w">
    </span><span class="c1">## of labels of the leaves of the tree lab.col: colour for the labels;</span><span class="w">
    </span><span class="c1">## NA=default device foreground colour hang: as in hclust &amp; plclust Side</span><span class="w">
    </span><span class="c1">## effect: A display of hierarchical cluster with coloured leaf labels.</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">hclust</span><span class="o">$</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">hclust</span><span class="o">$</span><span class="n">merge</span><span class="p">)</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span><span class="w">
    </span><span class="n">plot</span><span class="p">(</span><span class="n">hclust</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">hang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hang</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w">
    </span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">hclust</span><span class="o">$</span><span class="n">order</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">hclust</span><span class="o">$</span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">hang</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lab</span><span class="p">[</span><span class="n">hclust</span><span class="o">$</span><span class="n">order</span><span class="p">],</span><span class="w"> 
        </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lab.col</span><span class="p">[</span><span class="n">hclust</span><span class="o">$</span><span class="n">order</span><span class="p">],</span><span class="w"> </span><span class="n">srt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">adj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="n">xpd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="pretty-dendrograms">Pretty dendrograms</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataFrame</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">distxy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span><span class="w">
</span><span class="n">hClustering</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hclust</span><span class="p">(</span><span class="n">distxy</span><span class="p">)</span><span class="w">
</span><span class="n">myplclust</span><span class="p">(</span><span class="n">hClustering</span><span class="p">,</span><span class="w"> </span><span class="n">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">lab.col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="even-prettier-dendrograms">Even Prettier dendrograms</h3>

<p>Site doesn‚Äôt work! Site broken!</p>

<p><a href="http://gallery.r-enthusiasts.com/RGraphGallery.php?graph=79">http://gallery.r-enthusiasts.com/RGraphGallery.php?graph=79</a></p>

<hr />

<h3 id="merging-points---complete-or-average">Merging points - complete or average</h3>

<blockquote>
  <p>method: the agglomeration method to be used.  This should be (an
          unambiguous abbreviation of) one of ‚Äò‚Äùward.D‚Äù‚Äô, ‚Äò‚Äùward.D2‚Äù‚Äô,
          ‚Äò‚Äùsingle‚Äù‚Äô, ‚Äò‚Äùcomplete‚Äù‚Äô, ‚Äò‚Äùaverage‚Äù‚Äô (= UPGMA), ‚Äò‚Äùmcquitty‚Äù‚Äô
          (= WPGMA), ‚Äò‚Äùmedian‚Äù‚Äô (= WPGMC) or ‚Äò‚Äùcentroid‚Äù‚Äô (= UPGMC).</p>
</blockquote>

<p>method for hclust so that the clustering is done based on the farthest
points within the existing cluster if ‚Äúcomplete‚Äù.</p>

<h3 id="heatmap"><code class="language-plaintext highlighter-rouge">heatmap()</code></h3>
<p>Clusters rows based on XY distance just like hclust.</p>

<p>For columns it looks at individual columns and color codes them to
points that are close to each other.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataFrame</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">143</span><span class="p">)</span><span class="w">
</span><span class="n">dataMatrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">heatmap</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>In this example Y (9,12,6,7,1,5,11) are all ‚Äúclose‚Äù by where (3,2,4)
ain‚Äôt!</p>

<hr />

<h3 id="notes-and-further-resources-1">Notes and further resources</h3>

<ul>
  <li>Gives an idea of the relationships between variables/observations</li>
  <li>The picture may be unstable
    <ul>
      <li>Change a few points</li>
      <li>Have different missing values</li>
      <li>Pick a different distance</li>
      <li>Change the merging strategy</li>
      <li>Change the scale of points for one variable</li>
    </ul>
  </li>
  <li>But it is deterministic</li>
  <li>Choosing where to cut isn‚Äôt always obvious</li>
  <li>Should be primarily used for exploration</li>
  <li><a href="http://www.youtube.com/watch?v=wQhVWUcXM0A">Rafa‚Äôs Distances and Clustering Video</a></li>
  <li><a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/">Elements of statistical learning</a></li>
</ul>

<h3 id="my-notes-on-hierarchical-clustering-and-heatmaps">My notes on hierarchical clustering and heatmaps</h3>

<p>Hierarchical clustering is when you compare rows or columns of a DF by
first scaling them and the point is to see how everything is related
to each other. For example:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="o">&lt;-</span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">25</span><span class="p">,</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">s</span><span class="p">[</span><span class="n">lower.tri</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="n">lower.tri</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span><span class="w">
</span><span class="n">heatmap</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Heatmap()</code> takes a DF and then does hierarchical clustering on the
rows and columns. It uses the <code class="language-plaintext highlighter-rouge">dist()</code> to make distance based on
different <code class="language-plaintext highlighter-rouge">method</code> arguments. For example, for the <code class="language-plaintext highlighter-rouge">eucledian method</code>,
it basically takes 2 entire row vectors on n dimension and measures
the eucledian distance and uses that for clustering. Same with the Column.</p>

<h2 id="kmeans-can-we-find-things-that-are-close-together">Kmeans! Can we find things that are close together?</h2>

<ul>
  <li>How do we define close?</li>
  <li>How do we group things?</li>
  <li>How do we visualize the grouping?</li>
  <li>How do we interpret the grouping?</li>
</ul>

<hr />

<h3 id="how-do-we-define-close-1">How do we define close?</h3>

<ul>
  <li>Most important step
    <ul>
      <li>Garbage in $\longrightarrow$ garbage out</li>
    </ul>
  </li>
  <li>Distance or similarity
    <ul>
      <li>Continuous - euclidean distance</li>
      <li>Continous - correlation similarity</li>
      <li>Binary - manhattan distance</li>
    </ul>
  </li>
  <li>Pick a distance/similarity that makes sense for your problem</li>
</ul>

<hr />

<h3 id="k-means-clustering">K-means clustering</h3>

<ul>
  <li>A partioning approach
    <ul>
      <li>Fix a number of clusters</li>
      <li>Get ‚Äúcentroids‚Äù of each cluster</li>
      <li>Assign things to closest centroid</li>
      <li>Reclaculate centroids</li>
    </ul>
  </li>
  <li>Requires
    <ul>
      <li>A defined distance metric</li>
      <li>A number of clusters</li>
      <li>An initial guess as to cluster centroids</li>
    </ul>
  </li>
  <li>Produces
    <ul>
      <li>Final estimate of cluster centroids</li>
      <li>An assignment of each point to clusters</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="k-means-clustering----example">K-means clustering -  example</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<h3 id="what-kmeans-does">What Kmeans does?</h3>

<ul>
  <li>
    <p>starting centroids are guessed</p>
  </li>
  <li>
    <p>assign points to closest centroid</p>
  </li>
  <li>
    <p>recalculates centroids</p>
  </li>
  <li>
    <p>reassigns points to closest centroid</p>
  </li>
  <li>
    <p>update centroids</p>
  </li>
</ul>

<hr />

<h3 id="kmeans"><code class="language-plaintext highlighter-rouge">kmeans()</code></h3>

<ul>
  <li>Important parameters: <em>x</em>, <em>centers</em>, <em>iter.max</em>, <em>nstart</em></li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataFrame</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">kmeansObj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kmeans</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">,</span><span class="w"> </span><span class="n">centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">kmeansObj</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] "cluster"      "centers"      "totss"        "withinss"    
## [5] "tot.withinss" "betweenss"    "size"         "iter"        
## [9] "ifault"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kmeansObj</span><span class="o">$</span><span class="n">cluster</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  [1] 3 3 3 3 1 1 1 1 2 2 2 2
</code></pre></div></div>

<hr />

<h3 id="kmeans-1"><code class="language-plaintext highlighter-rouge">kmeans()</code></h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kmeansObj</span><span class="o">$</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">kmeansObj</span><span class="o">$</span><span class="n">centers</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="heatmaps">Heatmaps</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span><span class="w">
</span><span class="n">dataMatrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">kmeansObj2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kmeans</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">yaxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">)</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)[,</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">kmeansObj2</span><span class="o">$</span><span class="n">cluster</span><span class="p">)],</span><span class="w"> </span><span class="n">yaxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>slides have an error: <code class="language-plaintext highlighter-rouge">kmeansObj$cluster</code> is used and gives shitty
results!</p>

<hr />

<h3 id="notes-and-further-resources-2">Notes and further resources</h3>

<ul>
  <li>K-means requires a number of clusters
    <ul>
      <li>Pick by eye/intuition</li>
      <li>Pick by cross validation/information theory, etc.</li>
      <li><a href="http://en.wikipedia.org/wiki/Determining_the_number_of_clusters_in_a_data_set">Determining the number of clusters</a></li>
    </ul>
  </li>
  <li>K-means is not deterministic
    <ul>
      <li>Different # of clusters</li>
      <li>Different number of iterations</li>
    </ul>
  </li>
  <li><a href="http://www.youtube.com/watch?v=wQhVWUcXM0A">Rafael Irizarry‚Äôs Distances and Clustering Video</a></li>
  <li><a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/">Elements of statistical learning</a></li>
</ul>

<h2 id="dimension-reduction">Dimension reduction</h2>

<h3 id="matrix-data">Matrix data</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">12345</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="n">dataMatrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">400</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">)</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="cluster-the-data">Cluster the data</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="n">heatmap</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="what-if-we-add-a-pattern">What if we add a pattern?</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">678910</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># flip a coin</span><span class="w">
    </span><span class="n">coinFlip</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
    </span><span class="c1"># if coin is heads add a common pattern to that row</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">coinFlip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">dataMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dataMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rep(c(0,3),each=5) 
</code></pre></div></div>

<p>produces 0,0,0,0,0,3,3,3,3,3;</p>

<p>Adds mean to last 5 columns only</p>

<hr />

<h3 id="what-if-we-add-a-pattern---the-data">What if we add a pattern? - the data</h3>

<p>You see split between first and last 5 columns!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="what-if-we-add-a-pattern---the-clustered-data-heatmap">What if we add a pattern? - the clustered data; heatmap</h3>

<p>Appears random in the rows‚Ä¶</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="n">heatmap</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="patterns-in-rows-and-columns-heatmap">Patterns in rows and columns; heatmap</h3>

<p>order it and plot the heatmap</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hh</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hclust</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">))</span><span class="w">
</span><span class="n">dataMatrixOrdered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dataMatrix</span><span class="p">[</span><span class="n">hh</span><span class="o">$</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">rowMeans</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">),</span><span class="w"> </span><span class="m">40</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Row Mean"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Row"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">colMeans</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column Mean"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="related-problems">Related problems</h3>

<p>You have multivariate variables $X_1,\ldots,X_n$ so $X_1 = (X_{11},\ldots,X_{1m})$</p>

<ul>
  <li>Find a new set of multivariate variables that are uncorrelated and explain as much variance as possible.</li>
  <li>If you put all the variables together in one matrix, find the best matrix created with fewer variables (lower rank) that explains the original data.</li>
</ul>

<p>The first goal is <font color="#330066">statistical</font> and the second goal is <font color="#993300">data compression</font>.</p>

<hr />

<h3 id="related-solutions---pcasvd">Related solutions - PCA/SVD</h3>

<p><strong>SVD</strong></p>

<p>If $X$ is a matrix with each variable in a column and each observation in a row then the SVD is a ‚Äúmatrix decomposition‚Äù</p>

\[X = UDV^T\]

<p>where the columns of $U$ are orthogonal (left singular vectors), the columns of $V$ are orthogonal (right singular vectors) and $D$ is a diagonal matrix (singular values).</p>

<p><strong>PCA</strong></p>

<p>The principal components are equal to the right singular values if you
first scale (subtract the mean, divide by the standard deviation) the
variables.</p>

<p>This is pretty much it, it is a different way of doing the SVD I guess!</p>

<hr />

<h3 id="what-is-svd">What is SVD?</h3>

<p>X = U D V‚Äô, U spans the column space and V spans the row space and are
orthonormal vectors (UU^T=I).</p>

<p>X ‚Äì&gt; mxn; U ‚Äì&gt; mxm; D ‚Äì&gt; mxn; V ‚Äì&gt; nxn</p>

<p>Rank of X, r &lt;= min(m,n)</p>

<p>If r &lt; min(m,n), then</p>

<p>U and V have r vectors in the column (n) and row space (m). and n-r
vectors in the column space and m-r vectors in the row space.</p>

<p><a href="https://www.youtube.com/watch?v=Nx0lRBaXoz4">Gilbert Strang lecture is the source of this content.</a></p>

<h3 id="components-of-the-svd---u-and-v">Components of the SVD - $u$ and $v$</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">svd1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">u</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="m">40</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Row"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"First left singular vector"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"First right singular vector"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="when-to-scale-and-center">When to scale and center</h3>

<p><code class="language-plaintext highlighter-rouge">scale()</code> does both centering and scaling if true, i.e., (x_i -
mean(x_i)/sd(x_i)</p>

<blockquote>
  <p>it depends on the type of data you have. For some types of well
defined data, there may be no need to scale and center. A good
example is geolocation data (longitudes and latitudes). If you were
seeking to cluster towns, you wouldn‚Äôt need to scale and center
their locations.</p>

  <p>For data that is of different physical measurements or units, its
probably a good idea to scale and center. For example, when
clustering vehicles, the data may contain attributes such as number
of wheels, number of doors, miles per gallon, horsepower etc. In
this case it may be a better idea to scale and center since you are
unsure of the relationship between each attribute.</p>

  <p>The intuition behind that is that since many clustering algorithms
require some definition of distance, if you do not scale and center
your data, you may give attributes which have larger magnitudes more
importance.</p>

  <p>In the context of your problem, I would scale and center the data if
it contains attributes like patient height, weight, age etc.</p>
</blockquote>

<p><a href="https://datascience.stackexchange.com/a/22369/67821">Source Stack</a></p>

<hr />

<h3 id="components-of-the-svd---variance-calculation">Components of the SVD - Variance calculation</h3>

<p><code class="language-plaintext highlighter-rouge">svd1$d^2/sum(svd1$d^2)</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Singular value"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="o">^</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Prop. of variance explained"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="svd-vs-pca-principle-component-analysis">SVD vs PCA; principle component analysis</h3>

<p>Same as Right singular vectors. Nothing more. Look <a href="https://www.youtube.com/">here</a> for more info.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">svd1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">))</span><span class="w">
</span><span class="n">pca1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">prcomp</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">pca1</span><span class="o">$</span><span class="n">rotation</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">svd1</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Principal Component 1"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Right Singular Vector 1"</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="components-of-the-svd---variance-explained">Components of the SVD - variance explained</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">constantMatrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dataMatrixOrdered</span><span class="o">*</span><span class="m">0</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">)[</span><span class="m">1</span><span class="p">]){</span><span class="n">constantMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">each</span><span class="o">=</span><span class="m">5</span><span class="p">)}</span><span class="w">
</span><span class="n">svd1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">constantMatrix</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">constantMatrix</span><span class="p">)[,</span><span class="n">nrow</span><span class="p">(</span><span class="n">constantMatrix</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Column"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Singular value"</span><span class="p">,</span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="o">^</span><span class="m">2</span><span class="p">),</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Column"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Prop. of variance explained"</span><span class="p">,</span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="dimension-reduction-identifying-patterns">Dimension reduction: identifying patterns</h2>
<h3 id="what-if-we-add-a-second-pattern">What if we add a second pattern?</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">678910</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># flip a coin</span><span class="w">
    </span><span class="n">coinFlip1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
    </span><span class="n">coinFlip2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
    </span><span class="c1"># if coin is heads add a common pattern to that row</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">coinFlip1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">dataMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dataMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">coinFlip2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">dataMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dataMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">hh</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hclust</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">))</span><span class="w">
</span><span class="n">dataMatrixOrdered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dataMatrix</span><span class="p">[</span><span class="n">hh</span><span class="o">$</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="singular-value-decomposition---true-patterns">Singular value decomposition - true patterns</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">svd2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Pattern 1"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Pattern 2"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="v-and-patterns-of-variance-in-rows">$v$ and patterns of variance in rows</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">svd2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd2</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"First right singular vector"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd2</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Second right singular vector"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="d-and-variance-explained">$d$ and variance explained</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">svd1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Singular value"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="o">^</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Column"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of variance explained"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="missing-values-na">Missing values NA</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataMatrix2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dataMatrixOrdered</span><span class="w">
</span><span class="c1">## Randomly insert some missing data</span><span class="w">
</span><span class="n">dataMatrix2</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">svd1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">dataMatrix2</span><span class="p">))</span><span class="w">  </span><span class="c1">## Doesn't work!</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error: infinite or missing values in 'x'
</code></pre></div></div>

<hr />

<h3 id="own-imputing-the-missing-values-na">Own imputing the missing values NA</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mn2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">mean.across.days</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span><span class="c1">## Are there differences in activity patterns between weekdays and</span><span class="w">
</span><span class="c1">## weekends?</span><span class="w">

</span><span class="n">na.row</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">mn2</span><span class="o">$</span><span class="n">steps</span><span class="p">),</span><span class="n">arr.ind</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">mn2</span><span class="o">$</span><span class="n">steps.imputed.without.NA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mn2</span><span class="o">$</span><span class="n">steps</span><span class="w">
</span><span class="n">mn2</span><span class="o">$</span><span class="n">steps.imputed.without.NA</span><span class="p">[</span><span class="n">na.row</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mn2</span><span class="o">$</span><span class="n">mean.across.days</span><span class="p">[</span><span class="n">na.row</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h3 id="imputing-impute">Imputing {impute}</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">impute</span><span class="p">)</span><span class="w">  </span><span class="c1">## Available from http://bioconductor.org</span><span class="w">
</span><span class="n">dataMatrix2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dataMatrixOrdered</span><span class="w">
</span><span class="n">dataMatrix2</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">40</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">dataMatrix2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">impute.knn</span><span class="p">(</span><span class="n">dataMatrix2</span><span class="p">)</span><span class="o">$</span><span class="n">data</span><span class="w">
</span><span class="n">svd1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">dataMatrixOrdered</span><span class="p">));</span><span class="w"> </span><span class="n">svd2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">dataMatrix2</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">));</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">);</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">svd2</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="face-example">Face example</h3>

<!-- ## source("http://dl.dropbox.com/u/7710864/courseraPublic/myplclust.R") -->

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s2">"data/face.rda"</span><span class="p">)</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">faceData</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">faceData</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="face-example---variance-explained">Face example - variance explained</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">svd1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">faceData</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="o">^</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Singular vector"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Variance explained"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="face-example---create-approximations">Face example - create approximations</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="n">svd1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">faceData</span><span class="p">))</span><span class="w">
</span><span class="c1">## Note that %*% is matrix multiplication</span><span class="w">

</span><span class="c1"># Here svd1$d[1] is a constant</span><span class="w">
</span><span class="n">approx1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd1</span><span class="o">$</span><span class="n">u</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">

</span><span class="c1"># In these examples we need to make the diagonal matrix out of d</span><span class="w">
</span><span class="n">approx5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd1</span><span class="o">$</span><span class="n">u</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">]</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">diag</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">])</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">])</span><span class="w">
</span><span class="n">approx10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svd1</span><span class="o">$</span><span class="n">u</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">]</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">diag</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">d</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">])</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="face-example---plot-approximations">Face example - plot approximations</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">approx1</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">approx1</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(a)"</span><span class="p">)</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">approx5</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">approx5</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(b)"</span><span class="p">)</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">approx10</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">approx10</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(c)"</span><span class="p">)</span><span class="w">
</span><span class="n">image</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">faceData</span><span class="p">)[,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">faceData</span><span class="p">)</span><span class="o">:</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(d)"</span><span class="p">)</span><span class="w">  </span><span class="c1">## Original data</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="notes-and-further-resources-3">Notes and further resources</h3>

<ul>
  <li>Scale matters</li>
  <li>PC‚Äôs/SV‚Äôs may mix real patterns</li>
  <li>Can be computationally intensive</li>
  <li><a href="http://www.stat.cmu.edu/~cshalizi/ADAfaEPoV/ADAfaEPoV.pdf">Advanced data analysis from an elementary point of view</a></li>
  <li><a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/">Elements of statistical learning</a></li>
  <li>Alternatives
    <ul>
      <li><a href="http://en.wikipedia.org/wiki/Factor_analysis">Factor analysis</a></li>
      <li><a href="http://en.wikipedia.org/wiki/Independent_component_analysis">Independent components analysis</a></li>
      <li><a href="http://en.wikipedia.org/wiki/Latent_semantic_analysis">Latent semantic analysis</a>
        <h2 id="colors">Colors</h2>
        <h3 id="plotting-and-color">Plotting and Color</h3>
      </li>
    </ul>
  </li>
  <li>The default color schemes for most plots in R are horrendous
    <ul>
      <li>I don‚Äôt have good taste and even I know that</li>
    </ul>
  </li>
  <li>Recently there have been developments to improve the handling/specifica1on of colors in plots/graphs/etc.</li>
  <li>There are functions in R and in external packages that are very handy</li>
</ul>

<hr />

<h3 id="color-u1li1es-in-r">Color U1li1es in R</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">grDevices</code> package has two functions
    <ul>
      <li><code class="language-plaintext highlighter-rouge">colorRamp</code></li>
      <li><code class="language-plaintext highlighter-rouge">colorRampPalette</code></li>
    </ul>
  </li>
  <li>These functions take palettes of colors and help to interpolate between the colors</li>
  <li>The function colors() lists the names of colors you can use in any plotting function</li>
</ul>

<hr />

<h3 id="color-palette-utilities-in-r">Color Palette Utilities in R</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">colorRamp</code>: Take a palette of colors and return a function that takes valeus between 0 and 1, indicating the extremes of the color palette (e.g. see the ‚Äògray‚Äô function)</li>
  <li><code class="language-plaintext highlighter-rouge">colorRampPalette</code>: Take a palette of colors and return a function that takes integer arguments and returns a vector of colors interpolating the palette (like <code class="language-plaintext highlighter-rouge">heat.colors</code> or <code class="language-plaintext highlighter-rouge">topo.colors</code>)</li>
</ul>

<hr />

<h3 id="colorramp">colorRamp</h3>

<p><code class="language-plaintext highlighter-rouge">[,1] [,2] [,3]</code> corresponds to <code class="language-plaintext highlighter-rouge">[Red] [Blue] [Green]</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">pal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorRamp</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">))</span><span class="w">

</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pal</span><span class="p">(</span><span class="m">0</span><span class="p">)</span><span class="w">
     </span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="p">[,</span><span class="m">3</span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w">  </span><span class="m">255</span><span class="w">    </span><span class="m">0</span><span class="w">    </span><span class="m">0</span><span class="w">

</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pal</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
     </span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="p">[,</span><span class="m">3</span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w">    </span><span class="m">0</span><span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="m">255</span><span class="w">

</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pal</span><span class="p">(</span><span class="m">0.5</span><span class="p">)</span><span class="w">
      </span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w">  </span><span class="p">[,</span><span class="m">3</span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w"> </span><span class="m">127.5</span><span class="w">    </span><span class="m">0</span><span class="w"> </span><span class="m">127.5</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="colorramp-1">colorRamp</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">pal</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">))</span><span class="w">
                  </span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w">       </span><span class="p">[,</span><span class="m">3</span><span class="p">]</span><span class="w">
        </span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w"> </span><span class="m">255.00000</span><span class="w">    </span><span class="m">0</span><span class="w">          </span><span class="m">0</span><span class="w">
        </span><span class="p">[</span><span class="m">2</span><span class="p">,]</span><span class="w"> </span><span class="m">226.66667</span><span class="w">    </span><span class="m">0</span><span class="w">   </span><span class="m">28.33333</span><span class="w">
        </span><span class="p">[</span><span class="m">3</span><span class="p">,]</span><span class="w"> </span><span class="m">198.33333</span><span class="w">    </span><span class="m">0</span><span class="w">   </span><span class="m">56.66667</span><span class="w">
        </span><span class="p">[</span><span class="m">4</span><span class="p">,]</span><span class="w"> </span><span class="m">170.00000</span><span class="w">    </span><span class="m">0</span><span class="w">   </span><span class="m">85.00000</span><span class="w">
        </span><span class="p">[</span><span class="m">5</span><span class="p">,]</span><span class="w"> </span><span class="m">141.66667</span><span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="m">113.33333</span><span class="w">
        </span><span class="p">[</span><span class="m">6</span><span class="p">,]</span><span class="w"> </span><span class="m">113.33333</span><span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="m">141.66667</span><span class="w">
        </span><span class="p">[</span><span class="m">7</span><span class="p">,]</span><span class="w">  </span><span class="m">85.00000</span><span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="m">170.00000</span><span class="w">
        </span><span class="p">[</span><span class="m">8</span><span class="p">,]</span><span class="w">  </span><span class="m">56.66667</span><span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="m">198.33333</span><span class="w">
        </span><span class="p">[</span><span class="m">9</span><span class="p">,]</span><span class="w">  </span><span class="m">28.33333</span><span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="m">226.66667</span><span class="w">
        </span><span class="p">[</span><span class="m">10</span><span class="p">,]</span><span class="w">  </span><span class="m">0.00000</span><span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="m">255.00000</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="colorramppalette">colorRampPalette</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">pal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorRampPalette</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"yellow"</span><span class="p">))</span><span class="w">

</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pal</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"#FF0000"</span><span class="w"> </span><span class="s2">"#FFFF00"</span><span class="w">

</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pal</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">
 </span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"#FF0000"</span><span class="w"> </span><span class="s2">"#FF1C00"</span><span class="w"> </span><span class="s2">"#FF3800"</span><span class="w"> </span><span class="s2">"#FF5500"</span><span class="w"> </span><span class="s2">"#FF7100"</span><span class="w">
 </span><span class="p">[</span><span class="m">6</span><span class="p">]</span><span class="w"> </span><span class="s2">"#FF8D00"</span><span class="w"> </span><span class="s2">"#FFAA00"</span><span class="w"> </span><span class="s2">"#FFC600"</span><span class="w"> </span><span class="s2">"#FFE200"</span><span class="w"> </span><span class="err">"</span><span class="c1">#FFFF00‚Äù</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="rcolorbrewer-package">RColorBrewer Package</h3>

<ul>
  <li>
    <p>One package on CRAN that contains <strong>interesing/useful color palettes</strong></p>
  </li>
  <li>There are 3 types of palettes
    <ul>
      <li><strong>Sequential</strong></li>
      <li><strong>Diverging</strong></li>
      <li><strong>Qualitative</strong></li>
    </ul>
  </li>
  <li>Palette informa1on can be used in conjunction with the <code class="language-plaintext highlighter-rouge">colorRamp()</code> and <code class="language-plaintext highlighter-rouge">colorRampPalette()</code></li>
</ul>

<p>https://www.google.com/search?q=rcolorbrewer+package&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=0ahUKEwjUgtT7wsLgAhXIaFAKHVk6CdsQ_AUIDigB&amp;biw=792&amp;bih=756#imgrc=FVFdJalwdTOVNM:</p>

<hr />

<h3 id="rcolorbrewer-and-colorramppalette">RColorBrewer and colorRampPalette</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">

</span><span class="n">cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="s2">"BuGn"</span><span class="p">)</span><span class="w">

</span><span class="n">cols</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"#E5F5F9"</span><span class="w"> </span><span class="s2">"#99D8C9"</span><span class="w"> </span><span class="s2">"#2CA25F"</span><span class="w">

</span><span class="n">pal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorRampPalette</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="w">

</span><span class="n">image</span><span class="p">(</span><span class="n">volcano</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pal</span><span class="p">(</span><span class="m">20</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="the-smoothscatter-function">The smoothScatter function</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">smoothScatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w">


</span></code></pre></div></div>

<hr />

<h3 id="some-other-plotting-notes">Some other plotting notes</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">rgb</code> function can be used to produce any color via red, green, blue proportions</li>
  <li>Color transparency can be added via the <code class="language-plaintext highlighter-rouge">alpha</code> parameter to <code class="language-plaintext highlighter-rouge">rgb</code></li>
  <li>The <code class="language-plaintext highlighter-rouge">colorspace</code> package can be used for a different control over colors</li>
</ul>

<hr />

<h3 id="scatterplot-with-no-transparency">Scatterplot with no transparency</h3>

<p>plot(x,y,pch=19)</p>

<hr />

<h3 id="scatterplot-with-transparency">Scatterplot with transparency</h3>

<p>plot(x,y,col=rgb(0,0,0,0.2),pch=19)</p>

<hr />

<h3 id="summary-6">Summary</h3>

<ul>
  <li>Careful use of colors in plots/maps/etc. can make it easier for the reader to get what you‚Äôre trying to say (why make it harder?)</li>
  <li>The <code class="language-plaintext highlighter-rouge">RColorBrewer</code> package is an R package that provides color palettes for sequential, categorical, and diverging data</li>
  <li>The <code class="language-plaintext highlighter-rouge">colorRamp</code> and <code class="language-plaintext highlighter-rouge">colorRampPalette</code> functions can be used in conjunction with color palettes to connect data to colors</li>
  <li>Transparency can sometimes be used to clarify plots with many points
    <h2 id="c4-w4">c4-w4</h2>
    <h3 id="slightly-processed-data">Slightly processed data</h3>
  </li>
</ul>

<p><a href="https://github.com/jtleek/modules/blob/master/04_ExploratoryAnalysis/clusteringExample/data/samsungData.rda">Samsung data file</a></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s2">"data/samsungData.rda"</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">samsungData</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  [1] "tBodyAcc-mean()-X" "tBodyAcc-mean()-Y" "tBodyAcc-mean()-Z"
##  [4] "tBodyAcc-std()-X"  "tBodyAcc-std()-Y"  "tBodyAcc-std()-Z" 
##  [7] "tBodyAcc-mad()-X"  "tBodyAcc-mad()-Y"  "tBodyAcc-mad()-Z" 
## [10] "tBodyAcc-max()-X"  "tBodyAcc-max()-Y"  "tBodyAcc-max()-Z"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">table</span><span class="p">(</span><span class="n">samsungData</span><span class="o">$</span><span class="n">activity</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 
##   laying  sitting standing     walk walkdown   walkup 
##     1407     1286     1374     1226      986     1073
</code></pre></div></div>

<hr />

<h3 id="plotting-average-acceleration-for-first-subject">Plotting average acceleration for first subject</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">samsungData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">transform</span><span class="p">(</span><span class="n">samsungData</span><span class="p">,</span><span class="w"> </span><span class="n">activity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">activity</span><span class="p">))</span><span class="w">
</span><span class="n">sub1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">samsungData</span><span class="p">,</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">sub1</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">sub1</span><span class="p">)[</span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"bottomright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">),</span><span class="w"> 
    </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Need to use <code class="language-plaintext highlighter-rouge">unique</code> for legend, don‚Äôt need to use us unique in plot.</p>

<hr />

<h3 id="clustering-based-just-on-average-acceleration">Clustering based just on average acceleration</h3>

<!-- ## -->
<!-- source("http://dl.dropbox.com/u/7710864/courseraPublic/myplclust.R")  -->
<!-- above line of course doens't work! -->

<p>This is a bad idea in this case as the avg acc is not able to
distinguish between the different activities.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rafalib</span><span class="p">)</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"myplclust.R"</span><span class="p">)</span><span class="w">
</span><span class="n">distanceMatrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">])</span><span class="w">
</span><span class="n">hclustering</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hclust</span><span class="p">(</span><span class="n">distanceMatrix</span><span class="p">)</span><span class="w">
</span><span class="n">myplclust</span><span class="p">(</span><span class="n">hclustering</span><span class="p">,</span><span class="w"> </span><span class="n">lab.col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unclass</span><span class="p">(</span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<p>https://rdrr.io/cran/rafalib/src/R/myplclust.R</p>

<hr />

<h3 id="plotting-max-acceleration-for-the-first-subject">Plotting max acceleration for the first subject</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="m">10</span><span class="p">],</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">sub1</span><span class="p">)[</span><span class="m">10</span><span class="p">])</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="m">11</span><span class="p">],</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">sub1</span><span class="p">)[</span><span class="m">11</span><span class="p">])</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"bottomright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">),</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>Much better way to identify parameters for clustering and setting
cutoffs for identifying or distinguishing things.</p>

<hr />

<h3 id="clustering-based-on-maximum-acceleration">Clustering based on maximum acceleration</h3>
<p>Now we see some useful clustering based on distance, taking in XYZ acc!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">distanceMatrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="m">10</span><span class="o">:</span><span class="m">12</span><span class="p">])</span><span class="w">
</span><span class="n">hclustering</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hclust</span><span class="p">(</span><span class="n">distanceMatrix</span><span class="p">)</span><span class="w">
</span><span class="n">myplclust</span><span class="p">(</span><span class="n">hclustering</span><span class="p">,</span><span class="w"> </span><span class="n">lab.col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unclass</span><span class="p">(</span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">))</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">),</span><span class="w"> 
    </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="singular-value-decomposition">Singular Value Decomposition</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">svd1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svd</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">562</span><span class="p">,</span><span class="w"> </span><span class="m">563</span><span class="p">)]))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">u</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">u</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="find-maximum-contributor">Find maximum contributor</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-4.png" alt="plot of chunk unnamed-chunk-4" /></p>

<hr />

<h3 id="new-clustering-with-maximum-contributer">New clustering with maximum contributer</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">maxContrib</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which.max</span><span class="p">(</span><span class="n">svd1</span><span class="o">$</span><span class="n">v</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="n">distanceMatrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">maxContrib</span><span class="p">)])</span><span class="w">
</span><span class="n">hclustering</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hclust</span><span class="p">(</span><span class="n">distanceMatrix</span><span class="p">)</span><span class="w">
</span><span class="n">myplclust</span><span class="p">(</span><span class="n">hclustering</span><span class="p">,</span><span class="w"> </span><span class="n">lab.col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unclass</span><span class="p">(</span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-5.png" alt="plot of chunk unnamed-chunk-5" /></p>

<hr />

<h3 id="new-clustering-with-maximum-contributer-1">New clustering with maximum contributer</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">samsungData</span><span class="p">)[</span><span class="n">maxContrib</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] "fBodyAcc.meanFreq...Z"
</code></pre></div></div>

<hr />

<h3 id="k-means-clustering-nstart1-first-try">K-means clustering (nstart=1, first try)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kClust</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kmeans</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">562</span><span class="p">,</span><span class="w"> </span><span class="m">563</span><span class="p">)],</span><span class="w"> </span><span class="n">centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">kClust</span><span class="o">$</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##    
##     laying sitting standing walk walkdown walkup
##   1      0       0        0   50        1      0
##   2      0       0        0    0       48      0
##   3     27      37       51    0        0      0
##   4      3       0        0    0        0     53
##   5      0       0        0   45        0      0
##   6     20      10        2    0        0      0
</code></pre></div></div>

<hr />

<h3 id="k-means-clustering-nstart1-second-try">K-means clustering (nstart=1, second try)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kClust</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kmeans</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">562</span><span class="p">,</span><span class="w"> </span><span class="m">563</span><span class="p">)],</span><span class="w"> </span><span class="n">centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">nstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">kClust</span><span class="o">$</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##    
##     laying sitting standing walk walkdown walkup
##   1      0       0        0    0       49      0
##   2     18      10        2    0        0      0
##   3      0       0        0   95        0      0
##   4     29       0        0    0        0      0
##   5      0      37       51    0        0      0
##   6      3       0        0    0        0     53
</code></pre></div></div>

<hr />

<h3 id="k-means-clustering-nstart100-first-try">K-means clustering (nstart=100, first try)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kClust</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kmeans</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">562</span><span class="p">,</span><span class="w"> </span><span class="m">563</span><span class="p">)],</span><span class="w"> </span><span class="n">centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">nstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">kClust</span><span class="o">$</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##    
##     laying sitting standing walk walkdown walkup
##   1     18      10        2    0        0      0
##   2     29       0        0    0        0      0
##   3      0       0        0   95        0      0
##   4      0       0        0    0       49      0
##   5      3       0        0    0        0     53
##   6      0      37       51    0        0      0
</code></pre></div></div>

<hr />

<h3 id="k-means-clustering-nstart100-second-try">K-means clustering (nstart=100, second try)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kClust</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kmeans</span><span class="p">(</span><span class="n">sub1</span><span class="p">[,</span><span class="w"> </span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">562</span><span class="p">,</span><span class="w"> </span><span class="m">563</span><span class="p">)],</span><span class="w"> </span><span class="n">centers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">nstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">kClust</span><span class="o">$</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="n">sub1</span><span class="o">$</span><span class="n">activity</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##    
##     laying sitting standing walk walkdown walkup
##   1     29       0        0    0        0      0
##   2      3       0        0    0        0     53
##   3      0       0        0    0       49      0
##   4      0       0        0   95        0      0
##   5      0      37       51    0        0      0
##   6     18      10        2    0        0      0
</code></pre></div></div>

<hr />

<h3 id="cluster-1-variable-centers-laying">Cluster 1 Variable Centers (Laying)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">kClust</span><span class="o">$</span><span class="n">center</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">],</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cluster Center"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-9.png" alt="plot of chunk unnamed-chunk-9" /></p>

<hr />

<h3 id="cluster-2-variable-centers-walking">Cluster 2 Variable Centers (Walking)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">kClust</span><span class="o">$</span><span class="n">center</span><span class="p">[</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">],</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cluster Center"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-10.png" alt="plot of chunk unnamed-chunk-10" /></p>

<h2 id="airpollution-example">Airpollution example</h2>

<h3 id="setwd">setwd</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setwd</span><span class="p">(</span><span class="s2">"./blablabla/"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="entry-questions-has-fine-particle-pollution-in-the-us-decreased-from-1999-to-2012">Entry questions Has fine particle pollution in the U.S. decreased from 1999 to 2012?</h3>

<h3 id="read-in-data-from-1999">Read in data from 1999</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pm0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"RD_501_88101_1999-0.txt"</span><span class="p">,</span><span class="w"> </span><span class="n">comment.char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"|"</span><span class="p">,</span><span class="w"> </span><span class="n">na.strings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">pm0</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">pm0</span><span class="p">)</span><span class="w">
</span><span class="n">cnames</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readLines</span><span class="p">(</span><span class="s2">"RD_501_88101_1999-0.txt"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">cnames</span><span class="p">)</span><span class="w">
</span><span class="n">cnames</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">strsplit</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span><span class="w"> </span><span class="s2">"|"</span><span class="p">,</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">cnames</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">pm0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">make.names</span><span class="p">(</span><span class="n">cnames</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">pm0</span><span class="p">)</span><span class="w">
</span><span class="n">x0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm0</span><span class="o">$</span><span class="n">Sample.Value</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x0</span><span class="p">))</span><span class="w">  </span><span class="c1">## Are missing values important here?</span><span class="w">
</span></code></pre></div></div>

<h3 id="read-in-data-from-2012">Read in data from 2012</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pm1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"RD_501_88101_2012-0.txt"</span><span class="p">,</span><span class="w"> </span><span class="n">comment.char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"|"</span><span class="p">,</span><span class="w"> </span><span class="n">na.strings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1304290</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">pm1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">make.names</span><span class="p">(</span><span class="n">cnames</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span><span class="w"> </span><span class="c1"># remove spaces in names</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">pm1</span><span class="p">)</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">pm1</span><span class="p">)</span><span class="w">
</span><span class="n">x1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm1</span><span class="o">$</span><span class="n">Sample.Value</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="five-number-summaries-for-both-periods">Five number summaries for both periods</h3>
<p>summary(x1)
summary(x0)
mean(is.na(x1))  ## Are missing values important here?</p>

<h3 id="make-a-boxplot-of-both-1999-and-2012">Make a boxplot of both 1999 and 2012</h3>
<p>boxplot(x0, x1)
boxplot(log10(x0), log10(x1))</p>

<h3 id="check-negative-values-in-x1">Check negative values in ‚Äòx1‚Äô</h3>
<p>summary(x1)
negative &lt;- x1 &lt; 0
sum(negative, na.rm = T)
mean(negative, na.rm = T)
dates &lt;- pm1$Date
str(dates)
dates &lt;- as.Date(as.character(dates), ‚Äú%Y%m%d‚Äù)
str(dates)
hist(dates, ‚Äúmonth‚Äù)  ## Check what‚Äôs going on in months 1‚Äì6</p>

<h3 id="plot-a-subset-for-one-monitor-at-both-times">Plot a subset for one monitor at both times</h3>

<h3 id="find-a-monitor-for-new-york-state-that-exists-in-both-datasets">Find a monitor for New York State that exists in both datasets</h3>
<p>site0 &lt;- unique(subset(pm0, State.Code == 36, c(County.Code, Site.ID)))
site1 &lt;- unique(subset(pm1, State.Code == 36, c(County.Code, Site.ID)))
site0 &lt;- paste(site0[,1], site0[,2], sep = ‚Äú.‚Äù)
site1 &lt;- paste(site1[,1], site1[,2], sep = ‚Äú.‚Äù)
str(site0)
str(site1)
both &lt;- intersect(site0, site1)
print(both)</p>

<h3 id="find-how-many-observations-available-at-each-monitor">Find how many observations available at each monitor</h3>
<p>pm0$county.site &lt;- with(pm0, paste(County.Code, Site.ID, sep = ‚Äú.‚Äù))
pm1$county.site &lt;- with(pm1, paste(County.Code, Site.ID, sep = ‚Äú.‚Äù))
cnt0 &lt;- subset(pm0, State.Code == 36 &amp; county.site %in% both)
cnt1 &lt;- subset(pm1, State.Code == 36 &amp; county.site %in% both)
sapply(split(cnt0, cnt0$county.site), nrow)
sapply(split(cnt1, cnt1$county.site), nrow)</p>

<h3 id="choose-county-63-and-side-id-2008">Choose county 63 and side ID 2008</h3>
<p>pm1sub &lt;- subset(pm1, State.Code == 36 &amp; County.Code == 63 &amp; Site.ID == 2008)
pm0sub &lt;- subset(pm0, State.Code == 36 &amp; County.Code == 63 &amp; Site.ID == 2008)
dim(pm1sub)
dim(pm0sub)</p>

<h3 id="plot-data-for-2012">Plot data for 2012</h3>
<p>dates1 &lt;- pm1sub$Date
x1sub &lt;- pm1sub$Sample.Value
plot(dates1, x1sub)
dates1 &lt;- as.Date(as.character(dates1), ‚Äú%Y%m%d‚Äù)
str(dates1)
plot(dates1, x1sub)</p>

<h3 id="plot-data-for-1999">Plot data for 1999</h3>
<p>dates0 &lt;- pm0sub$Date
dates0 &lt;- as.Date(as.character(dates0), ‚Äú%Y%m%d‚Äù)
x0sub &lt;- pm0sub$Sample.Value
plot(dates0, x0sub)</p>

<h3 id="plot-data-for-both-years-in-same-panel">Plot data for both years in same panel</h3>
<p>par(mfrow = c(1, 2), mar = c(4, 4, 2, 1))
plot(dates0, x0sub, pch = 20)
abline(h = median(x0sub, na.rm = T))
plot(dates1, x1sub, pch = 20)  ## Whoa! Different ranges
abline(h = median(x1sub, na.rm = T))</p>

<h3 id="find-global-range">Find global range</h3>
<p>rng &lt;- range(x0sub, x1sub, na.rm = T)
rng
par(mfrow = c(1, 2), mar = c(4, 4, 2, 1))
plot(dates0, x0sub, pch = 20, ylim = rng)
abline(h = median(x0sub, na.rm = T))
plot(dates1, x1sub, pch = 20, ylim = rng)
abline(h = median(x1sub, na.rm = T))</p>

<h3 id="show-state-wide-means-and-make-a-plot-showing-trend">Show state-wide means and make a plot showing trend</h3>
<p>head(pm0)
mn0 &lt;- with(pm0, tapply(Sample.Value, State.Code, mean, na.rm = T))
str(mn0)
summary(mn0)
mn1 &lt;- with(pm1, tapply(Sample.Value, State.Code, mean, na.rm = T))
str(mn1)</p>

<h3 id="make-separate-data-frames-for-states--years">Make separate data frames for states / years</h3>
<p>d0 &lt;- data.frame(state = names(mn0), mean = mn0)
d1 &lt;- data.frame(state = names(mn1), mean = mn1)
mrg &lt;- merge(d0, d1, by = ‚Äústate‚Äù)
dim(mrg)
head(mrg)</p>

<h3 id="connect-lines">Connect lines</h3>
<p>par(mfrow = c(1, 1))
with(mrg, plot(rep(1, 52), mrg[, 2], xlim = c(.5, 2.5)))
with(mrg, points(rep(2, 52), mrg[, 3]))
segments(rep(1, 52), mrg[, 2], rep(2, 52), mrg[, 3])</p>
<h2 id="reproducible-research-c5--structure-of-data-analysis">Reproducible research (c5)- Structure of Data analysis</h2>
<h3 id="steps-in-a-data-analysis">Steps in a data analysis</h3>

<ul>
  <li>
    <redtext>Define the question</redtext>
  </li>
  <li>
    <redtext>Define the ideal data set</redtext>
  </li>
  <li>
    <redtext>Determine what data you can access</redtext>
  </li>
  <li>
    <redtext>Obtain the data</redtext>
  </li>
  <li>
    <redtext>Clean the data </redtext>
  </li>
  <li>Exploratory data analysis</li>
  <li>Statistical prediction/modeling</li>
  <li>Interpret results</li>
  <li>Challenge results</li>
  <li>Synthesize/write up results</li>
  <li>Create reproducible code</li>
</ul>

<hr />

<h3 id="the-key-challenge-in-data-analysis">The key challenge in data analysis</h3>

<p>‚ÄúAsk yourselves, what problem have you solved, ever, that was worth solving, where you knew all of the given information in advance? Where you didn‚Äôt have a surplus of information and have to filter it out, or you had insufficient information and have to go find some?‚Äù</p>

<hr />

<h3 id="an-example">An example</h3>

<p><strong>Start with a general question</strong></p>

<p>Can I automatically detect emails that are SPAM that are not?</p>

<p><strong>Make it concrete</strong></p>

<p>Can I use quantitative characteristics of the emails to classify them as SPAM/HAM?</p>

<hr />

<h3 id="define-the-ideal-data-set">Define the ideal data set</h3>

<ul>
  <li>The data set may depend on your goal
    <ul>
      <li>Descriptive - a whole population</li>
      <li>Exploratory - a random sample with many variables measured</li>
      <li>Inferential - the right population, randomly sampled</li>
      <li>Predictive - a training and test data set from the same population</li>
      <li>Causal - data from a randomized study</li>
      <li>Mechanistic - data about all components of the system</li>
    </ul>
  </li>
</ul>

<p>Say for example, <a href="http://www.google.com/about/datacenters/inside/">http://www.google.com/about/datacenters/inside/</a></p>

<hr />

<h3 id="determine-what-data-you-can-access">Determine what data you can access</h3>

<ul>
  <li>Sometimes you can find data free on the web</li>
  <li>Other times you may need to buy the data</li>
  <li>Be sure to respect the terms of use</li>
  <li>If the data don‚Äôt exist, you may need to generate it yourself</li>
</ul>

<h3 id="a-possible-solution">A possible solution</h3>

<p>Open source data available on UCI!</p>

<p><a href="http://archive.ics.uci.edu/ml/datasets/Spambase">http://archive.ics.uci.edu/ml/datasets/Spambase</a></p>

<hr />

<h3 id="obtain-the-data">Obtain the data</h3>

<ul>
  <li>Try to obtain the raw data</li>
  <li>Be sure to reference the source</li>
  <li>Polite emails go a long way</li>
  <li>If you will load the data from an internet source, record the url and time accessed</li>
</ul>

<hr />

<h3 id="our-data-set-for-spam-emails">Our data set for spam emails!</h3>

<p><code class="language-plaintext highlighter-rouge">kernlab</code> seems to have data on spam email!</p>

<p><a href="http://search.r-project.org/library/kernlab/html/spam.html">http://search.r-project.org/library/kernlab/html/spam.html</a></p>

<hr />

<h3 id="clean-the-data">Clean the data</h3>

<ul>
  <li>Raw data often needs to be processed</li>
  <li>If it is pre-processed, make sure you understand how</li>
  <li>Understand the source of the data (census, sample, convenience sample, etc.)</li>
  <li>May need reformating, subsampling - record these steps</li>
  <li><strong>Determine if the data are good enough</strong> - if not, quit or change data</li>
</ul>

<hr />

<h3 id="our-cleaned-data-set">Our cleaned data set</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># If it isn't installed, install the kernlab package with install.packages()</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">kernlab</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">spam</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	4601 obs. of  5 variables:
 $ make   : num  0 0.21 0.06 0 0 0 0 0 0.15 0.06 ...
 $ address: num  0.64 0.28 0 0 0 0 0 0 0 0.12 ...
 $ all    : num  0.64 0.5 0.71 0 0 0 0 0 0.46 0.77 ...
 $ num3d  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ our    : num  0.32 0.14 1.23 0.63 0.63 1.85 1.92 1.88 0.61 0.19 ...
</code></pre></div></div>

<p><a href="http://search.r-project.org/library/kernlab/html/spam.html">http://search.r-project.org/library/kernlab/html/spam.html</a></p>

<h2 id="structure-of-data-analysis-2-c5">Structure of Data analysis 2 (c5)</h2>
<h3 id="steps-in-a-data-analysis-1">Steps in a data analysis</h3>

<ul>
  <li>Define the question</li>
  <li>Define the ideal data set</li>
  <li>Determine what data you can access</li>
  <li>Obtain the data</li>
  <li>Clean the data</li>
  <li>
    <redtext>Exploratory data analysis</redtext>
  </li>
  <li>
    <redtext>Statistical prediction/modeling</redtext>
  </li>
  <li>
    <redtext>Interpret results</redtext>
  </li>
  <li>
    <redtext>Challenge results</redtext>
  </li>
  <li>
    <redtext>Synthesize/write up results</redtext>
  </li>
  <li>
    <redtext>Create reproducible code</redtext>
  </li>
</ul>

<hr />

<h3 id="an-example-1">An example</h3>

<p><strong>Start with a general question</strong></p>

<p>Can I automatically detect emails that are SPAM or not?</p>

<p><strong>Make it concrete</strong></p>

<p>Can I use quantitative characteristics of the emails to classify them as SPAM/HAM?</p>

<hr />

<h3 id="our-data-set">Our data set</h3>

<p><a href="http://search.r-project.org/library/kernlab/html/spam.html">http://search.r-project.org/library/kernlab/html/spam.html</a></p>

<hr />

<h3 id="subsampling-our-data-set">Subsampling our data set</h3>
<p>We need to generate a test and training set (prediction)</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># If it isn't installed, install the kernlab package</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">kernlab</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span><span class="w">
</span><span class="c1"># Perform the subsampling</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">3435</span><span class="p">)</span><span class="w">
</span><span class="n">trainIndicator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="m">4601</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">trainIndicator</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## trainIndicator
##    0    1 
## 2314 2287
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trainSpam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spam</span><span class="p">[</span><span class="n">trainIndicator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">testSpam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spam</span><span class="p">[</span><span class="n">trainIndicator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="exploratory-data-analysis">Exploratory data analysis</h3>

<ul>
  <li>Look at summaries of the data</li>
  <li>Check for missing data</li>
  <li>Create exploratory plots</li>
  <li>Perform exploratory analyses (e.g. clustering)</li>
</ul>

<hr />

<h3 id="names">Names</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">trainSpam</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  [1] "make"              "address"           "all"              
##  [4] "num3d"             "our"               "over"             
##  [7] "remove"            "internet"          "order"            
## [10] "mail"              "receive"           "will"             
## [13] "people"            "report"            "addresses"        
## [16] "free"              "business"          "email"            

</code></pre></div></div>

<hr />

<h3 id="head">Head</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">trainSpam</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##    make address  all num3d  our over remove internet order mail receive
## 1  0.00    0.64 0.64     0 0.32 0.00   0.00        0  0.00 0.00    0.00
## 7  0.00    0.00 0.00     0 1.92 0.00   0.00        0  0.00 0.64    0.96
## 9  0.15    0.00 0.46     0 0.61 0.00   0.30        0  0.92 0.76    0.76
## 12 0.00    0.00 0.25     0 0.38 0.25   0.25        0  0.00 0.00    0.12
## 14 0.00    0.00 0.00     0 0.90 0.00   0.90        0  0.00 0.90    0.90
## 16 0.00    0.42 0.42     0 1.27 0.00   0.42        0  0.00 1.27    0.00
##    will people report addresses free business email  you credit your font
## 1  0.64   0.00      0         0 0.32        0  1.29 1.93   0.00 0.96    0
## 7  1.28   0.00      0         0 0.96        0  0.32 3.85   0.00 0.64    0
## 9  0.92   0.00      0         0 0.00        0  0.15 1.23   3.53 2.00    0
## 12 0.12   0.12      0         0 0.00        0  0.00 1.16   0.00 0.77    0
## 14 0.00   0.90      0         0 0.00        0  0.00 2.72   0.00 0.90    0
## 16 0.00   0.00      0         0 1.27        0  0.00 1.70   0.42 1.27    0
##    num000 money hp hpl george num650 lab labs telnet num857 data num415
## 1       0  0.00  0   0      0      0   0    0      0      0 0.00      0
## 7       0  0.00  0   0      0      0   0    0      0      0 0.00      0
## 9       0  0.15  0   0      0      0   0    0      0      0 0.15      0
## 12      0  0.00  0   0      0      0   0    0      0      0 0.00      0
## 14      0  0.00  0   0      0      0   0    0      0      0 0.00      0
## 16      0  0.42  0   0      0      0   0    0      0      0 0.00      0
##    num85 technology num1999 parts pm direct cs meeting original project re
## 1      0          0    0.00     0  0   0.00  0       0      0.0       0  0
## 7      0          0    0.00     0  0   0.00  0       0      0.0       0  0
## 9      0          0    0.00     0  0   0.00  0       0      0.3       0  0
## 12     0          0    0.00     0  0   0.00  0       0      0.0       0  0
## 14     0          0    0.00     0  0   0.00  0       0      0.0       0  0
## 16     0          0    1.27     0  0   0.42  0       0      0.0       0  0
##    edu table conference charSemicolon charRoundbracket charSquarebracket
## 1    0     0          0         0.000            0.000                 0
## 7    0     0          0         0.000            0.054                 0
## 9    0     0          0         0.000            0.271                 0
## 12   0     0          0         0.022            0.044                 0
## 14   0     0          0         0.000            0.000                 0
## 16   0     0          0         0.000            0.063                 0
##    charExclamation charDollar charHash capitalAve capitalLong capitalTotal
## 1            0.778      0.000    0.000      3.756          61          278
## 7            0.164      0.054    0.000      1.671           4          112
## 9            0.181      0.203    0.022      9.744         445         1257
## 12           0.663      0.000    0.000      1.243          11          184
## 14           0.000      0.000    0.000      2.083           7           25
## 16           0.572      0.063    0.000      5.659          55          249
##    type
## 1  spam
## 7  spam
## 9  spam
## 12 spam
## 14 spam
## 16 spam
</code></pre></div></div>

<hr />

<h3 id="summaries">Summaries</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">table</span><span class="p">(</span><span class="n">trainSpam</span><span class="o">$</span><span class="n">type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 
## nonspam    spam 
##    1381     906
</code></pre></div></div>

<hr />

<h3 id="plots">Plots</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">trainSpam</span><span class="o">$</span><span class="n">capitalAve</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">trainSpam</span><span class="o">$</span><span class="n">type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-5.png" alt="plot of chunk unnamed-chunk-5" /></p>

<hr />

<h3 id="plots-1">Plots</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">trainSpam</span><span class="o">$</span><span class="n">capitalAve</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">trainSpam</span><span class="o">$</span><span class="n">type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-6.png" alt="plot of chunk unnamed-chunk-6" /></p>

<hr />

<h3 id="relationships-between-predictors">Relationships between predictors</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">trainSpam</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-7.png" alt="plot of chunk unnamed-chunk-7" /></p>

<hr />

<h3 id="clustering">Clustering</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hCluster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hclust</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">trainSpam</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">57</span><span class="p">])))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">hCluster</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-9.png" alt="plot of chunk unnamed-chunk-9" /></p>

<hr />
<h3 id="new-clustering">New clustering</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hClusterUpdated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hclust</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">trainSpam</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">55</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">))))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">hClusterUpdated</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figure/unnamed-chunk-10.png" alt="plot of chunk unnamed-chunk-10" /></p>

<hr />
<h3 id="statistical-predictionmodeling">Statistical prediction/modeling</h3>

<ul>
  <li>Should be informed by the results of your exploratory analysis</li>
  <li>Exact methods depend on the question of interest</li>
  <li>Transformations/processing should be accounted for when necessary</li>
  <li>Measures of uncertainty should be reported</li>
</ul>

<hr />
<h3 id="statistical-predictionmodeling-1">Statistical prediction/modeling</h3>
<p>Logistic regression; prediction modelling, binomial etc‚Ä¶</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trainSpam</span><span class="o">$</span><span class="n">numType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">trainSpam</span><span class="o">$</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="n">costFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">))</span><span class="w">
</span><span class="n">cvError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">55</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">boot</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">55</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">lmFormula</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reformulate</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">trainSpam</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"numType"</span><span class="p">)</span><span class="w">
    </span><span class="n">glmFit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">lmFormula</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"binomial"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainSpam</span><span class="p">)</span><span class="w">
    </span><span class="n">cvError</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.glm</span><span class="p">(</span><span class="n">trainSpam</span><span class="p">,</span><span class="w"> </span><span class="n">glmFit</span><span class="p">,</span><span class="w"> </span><span class="n">costFunction</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">$</span><span class="n">delta</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">## Which predictor has minimum cross-validated error?</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">trainSpam</span><span class="p">)[</span><span class="n">which.min</span><span class="p">(</span><span class="n">cvError</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] "charDollar"
</code></pre></div></div>

<p>The explanation goes as follows. It took me about 2-3 hrs to wrap the
whole thing around my head but here goes my explanation.</p>

<p><strong>Goal</strong>: Find a ‚Äúsimple model‚Äù <del>(binomial regression)</del> that has least
‚Äúerror‚Äù <del>(cross validated error)</del>, when we use the ‚Äúsimple model‚Äù to predict.</p>

<p><strong>Dataset</strong> We only use the <code class="language-plaintext highlighter-rouge">trainSpam</code> data set to make the
predictive model. Each cell has the numerical value representing the
occurrence of a word (given by column) for a given e-mail (row). For
example, row 2 of the <code class="language-plaintext highlighter-rouge">charDollar</code> column has a of 0.054. This means
that 2nd mail has 0.054 <code class="language-plaintext highlighter-rouge">$</code> symbols in the mail.</p>

<p>The data is binomial in nature, i.e., 0 for non-Spam and 1 for
Spam. This is made numerical with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>trainSpam$numType = as.numeric(trainSpam$type)-1
</code></pre></div></div>

<p><strong>Binomial regression</strong> As the data is binomial, we fit a curve,
<del>Binomial Regression</del> that predicts probability for a mail being
spam depending on the Value .  For example, look at column <code class="language-plaintext highlighter-rouge">charDollar</code>,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>png(filename="glm.png")
lmFormula=numType~charDollar
plot(lmFormula,data=trainSpam, ylab="probability")
g=glm(lmFormula,family=binomial, data=trainSpam)
curve(predict(g,data.frame(charDollar=x),type="resp"),add=TRUE)
dev.off()
</code></pre></div></div>

<p><a href="https://i.stack.imgur.com/Y8qyz.png"><img src="https://i.stack.imgur.com/Y8qyz.png" alt="GLM" /></a></p>

<p>Here you see that for charDollar values &gt; 0.5 there is almost a 100%
probability that it is SPAM. This is how binomial regression is used.</p>

<p>The author looks at every column, makes a binomial regression
fit. This is done with the <code class="language-plaintext highlighter-rouge">for loop</code>. So the author now has 55 models.</p>

<p><strong>Error Estimation</strong>
The author wants to see which of these 55 models is predicting the
‚ÄúBEST‚Äù. For this we use Cross validation‚Ä¶</p>

<p><strong>cv.glm or CrossValidation</strong></p>

<p>The crossvalidation works as follows: It divides the trainData further
into TRAIN and TEST. The TRAIN data is used to compute the glm, and
this glm is used to predict the outcome of the TEST data. This is done
‚Äú<a href="https://www.youtube.com/watch?v=fSytzGwwBVw">in a particular way</a>‚Äù many times and the results are averaged.</p>

<p>The CV uses a cost-function to calculate the error.</p>

<p>The <code class="language-plaintext highlighter-rouge">cost function</code> (in this case) counts number of failed
predictions. The TEST data is used for this.  It takes two parameters
which is X (observed TEST data) and Y (Predicted data based on glm)
and checks how many times it failed in this case:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>costFunction = function(x,y) sum(x!=(y &gt; 0.5))
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Y&gt;0.5</code> provides a cutoff to decide if a value is spam or not. So if
the predicted value is <code class="language-plaintext highlighter-rouge">0.6</code> then the prediction is SPAM (or 1). If
the predicted value is <code class="language-plaintext highlighter-rouge">&lt;=0.5</code> then it is NOT SPAM (or 0).</p>

<p>With the for loop we cycle over every single column and in the end pic
the column which has the least error of predictions:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>which.min(cvError)
</code></pre></div></div>

<p><strong>P.S</strong> It is very beneficial to look at how the <a href="https://www.youtube.com/watch?v=yIYKR4sgzI8&amp;t=458s">glm binomial fitting
(including timestamp)</a> is done, and the explanation of the
<a href="https://www.youtube.com/watch?v=vN5cNN2-HWE&amp;t=304s">coefficients that come from <code class="language-plaintext highlighter-rouge">glm</code></a> and what it means to obtain
<a href="https://www.youtube.com/watch?v=fSytzGwwBVw">cross-validated error</a>. The course, I agree however made a steep
jump in this aspect, without bothering to explain anything related to
this, what so ever. Hope this is helpful.</p>

<p><a href="https://stackoverflow.com/questions/48602066/log-regression-code-explanation-from-courseras-reproducible-research-class/54884544#54884544">Question and my answer on stack as well</a></p>

<hr />

<h3 id="get-a-measure-of-uncertainty">Get a measure of uncertainty</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Use the best model from the group</span><span class="w">
</span><span class="n">predictionModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">numType</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">charDollar</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"binomial"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainSpam</span><span class="p">)</span><span class="w">

</span><span class="c1">## Get predictions on the test set</span><span class="w">
</span><span class="n">predictionTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">predictionModel</span><span class="p">,</span><span class="w"> </span><span class="n">testSpam</span><span class="p">)</span><span class="w">
</span><span class="n">predictedSpam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">"nonspam"</span><span class="p">,</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">testSpam</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="w">

</span><span class="c1">## Classify as `spam' for those with prob &gt; 0.5</span><span class="w">
</span><span class="n">predictedSpam</span><span class="p">[</span><span class="n">predictionModel</span><span class="o">$</span><span class="n">fitted</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"spam"</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="get-a-measure-of-uncertainty-1">Get a measure of uncertainty</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Classification table</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">predictedSpam</span><span class="p">,</span><span class="w"> </span><span class="n">testSpam</span><span class="o">$</span><span class="n">type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##              
## predictedSpam nonspam spam
##       nonspam    1346  458
##       spam         61  449
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1">## Error rate</span><span class="w">
</span><span class="p">(</span><span class="m">61</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">458</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">1346</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">458</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">61</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">449</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.2243
</code></pre></div></div>

<hr />

<h3 id="interpret-results">Interpret results</h3>

<ul>
  <li>Use the appropriate language
    <ul>
      <li>describes</li>
      <li>correlates with/associated with</li>
      <li>leads to/causes</li>
      <li>predicts</li>
    </ul>
  </li>
  <li>Give an explanation</li>
  <li>Interpret coefficients</li>
  <li>Interpret measures of uncertainty</li>
</ul>

<hr />

<h3 id="our-example">Our example</h3>

<ul>
  <li>The fraction of charcters that are dollar signs can be used to predict if an email is Spam</li>
  <li>Anything with more than 6.6% dollar signs is classified as Spam</li>
  <li>More dollar signs always means more Spam under our prediction</li>
  <li>Our test set error rate was 22.4%</li>
</ul>

<hr />

<h3 id="challenge-results">Challenge results</h3>

<ul>
  <li>Challenge all steps:
    <ul>
      <li>Question</li>
      <li>Data source</li>
      <li>Processing</li>
      <li>Analysis</li>
      <li>Conclusions</li>
    </ul>
  </li>
  <li>Challenge measures of uncertainty</li>
  <li>Challenge choices of terms to include in models</li>
  <li>Think of potential alternative analyses</li>
</ul>

<hr />

<h3 id="synthesizewrite-up-results">Synthesize/write-up results</h3>

<ul>
  <li>Lead with the question</li>
  <li>Summarize the analyses into the story</li>
  <li>Don‚Äôt include every analysis, include it
    <ul>
      <li>If it is needed for the story</li>
      <li>If it is needed to address a challenge</li>
    </ul>
  </li>
  <li>Order analyses according to the story, rather than chronologically</li>
  <li>Include ‚Äúpretty‚Äù figures that contribute to the story</li>
</ul>

<hr />

<h3 id="in-our-example">In our example</h3>

<ul>
  <li>Lead with the question
    <ul>
      <li>Can I use quantitative characteristics of the emails to classify them as SPAM/HAM?</li>
    </ul>
  </li>
  <li>Describe the approach
    <ul>
      <li>Collected data from UCI -&gt; created training/test sets</li>
      <li>Explored relationships</li>
      <li>Choose logistic model on training set by cross validation</li>
      <li>Applied to test, 78% test set accuracy</li>
    </ul>
  </li>
  <li>Interpret results
    <ul>
      <li>Number of dollar signs seems reasonable, e.g. ‚ÄúMake money with Viagra \$ \$ \$ \$!‚Äù</li>
    </ul>
  </li>
  <li>Challenge results
    <ul>
      <li>78% isn‚Äôt that great</li>
      <li>I could use more variables</li>
      <li>Why logistic regression?</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="organizing-data-analysis-c5">Organizing Data Analysis (c5)</h2>
<h3 id="data-analysis-files">Data analysis files</h3>

<ul>
  <li>Data
    <ul>
      <li>Raw data</li>
      <li>Processed data</li>
    </ul>
  </li>
  <li>Figures
    <ul>
      <li>Exploratory figures</li>
      <li>Final figures</li>
    </ul>
  </li>
  <li>R code
    <ul>
      <li>Raw / unused scripts</li>
      <li>Final scripts</li>
      <li>R Markdown files</li>
    </ul>
  </li>
  <li>Text
    <ul>
      <li>README files</li>
      <li>Text of analysis / report</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="raw-data">Raw Data</h3>

<p>&lt;img class=center src=../../assets/img/medicalrecord.png height=‚Äô400‚Äô/&gt;</p>

<ul>
  <li>Should be stored in your analysis folder</li>
  <li>If accessed from the web, include url, description, and date accessed in README</li>
</ul>

<hr />

<h3 id="processed-data">Processed data</h3>

<p>&lt;img class=center src=../../assets/img/excel.png height=‚Äô400‚Äô/&gt;</p>
<ul>
  <li>Processed data should be named so it is easy to see which script generated the data.</li>
  <li>The processing script - processed data mapping should occur in the README</li>
  <li>Processed data should be <a href="http://vita.had.co.nz/papers/tidy-data.pdf">tidy</a></li>
</ul>

<hr />

<h3 id="exploratory-figures">Exploratory figures</h3>

<p>&lt;img class=center src=../../assets/img/example10.png height=‚Äô400‚Äô/&gt;</p>

<ul>
  <li>Figures made during the course of your analysis, not necessarily part of your final report.</li>
  <li>They do not need to be ‚Äúpretty‚Äù</li>
</ul>

<hr />

<h3 id="final-figures">Final Figures</h3>

<p>&lt;img class=center src=../../assets/img/figure1final.png height=‚Äô400‚Äô/&gt;</p>

<ul>
  <li>Usually a small subset of the original figures</li>
  <li>Axes/colors set to make the figure clear</li>
  <li>Possibly multiple panels</li>
</ul>

<hr />

<h3 id="raw-scripts">Raw scripts</h3>

<p>&lt;img class=center src=../../assets/img/rawcode.png height=‚Äô350‚Äô/&gt;</p>

<ul>
  <li>May be less commented (but comments help you!)</li>
  <li>May be multiple versions</li>
  <li>May include analyses that are later discarded</li>
</ul>

<hr />

<h3 id="final-scripts">Final scripts</h3>

<p>&lt;img class=center src=../../assets/img/finalscript2.png height=‚Äô300‚Äô/&gt;</p>

<ul>
  <li>Clearly commented
    <ul>
      <li>Small comments liberally - what, when, why, how</li>
      <li>Bigger commented blocks for whole sections</li>
    </ul>
  </li>
  <li>Include processing details</li>
  <li>Only analyses that appear in the final write-up</li>
</ul>

<hr />

<h3 id="r-markdown-files">R markdown files</h3>

<p>&lt;img class=center src=../../assets/img/rmd.png height=‚Äô400‚Äô/&gt;</p>

<ul>
  <li><a href="http://www.rstudio.com/ide/docs/authoring/using_markdown">R markdown</a> files can be used to generate reproducible reports</li>
  <li>Text and R code are integrated</li>
  <li>Very easy to create in <a href="http://www.rstudio.com/">Rstudio</a></li>
</ul>

<hr />

<h3 id="readme-files">Readme files</h3>

<p>&lt;img class=center src=../../assets/img/readme.png height=‚Äô400‚Äô/&gt;</p>

<ul>
  <li>Not necessary if you use R markdown</li>
  <li>Should contain step-by-step instructions for analysis</li>
  <li>Here is an example <a href="https://github.com/jtleek/swfdr/blob/master/README">https://github.com/jtleek/swfdr/blob/master/README</a></li>
</ul>

<hr />

<h3 id="text-of-the-document">Text of the document</h3>

<p>&lt;img class=center src=../../assets/img/swfdr.png height=‚Äô350‚Äô/&gt;</p>

<ul>
  <li>It should include a title, introduction (motivation), methods (statistics you used), results (including measures of uncertainty), and conclusions (including potential problems)</li>
  <li>It should tell a story</li>
  <li><em>It should not include every analysis you performed</em></li>
  <li>References should be included for statistical methods</li>
</ul>

<hr />

<h3 id="further-resources-1">Further resources</h3>

<ul>
  <li>Information about a non-reproducible study that led to cancer patients being mistreated: <a href="http://simplystatistics.org/2012/02/27/the-duke-saga-starter-set/">The Duke Saga Starter Set</a></li>
  <li><a href="http://biostatistics.oxfordjournals.org/content/10/3/405.full">Reproducible research and Biostatistics</a></li>
  <li><a href="http://www.r-statistics.com/2010/09/managing-a-statistical-analysis-project-guidelines-and-best-practices/">Managing a statistical analysis project guidelines and best practices</a></li>
  <li><a href="http://projecttemplate.net/">Project template</a> - a pre-organized set of files for data analysis</li>
</ul>

<h2 id="markdown-r-knitr-c5">Markdown R knitr (c5)</h2>

<h3 id="what-is-markdown">What is Markdown?</h3>

<ul>
  <li>
    <p>Created by <a href="http://daringfireball.net">John Gruber</a> and Aaron Swartz</p>
  </li>
  <li>
    <p>A simplified version of ‚Äúmarkup‚Äù languages</p>
  </li>
  <li>
    <p>Allows one to focus on writing as opposed to formatting</p>
  </li>
  <li>
    <p>Simple/minimal intuitive formatting elements</p>
  </li>
  <li>
    <p>Easily converted to valid HTML (and other formats) using existing tools</p>
  </li>
  <li>
    <p>Complete information is available at <a href="http://daringfireball.net/projects/markdown/">http://daringfireball.net/projects/markdown/</a></p>
  </li>
  <li>
    <p>Some background information at <a href="http://daringfireball.net/2004/03/dive_into_markdown">http://daringfireball.net/2004/03/dive_into_markdown</a></p>
  </li>
</ul>

<hr />

<h3 id="what-is-r-markdown">What is R Markdown?</h3>

<ul>
  <li>
    <p>R markdown is the integration of R code with markdown</p>
  </li>
  <li>
    <p>Allows one to create documents containing ‚Äúlive‚Äù R code</p>
  </li>
  <li>
    <p>R code is evaluated as part of the processing of the markdown</p>
  </li>
  <li>
    <p>Results from R code are inserted into markdown document</p>
  </li>
  <li>
    <p>A core tool in <b>literate statistical programming</b></p>
  </li>
</ul>

<hr />

<h3 id="what-is-r-markdown-1">What is R Markdown?</h3>

<ul>
  <li>
    <p>R markdown can be converted to standard markdown using the
<a href="http://yihui.name/knitr/">knitr</a> package in R</p>
  </li>
  <li>
    <p>Markdown can be converted to HTML using the <a href="https://github.com/rstudio/markdown">markdown</a> package in R</p>
  </li>
  <li>
    <p>Any basic text editor can be used to create a markdown document; no
special editing tools needed</p>
  </li>
  <li>
    <p>The R markdown ‚Äì&gt; markdown ‚Äì&gt; HTML work flow can be easily managed
using <a href="http://rstudio.org">R Studio</a> (but not required)</p>
  </li>
  <li>These slides were written in R markdown and converted to slides
using the <a href="http://slidify.org">slidify</a> package
    <h3 id="literate-programming-pros-and-cons">Literate programming pros and cons</h3>
  </li>
  <li>Text and code all in one place, logical order</li>
  <li>Data, results automatically updated to reflect external changes</li>
  <li>
    <p>Code is live‚Äìautomatic ‚Äúregression test‚Äù when building a document</p>
  </li>
  <li>Text and code all in one place; can make documents difficult to read,
especially if there is a lot of code</li>
  <li>Can substantially slow down
processing of documents (although there are tools to help)</li>
</ul>

<h3 id="knitr-usage-and-syntax">Knitr USAGE and syntax</h3>

<p>An R package written by Yihui Xie (while he was a grad student at Iowa State)
Available on CRAN
Supports RMarkdown, LaTeX, and HTML as documentation languages
Can export to PDF, HTML
Built right into RStudio for your convenience</p>

<p><strong>Usage</strong></p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="o">&lt;</span><span class="n">working</span><span class="w"> </span><span class="n">directory</span><span class="o">&gt;</span><span class="p">)</span><span class="w">
</span><span class="n">knit2html</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">document.Rmd</span><span class="err">‚Äù</span><span class="p">)</span><span class="w">
</span><span class="n">browseURL</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">document.html</span><span class="err">‚Äù</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<p>Knitr adds both code and the output, is useful for documentation.</p>

<pre><code class="language-Rmd">\```{r firstchunk}
## R code goes here
\```
</code></pre>

<p>.Rmd ‚Äì&gt; .md ‚Äì&gt; .html</p>

<p>Hiding results!</p>

<pre><code class="language-Rmd">\```{r firstchunk, echo=FALSE,results="hide"}
## R code goes here
time-&gt; bla bla
rand-&gt; rnorm(1)
\```
The current time is `r time`. My favourite random number is `r rand`.
</code></pre>

<p>Plotting and controlling figure height</p>

<pre><code class="language-Rmd">\```{r ploting, fig.height=4}
plot(x,y) bla bla bla
\```

</code></pre>

<p>Making tables with xtable</p>

<pre><code class="language-Rmd">\```{r tablespandian, results="asis"}
library(xtable)
xt&lt;- xtable(summary(fit))
print(xt,type="html")

\```
</code></pre>

<p>Setting options to on a global level</p>

<pre><code class="language-RMD">\```{r settingblablaoptions, echo=FALSE}
knitr::opts_chunk$set(echo=FALSE, results="hide")
\```
</code></pre>
<p>https://yihui.name/knitr/options/</p>

<p><strong>Options common</strong></p>

<p><strong>Output</strong></p>

<p>results: ‚Äúasis‚Äù, ‚Äúhide‚Äù
echo: TRUE, FALSE
message: FALSE
warning=FALSE</p>

<p>https://yihui.name/knitr/demo/output/ More info by author.</p>

<p>‚ÄúError‚Äù reported here: https://github.com/yihui/knitr/issues/220</p>

<p><strong>Figures</strong></p>

<p>fig.height: numeric
fig.width: numeric</p>

<p><strong>Caching</strong></p>

<p>What if one chunk takes a long time to run?  All chunks have to be
re-computed every time you re-knit the file The <code class="language-plaintext highlighter-rouge">cache=TRUE</code> option can
be set on a chunk-by-chunk basis to store results of computation After
the first run, results are loaded from cache</p>

<p>Useful help document from stack:
https://stackoverflow.com/a/51409622/5986651</p>

<p><strong>YAML Front Matter example</strong></p>

<hr />
<p>title: ‚ÄúReproducible Research: Peer Assessment 1‚Äù
output: 
  html_document:
    keep_md: yes
‚Äî</p>

<p>```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, message=F, warning=F, cache=T)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
More info in [Yihui's book](https://bookdown.org/yihui/rmarkdown/pdf-document.html) and his blog.

### Knitr for pdf; plots not working!

https://stackoverflow.com/questions/55032228/package-pdftex-def-error-file-not-found

Made a stack question that says it doesn't work.

however I stumbled upon something by accident: 

`rmarkdown::render("./code.rmd")` in the console seems to work on
plots. I just used this for now and finished the assignement. A lot of
issues here, appears to be not within EMACS!

### Making an Rmd document work with ESS init.el

https://stackoverflow.com/a/23326318/5986651 shows how to add the
basics and setup rmd mode

polymode keybindings are given here https://polymode.github.io/usage/

Also the library `rmarkdown` seems to be needed along with pandoc!

So install pandoc with 

	sudo apt-get install pandoc 
	
Got lot of sql errors but ignored it for now! and the system generates
an html nicely with `M-n e`.

Done! Peace!

Also for adding the code chunk you need to follow instructions given
here: https://emacs.stackexchange.com/a/27419/17941

	(defun tws-insert-r-chunk (header) 
	"Insert an r-chunk in markdown mode. Necessary due to interactions between polymode and yas snippet" 
	(interactive "sHeader: ") 
	(insert (concat "```{r " header "}\n\n```")) 
	(forward-line -1))

	M-x tws-insert-r-chunk

Emacs init file attempts and failures for keybinding!

	;; (eval-after-load 'rmd-mode
	;;   '(define-key rmd-mode-map (kbd "C-c r")
	;;      'tws-insert-r-chunk)) 

	(global-set-key (kbd "C-c r") 'tws-insert-r-chunk) 

### Caching and the way to go

&gt; It seems the default is set to FALSE and local chunk options
&gt; override the global options but one thing **you could do is set the
&gt; global options to cache by default by adding this to the top of your
&gt; document**

    `r opts_chunk$set(cache=TRUE)`

&gt; Then for the sections you don't want cached ever you would
&gt; explicitly set those sections to cache=FALSE.
&gt;
&gt; Then if you want to set the whole document to not cache anything you
&gt; could change the global option to FALSE and rerun it.
&gt;
&gt; The problem is that if any of the chunk options are set to
&gt; cache=TRUE then those will override the global setting and won't be
&gt; rerun if you set the global option to FALSE.  So I think the only
&gt; way to achieve what you want is to change the default to cache=TRUE,
&gt; explicitly set chunks that you don't want cached to have
&gt; cache=FALSE, and then you can switch the global option to FALSE to
&gt; do what you want when the time occurs.

Source: https://stackoverflow.com/a/10628731/5986651

### template Knitr doc and my workflow

-----------
 
	---
	title: "Effects of Storm Events on People and Economy"
    output: html
    ---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, message=F, warning=F, cache=T)
</code></pre></div></div>
<p>Keep the cache at true in the main settings so that you can toggle
when needed to do a full evaluation.</p>

<p>You use include=FALSE to have the chunk evaluated, but neither the
code nor its output displayed.</p>

<p>And, echo=FALSE indicates that the code will not be shown in the final
document (though any results/output would still be displayed).</p>

<p><a href="https://kbroman.org/knitr_knutshell/pages/Rmarkdown.html">Source</a>.</p>

<p><code class="language-plaintext highlighter-rouge">C-c r</code>  gives the r code section based on my init file!</p>

<p>```{r }
a &lt;- 2</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```{r libraries, include=F}
library(dplyr) #library that aids in grouping (mainly %&gt;%)
</code></pre></div></div>

<p>```{r scatterplot, fig.width=8, fig.height=6}
plot(x,y)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

--------------

Use `M-n e` for executing. PDF images don't work with this command but
html works well! Use `rmarkdown::render("./code.rmd")` in the console
and it works well. Recently that has been failing as well. So do the
html rendering and then in the end wrap it up with rstudio's console!


	
### Making a presentation


``` R

##---
title: "Data Science Capstone - Word Prediction App"
date: "June 6, 2019"
output: slidy_presentation
##---

</code></pre></div></div>

<p>This already brings up a presentation.</p>

<h4 id="uploading-it-to-github">Uploading it to github</h4>
<h4 id="uploading-it-to-rpubs">Uploading it to rpubs</h4>

<p>Based on https://stackoverflow.com/a/32304336/5986651</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rpubsUpload</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Your
title'</span><span class="p">,</span><span class="n">htmlFile</span><span class="o">=</span><span class="s1">'your_html_file_and_path.html'</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">getOption</span><span class="p">(</span><span class="s1">'rpubs.upload.method'</span><span class="p">,</span><span class="s1">'auto'</span><span class="p">)</span><span class="w">

</span><span class="n">browseURL</span><span class="p">(</span><span class="n">results</span><span class="o">$</span><span class="n">continueUrl</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>
<p>Thats all you need to do and the rest is self explanatory. You get a
website where you trim shit down.</p>

<h4 id="update-it-to-rpubs">Update it to rpubs</h4>
<h3 id="adding-picture-to-presentation">Adding picture to presentation</h3>

<p>based on https://stackoverflow.com/a/44665110/5986651</p>

<p>```{r, echo=FALSE}
   knitr::include_graphics(‚Äò./Capture-Output.png‚Äô)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Works all the way into the file

remember id
"https://api.rpubs.com/api/v1/document/516159/bf2c070b171144b0bf949bca29e62ef2"

#### Resize picture

two methods as per
https://stackoverflow.com/questions/15625990/how-to-set-size-for-local-image-using-knitr-for-markdown

```{r}
knitr::include_graphics("path/to/image.png", dpi = 100)
</code></pre></div></div>

<p>```{r, out.width = ‚Äú400px‚Äù}
knitr::include_graphics(‚Äúpath/to/image.png‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
https://stackoverflow.com/questions/25415365/insert-side-by-side-png-images-using-knitr/25454753

```{r, echo=FALSE,out.width="49%", out.height="20%",fig.cap="caption",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("path/to/img1","path/to/img1"))
</code></pre></div></div>

<h2 id="levels-of-detail-c5-w3">Levels of detail (c5-w3)</h2>
<h3 id="tldr">tl;dr</h3>

<ul>
  <li>
    <p>People are busy, especially managers and leaders</p>
  </li>
  <li>
    <p>Results of data analyses are sometimes presented in oral form, but
often the first cut is presented via email</p>
  </li>
  <li>
    <p>It is often useful to breakdown the results of an analysis into
different levels of granularity / detail</p>
  </li>
  <li>
    <p>Getting responses from busy people: <a href="http://goo.gl/sJDb9V">http://goo.gl/sJDb9V</a></p>
  </li>
</ul>

<hr />

<h3 id="hierarchy-of-information-research-paper">Hierarchy of Information: Research Paper</h3>

<ul>
  <li>
    <p>Title / Author list</p>
  </li>
  <li>
    <p>Abstract</p>
  </li>
  <li>
    <p>Body / Results</p>
  </li>
  <li>
    <p>Supplementary Materials / the gory details</p>
  </li>
  <li>
    <p>Code / Data / really gory details</p>
  </li>
</ul>

<hr />

<h3 id="hierarchy-of-information-email-presentation">Hierarchy of Information: Email Presentation</h3>

<ul>
  <li>
    <p>Subject line / Sender info</p>

    <ul>
      <li>At a minimum; include one</li>
      <li>Can you summarize findings in one sentence?</li>
    </ul>
  </li>
  <li>
    <p>Email body</p>

    <ul>
      <li>
        <p>A brief description of the problem / context; recall what was
proposed and executed; summarize findings / results; 1‚Äì2
paragraphs</p>
      </li>
      <li>
        <p>If action needs to be taken as a result of this presentation,
suggest some options and make them as concrete as possible.</p>
      </li>
      <li>
        <p>If questions need to be addressed, try ot make them yes / no</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="hierarchy-of-information-email-presentation-1">Hierarchy of Information: Email Presentation</h3>

<ul>
  <li>
    <p>Attachment(s)</p>

    <ul>
      <li>R Markdown file</li>
      <li>
        <p>knitr report</p>
      </li>
      <li>Stay concise; don‚Äôt spit out pages of code (because you
used knitr we know it‚Äôs available)</li>
    </ul>
  </li>
  <li>
    <p>Links to Supplementary Materials</p>

    <ul>
      <li>Code / Software / Data</li>
      <li>GitHub repository / Project web site</li>
    </ul>
  </li>
</ul>

<h2 id="caching-computations">Caching computations</h2>

<p>Not sure where to use it. the library is called <code class="language-plaintext highlighter-rouge">cacher</code></p>

<h2 id="si-probability-c6-w1">SI: probability (c6-w1)</h2>

<p>Statistical inference</p>

<p><strong>Course Content</strong> The course is taught via 13 lectures</p>

<p>Introduction
Probability
Conditional Probability
Expectations
Variance
Common Distributions
Asymptotics
T confidence intervals
Hypothesis testing
P-values
Power
Multiple Testing
Resampling</p>

<p>https://www.youtube.com/playlist?list=PLpl-gQkQivXiBmGyzLrUjzsblmQsLtkzJ</p>

<ul>
  <li>In these slides we will cover the basics of probability at low enough level
to have a basic understanding for the rest of the series</li>
  <li>For a more complete treatment see the class Mathematical Biostatistics Boot Camp 1
    <ul>
      <li>Youtube: www.youtube.com/playlist?list=PLpl-gQkQivXhk6qSyiNj51qamjAtZISJ-</li>
      <li>Coursera: www.coursera.org/course/biostats</li>
      <li>Git: http://github.com/bcaffo/Caffo-Coursera</li>
    </ul>
  </li>
</ul>

<h2 id="probability-c6-w1">Probability c6-w1</h2>
<h3 id="rules-probability-must-follow">Rules probability must follow</h3>

<p>An event A occurs; A die is rolled and we get the outcome from the set
{1,2,3,4,5,6}.</p>
<ul>
  <li>P(nothing occurs) = 0; When a die rolls the probability that we
don‚Äôt see 1,2,3,4,5,6 is 0.</li>
  <li>P(something occurs) = 1;</li>
  <li>P(A) + P(1-A) = 1</li>
  <li>P(AUB)= P(A) + P(B) ; if they are mutually exclusive</li>
</ul>

<p>You roll a die. A={1,2}, B= {3,4}. P(A)=2/6; P(B)=2/6; P(1 or 2 or 3
or 4)=P(A‚à™B)=P4/6.</p>

<ul>
  <li>P(AUB) = P(A) + P(B) - P(A‚à©B)</li>
</ul>

<p>Example: A={1,2,3}; B={1,5,6}</p>

<ul>
  <li>if {A} =&gt; {B}; P(A) &lt; P(B)</li>
</ul>

<p>A={1,2}; B={1,2,3,4}</p>

<hr />

<h3 id="example">Example</h3>

<p>The National Sleep Foundation (<a href="http://www.sleepfoundation.org/">www.sleepfoundation.org</a>) reports
that around 3% of the American population has sleep apnea. They also
report that around 10% of the North American and European population
has restless leg syndrome. Does this imply that 13% of people will
have at least one sleep problems of these sorts?</p>

<p>Assuming all of this are probabilities from the same population, i.e.,
P(sleep apnea in America) represents the population, as much as
P(RLS in North America).</p>

<p>A person can have SA and/or RLS. Both are not mutually exclusive. So</p>

<p>P(SA)= 0.03; P(RLS)= 0.1; P(atleast SA or RLS)=P(SA)+P(RLS)-P(SA‚à©RLS)
Answer: No, the events can simultaneously occur and so 
are not mutually exclusive. To elaborate let:</p>

<h3 id="random-variables">Random variables</h3>

<ul>
  <li>A <strong>random variable</strong> is a numerical outcome of an experiment.</li>
</ul>

<p>Roll a die and the outcome is say X (random variable), and this is either 1 or,2,3,4,5,6.</p>

<ul>
  <li>The random variables that we study will come in two varieties,
<strong>discrete</strong> or <strong>continuous</strong>.</li>
  <li>Discrete random variable are random variables that take on only a
countable number of possibilities and we talk about the probability that they
take specific values</li>
  <li>Continuous random variable can conceptually take any value on the real line or some subset of the real line and we talk about the probability that they line within
some range</li>
</ul>

<hr />

<h3 id="examples-of-variables-that-can-be-thought-of-as-random-variables">Examples of variables that can be thought of as random variables</h3>

<p>Experiments that we use for intuition and building context</p>
<ul>
  <li>The $(0-1)$ outcome of the flip of a coin</li>
  <li>The outcome from the roll of a die</li>
</ul>

<p>Specific instances of treating variables as if random</p>
<ul>
  <li>The web site traffic on a given day</li>
  <li>The BMI of a subject four years after a baseline measurement</li>
  <li>The hypertension status of a subject randomly drawn from a population</li>
  <li>The number of people who click on an ad</li>
  <li>Intelligence quotients for a sample of children</li>
</ul>

<hr />

<h3 id="pmf-and-pdf">PMF and PDF</h3>

<p>PMF is for discrete random variables and PDF (probability density function) is for continuous random
variables.</p>

<p>Probability Mass Function example:</p>

\[PMF(x)=(1/2)À£ (1/2)^(1-x); for x = {0,1}
PMF2(x)=(Œ∏)À£ (1-Œ∏)^(1-x);\]

<p>PMF(x) is a probability of a coin flip. This function gives value of
0.5 when x the random variable takes 0 or
1 . With PMF2 we see a die which is biased.</p>

<p>‚àëPMF(x·µ¢)=1;</p>

<p>PDF is for continuous variable. Example: Suppose that the proportion
of help calls that get addressed in a random day by a help line is
given by \(f(x) = \left{\begin{array}{ll} 2 x &amp; \mbox{ for }&amp; 0&lt; x &lt;
1 \ 0 &amp; \mbox{ otherwise} \end{array} \right.\)</p>

<p>Is this a mathematically valid density?</p>

\[PDF(x)=2x for 0&lt;x&lt;1\]

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="example-continued">Example continued</h3>

<p>What is the probability that 75% or fewer of calls get addressed?</p>

<p><img src="assets/fig/unnamed-chunk-2.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" style="display: block; margin: auto;" /></p>

<hr />

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.75</span><span class="o">/</span><span class="m">2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.5625
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pbeta</span><span class="p">(</span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.5625
</code></pre></div></div>

<h3 id="cdf-and-survival-function">CDF and survival function</h3>
<h4 id="certain-areas-are-so-useful-we-give-them-names">Certain areas are so useful, we give them names</h4>

<ul>
  <li>The <strong>cumulative distribution function</strong> (CDF) of a random variable, $X$, returns the probability that the random variable is less than or equal to the value $x$
\(F(x) = P(X \leq x)\)
(This definition applies regardless of whether $X$ is discrete or continuous.)</li>
  <li>The <strong>survival function</strong> of a random variable $X$ is defined as the probability
that the random variable is greater than the value $x$
\(S(x) = P(X &gt; x)\)</li>
  <li>Notice that $S(x) = 1 - F(x)$</li>
</ul>

<hr />

<h3 id="example-1">Example</h3>

<p>What are the survival function and CDF from the density considered before?</p>

<p>For $1 \geq x \geq 0$
\(F(x) = P(X \leq x) = \frac{1}{2} Base \times Height = \frac{1}{2} (x) \times (2 x) = x^2\)</p>

\[S(x) = 1 - x^2\]

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pbeta</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.6</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.16 0.25 0.36
</code></pre></div></div>

<hr />

<h3 id="percentiles">Percentiles</h3>

<p>You‚Äôve heard of sample quantiles. If you were the 95th percentile on an exam, you know
that 95% of people scored worse than you and 5% scored better. 
These are sample quantities. Here we define their population analogs.</p>

<p>Arrange grades in increasing order. If there were 100 people you are 95th.</p>

<hr />
<h3 id="definition">Definition</h3>

<p>The  $\alpha^{th}$ <strong>quantile</strong> of a distribution with distribution function $F$ is the point $x_\alpha$ so that
\(F(x_\alpha) = \alpha\)</p>
<ul>
  <li>A <strong>percentile</strong> is simply a quantile with $\alpha$ expressed as a percent</li>
  <li>The <strong>median</strong> is the $50^{th}$ percentile</li>
</ul>

<hr />
<h3 id="for-example">For example</h3>

<p>The $95^{th}$ percentile of a distribution is the point so that:</p>
<ul>
  <li>the probability that a random variable drawn from the population is less is 95%</li>
  <li>the probability that a random variable drawn from the population is more is 5%</li>
</ul>

<hr />
<h3 id="example-2">Example</h3>

<p>Consider a PDF for scores for 10000 people. The 0.5th quantile is
F(score&lt;=some_score)=0.5. F
(score&lt;=some_score) is the area under the
curve or the CDF(distribution function.x
What is the median of the distribution that we were working with before?</p>
<ul>
  <li>We want to solve $0.5 = F(x) = x^2$</li>
  <li>Resulting in the solution</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">sqrt</span><span class="p">(</span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.7071
</code></pre></div></div>

<ul>
  <li>Therefore, about 0.7071 of calls being answered on a random day is the median.</li>
</ul>

<hr />
<h3 id="example-continued-1">Example continued</h3>
<p>R can approximate quantiles for you for common distributions</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qbeta</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.7071
</code></pre></div></div>

<hr />

<h3 id="summary-7">Summary</h3>

<ul>
  <li>You might be wondering at this point ‚ÄúI‚Äôve heard of a median before, it didn‚Äôt require integration. Where‚Äôs the data?‚Äù</li>
  <li>We‚Äôre referring to are <strong>population quantities</strong>. Therefore, the median being
discussed is the <strong>population median</strong>.</li>
  <li>A probability model connects the data to the population using assumptions.</li>
  <li>Therefore the median we‚Äôre discussing is the <strong>estimand</strong>, the sample median will be the <strong>estimator</strong></li>
</ul>

<h2 id="si-conditional-probability-c6-w1">SI: Conditional probability c6-w1</h2>

<h3 id="conditional-probability-motivation">Conditional probability, motivation</h3>

<ul>
  <li>The probability of getting a one when rolling a (standard) die
is usually assumed to be one sixth</li>
  <li>Suppose you were given the extra information that the die roll
was an odd number (hence 1, 3 or 5)</li>
  <li><em>conditional on this new information</em>, the probability of a
one is now one third</li>
</ul>

<hr />

<h3 id="conditional-probability-definition">Conditional probability, definition</h3>

<table>
  <tbody>
    <tr>
      <td>implies given condition! Roll a die.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Consider our die roll example</li>
  <li>$B = {1, 3, 5}$</li>
  <li>
    <p>$A = {1}$</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>P(A</td>
          <td>B)=P(A‚à©B)/P(B). Draw venn diagram you will understand.</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<p>= 1/3= 1/6 √∑ 3/6 = 1/3.</p>

<hr />

<h3 id="bayes-rule">Bayes‚Äô rule</h3>
<p>Baye‚Äôs rule allows us to reverse the conditioning set provided
that we know some marginal probabilities
\(P(B ~|~ A) = \frac{P(A ~|~ B) P(B)}{P(A ~|~ B) P(B) + P(A ~|~ B^c)P(B^c)}.\)</p>

<hr />

<h3 id="diagnostic-tests">Diagnostic tests</h3>

<ul>
  <li>Let $+$ and $-$ be the events that the result of a diagnostic test is positive or negative respectively</li>
  <li>Let $D$ and $D^c$ be the event that the subject of the test has or does not have the disease respectively</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>The <strong>sensitivity</strong> is the probability that the test is positive given that the subject actually has the disease, $P(+ ~</td>
          <td>~ D)$</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>The <strong>specificity</strong> is the probability that the test is negative given that the subject does not have the disease, $P(- ~</td>
          <td>~ D^c)$</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>The <strong>positive predictive value</strong> is the probability that the subject has the  disease given that the test is positive, $P(D ~</td>
          <td>~ +)$</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>The <strong>negative predictive value</strong> is the probability that the subject does not have the disease given that the test is negative, $P(D^c ~</td>
          <td>~ -)$</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>The <strong>prevalence of the disease</strong> is the marginal probability of disease, $P(D)$</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>The <strong>diagnostic likelihood ratio of a positive test</strong>, labeled $DLR_+$, is $P(+ ~</td>
          <td>~ D) / P(+ ~</td>
          <td>~ D^c)$, which is the \(sensitivity / (1 - specificity)\)</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>The <strong>diagnostic likelihood ratio of a negative test</strong>, labeled $DLR_-$, is $P(- ~</td>
          <td>~ D) / P(- ~</td>
          <td>~ D^c)$, which is the \((1 - sensitivity) / specificity\)</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<hr />

<h3 id="example-3">Example</h3>

<ul>
  <li>A study comparing the efficacy of HIV tests, reports on an
experiment which concluded that HIV antibody tests have a
sensitivity of 99.7% and a specificity of 98.5%</li>
  <li>Suppose that a subject, from a population with a .1% prevalence of
HIV, receives a positive test result. What is the positive
predictive value?</li>
  <li>Mathematically, we want $P(D ~|~ +)$ given the sensitivity, $P(+ ~|~
D) = .997$, the specificity, $P(- ~|~ D^c) =.985$, and the
prevalence $P(D) = .001$</li>
</ul>

<hr />

<h3 id="using-bayes-formula">Using Bayes‚Äô formula</h3>

<ul>
  <li>In this population a positive test result only suggests a 6%
probability that the subject has the disease</li>
  <li>
    <p>(The positive predictive value is 6% for this test) This is super
low owing to the prevalence!</p>
  </li>
  <li>The low positive predictive value is due to low prevalence of
disease and the somewhat modest specificity</li>
  <li>Suppose it was known that the subject was an intravenous drug user
and routinely had intercourse with an HIV infected partner</li>
  <li>Notice that the evidence implied by a positive test result does not
change because of the prevalence of disease in the subject‚Äôs
population, only our interpretation of that evidence changes</li>
</ul>

<h3 id="likelihood-ratios">Likelihood ratios</h3>

<ul>
  <li>Therefore
\(\
frac{P(D ~|~ +)}{P(D^c ~|~ +)} = \frac{P(+~|~D)}{P(+~|~D^c)}\times \frac{P(D)}{P(D^c)}\)</li>
</ul>

<p>i.e.,</p>

\[\mbox{post-test odds of }D = DLR_+\times\mbox{pre-test odds of }D\]

<ul>
  <li>
    <p>odds is when you do P(X)√∑P(1-X)</p>
  </li>
  <li>
    <p>Post odds = likelihood * prior odds.</p>
  </li>
  <li>
    <p>Similarly, $DLR_-$ relates the decrease in the odds of the
disease after a negative test result to the odds of disease prior to
the test.</p>
  </li>
</ul>

<hr />

<h3 id="hiv-example-revisited">HIV example revisited</h3>

<ul>
  <li>Suppose a subject has a positive HIV test</li>
  <li>$DLR_+ = .997 / (1 - .985) \approx 66$</li>
  <li>The result of the positive test is that the odds of disease is now 66 times the pretest odds</li>
  <li>Or, equivalently, the hypothesis of disease is 66 times more supported by the data than the hypothesis of no disease</li>
</ul>

<hr />

<h3 id="hiv-example-revisited-1">HIV example revisited</h3>

<ul>
  <li>Suppose that a subject has a negative test result</li>
  <li>$DLR_- = (1 - .997) / .985  \approx .003$</li>
  <li>Therefore, the post-test odds of disease is now $.3\%$ of the pretest odds given the negative test.</li>
  <li>Or, the hypothesis of disease is supported $.003$ times that of the hypothesis of absence of disease given the negative test result</li>
</ul>

<hr />

<h3 id="independence">Independence</h3>

<ul>
  <li>
    <p>Two events $A$ and $B$ are <strong>independent</strong> if \(P(A \cap B) =
P(A)P(B)\);</p>

    <p>Two successive coin flips.</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Equivalently if $P(A ~</td>
          <td>~ B) = P(A)$</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>Two random variables, $X$ and $Y$ are independent if for any two
sets $A$ and $B$ P(A‚à©B)=P(A)*P(B)</li>
  <li>Two coin flips both having heads is 0.5*0.5</li>
  <li>If $A$ is independent of $B$ then
    <ul>
      <li>$A^c$ is independent of $B$</li>
      <li>$A$ is independent of $B^c$</li>
      <li>$A^c$ is independent of $B^c$</li>
    </ul>
  </li>
</ul>

<h3 id="example-star-mark-example">Example (star mark example)</h3>

<ul>
  <li>Volume 309 of Science reports on a physician who was on trial for expert testimony in a criminal trial</li>
  <li>Based on an estimated prevalence of sudden infant death syndrome of
1√∑8543, the physician testified that that the probability of a
mother having two children with SIDS was
$\left(\frac{1}{8,543}\right)^2</li>
  <li>The mother was convicted for murder.</li>
</ul>

<p>WOW! Apparently A and B are not independent. The chance of A&amp;B
happening given (|) the same mother is different. There are dependent
as fuck!</p>

<ul>
  <li>That is, $P(A_1 \cap A_2)$ is not necessarily equal to $P(A_1)P(A_2)$</li>
  <li>
    <p>Biological processes that have a believed genetic or familiar
environmental component, of course, tend to be dependent within
families</p>
  </li>
  <li>
    <p><strong>Relevant to this discussion, the principal mistake was to <em>assume</em>
that the events of having SIDs within a family are independent</strong></p>
  </li>
  <li>(There are many other statistical points of discussion for this case.)</li>
</ul>

<hr />
<h3 id="iid-random-variables-independent-identically-distributed">IID random variables (independent identically distributed)</h3>

<ul>
  <li>Random variables are said to be iid if they are independent and identically distributed
    <ul>
      <li>Independent: statistically unrelated from one and another</li>
      <li>Identically distributed: all having been drawn from the same
population distribution</li>
    </ul>
  </li>
</ul>

<p>Unlike the mother murder example and like a coin toss, every coin toss
is independent of the other and the probabilities are obtained from
the same distribution data (0.5).</p>
<ul>
  <li>iid random variables are the default model for random samples</li>
  <li>Many of the important theories of statistics are founded on assuming that variables are iid</li>
  <li>Assuming a random sample and iid will be the default starting point
of inference for this class</li>
</ul>

<h2 id="si-expected-values-c6-w1">SI: Expected values c6-w1</h2>

<h3 id="expected-values-or-mean">Expected values or Mean</h3>
<ul>
  <li>Expected values are useful for characterizing a distribution</li>
  <li>The mean is a characterization of its center</li>
  <li>The variance and standard deviation are characterizations of
how spread out it is</li>
  <li>Our sample expected values (the sample mean and variance) will
estimate the population versions</li>
</ul>

<h3 id="the-population-mean">The population mean</h3>
<ul>
  <li>The <strong>expected value</strong> or <strong>mean</strong> of a random variable is the center of its distribution</li>
  <li>
    <p>For discrete random variable $X$ with PMF $p(x)$, it is defined as
follows:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  X*100% = ‚àëx·µ¢*p(x·µ¢); It is the center of Mass of the system 
</code></pre></div>    </div>
  </li>
  <li>X represents the center of mass of a collection of locations and
weights, x and p(x).</li>
</ul>

<h3 id="the-sample-mean">The sample mean</h3>

<ul>
  <li>The sample mean estimates this population mean</li>
  <li>The center of mass of the data is the empirical mean</li>
</ul>

<p>Why? we assume it? why? no idea!</p>

<hr />

<h3 id="example-4">Example</h3>

<h3 id="using-manipulate">Using manipulate</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(manipulate)
myHist &lt;- function(mu){
    g &lt;- ggplot(galton, aes(x = child))
    g &lt;- g + geom_histogram(fill = "salmon", 
      binwidth=1, aes(y = ..density..), colour = "black")
    g &lt;- g + geom_density(size = 2)
    g &lt;- g + geom_vline(xintercept = mu, size = 2)
    mse &lt;- round(mean((galton$child - mu)^2), 3)  
    g &lt;- g + labs(title = paste('mu = ', mu, ' MSE = ', mse))
    g
}
manipulate(myHist(mu), mu = slider(62, 74, step = 0.5))
</code></pre></div></div>

<p>Getting an error that it needs to be run from R-studio.</p>

<hr />
<h3 id="example-of-a-population-mean">Example of a population mean</h3>

<ul>
  <li>
    <p>Suppose a coin is flipped and $X$ is declared $0$ or $1$
corresponding to a head or a tail, respectively, the expected value
is at 0.5 (i.e., mean);</p>
  </li>
  <li>
    <p>Note, if thought about geometrically, this answer is obvious; if two
equal weights are spaced at 0 and 1, the center of mass will be $.5$</p>
  </li>
</ul>

<h3 id="example-5">Example</h3>

<ul>
  <li>Suppose that a die is rolled and $X$ is the number face up</li>
  <li>What is the expected value of $X$?
  \(E[X] = 1 \times \frac{1}{6} + 2 \times \frac{1}{6} +
  3 \times \frac{1}{6} + 4 \times \frac{1}{6} +
  5 \times \frac{1}{6} + 6 \times \frac{1}{6} = 3.5\)</li>
  <li>Again, the geometric argument makes this answer obvious without calculation.</li>
</ul>

<h3 id="what-about-a-biased-coin">What about a biased coin?</h3>

<ul>
  <li>Suppose that a random variable, $X$, is so that
$P(X=1) = p$ and $P(X=0) = (1 - p)$</li>
  <li>(This is a biased coin when $p\neq 0.5$)</li>
  <li>What is its expected value?
\(E[X] = 0 * (1 - p) + 1 * p = p\)</li>
</ul>

<hr />

<h3 id="continuous-random-variables">Continuous random variables</h3>

<ul>
  <li>For a continuous random variable, $X$, with density, $f$, the
expected value is again exactly the center of mass of the density</li>
</ul>

<hr />

<h3 id="example-6">Example</h3>

<ul>
  <li>Consider a density where $f(x) = 1$ for $x$ between zero and one</li>
  <li>(Is this a valid density?)</li>
  <li>Suppose that $X$ follows this density; what is its expected value?</li>
</ul>

<hr />

<h3 id="facts-about-expected-values">Facts about expected values</h3>

<ul>
  <li>Recall that expected values are properties of distributions</li>
  <li>Note the average of random variables is itself a random variable
and its associated distribution has an expected value</li>
  <li>
    <p>The center of this distribution is the same as that of the original distribution</p>
  </li>
  <li>
    <p>Take several values from a std. normal distribution. Plot it and you
can draw the original PDF.</p>
  </li>
  <li>
    <p>Now take 10 observations and average it (likely to be closer to the
center than one observation); Do this several times and you have
another PDF which has the same Expected value aka mean as that of
the PDF we began with.</p>
  </li>
  <li>
    <p>Average of 10 die flips taken N times and ploted gives a shape like
a normal distribution with mean in the centre as you would have for
N*10 die flips</p>
  </li>
  <li>Average of 20 die flips will be more concentrated towards the centre
and so on with 30 die flips. The variance will be low and the mean
is at the same place as that of individual die flips.
‚Äî
    <h3 id="summarizing-what-we-know">Summarizing what we know</h3>
  </li>
  <li>Expected values are properties of distributions</li>
  <li>The population mean is the center of mass of population</li>
  <li>The sample mean is the center of mass of the observed data</li>
  <li>The sample mean is an estimate of the population mean</li>
  <li>The sample mean is unbiased if the population mean of its
distribution is the mean that it‚Äôs trying to estimate</li>
  <li>The more data that goes into the sample mean, the more 
concentrated its density / mass function is around the population mean</li>
</ul>

<h2 id="si-c6-w2-variance">SI c6-w2 Variance</h2>

<h3 id="the-variance">The variance</h3>

<ul>
  <li>The variance of a random variable is a measure of <em>spread</em></li>
  <li>If $X$ is a random variable with mean $\mu$, the variance of $X$ is defined as</li>
</ul>

\[Var(X) = E[(X - \mu)^2] = E[X^2] - E[X]^2\]

<p>derivation for above is <a href="https://www.khanacademy.org/math/statistics-probability/summarizing-quantitative-data/variance-standard-deviation-population/v/statistics-alternate-variance-formulas">here</a></p>

<ul>
  <li>The expected (squared) distance from the mean</li>
  <li>Densities with a higher variance are more spread out than densities with a lower variance</li>
  <li>The square root of the variance is called the <strong>standard deviation</strong></li>
  <li>The standard deviation has the same units as $X$</li>
</ul>

<hr />

<h3 id="example-7">Example</h3>

<ul>
  <li>
    <p>What‚Äôs the variance from the result of a toss of a die?</p>

    <ul>
      <li>$E[X] = 3.5$</li>
      <li>$E[X^2] = 1 ^ 2 \times \frac{1}{6} + 2 ^ 2 \times \frac{1}{6} + 3 ^ 2 \times \frac{1}{6} + 4 ^ 2 \times \frac{1}{6} + 5 ^ 2 \times \frac{1}{6} + 6 ^ 2 \times \frac{1}{6} = 15.17$</li>
    </ul>
  </li>
  <li>
    <p>$Var(X) = E[X^2] - E[X]^2 \approx 2.92$</p>
  </li>
</ul>

<hr />

<h3 id="example-coin-toss">Example: coin toss</h3>

<ul>
  <li>
    <p>What‚Äôs the variance from the result of the toss of a coin with probability of heads (1) of $p$?</p>

    <ul>
      <li>$E[X] = 0 \times (1 - p) + 1 \times p = p$</li>
      <li>$E[X^2] = E[X] = p$</li>
    </ul>
  </li>
</ul>

\[Var(X) = E[X^2] - E[X]^2 = p - p^2 = p(1 - p)\]

<hr />
<h3 id="the-sample-variance">The sample variance</h3>
<ul>
  <li>The sample variance is 
\(S^2 = \frac{\sum_{i=1} (X_i - \bar X)^2}{n-1}\)
(almost, but not quite, the average squared deviation from
the sample mean)</li>
  <li>It is also a random variable
    <ul>
      <li>It has an associate population distribution</li>
      <li>Its expected value is the population variance</li>
      <li>Its distribution gets more concentrated around the population variance with mroe data</li>
    </ul>
  </li>
  <li>Its square root is the sample standard deviation</li>
</ul>

<hr />
<h3 id="variances-of-x-die-rolls">Variances of x die rolls</h3>

<p>Variance of sample is $S^2$</p>

<p>Variance of sample mean (n average) is $S^2/n$</p>

<hr />

<h3 id="recall-the-mean">Recall the mean</h3>
<ul>
  <li>Recall that the average of random sample from a population 
is itself a random variable</li>
  <li>We know that this distribution is centered around the population
mean, $E[\bar X] = \mu$</li>
  <li>We also know what its variance is $Var(\bar X) = \sigma^2 / n$</li>
  <li>This is very useful, since we don‚Äôt have repeat sample means 
to get its variance; now we know how it relates to
the population variance</li>
  <li>We call the standard deviation of a statistic a standard error</li>
</ul>

<hr />
<h3 id="to-summarize">To summarize</h3>
<ul>
  <li>The sample variance, $S^2$, estimates the population variance, $\sigma^2$</li>
  <li>The distribution of the sample variance is centered around $\sigma^2$</li>
  <li>The variance of the sample mean is $\sigma^2 / n$
    <ul>
      <li>Its logical estimate is $s^2 / n$</li>
      <li>The logical estimate of the standard error is $S / \sqrt{n}$</li>
    </ul>
  </li>
  <li>$S$, the standard deviation, talks about how variable the population is</li>
  <li>$S/\sqrt{n}$, the standard error, talks about how variable averages of random samples of size $n$ from the population are</li>
</ul>

<hr />

<h3 id="simulation-example-standard-normal">Simulation example: standard normal</h3>

<p>Standard normals have variance 1; means of $n$ standard normals
have standard deviation $1/\sqrt{n}$</p>

<blockquote>
  <p>A normal distribution with a mean of 0 and a standard deviation of 1
is called a standard normal distribution. -wiki</p>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nosim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="n">sd</span><span class="p">(</span><span class="n">apply</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="n">nosim</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">nosim</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.3156
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.3162
</code></pre></div></div>

<hr />

<h3 id="simulation-example-uniform-distribution">Simulation example: uniform distribution</h3>

<p>https://en.wikipedia.org/wiki/Uniform_distribution_%28continuous%29</p>

\[f(x) = 1/(b-a) for a&lt;=x&lt;=b

f(x) =         for other cases\]

<p>https://math.stackexchange.com/a/728072/332456 for explanation of
variance = (b-a)/12.</p>

<p>Standard uniforms have variance $1/12$; means of 
random samples of $n$ uniforms have sd = $1/\sqrt{12 \times n}$</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nosim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="n">sd</span><span class="p">(</span><span class="n">apply</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="n">nosim</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">nosim</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.09017
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="m">12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.09129
</code></pre></div></div>

<hr />
<h3 id="binomial-distribution">Binomial distribution</h3>

<ul>
  <li>Based on <a href="https://www.khanacademy.org/math/in-in-grade-12-ncert/in-in-probability-of-events/copy-of-binomial-random-variables/v/visualizing-a-binomial-distribution">khan lecture</a>.</li>
</ul>

<p>Let‚Äôs say we have 5 coin tosses and we are interested in the #heads
that come about!</p>

<p>X is the random variable which has the outcome of #heads</p>

<p>P(X=0) = 5C1 x (1/2)^0 x (1/2)^5</p>

<p>P(X=2) = 5C2 x (1/2)^1 x (1/2)^4</p>

<p>And so on. It will look like a normal distribution but it is discrete.</p>

<ul>
  <li>Based on ‚Äú<a href="https://www.khanacademy.org/math/in-in-grade-12-ncert/in-in-probability-of-events/copy-of-binomial-random-variables/v/probability-of-making-2-shots-in-6-attempts">Binomial probability example‚Äù</a></li>
</ul>

<p>P(making basket) = 70%</p>

<p>P(failing) = 30%</p>

<p>P(X=2 in 6 attempts) = 6C2 x (0.7)^2 x (0.3)^4 = 15 x 0.49 x 0.0081 = 6%</p>

<ul>
  <li>Mean of binomial probability.</li>
</ul>

<p>E(X)= n x p(success)</p>

<p>For example, if we shoot with 60% success (per shot), then for 10 shots
we would have made on an average = 10 x 60% = 6 baskets.</p>

<ul>
  <li>Generalization of p of binomial distributions!</li>
</ul>

<p>P(exactly k scores in n attempts) = nCk f^k (1-f)^(n-k)</p>

<h3 id="simulation-example-poissons">Simulation example: Poissons</h3>

<p>Based on this <a href="https://www.khanacademy.org/math/statistics-probability/random-variables-stats-library/poisson-distribution/v/poisson-process-1">khan video</a>, we understand that Poisson is nothing
but binomial but when n -&gt; infinity.</p>

<p>Also according to <a href="https://math.stackexchange.com/questions/1050184/difference-between-poisson-and-binomial-distributions">stack</a>,</p>

<blockquote>
  <p>The difference between the two is that while both measure the number
of certain random events (or ‚Äúsuccesses‚Äù) within a certain frame,
the Binomial is based on discrete events, while the Poisson is based
on continuous events. That is, with a binomial distribution you have
a certain number, $n$, of ‚Äúattempts,‚Äù each of which has probability
of success $p$. With a Poisson distribution, you essentially have
infinite attempts, with infinitesimal chance of success. That is,
given a Binomial distribution with some $n,p$, if you let
$n\rightarrow\infty$ and $p\rightarrow0$ in such a way that
$np\rightarrow\lambda$, then that distribution approaches a Poisson
distribution with parameter $\lambda$.</p>
</blockquote>

<p><strong>Mean=Variance</strong>= $\lambda$</p>

<p><strong>Probability is given by</strong></p>

\[\Pr[X = k] = e^{-\lambda} \frac{\lambda^k}{k!}, \quad k = 0, 1, 2, \ldots.\]

<p>If Var=Mean=4, &amp; number we average upon is n = 10; then SD = sqrt(variance/n)</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nosim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="n">sd</span><span class="p">(</span><span class="n">apply</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">rpois</span><span class="p">(</span><span class="n">nosim</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">nosim</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.6219
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">sqrt</span><span class="p">(</span><span class="m">4</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.6325
</code></pre></div></div>

<hr />
<h3 id="simulation-example-binomial-distribution">Simulation example: binomial distribution</h3>

<p>Fair coin flips have variance $0.25$; means of 
random samples of $n$ coin flips have SD = sqrt(variance/n); same as poissons!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nosim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="n">sd</span><span class="p">(</span><span class="n">apply</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="m">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nosim</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
                </span><span class="n">nosim</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.1587
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.1581
</code></pre></div></div>

<hr />
<h3 id="data-example">Data example</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">);</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">father.son</span><span class="p">);</span><span class="w"> 
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">father.son</span><span class="o">$</span><span class="n">sheight</span><span class="w">
</span><span class="n">n</span><span class="o">&lt;-</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />
<h3 id="plot-of-the-sons-heights">Plot of the son‚Äôs heights</h3>
<p><img src="assets/fig/unnamed-chunk-9.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" style="display: block; margin: auto;" /></p>

<hr />
<h3 id="lets-interpret-these-numbers">Let‚Äôs interpret these numbers</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">round</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">var</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 7.92 0.01 2.81 0.09
</code></pre></div></div>

<p><img src="assets/fig/unnamed-chunk-11.png" title="plot of chunk unnamed-chunk-11" alt="plot of chunk unnamed-chunk-11" style="display: block; margin: auto;" /></p>

<hr />

<h3 id="summarizing-what-we-know-about-variances">Summarizing what we know about variances</h3>
<ul>
  <li>The sample variance estimates the population variance</li>
  <li>The distribution of the sample variance is centered at
what its estimating</li>
  <li>It gets more concentrated around the population variance with larger sample sizes</li>
  <li>The variance of the sample mean is the population variance
divided by $n$
    <ul>
      <li>The square root is the standard error</li>
    </ul>
  </li>
  <li>It turns out that we can say a lot about the distribution of
averages from random samples, 
even though we only get one to look at in a given data set</li>
</ul>

<h2 id="common-distributions-c6-w2">Common distributions c6-w2</h2>
<h3 id="the-bernoulli-distribution">The Bernoulli distribution</h3>

<ul>
  <li>The <strong>Bernoulli distribution</strong> arises as the result of a binary outcome</li>
  <li>Bernoulli random variables take (only) the values 1 and 0 with probabilities of (say) $p$ and $1-p$ respectively</li>
  <li>The PMF for a Bernoulli random variable $X$ is \(P(X = x) =  p^x (1 - p)^{1 - x}\)</li>
  <li>The mean of a Bernoulli random variable is $p$ and the variance is $p(1 - p)$</li>
  <li>If we let $X$ be a Bernoulli random variable, it is typical to call $X=1$ as a ‚Äúsuccess‚Äù and $X=0$ as a ‚Äúfailure‚Äù</li>
</ul>

<hr />

<h3 id="binomial-trials">Binomial trials</h3>

<ul>
  <li>The <em>binomial random variables</em> are obtained as the sum of iid Bernoulli trials</li>
  <li>In specific, let $X_1,\ldots,X_n$ be iid Bernoulli$(p)$; then $X = \sum_{i=1}^n X_i$ is a binomial random variable</li>
  <li>The binomial mass function is
\(P(X = x) = 
\left(
\begin{array}{c}
n \\ x
\end{array}
\right)
p^x(1 - p)^{n-x}\)
for $x=0,\ldots,n$</li>
</ul>

<hr />

<h3 id="choose">Choose</h3>

<ul>
  <li>Recall that the notation 
\(\left(
  \begin{array}{c}
    n \\ x
  \end{array}
\right) = \frac{n!}{x!(n-x)!}\) (read ‚Äú$n$ choose $x$‚Äù) counts the number of ways of selecting $x$ items out of $n$
without replacement disregarding the order of the items</li>
</ul>

\[\left(
    \begin{array}{c}
      n \\ 0
    \end{array}
  \right) =
\left(
    \begin{array}{c}
      n \\ n
    \end{array}
  \right) =  1\]

<hr />

<h3 id="example-8">Example</h3>

<ul>
  <li>Suppose a friend has $8$ children (oh my!), $7$ of which are girls and none are twins</li>
  <li>If each gender has an independent $50$% probability for each birth, what‚Äôs the probability of getting $7$ or more girls out of $8$ births?
\(\left(
\begin{array}{c}
8 \\ 7
\end{array}
\right) .5^{7}(1-.5)^{1}
+
\left(
\begin{array}{c}
8 \\ 8
\end{array}
\right) .5^{8}(1-.5)^{0} \approx 0.04\)</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">choose</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.5</span><span class="o">^</span><span class="m">8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">choose</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.5</span><span class="o">^</span><span class="m">8</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.03516
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pbinom</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.03516
</code></pre></div></div>

<hr />

<h3 id="the-normal-distribution">The normal distribution</h3>

<ul>
  <li>A random variable is said to follow a <strong>normal</strong> or <strong>Gaussian</strong> distribution with mean $\mu$ and variance $\sigma^2$ if the associated density is
\((2\pi \sigma^2)^{-1/2}e^{-(x - \mu)^2/2\sigma^2}\)
If $X$ a RV with this density then $E[X] = \mu$ and $Var(X) = \sigma^2$</li>
  <li>We write $X\sim \mbox{N}(\mu, \sigma^2)$</li>
  <li>When $\mu = 0$ and $\sigma = 1$ the resulting distribution is called <strong>the standard normal distribution</strong></li>
  <li>Standard normal RVs are often labeled $Z$</li>
</ul>

<hr />
<h3 id="the-standard-normal-distribution-with-reference-lines">The standard normal distribution with reference lines</h3>
<p><img src="assets/fig/unnamed-chunk-2.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" style="display: block; margin: auto;" /></p>

<hr />

<h3 id="facts-about-the-normal-density">Facts about the normal density</h3>

<p>If $X \sim \mbox{N}(\mu,\sigma^2)$ then 
\(Z = \frac{X -\mu}{\sigma} \sim N(0, 1)\)</p>

<p>If $Z$ is standard normal \(X = \mu + \sigma Z \sim \mbox{N}(\mu, \sigma^2)\)</p>

<hr />

<h3 id="more-facts-about-the-normal-density-by-thra">More facts about the normal density by ThRa</h3>

<p>Take a normal distribution with mean 0 and standard deviation 1.</p>

<p>0th quantile is the middle. 1st quantile is 1 sd to the right. 2nd
quantile is 2 sd to the right.</p>

<p>0th quantile is 50 percentile. 2nd quantil is 97.7%. 3rd quantile is
99.8%.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pnorm(q) # gives distribution function value for given quantile
qnorm(p) # gives the other way around
</code></pre></div></div>

<p>CDF: F(X_alpha)= area under the curve until X_alpha</p>

<ol>
  <li>
    <p>Approximately $68\%$, $95\%$ and $99\%$  of the normal density lies
within $1$, $2$ and $3$ standard deviations from the mean,
respectively</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &gt;pnorm(1)-pnorm(-1)
 [1] 0.6826895
 &gt; pnorm(2)-pnorm(-2)
 [1] 0.9544997
 &gt; (pnorm(3)-pnorm(-3))
 [1] 0.9973002
</code></pre></div>    </div>
  </li>
  <li>
    <p>$-1.28$, $-1.645$, $-1.96$ and $-2.33$ are the $10^{th}$, $5^{th}$,
$2.5^{th}$ and $1^{st}$ percentiles of the standard normal
distribution respectively</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &gt; qnorm(0.1)
 [1] -1.281552
</code></pre></div>    </div>
  </li>
  <li>
    <p>By symmetry, $1.28$, $1.645$, $1.96$ and $2.33$ are the $90^{th}$, $95^{th}$, $97.5^{th}$ and $99^{th}$ percentiles of the standard normal distribution respectively</p>
  </li>
</ol>

<hr />

<h3 id="question">Question</h3>

<ul>
  <li>What is the $95^{th}$ percentile of a $N(\mu, \sigma^2)$ distribution?
    <ul>
      <li>Quick answer in R <code class="language-plaintext highlighter-rouge">qnorm(.95, mean = mu, sd = sd)</code></li>
    </ul>
  </li>
  <li>Or, because you have the standard normal quantiles memorized
and you know that 1.645 is the 95th percentile you know that the answer has to be
\(\mu + \sigma 1.645\)</li>
  <li>(In general $\mu + \sigma z_0$ where $z_0$ is the appropriate standard normal quantile)</li>
</ul>

<hr />

<h3 id="question-1">Question</h3>

<ul>
  <li>What is the probability that a $\mbox{N}(\mu,\sigma^2)$ RV is larger than $x$?</li>
</ul>

<hr />
<h3 id="example-9">Example</h3>

<p>Assume that the number of daily ad clicks for a company 
is (approximately) normally distributed with a mean of 1020 and a standard
deviation of 50. What‚Äôs the probability of getting
more than  1,160 clicks in a day?</p>

<hr />

<h3 id="example-10">Example</h3>

<p>Assume that the number of daily ad clicks for a company 
is (approximately) normally distributed with a mean of 1020 and a standard
deviation of 50. What‚Äôs the probability of getting
more than  1,160 clicks in a day?</p>

<p>It‚Äôs not very likely, 1,160 is 2.8 standard
deviations from the mean</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pnorm</span><span class="p">(</span><span class="m">1160</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1020</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.002555
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pnorm</span><span class="p">(</span><span class="m">2.8</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.002555
</code></pre></div></div>

<hr />

<h3 id="example-11">Example</h3>

<p>Assume that the number of daily ad clicks for a company 
is (approximately) normally distributed with a mean of 1020 and a standard
deviation of 50. What number of daily ad clicks would represent
the one where 75% of days have fewer clicks (assuming
days are independent and identically distributed)?</p>

<hr />

<h3 id="example-12">Example</h3>

<p>Assume that the number of daily ad clicks for a company 
is (approximately) normally distributed with a mean of 1020 and a standard
deviation of 50. What number of daily ad clicks would represent
the one where 75% of days have fewer clicks (assuming
days are independent and identically distributed)?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qnorm</span><span class="p">(</span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1020</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 1054
</code></pre></div></div>

<hr />
<h3 id="the-poisson-distribution">The Poisson distribution</h3>

<ul>
  <li>Used to model counts</li>
  <li>
    <p>The Poisson mass function is
\(P(X = x; \lambda) = \frac{\lambda^x e^{-\lambda}}{x!}\)
for $x=0,1,\ldots$</p>
  </li>
  <li><strong>The mean of this distribution is $\lambda$</strong></li>
  <li><strong>The variance of this distribution is $\lambda$</strong></li>
  <li><strong>Notice that $x$ ranges from $0$ to $\infty$</strong></li>
</ul>

<hr />
<h3 id="some-uses-for-the-poisson-distribution">Some uses for the Poisson distribution</h3>
<ul>
  <li>Modeling count data</li>
  <li>Modeling event-time or survival data</li>
  <li>Modeling contingency tables</li>
  <li>Approximating binomials when $n$ is large and $p$ is small</li>
</ul>

<hr />
<h3 id="rates-and-poisson-random-variables">Rates and Poisson random variables</h3>
<ul>
  <li>Poisson random variables are used to model rates</li>
  <li>$X \sim Poisson(\lambda t)$ where
    <ul>
      <li>$\lambda = E[X / t]$ is the expected count per unit of time</li>
      <li>$t$ is the total monitoring time</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="example-13">Example</h3>
<p>The number of people that show up at a bus stop is Poisson with
a mean of $2.5$ per hour.</p>

<p>If watching the bus stop for 4 hours, what is the probability that $3$
or fewer people show up for the whole time?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ppois</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.01034
</code></pre></div></div>

<hr />
<h3 id="poisson-approximation-to-the-binomial">Poisson approximation to the binomial</h3>
<ul>
  <li>When $n$ is large and $p$ is small the Poisson distribution
is an accurate approximation to the binomial distribution</li>
  <li>Notation
    <ul>
      <li>$X \sim \mbox{Binomial}(n, p)$</li>
      <li>$\lambda = n p$</li>
      <li>$n$ gets large</li>
      <li>$p$ gets small</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="example-poisson-approximation-to-the-binomial">Example, Poisson approximation to the binomial</h3>

<p>We flip a coin with success probablity $0.01$ five hundred times.</p>

<p>What‚Äôs the probability of 2 or fewer successes?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pbinom</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.1234
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ppois</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.01</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.1247
</code></pre></div></div>

<h2 id="asymtotics">Asymtotics</h2>

<h3 id="asymptotics">Asymptotics</h3>
<ul>
  <li>Asymptotics is the term for the behavior of statistics as the sample size (or some other relevant quantity) limits to infinity (or some other relevant number)</li>
  <li>(Asymptopia is my name for the land of asymptotics, where everything works out well and there‚Äôs no messes. The land of infinite data is nice that way.)</li>
  <li>Asymptotics are incredibly useful for simple statistical inference and approximations</li>
  <li>(Not covered in this class) Asymptotics often lead to nice understanding of procedures</li>
  <li>Asymptotics generally give no assurances about finite sample performance</li>
  <li>Asymptotics form the basis for frequency interpretation of probabilities 
(the long run proportion of times an event occurs)</li>
</ul>

<hr />

<h3 id="law-of-large-numbers-in-action">Law of large numbers in action</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="n">means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">means</span><span class="p">),</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Number of obs"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cumulative mean"</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w">
</span></code></pre></div></div>

<hr />
<h3 id="law-of-large-numbers-in-action-coin-flip">Law of large numbers in action, coin flip</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">means</span><span class="p">),</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Number of obs"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cumulative mean"</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w">
</span></code></pre></div></div>

<p><img src="assets/fig/unnamed-chunk-2.png" alt="plot of chunk unnamed-chunk-2" /></p>

<p>If we make infinite coin tosses then we get the right answer, law of
large numbers!</p>

<hr />

<h3 id="the-central-limit-theorem">The Central Limit Theorem</h3>

<ul>
  <li>The <strong>Central Limit Theorem</strong> (CLT) is one of the most important theorems in statistics</li>
  <li>For our purposes, the CLT states that the distribution of averages of iid variables (properly normalized) becomes that of a standard normal as the sample size increases</li>
  <li>The CLT applies in an endless variety of settings</li>
  <li>The result is that 
\(\frac{\bar X_n - \mu}{\sigma / \sqrt{n}}=
\frac{\sqrt n (\bar X_n - \mu)}{\sigma}
= \frac{\mbox{Estimate} - \mbox{Mean of estimate}}{\mbox{Std. Err. of estimate}}\) has a distribution like that of a standard normal for large $n$.</li>
  <li>(Replacing the standard error by its estimated value doesn‚Äôt change the CLT)</li>
  <li><strong>The useful way to think about the CLT is that $\bar X_n$ is
approximately $N(\mu, \sigma^2 / n)$</strong></li>
</ul>

<p><strong>Basically, that when you take an iid like a coin flip, and you start
making distribution of averages out of them, it tends to normal
distribution.</strong></p>

<hr />

<h3 id="example-14">Example</h3>

<ul>
  <li>Simulate a standard normal random variable by rolling $n$ (six sided)</li>
  <li>Let $X_i$ be the outcome for die $i$</li>
  <li>Then note that $\mu = E[X_i] = 3.5$</li>
  <li>$Var(X_i) = 2.92$</li>
  <li>SE $\sqrt{2.92 / n} = 1.71 / \sqrt{n}$</li>
  <li>Lets roll $n$ dice, take their mean, subtract off 3.5,
and divide by $1.71 / \sqrt{n}$ and repeat this over and over</li>
</ul>

<hr />
<h3 id="result-of-our-die-rolling-experiment">Result of our die rolling experiment</h3>

<p>You see that for 10 rolls of a die it is still discrete, but for 30
rolls it almost makes the bell curve given by $\mu$ and the Variance!</p>

<hr />
<h3 id="coin-clt">Coin CLT</h3>

<ul>
  <li>
    <p>Let $X_i$ be the $0$ or $1$ result of the $i^{th}$ flip of a possibly unfair coin</p>
  </li>
  <li>The sample proportion, say $\hat p$, is the average of the coin flips</li>
  <li>$E[X_i] = p$ and $Var(X_i) = p(1-p)$</li>
  <li>Standard error of the mean is $\sqrt{p(1-p)/n}$</li>
  <li>
    <p>Then
\(\frac{\hat p - p}{\sqrt{p(1-p)/n}}\)
will be approximately normally distributed</p>
  </li>
  <li>Let‚Äôs flip a coin $n$ times, take the sample proportion
of heads, subtract off .5 and multiply the result by
$2 \sqrt{n}$ (divide by $1/(2 \sqrt{n})$)</li>
</ul>

<hr />
<h3 id="simulation-results">Simulation results</h3>
<p><img src="assets/fig/unnamed-chunk-4.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" style="display: block; margin: auto;" /></p>

<hr />
<h3 id="simulation-results-p--09">Simulation results, $p = 0.9$</h3>
<p><img src="assets/fig/unnamed-chunk-5.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" style="display: block; margin: auto;" /></p>

<hr />
<h3 id="galtons-quincunx">Galton‚Äôs quincunx</h3>

<p>http://en.wikipedia.org/wiki/Bean_machine#mediaviewer/File:Quincunx_(Galton_Box)_-_Galton_1889_diagram.png</p>

<p><img src="fig/quincunx.png" height="450" />&lt;/img&gt;</p>

<hr />

<h3 id="confidence-intervals-thej">Confidence intervals thej</h3>

<p>This is a hard topic almost impossible to follow from the coursera
course.</p>

<p><strong>Population</strong><br />
Let‚Äôs say there are 100k people and you want to find out who voted for
k. Let‚Äôs assume the <strong>True mean</strong> (aka sample proportion) to be <strong>p</strong>.</p>

<p><strong>Sampling</strong><br />
But unfortunately we cannot estimate the true mean, so we take
<strong>n=100</strong> sample. We determine the what is the sample proportion i.e.,
54 people vote for A (success). $\cap{p}=0.54$.</p>

<p><strong>Normal distribution</strong></p>

<p>Imagine a bell curve over different population sets of 100. So we make
<strong>$\cap{p}_1$</strong> and then another 100 leads to <strong>$\cap{p}_2$</strong> etc‚Ä¶ We make a
plot out of it.</p>

<p>Obviously <strong>E[$\cap{p}$]</strong> is the same as the population mean <strong>p</strong>
and a bell curve is formed eventually where std deviation as we have
seen earlier is $\sigma_\cap{p} = \sqrt{p(1-p)/n}$. Note it is <strong>p</strong>
that determines the SD of the bell!</p>

<p><strong>2 things we are interested in</strong></p>

<ul>
  <li>What is the probability that any <strong>$\cap{p}$</strong> lies within 2sigma of the
<strong>True Mean p</strong></li>
</ul>

<p>or conversely,</p>

<ul>
  <li>What is the probability that the <strong>True Mean p</strong> lies within 2sigma
of the <strong>$\cap{p}$</strong></li>
</ul>

<p><strong>Note</strong>: Sigma can only be calculated from the true mean.</p>

<p><strong>The problem and solution</strong></p>

<p>But there is no way of knowing the true mean in advance and possibly
ever, (for example think of determining who people are going to vote
for in the country.)</p>

<p>So we do what is the <strong>next ‚Äúbest‚Äù possible stuff!</strong></p>

<p>We try to take the <strong>SE (standard Error)</strong> which is obtained by using
$\cap{p}$ instead of P in the SD calculations. I.e., We draw <strong>a</strong> <strong>sample</strong>
of <strong>n=100</strong>, find the $\cap{p}=0.54$. Then we use this to determine
the <strong>SE and not the SD</strong>.</p>

<p><strong>What does this mean? and why?</strong></p>

<p>There is a <strong>95% probability</strong> that <strong>p is within 2sigma $\cap{p}$ of
$\cap{p}$</strong>.</p>

<p>In the above example SE=0.05, so there is 95% probability that the
drawn sample mean is within 0.44 and 0.64.</p>

<p>It turns out that <a href="https://www.khanacademy.org/math/statistics-probability/confidence-intervals-one-sample/introduction-to-confidence-intervals/v/confidence-interval-simulation">SE is a decent estimation of SD</a>.</p>

<p><strong>There are 3 types of interval findings in this notes</strong></p>

<ul>
  <li>
    <p>Finding SE with <strong>$\cap{p}$ instead of p (true mean)</strong>, and
computing Confidence interval</p>
  </li>
  <li>
    <p>SE for biased coin type problems with ** 2xSE=1/sqrt(n)**</p>

    <ul>
      <li>Using Agresti interval by taking X+2 and n+4 (i.e., adding 2 more
successes and failures!</li>
    </ul>
  </li>
</ul>

<h4 id="give-a-confidence-interval-for-the-average-height-of-sons">Give a confidence interval for the average height of sons</h4>

<p>in Galton‚Äôs data</p>

<p>Here we take the same of data we have for the son‚Äôs height and find
the 95% confidence intervals.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">father.son</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">father.son</span><span class="o">$</span><span class="n">sheight</span><span class="w">
</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="o">/</span><span class="m">12</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 5.710 5.738
</code></pre></div></div>

<hr />

<h3 id="confidence-interval-walds-interval">Confidence interval Walds interval</h3>

<p>We imagine a biased coin, i.e., SD= sqrt(p(1-p));</p>

<ul>
  <li>The interval takes the form:</li>
</ul>

\[\hat p \pm z_{1 - \alpha/2}  \sqrt{\frac{p(1 - p)}{n}}\]

<p>The maximum value p(1-p) can take is 1/2 at p=0.5.</p>

<p>-<strong>For 95% intervals \(\hat p \pm \frac{1}{\sqrt{n}}\)</strong></p>

<p>This is used for quick ‚Äúconservative‚Äù(maybe) estimates.</p>

<hr />
<h3 id="example-of-voters-for-walds-interval">Example of voters for Wald‚Äôs interval</h3>

<ul>
  <li>Your campaign advisor told you that in a random sample of 100 likely voters,
56 intent to vote for you.
    <ul>
      <li>Can you relax? Do you have this race in the bag?</li>
      <li>Without access to a computer or calculator, how precise is this estimate?</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">1/sqrt(100)=0.1</code> so a back of the envelope calculation gives an
<strong>approximate 95% interval</strong> of <code class="language-plaintext highlighter-rouge">(0.46, 0.66)</code>
    <ul>
      <li>Not enough for you to relax, better go do more campaigning as it
is not &gt;50%</li>
    </ul>
  </li>
  <li>Rough guidelines is that when n=100 you have one decimal place of in
the SE and n=10000 you have 2 deimal places in the SE.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">round</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="m">10</span><span class="o">^</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">)),</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.316 0.100 0.032 0.010 0.003 0.001
</code></pre></div></div>

<hr />

<h3 id="2-ways-of-determining-the-confidence-interval">2 ways of determining the confidence interval!</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">0.56</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="m">0.56</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.44</span><span class="o">/</span><span class="m">100</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.4627 0.6573
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">binom.test</span><span class="p">(</span><span class="m">56</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="o">$</span><span class="n">conf.int</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.4572 0.6592
## attr(,"conf.level")
## [1] 0.95
</code></pre></div></div>

<hr />

<h3 id="simulation-for-n20">Simulation fOR n=20</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">20</span><span class="w">
</span><span class="n">pvals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
</span><span class="n">nosim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">coverage</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">phats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">nosim</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="w">
    </span><span class="n">ll</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">phats</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">phats</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">phats</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="w">
    </span><span class="n">ul</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">phats</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">phats</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">phats</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="w">
    </span><span class="n">mean</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ul</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p><strong>When true mean is 0.5, then confidence interval covers the true
mean</strong>, i.e., follows central limit theorem!! but otherwise for
<strong>n=20</strong> it doesn‚Äôt seem to work correctly. For some cases of
<strong>p=0.1</strong>, the confidence interval obtained from the SE does not seem
to contain the <strong>p</strong>.</p>

<h3 id="simulation-for-n100">Simulation for n=100</h3>

<p>For n=100 the graph is rather spot on: For all <strong>p</strong>‚Äôs there is a
90-95% chance that it covers the true mean when using SE.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="n">pvals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
</span><span class="n">nosim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">coverage2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">phats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">nosim</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="w">
    </span><span class="n">ll</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">phats</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">phats</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">phats</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="w">
    </span><span class="n">ul</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">phats</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">phats</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">phats</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="w">
    </span><span class="n">mean</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ul</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<hr />
<h3 id="whats-happening-fix-agresticoull-interval">What‚Äôs happening? Fix: Agresti/Coull interval</h3>

<ul>
  <li>
    <p><strong>$n$ isn‚Äôt ‚Äúlarge enough‚Äù for the CLT to be applicable
for many of the values of $p$</strong></p>
  </li>
  <li>Quick fix, form the interval with 
\(\frac{X + 2}{n + 4}\)</li>
  <li>(Add two successes and failures, <strong>Agresti/Coull interval)</strong></li>
</ul>

<p><strong>Use Agresti/Coull interval generally- Bcaffo</strong></p>

<h3 id="simulation-with-agresti-interval-for-n20">Simulation with Agresti interval for n=20</h3>
<p>Now let‚Äôs look at $n=20$ but adding 2 successes and failures</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">20</span><span class="w">
</span><span class="n">pvals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
</span><span class="n">nosim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">coverage</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">phats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">rbinom</span><span class="p">(</span><span class="n">nosim</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
    </span><span class="n">ll</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">phats</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">phats</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">phats</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="w">
    </span><span class="n">ul</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">phats</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">phats</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">phats</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="w">
    </span><span class="n">mean</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ul</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>
<p>It‚Äôs a little conservative, i.e. the mean lies within &gt;2 sigma for
sure. i.e., &gt;95% confidence</p>

<hr />

<h3 id="poisson-interval">Poisson interval</h3>
<ul>
  <li>A nuclear pump failed 5 times out of 94.32 days, give a 95% confidence interval for the failure rate per day?</li>
  <li>$X \sim Poisson(\lambda t)$.</li>
  <li>Estimate $\hat \lambda = X/t$</li>
  <li>$Var(\hat \lambda) = \lambda / t$</li>
  <li>$\hat \lambda / t$ is our variance estimate</li>
</ul>

<hr />
<h3 id="r-code">R code</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">94.32</span><span class="w">
</span><span class="n">lambda</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="o">/</span><span class="n">t</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">lambda</span><span class="o">/</span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.007 0.099
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">poisson.test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nb">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">94.32</span><span class="p">)</span><span class="o">$</span><span class="n">conf</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.01721 0.12371
## attr(,"conf.level")
## [1] 0.95
</code></pre></div></div>

<hr />
<h3 id="simulating-the-poisson-coverage-rate">Simulating the Poisson coverage rate</h3>
<p>Let‚Äôs see how this interval performs for lambda
values near what we‚Äôre estimating</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lambdavals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.005</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">)</span><span class="w">
</span><span class="n">nosim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="n">coverage</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">lambdavals</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">lambda</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">lhats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rpois</span><span class="p">(</span><span class="n">nosim</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">t</span><span class="w">
    </span><span class="n">ll</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lhats</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">lhats</span><span class="o">/</span><span class="n">t</span><span class="p">)</span><span class="w">
    </span><span class="n">ul</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lhats</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">lhats</span><span class="o">/</span><span class="n">t</span><span class="p">)</span><span class="w">
    </span><span class="n">mean</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ul</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">lambda</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<hr />
<h3 id="covarage">Covarage</h3>
<p>(Gets really bad for small values of lambda)
<img src="assets/fig/unnamed-chunk-17.png" title="plot of chunk unnamed-chunk-17" alt="plot of chunk unnamed-chunk-17" style="display: block; margin: auto;" /></p>

<hr />
<h3 id="what-if-we-increase-t-to-1000">What if we increase t to 1000?</h3>
<p><img src="assets/fig/unnamed-chunk-18.png" title="plot of chunk unnamed-chunk-18" alt="plot of chunk unnamed-chunk-18" style="display: block; margin: auto;" /></p>

<hr />
<h3 id="summary-8">Summary</h3>
<ul>
  <li>The LLN states that averages of iid samples 
converge to the population means that they are estimating</li>
  <li>The CLT states that averages are approximately normal, with
distributions
    <ul>
      <li>centered at the population mean</li>
      <li>with standard deviation equal to the standard error of the mean</li>
      <li>CLT gives no guarantee that $n$ is large enough</li>
    </ul>
  </li>
  <li>Taking the mean and adding and subtracting the relevant
normal quantile times the SE yields a confidence interval for the mean
    <ul>
      <li>Adding and subtracting 2 SEs works for 95% intervals</li>
    </ul>
  </li>
  <li>Confidence intervals get wider as the coverage increases
(why?)</li>
  <li>Confidence intervals get narrower with less variability or
larger sample sizes</li>
  <li>The Poisson and binomial case have exact intervals that
don‚Äôt require the CLT
    <ul>
      <li>But a quick fix for small sample size binomial calculations is to add 2 successes and failures
        <h2 id="questions-c6-w2">Questions c6-w2</h2>
      </li>
    </ul>
  </li>
</ul>

<ol>
  <li>
    <p>What is the variance of the distribution of the average an IID draw
of nn observations from a population with mean Œº and variance œÉ^2</p>

    <p>$sigma^2/n$</p>
  </li>
  <li>
    <p>Suppose that diastolic blood pressures (DBPs) for men aged 35-44
are normally distributed with a mean of 80 (mm Hg) and a standard
deviation of 10. About what is the probability that a random 35-44
year old has a DBP less than 70?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pnorm(70, mean = 80, sd = 10)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Brain volume for adult women is normally distributed with a mean of
about 1,100 cc for women with a standard deviation of 75 cc. What
brain volume represents the 95th percentile?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> qnorm(0.95, mean = 1100, sd = 75)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Refer to the previous question. Brain volume for adult women is
about 1,100 cc for women with a standard deviation of 75
cc. Consider the sample mean of 100 random adult women from this
population. What is the 95th percentile of the distribution of that
sample mean?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> qnorm(0.95, mean = 1100, sd = 75/sqrt(100))
</code></pre></div>    </div>
  </li>
  <li>
    <p>You flip a fair coin 5 times, about what‚Äôs the probability of
getting 4 or 5 heads?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pbinom(3, size = 5, prob = 0.5, lower.tail = FALSE)
</code></pre></div>    </div>
  </li>
  <li>
    <p>The respiratory disturbance index (RDI), a measure of sleep
disturbance, for a specific population has a mean of 15 (sleep
events per hour) and a standard deviation of 10. They are not
normally distributed. Give your best estimate of the probability
that a sample mean RDI of 100 people is between 14 and 16 events
per hour?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pnorm(16, mean = 15, sd = 1) - pnorm(14, mean = 15, sd = 1)
</code></pre></div>    </div>

    <p>The population needn‚Äôt be normal but <strong>distribution of sample mean</strong> seems to be
 normally distributed.</p>
  </li>
  <li>
    <p>Consider a standard uniform density. The mean for this density is
.5 and the variance is 1 / 12. You sample 1,000 observations from
this distribution and take the sample mean, what value would you
expect it to be near?</p>

    <p>Via the LLN it should be near .5 <em>it seems!!!!</em></p>
  </li>
  <li>
    <p>The number of people showing up at a bus stop is assumed to be
Poisson with a mean of 5 5 people per hour. You watch the bus stop
for 3 hours. About what‚Äôs the probability of viewing 10 or fewer
people?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ppois(10, lambda = 15)
</code></pre></div>    </div>

    <p>Need to give this a bit more thought! But I nailed the answer! of
 course!</p>
  </li>
</ol>

<h2 id="t-confidence-interval-c6-w3">T confidence interval (c6-w3)</h2>
<h3 id="t-confidence-intervals">T Confidence intervals</h3>

<ul>
  <li>In the previous, we discussed creating a confidence interval using the CLT
    <ul>
      <li>They took the form $Est \pm ZQ \times SE_{Est}$</li>
    </ul>

    <p>But according to <a href="https://youtu.be/Uv6nGIgZMVw?t=68">jbstatistics</a>, he says that only Z quantile
implies using population sd. But what ever! we move on.</p>
  </li>
  <li>
    <p>In this lecture, we discuss some methods for <strong>small samples</strong>,
notably <strong>Gosset‚Äôs $t$ distribution and $t$ confidence intervals</strong></p>

    <ul>
      <li>They are of the form <strong>$Est \pm TQ \times SE_{Est}$</strong></li>
    </ul>
  </li>
  <li><strong>If you want a rule between whether to use a $t$ interval or normal
interval, just always use the $t$ interval</strong></li>
</ul>

<hr />

<h3 id="gossets-t-distribution">Gosset‚Äôs $t$ distribution</h3>

<p>If you look in this <a href="https://youtu.be/Uv6nGIgZMVw?t=190">jbstatistics video</a>, you see how the curve
looks for a given ‚Äúdegrees of Freedom‚Äù. No one dares to explain what
it is though.</p>

<ul>
  <li>Has thicker tails than the normal</li>
  <li>
    <p><strong>Is indexed by a degrees of freedom; gets more like a standard
normal as df gets larger</strong></p>
  </li>
  <li>
    <p>It assumes that the underlying data are iid Gaussian with the result
that \(\frac{\bar X - \mu}{SE/\sqrt{n}}\) follows Gosset‚Äôs $t$
distribution with $n-1$ degrees of freedom</p>
  </li>
  <li>(If we replaced $s$ by $\sigma$ the statistic would be exactly standard normal)</li>
  <li>Interval is $\bar X \pm t_{n-1} S/\sqrt{n}$ where $t_{n-1}$
is the relevant quantile</li>
</ul>

<p>So what changes in essence is the lack of $\sigma$ resulting in a t
distribution whose quantile terms are not Z anymore, they are t. And
the approximation of this distribution closes to the normal when dof = infinity!</p>

<hr />
<h3 id="code-for-manipulate">Code for manipulate</h3>

<p>Shows the normal and T plots with varying dofs!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">manipulate</span><span class="p">)</span><span class="w">
</span><span class="n">k</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">xvals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w">
</span><span class="n">myplot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">dnorm</span><span class="p">(</span><span class="n">xvals</span><span class="p">),</span><span class="w"> </span><span class="n">dt</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">)),</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xvals</span><span class="p">,</span><span class="w"> </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Normal"</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"T"</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">))))</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dist</span><span class="p">))</span><span class="w">
    </span><span class="n">g</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">manipulate</span><span class="p">(</span><span class="n">myplot</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span><span class="w"> </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slider</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />
<h3 id="easier-to-see">Easier to see</h3>

<p>Compares the z and t quantiles</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pvals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.99</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">)</span><span class="w">
</span><span class="n">myplot2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="n">pvals</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">),</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pvals</span><span class="p">)</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">))</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_abline</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lightblue"</span><span class="p">)</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">))</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="m">0.975</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">))</span><span class="w">
    </span><span class="n">g</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">manipulate</span><span class="p">(</span><span class="n">myplot2</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slider</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="notes-about-the-t-interval">Note‚Äôs about the $t$ interval</h3>

<ul>
  <li>The $t$ interval technically assumes that the data are iid normal,
though it is robust to this assumption</li>
  <li>It works well whenever the distribution of the data is roughly
symmetric and mound shaped</li>
  <li>Paired observations are often analyzed using the $t$ interval by
taking differences</li>
  <li>For large degrees of freedom, $t$ quantiles become the same as
standard normal quantiles; therefore this interval converges to the
same interval as the CLT yielded</li>
  <li>
    <p>For skewed distributions, the spirit of the $t$ interval assumptions
are violated</p>

    <p>-<strong>Also, for skewed distributions, it doesn‚Äôt make a lot of sense to
center the interval at the mean</strong>????</p>

    <ul>
      <li>In this case, consider taking logs or using a different summary
like the median</li>
    </ul>
  </li>
  <li>For highly discrete data, like binary, other intervals are available</li>
</ul>

<hr />

<h3 id="paired-data--sleep-data">Paired data ‚Äî Sleep data</h3>

<p>In R typing <code class="language-plaintext highlighter-rouge">data(sleep)</code> brings up the sleep data originally
analyzed in Gosset‚Äôs Biometrika paper, which shows the increase in
hours for 10 patients on two soporific drugs. R treats the data as two
groups rather than paired despite the same patients using both the
drugs in succession.</p>

<hr />
<h3 id="the-data">The data</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##   extra group ID
## 1   0.7     1  1
## 2  -1.6     1  2
## 3  -0.2     1  3
## 4  -1.2     1  4
## 5  -0.1     1  5
## 6   3.4     1  6
</code></pre></div></div>

<hr />

<h3 id="different-ways-of-running-the-ttest-t-distribution">Different ways of running the T.test t distribution</h3>

<p><strong>97.5 is used and not 95%</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sleep</span><span class="o">$</span><span class="n">extra</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">]</span><span class="w">
</span><span class="n">g2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sleep</span><span class="o">$</span><span class="n">extra</span><span class="p">[</span><span class="m">11</span><span class="o">:</span><span class="m">20</span><span class="p">]</span><span class="w">
</span><span class="n">difference</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">g1</span><span class="w">
</span><span class="n">mn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span><span class="w">
</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="m">0.975</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">s</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="n">t.test</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span><span class="w">
</span><span class="n">t.test</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span><span class="w"> </span><span class="n">g1</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">t.test</span><span class="p">(</span><span class="n">extra</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">relevel</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)),</span><span class="w"> </span><span class="n">paired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sleep</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="the-results">The results</h3>
<p>(After a little formatting)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##        [,1] [,2]
## [1,] 0.7001 2.46
## [2,] 0.7001 2.46
## [3,] 0.7001 2.46
## [4,] 0.7001 2.46
</code></pre></div></div>

<hr />

<h3 id="unpaired-data--independent-group-t-confidence-intervals">Unpaired data ‚Äî Independent group $t$ confidence intervals</h3>

<ul>
  <li>Suppose that we want to compare the mean blood pressure between two
groups in a randomized trial; <strong>those who received the treatment to those who received a placebo</strong></li>
  <li><strong>We cannot use the paired t test because the groups are independent and may have different sample sizes</strong></li>
  <li>We now present methods for comparing independent groups</li>
</ul>

<hr />
<h3 id="confidence-interval">Confidence interval</h3>

<ul>
  <li>Therefore a $(1 - \alpha)\times 100\%$ confidence interval for $\mu_y - \mu_x$ is 
\(\bar Y - \bar X \pm t_{n_x + n_y - 2, 1 - \alpha/2}S_p\left(\frac{1}{n_x} + \frac{1}{n_y}\right)^{1/2}\)</li>
  <li>The pooled variance estimator is \(S_p^2 = \{(n_x - 1) S_x^2 + (n_y - 1) S_y^2\}/(n_x + n_y - 2)\)</li>
  <li>
    <p><strong>Remember this interval is assuming a constant variance across the
two groups</strong></p>
  </li>
  <li>According to the lecture, it is a reasonable assumption if we
perform randomization, that variance is the same.</li>
  <li><strong>If there is some doubt, assume a different variance per group</strong>,
which we will discuss later</li>
</ul>

<hr />

<h3 id="example--unpaired-data-var-is-equal">Example : unpaired data; var is equal</h3>
<h4 id="based-on-rosner-fundamentals-of-biostatistics">Based on Rosner, Fundamentals of Biostatistics</h4>
<p>(Really a very good reference book)</p>

<ul>
  <li>Comparing SBP for 8 oral contraceptive users versus 21 controls</li>
  <li>$\bar X_{OC} = 132.86$ mmHg with $s_{OC} = 15.34$ mmHg</li>
  <li>$\bar X_{C} = 127.44$ mmHg with $s_{C} = 18.23$ mmHg</li>
  <li>Pooled variance estimate</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">((</span><span class="m">7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">15.34</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">18.23</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="m">132.86</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">127.44</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="m">0.975</span><span class="p">,</span><span class="w"> </span><span class="m">27</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">21</span><span class="p">)</span><span class="o">^</span><span class="m">0.5</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] -9.521 20.361
</code></pre></div></div>

<hr />
<h3 id="mistakenly-treating-the-sleep-data-as-paired">Mistakenly treating the sleep data as paired</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span><span class="w">
</span><span class="n">n2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span><span class="w">
</span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(((</span><span class="n">n1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">n2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error: object 'x1' not found
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">md</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span><span class="w">
</span><span class="n">semd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">n1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">n2</span><span class="p">)</span><span class="w">
</span><span class="n">rbind</span><span class="p">(</span><span class="n">md</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="m">0.975</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">semd</span><span class="p">,</span><span class="w"> </span><span class="n">t.test</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span><span class="w"> </span><span class="n">g1</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> 
    </span><span class="n">var.equal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="o">$</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="n">t.test</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span><span class="w"> </span><span class="n">g1</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="o">$</span><span class="n">conf</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##          [,1]   [,2]
## [1,] -14.8873 18.047
## [2,]  -0.2039  3.364
## [3,]   0.7001  2.460
</code></pre></div></div>

<hr />

<h3 id="var-equal-and-var-non-equal">Var equal and Var non equal!</h3>
<h4 id="chickweight-data-in-r"><code class="language-plaintext highlighter-rouge">ChickWeight</code> data in R</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">ChickWeight</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="c1">## define weight gain or loss</span><span class="w">
</span><span class="n">wideCW</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dcast</span><span class="p">(</span><span class="n">ChickWeight</span><span class="p">,</span><span class="w"> </span><span class="n">Diet</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Chick</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">value.var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"weight"</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">wideCW</span><span class="p">)[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"time"</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">wideCW</span><span class="p">)[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)],</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wideCW</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">wideCW</span><span class="p">,</span><span class="w"> </span><span class="n">gain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time21</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />
<h3 id="plotting-the-raw-data">Plotting the raw data</h3>

<p><img src="assets/fig/unnamed-chunk-12.png" title="plot of chunk unnamed-chunk-12" alt="plot of chunk unnamed-chunk-12" style="display: block; margin: auto;" /></p>

<p>noodle plot of the data per diet</p>

<hr />
<h3 id="weight-gain-by-diet">Weight gain by diet</h3>
<p><img src="assets/fig/unnamed-chunk-13.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" style="display: block; margin: auto;" /></p>

<p>violin plot of the data per diet!</p>

<hr />
<h3 id="lets-do-a-t-interval">Let‚Äôs do a t interval</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wideCW14</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">wideCW</span><span class="p">,</span><span class="w"> </span><span class="n">Diet</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="n">rbind</span><span class="p">(</span><span class="n">t.test</span><span class="p">(</span><span class="n">gain</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Diet</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">var.equal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wideCW14</span><span class="p">)</span><span class="o">$</span><span class="n">conf</span><span class="p">,</span><span class="w"> 
    </span><span class="n">t.test</span><span class="p">(</span><span class="n">gain</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Diet</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">var.equal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wideCW14</span><span class="p">)</span><span class="o">$</span><span class="n">conf</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##        [,1]   [,2]
## [1,] -108.1 -14.81
## [2,] -104.7 -18.30
</code></pre></div></div>

<hr />

<h3 id="finding-the-unequal-variances">Finding the Unequal variances</h3>

<ul>
  <li>Under unequal variances
\(\bar Y - \bar X \pm t_{df} \times \left(\frac{s_x^2}{n_x} + \frac{s_y^2}{n_y}\right)^{1/2}\)
where $t_{df}$ is calculated with degrees of freedom
\(df=    \frac{\left(S_x^2 / n_x + S_y^2/n_y\right)^2}
  {\left(\frac{S_x^2}{n_x}\right)^2 / (n_x - 1) +
    \left(\frac{S_y^2}{n_y}\right)^2 / (n_y - 1)}\)
will be approximately a 95% interval</li>
  <li>This works really well
    <ul>
      <li>So when in doubt, just assume unequal variances</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="example-15">Example</h3>

<ul>
  <li>Comparing SBP for 8 oral contraceptive users versus 21 controls</li>
  <li>$\bar X_{OC} = 132.86$ mmHg with $s_{OC} = 15.34$ mmHg</li>
  <li>$\bar X_{C} = 127.44$ mmHg with $s_{C} = 18.23$ mmHg</li>
  <li>$df=15.04$, $t_{15.04, .975} = 2.13$</li>
  <li>Interval
\(132.86 - 127.44 \pm 2.13 \left(\frac{15.34^2}{8} + \frac{18.23^2}{21} \right)^{1/2}
= [-8.91, 19.75]\)</li>
  <li>In R, <code class="language-plaintext highlighter-rouge">t.test(..., var.equal = FALSE)</code></li>
</ul>

<hr />
<h3 id="comparing-other-kinds-of-data">Comparing other kinds of data</h3>
<ul>
  <li>For binomial data, there‚Äôs lots of ways to compare two groups
    <ul>
      <li>Relative risk, risk difference, odds ratio.</li>
      <li>Chi-squared tests, normal approximations, exact tests.</li>
    </ul>
  </li>
  <li>For count data, there‚Äôs also Chi-squared tests and exact tests.</li>
  <li>We‚Äôll leave the discussions for comparing groups of data for binary
and count data until covering glms in the regression class.</li>
  <li>In addition, Mathematical Biostatistics Boot Camp 2 covers many special
cases relevant to biostatistics.</li>
</ul>

<h3 id="summary-agents">Summary Agents</h3>

<ul>
  <li>
    <p>t intervals arise due to lack of population $\sigma$</p>
  </li>
  <li>
    <p>T intervals can be obtained from <code class="language-plaintext highlighter-rouge">t.test()</code>, no need to memorize any
insane formulas!</p>
  </li>
  <li>
    <p>T intervals can be grouped (takes difference) or ungrouped</p>
  </li>
  <li>
    <p>T intervals also are split based on the assumption that the
variances of the two ungrouped groups are equal or not!</p>

    <ul>
      <li>Variance is assumed to be equal when the sample is randomized!!!
What ever that is supposed to mean!</li>
    </ul>
  </li>
</ul>

<h2 id="hypothesis-testing-c6-w3">Hypothesis testing c6-w3</h2>

<ul>
  <li>Hypothesis testing is concerned with making decisions using data</li>
  <li>A null hypothesis is specified that represents the status quo,
usually labeled $H_0$</li>
  <li>The null hypothesis is assumed true and statistical evidence is required
to reject it in favor of a research or alternative hypothesis</li>
</ul>

<hr />
<h3 id="example-16">Example</h3>
<ul>
  <li>A respiratory disturbance index of more than $30$ events / hour, say, is 
considered evidence of severe sleep disordered breathing (SDB).</li>
  <li>Suppose that in a sample of $100$ overweight subjects with other
risk factors for sleep disordered breathing at a sleep clinic, the
mean RDI was $32$ events / hour with a standard deviation of $10$ events / hour.</li>
  <li>We might want to test the hypothesis that
    <ul>
      <li>$H_0 : \mu = 30$</li>
      <li>$H_a : \mu &gt; 30$</li>
      <li><strong>where $\mu$ is the population mean RDI.</strong></li>
    </ul>
  </li>
  <li>
    <p>Disease : &gt; 30 events/hr</p>
  </li>
  <li>
    <p>Overweight sample n=100</p>
  </li>
  <li>
    <p>Mu_sample = 32 events/hr</p>
  </li>
  <li>Sigma_sample = 10 events/hr</li>
</ul>

<hr />
<h3 id="hypothesis-testing">Hypothesis testing</h3>
<ul>
  <li>The alternative hypotheses are typically of the form $&lt;$, $&gt;$ or $\neq$</li>
  <li>Note that there are four possible outcomes of our statistical decision process</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Truth</th>
      <th>Decide</th>
      <th>Result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>$H_0$</td>
      <td>$H_0$</td>
      <td>Correctly accept null</td>
    </tr>
    <tr>
      <td>$H_0$</td>
      <td>$H_a$</td>
      <td>Type I error</td>
    </tr>
    <tr>
      <td>$H_a$</td>
      <td>$H_a$</td>
      <td>Correctly reject null</td>
    </tr>
    <tr>
      <td>$H_a$</td>
      <td>$H_0$</td>
      <td>Type II error</td>
    </tr>
  </tbody>
</table>

<hr />
<h3 id="discussion">Discussion</h3>
<ul>
  <li>Consider a court of law; the null hypothesis is that the
defendant is innocent</li>
  <li>We require a standard on the available evidence to reject the null hypothesis (convict)</li>
  <li>If we set a low standard, then we would increase the
percentage of innocent people convicted (type I errors); however we
would also increase the percentage of guilty people convicted
(correctly rejecting the null)</li>
  <li>
    <p>If we set a high standard, then we increase the the
percentage of innocent people let free (correctly accepting the
null) while we would also increase the percentage of guilty people
let free (type II errors)</p>
  </li>
  <li>
    <p><strong>H0:</strong> Defendant is innocent; Person does not have Disease</p>
  </li>
  <li>
    <p><strong>Ha:</strong> Defendant is guilty; Person has Disease</p>
  </li>
  <li>
    <p>if we make <strong>type 1 error</strong> by having a convicting everyone 90%
close to the murder scene, then we reject H0, i.e.,we would increase
the percentage of innocent people convicted and we would also
increase the percentage of guilty people convicted</p>
  </li>
  <li>if we make <strong>type 2 error</strong>, vice versa!</li>
</ul>

<p><strong>In the case of diseases</strong></p>

<ul>
  <li>
    <p>If we make a type 1 error, then we wrongly accuse people of having
disease and we rightly accuse people of having disease</p>
  </li>
  <li>
    <p>and Vice Versa!</p>
  </li>
</ul>

<p>So we need to set some limit to minimize the type 1 error i.e.,
wrong accusation of people as having disease when they actually don‚Äôt.</p>

<hr />

<h3 id="the-rejection-constant-c">The Rejection constant C</h3>
<ul>
  <li>Consider our sleep example again</li>
  <li>A reasonable strategy would reject the null hypothesis if
$\bar X$ was larger than some constant, say $C$</li>
  <li>Typically, $C$ is chosen so that the probability of a Type I
error, $\alpha$, is $.05$ (or some other relevant constant)</li>
  <li>
    <p>$\alpha$ = Type I error rate = Probability of rejecting the null
hypothesis when, in fact, the null hypothesis is correct</p>
  </li>
  <li>So if in a random sample we have $\bar X$ to be &gt;95th percentile</li>
</ul>

<hr />
<h3 id="rejection-based-on-c-example">Rejection based on C Example!</h3>

<ul>
  <li>
    <p>Standard error of the mean $10 / \sqrt{100} = 1$</p>
  </li>
  <li>
    <p><strong>Under $H_0$</strong> $\bar X \sim N(30, 1)$</p>
  </li>
</ul>

<p><em>How we are justified in using the std deviation of 1, I am not clear!
Take this into class and identify exactly what you do not understand!</em></p>

<ul>
  <li>We want to chose $C$ so that the $P(\bar X &gt; C; H_0)$ is 
5%</li>
  <li>
    <p>The 95th percentile of a normal distribution is 1.645
standard deviations from the mean</p>
  </li>
  <li>If $C = 30 + 1 \times 1.645 = 31.645$
    <ul>
      <li>Then the probability that a $N(30, 1)$ is larger
than it is 5%</li>
      <li>So the rule ‚ÄúReject $H_0$ when $\bar X \geq 31.645$‚Äù
has the property that the probability of rejection
is 5% when $H_0$ is true (for the $\mu_0$, $\sigma$
and $n$ given)</li>
    </ul>
  </li>
</ul>

<p><strong>- So we want to identify if H0 shall be rejected.</strong></p>

<p><strong>- We take a normal distribution of sample means, based on H0 and see
where the sample mean lies (within C or outside C!</strong></p>

<hr />
<h3 id="discussion-1">Discussion</h3>
<ul>
  <li>In general we don‚Äôt convert $C$ back to the original scale</li>
  <li>We would just reject because the Z-score; which is how many
standard errors the sample mean is above the hypothesized mean
\(\frac{32 - 30}{10 / \sqrt{100}} = 2\)
is greater than $1.645$</li>
  <li>Or, whenever $ (\bar X - \mu_0) / (s/\sqrt{n}) &gt; Z_{1-\alpha}$</li>
</ul>

<hr />
<h3 id="summary-1-general-rules">Summary 1: General rules</h3>

<ul>
  <li>The $Z$ test for $H_0:\mu = \mu_0$ versus
    <ul>
      <li>$H_1: \mu &lt; \mu_0$</li>
      <li>$H_2: \mu \neq \mu_0$</li>
      <li>$H_3: \mu &gt; \mu_0$</li>
    </ul>
  </li>
  <li>Test statistic $ TS = \frac{\bar{X} - \mu_0}{S / \sqrt{n}} $</li>
  <li>Reject the null hypothesis when
    <ul>
      <li>$TS \leq Z_{\alpha} = -Z_{1 - \alpha}$</li>
      <li>
        <table>
          <tbody>
            <tr>
              <td>$</td>
              <td>TS</td>
              <td>\geq Z_{1 - \alpha / 2}$</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>$TS \geq Z_{1 - \alpha}$</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="failing-to-reject-h0-and-not-accepting-h0">Failing to reject H0 and not, accepting H0!</h3>

<ul>
  <li><strong>We have fixed $\alpha$ to be low, so if we reject $H_0$ (either
our model is wrong) or there is a low probability that we have made
an error</strong></li>
  <li><strong>We have not fixed the probability of a type II error, $\beta$;
therefore we tend to say ``Fail to reject $H_0$‚Äô‚Äô rather than
accepting $H_0$</strong></li>
  <li>Statistical significance is not the same as scientific
significance</li>
  <li>The region of TS values for which you reject $H_0$ is called the
rejection region</li>
</ul>

<hr />
<h3 id="when-to-apply-z-and-when-to-apply-t-test-agents">When to apply Z and when to apply T test! Agents!</h3>

<p>From <a href="https://youtu.be/Uv6nGIgZMVw?t=108">jbStatisctics‚Äôs explanation</a>:</p>

<ul>
  <li>Z statistic is used when $\sigma$ is known. As a result we have a
normal distribution,</li>
</ul>

\[Z = (\bar{X} - \mu) / (**\sigma** / sqrt(n))\]

<ul>
  <li>t statistic is used when $\sigma$ is not known. We use SE and so
have t statistic with n-1 dofs!</li>
</ul>

<p>\(t = (\bar{X} - \mu) / (**SE**     / sqrt(n))\)  has a t
distribution with n-1 dofs!</p>

<ul>
  <li>95% confidence intervals are obtained by:</li>
</ul>

<p>Z ‚Äì&gt; \(\bar{X} +-       1.96  \sigma / sqrt(n)\)</p>

<p>T ‚Äì&gt; \(\bar{X} +- qt(0.95,n-1) SE    / sqrt(n)\)</p>

<ul>
  <li><strong>The $Z$ test requires the assumptions of the CLT and for $n$ to be large enough
for it to apply</strong></li>
  <li><strong>If $n$ is small, then a Gossett‚Äôs $T$ test is performed exactly in the same way,
with the normal quantiles replaced by the appropriate Student‚Äôs $T$ quantiles and
$n-1$ df</strong></li>
  <li>The probability of rejecting the null hypothesis when it is false is called <em>power</em></li>
  <li>Power is a used a lot to calculate sample sizes for experiments</li>
</ul>

<hr />
<h3 id="example-with-n16-and-using-t-statistic">Example with n=16 and using T-statistic</h3>

<ul>
  <li>
    <p>Consider our example again. Suppose that $n= 16$ (rather than
$100$)</p>
  </li>
  <li>
    <p>The statistic
\(\frac{\bar X - 30}{s / \sqrt{16}}\)
follows a $T$ distribution with 15 df under $H_0$</p>
  </li>
</ul>

<p>-<strong>Under $H_0$, the probability that it is larger
that the 95th percentile of the $T$ distribution is 5%</strong></p>

<ul>
  <li>
    <p><strong>The 95th percentile of the T distribution with 15
df is 1.7531 (obtained via <code class="language-plaintext highlighter-rouge">qt(.95, 15)</code>)</strong></p>
  </li>
  <li>
    <p>So that our test statistic is now <strong>$\sqrt{16}(32 - 30) / 10 = 0.8
$</strong> ¬´¬†1.7531 (95% with 15 dofs)</p>
  </li>
  <li>
    <p>We now <strong>fail to reject.</strong></p>
  </li>
</ul>

<hr />
<h3 id="two-sided-tests">Two sided tests</h3>

<p><strong>Not 95% anymore. It will become 97.5%; Just pay attention when you
encounter such a problem.</strong></p>

<ul>
  <li>Suppose that we would reject the null hypothesis if in fact the  mean was too large or too small</li>
  <li>That is, we want to test the alternative $H_a : \mu \neq 30$</li>
  <li>We will reject if the test statistic, $0.8$, is either too large or too small</li>
  <li>Then we want the probability of rejecting under the
null to be 5%, split equally as 2.5% in the upper
tail and 2.5% in the lower tail</li>
  <li>Thus we reject if our test statistic is larger
than <code class="language-plaintext highlighter-rouge">qt(.975, 15)</code> or smaller than <code class="language-plaintext highlighter-rouge">qt(.025, 15)</code>
    <ul>
      <li>This is the same as saying: reject if the
absolute value of our statistic is larger than
<code class="language-plaintext highlighter-rouge">qt(0.975, 15)</code> = 2.1314</li>
      <li>So we fail to reject the two sided test as well</li>
      <li>(If you fail to reject the one sided test, you
know that you will fail to reject the two sided)</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="t-test-in-r">T test in R</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">);</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">father.son</span><span class="p">)</span><span class="w">
</span><span class="n">t.test</span><span class="p">(</span><span class="n">father.son</span><span class="o">$</span><span class="n">sheight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">father.son</span><span class="o">$</span><span class="n">fheight</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; 
&gt; 	One Sample t-test
&gt; 
&gt; data:  father.son$sheight - father.son$fheight
&gt; t = 11.79, df = 1077, p-value &lt; 2.2e-16
&gt; alternative hypothesis: true mean is not equal to 0
&gt; 95 percent confidence interval:
&gt;  0.831 1.163
&gt; sample estimates:
&gt; mean of x 
&gt;     0.997
</code></pre></div></div>

<hr />
<h3 id="connections-with-confidence-intervals-important">Connections with confidence intervals (Important)</h3>

<ul>
  <li>Consider testing $H_0: \mu = \mu_0$ versus $H_a: \mu \neq \mu_0$</li>
  <li>Take the set of all possible values for which you fail to reject $H_0$, this set is a $(1-\alpha)100\%$ confidence interval for $\mu$</li>
  <li>The same works in reverse; if a $(1-\alpha)100\%$ interval
contains $\mu_0$, then we <em>fail  to</em> reject $H_0$</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">);</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">father.son</span><span class="p">)</span><span class="w">
</span><span class="n">t.test</span><span class="p">(</span><span class="n">father.son</span><span class="o">$</span><span class="n">sheight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">father.son</span><span class="o">$</span><span class="n">fheight</span><span class="p">)</span><span class="w">
</span><span class="n">qt</span><span class="p">(</span><span class="m">0.975</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">father.son</span><span class="o">$</span><span class="n">sheight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">father.son</span><span class="o">$</span><span class="n">fheight</span><span class="p">)</span><span class="m">-1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; 
&gt; 	One Sample t-test
&gt; 
&gt; data:  father.son$sheight - father.son$fheight
&gt; t = 11.79, df = 1077, p-value &lt; 2.2e-16
&gt; alternative hypothesis: true mean is not equal to 0
&gt; 95 percent confidence interval:
&gt;  0.831 1.163
&gt; sample estimates:
&gt; mean of x 
&gt;     0.997

&gt; 1.962
</code></pre></div></div>
<p><strong>H0</strong>: Mu = 0 (no difference in heights)</p>

<p><strong>H_$\alpha$</strong> : Mu != 0 (two sided alternate hypothesis)</p>

<p>t statistic for 95% confidence = 1.962 for 97.5 percentile;</p>

<p>t statistic for mu.sample=0.99 is, 11.78 =&gt; ~100 percentile; This
implies there is a 0% chance that 11.78 will occur, which leads us to
think that the null hypothesis is BS!</p>

<p>So we reject the null hypothesis that it is a normal distribution
about 0. BS!</p>

<p><strong>If the t statistic lied below the 95th t percentile, then H0 is failed
to be rejected,</strong> <a href="https://youtu.be/pGv13jvnjKc?t=548">as shown here in jbstatistics video</a>.</p>

<p>The beauti is that we can also see if we reject the null hypothesis
with the confidence interval (0.83 and 1.16). 0 is not in the 95%
confidence interval, so, REJECT H0.</p>

<hr />
<h3 id="two-group-intervals">Two group intervals</h3>
<ul>
  <li>First, now you know how to do two group T tests
since we already covered indepedent group T intervals</li>
  <li>Rejection rules are the same</li>
  <li>Test $H_0 : \mu_1 = \mu_2$</li>
  <li>Let‚Äôs just go through an example</li>
</ul>

<hr />
<h3 id="chickweight-data"><code class="language-plaintext highlighter-rouge">chickWeight</code> data</h3>
<p>Recall that we reformatted this data</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">datasets</span><span class="p">);</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">ChickWeight</span><span class="p">);</span><span class="w"> </span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="c1">##define weight gain or loss</span><span class="w">
</span><span class="n">wideCW</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dcast</span><span class="p">(</span><span class="n">ChickWeight</span><span class="p">,</span><span class="w"> </span><span class="n">Diet</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Chick</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">value.var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"weight"</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">wideCW</span><span class="p">)[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="m">2</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"time"</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">wideCW</span><span class="p">)[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="m">2</span><span class="p">)],</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">wideCW</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">wideCW</span><span class="p">,</span><span class="w">
  </span><span class="n">gain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time21</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time0</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />
<h4 id="unequal-variance-t-test-comparing-diets-1-and-4">Unequal variance T test comparing diets 1 and 4</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wideCW14</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">wideCW</span><span class="p">,</span><span class="w"> </span><span class="n">Diet</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="n">t.test</span><span class="p">(</span><span class="n">gain</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Diet</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> 
       </span><span class="n">var.equal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wideCW14</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;  
&gt;  	Two Sample t-test
&gt;  
&gt;  data:  gain by Diet
&gt;  t = -2.725, df = 23, p-value = 0.01207
&gt;  alternative hypothesis: true difference in means is not equal to 0
&gt;  95 percent confidence interval:
&gt;   -108.15  -14.81
&gt;  sample estimates:
&gt;  mean in group 1 mean in group 4 
&gt;            136.2           197.7
</code></pre></div></div>

<p>We reject the null hypothesis as it falls the t statistic falls
outside the 95% confidence interval!</p>

<hr />
<h3 id="exact-binomial-test">Exact binomial test</h3>
<ul>
  <li>Recall this problem, <em>Suppose a friend has $8$ children, $7$ of which are girls and none are twins</em></li>
  <li>Perform the relevant hypothesis test. $H_0 : p = 0.5$ $H_a : p &gt; 0.5$
    <ul>
      <li>What is the relevant rejection region so that the probability of rejecting is (less than) 5%?</li>
    </ul>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>Rejection region</th>
      <th>Type I error rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[0 : 8]</td>
      <td>1</td>
    </tr>
    <tr>
      <td>[1 : 8]</td>
      <td>0.9961</td>
    </tr>
    <tr>
      <td>[2 : 8]</td>
      <td>0.9648</td>
    </tr>
    <tr>
      <td>[3 : 8]</td>
      <td>0.8555</td>
    </tr>
    <tr>
      <td>[4 : 8]</td>
      <td>0.6367</td>
    </tr>
    <tr>
      <td>[5 : 8]</td>
      <td>0.3633</td>
    </tr>
    <tr>
      <td>[6 : 8]</td>
      <td>0.1445</td>
    </tr>
    <tr>
      <td>[7 : 8]</td>
      <td>0.0352</td>
    </tr>
    <tr>
      <td>[8 : 8]</td>
      <td>0.0039</td>
    </tr>
  </tbody>
</table>

<hr />
<h3 id="notes">Notes</h3>
<ul>
  <li>It‚Äôs impossible to get an exact 5% level test for this case due to the discreteness of the binomial.
    <ul>
      <li>The closest is the rejection region [7 : 8]</li>
      <li>Any alpha level lower than 0.0039 is not attainable.</li>
    </ul>
  </li>
  <li>For larger sample sizes, we could do a normal approximation, but you already knew this.</li>
  <li>Two sided test isn‚Äôt obvious.
    <ul>
      <li>Given a way to do two sided tests, we could take the set of values of $p_0$ for which we fail to reject to get an exact binomial confidence interval (called the Clopper/Pearson interval, BTW)</li>
    </ul>
  </li>
  <li>For these problems, people always create a P-value (next lecture) rather than computing the rejection region.</li>
</ul>

<h2 id="p-values-c6-w3">P-values (c6-w3)</h2>

<ul>
  <li>Most common measure of statistical significance</li>
  <li>Their ubiquity, along with concern over their interpretation and use
makes them controversial among statisticians
    <ul>
      <li><a href="http://warnercnr.colostate.edu/~anderson/thompson1.html">http://warnercnr.colostate.edu/~anderson/thompson1.html</a></li>
      <li>Also see <em>Statistical Evidence: A Likelihood Paradigm</em> by Richard Royall</li>
      <li><em>Toward Evidence-Based Medical Statistics. 1: The P Value Fallacy</em> by Steve Goodman</li>
      <li>The hilariously titled: <em>The Earth is Round (p &lt; .05)</em> by Cohen.</li>
    </ul>
  </li>
  <li>Some positive comments
    <ul>
      <li><a href="http://simplystatistics.org/2012/01/06/p-values-and-hypothesis-testing-get-a-bad-rap-but-we/">simply statistics</a></li>
      <li><a href="http://normaldeviate.wordpress.com/2013/03/14/double-misunderstandings-about-p-values/">normal deviate</a></li>
      <li><a href="http://errorstatistics.com/2013/06/14/p-values-cant-be-trusted-except-when-used-to-argue-that-p-values-cant-be-trusted/">Error statistics</a></li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="what-is-a-p-value">What is a P-value?</h3>

<p>Not using alpha, but allowing others to choose their own alpha.</p>

<p>It is the 1-CDF(test statistic value). That‚Äôs all!</p>

<hr />
<h3 id="p-values">P-values</h3>
<ul>
  <li>The P-value is the probability under the null hypothesis of
obtaining evidence as extreme or more extreme than that obtained</li>
  <li>If the P-value is small, then either $H_0$ is true and we have
observed a rare event or $H_0$ is false</li>
  <li>Suppos that you get a $T$ statistic of $2.5$ for 15 df testing
$H_0:\mu = \mu_0$ versus $H_a : \mu &gt; \mu_0$.</li>
  <li>What‚Äôs the probability of getting a $T$ statistic as large as
$2.5$?</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pt</span><span class="p">(</span><span class="m">2.5</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.01225
</code></pre></div></div>

<ul>
  <li>Therefore, the probability of seeing evidence as extreme or more extreme than that actually obtained under $H_0$ is 0.0123</li>
</ul>

<hr />
<h3 id="the-attained-significance-level">The attained significance level</h3>
<ul>
  <li>Our test statistic was $2$ for $H_0 : \mu_0  = 30$ versus $H_a:\mu &gt; 30$.</li>
  <li>Notice that we rejected the one sided test when $\alpha = 0.05$, would we reject if $\alpha = 0.01$, how about $0.001$?</li>
  <li>The smallest value for alpha that you still reject the null hypothesis is called the <em>attained significance level</em></li>
  <li>This is equivalent, but philosophically a little different from, the <em>P-value</em></li>
</ul>

<hr />
<h3 id="notes-1">Notes</h3>
<ul>
  <li>By reporting a P-value the reader can perform the hypothesis
test at whatever $\alpha$ level he or she choses</li>
  <li>If the P-value is less than $\alpha$ you reject the null hypothesis</li>
  <li>For two sided hypothesis test, double the smaller of the two one
sided hypothesis test Pvalues</li>
</ul>

<hr />
<h3 id="revisiting-an-earlier-example-star-mark-">Revisiting an earlier example (star mark) ;)</h3>

<ul>
  <li>Suppose a friend has $8$ children, $7$ of which are girls and none are twins</li>
  <li>If each gender has an independent $50$% probability for each birth, what‚Äôs the probability of getting $7$ or more girls out of $8$ births?</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">choose</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.5</span><span class="o">^</span><span class="m">8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">choose</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.5</span><span class="o">^</span><span class="m">8</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.03516
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pbinom</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.03516
</code></pre></div></div>

<hr />
<h3 id="poisson-example">Poisson example</h3>

<ul>
  <li>Suppose that a hospital has an infection rate of 10 infections per
100 person/days at risk (rate of 0.1) during the last monitoring
period.</li>
  <li>Assume that an infection rate of 0.05 is an important benchmark.</li>
  <li>Given the model, could the observed rate being larger than 0.05 be attributed to chance?</li>
  <li>Under $H_0: \lambda = 0.05$ so that $\lambda_0 100 = 5$</li>
  <li>Consider $H_a: \lambda &gt; 0.05$.</li>
</ul>

<p>JFC the writing is crazy!</p>

<p><strong>Sample:</strong> 10 infections for 100 sick people/day =&gt; rate of 0.1</p>

<p><strong>Expected, prefered rate</strong>: 5 infections for ‚Ä¶. =&gt; rate of 0.05</p>

<p><strong>H0</strong> rate = 0.05</p>

<p><strong>H_a</strong> rate &gt; 0.05</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ppois</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.03183
</code></pre></div></div>

<h2 id="quiz-c6-w3">quiz c6-w3</h2>

<ol>
  <li>
    <p>In a population of interest, a sample of 9 men yielded a sample
average brain volume of 1,100cc and a standard deviation of
30cc. What is a 95% Student‚Äôs T confidence interval for the mean
brain volume in this new population?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> mn=1100
 sp=30/3
 mn + c(1,-1) * qt(0.975,8) * sp
</code></pre></div>    </div>
  </li>
  <li>
    <p>In a population of interest, a sample of 9 men yielded a sample
average brain volume of 1,100cc and a standard deviation of
30cc. What is a 95% Student‚Äôs T confidence interval for the mean
brain volume in this new population?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 2*3/qt(0.975,8)
 2.60
</code></pre></div>    </div>
  </li>
  <li>
    <p>In an effort to improve running performance, 5 runners were either
given a protein supplement or placebo. Then, after a suitable
washout period, they were given the opposite treatment. Their mile
times were recorded under both the treatment and placebo, yielding
10 measurements with 2 per subject. The researchers intend to use a
T test and interval to investigate the treatment. Should they use a
paired or independent group T test and interval?</p>
  </li>
  <li>
    <p>In a study of emergency room waiting times, investigators consider
a new and the standard triage systems. To test the systems,
administrators selected 20 nights and randomly assigned the new
triage system to be used on 10 nights and the standard system on
the remaining 10 nights. They calculated the nightly median waiting
time (MWT) to see a physician. The average MWT for the new system
was 3 hours with a variance of 0.60 while the average MWT for the
old system was 5 hours with a variance of 0.68. Consider the 95%
confidence interval estimate for the differences of the mean MWT
associated with the new system. Assume a constant variance. What is
the interval? Subtract in this order (New System - Old System).</p>

    <p>-2.75 to -1.25</p>
  </li>
  <li>
    <p>Suppose that you create a 95% T confidence interval. You then
create a 90% interval using the same data. What can be said about
the 90% interval with respect to the 95% interval?</p>

    <p>Smaller obviously</p>
  </li>
  <li>
    <p>To further test the hospital triage system, administrators selected
200 nights and randomly assigned a new triage system to be used on
100 nights and a standard system on the remaining 100 nights. They
calculated the nightly median waiting time (MWT) to see a
physician. The average MWT for the new system was 4 hours with a
standard deviation of 0.5 hours while the average MWT for the old
system was 6 hours with a standard deviation of 2 hours. Consider
the hypothesis of a decrease in the mean MWT associated with the
new treatment.</p>

    <p>What does the 95% independent group confidence interval with
 unequal variances suggest vis a vis this hypothesis? (Because there‚Äôs
 so many observations per group, just use the Z quantile instead of the
 T.)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> n1 &lt;- n2 &lt;- 100
 xbar1 &lt;- 4
 xbar2 &lt;- 6
 s1 &lt;- 0.5
 s2 &lt;- 2
 xbar2 - xbar1 + c(-1, 1) * qnorm(0.975) * sqrt(s1^2/n1 +
 s2^2/n2)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Suppose that 18 obese subjects were randomized, 9 each, to a new
diet pill and a placebo. Subjects‚Äô body mass indices (BMIs) were
measured at a baseline and again after having received the
treatment or placebo for four weeks. The average difference from
follow-up to the baseline (followup - baseline) was ‚àí3 kg/m2 for
the treated group and 1 kg/m2 for the placebo group. The
corresponding standard deviations of the differences was 1.5 kg/m2
for the treatment group and 1.8 kg/m2 for the placebo group. Does
the change in BMI over the four week period appear to differ
between the treated and placebo groups? Assuming normality of the
underlying data and a common population variance, calculate the
relevant <em>90%</em> t confidence interval. Subtract in the order of
(Treated - Placebo) with the smaller (more negative) number first.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> n1 &lt;- n2 &lt;- 9
 x1 &lt;- -3 ##treated
 x2 &lt;- 1 ##placebo
 s1 &lt;- 1.5 ##treated
 s2 &lt;- 1.8 ##placebo
 s &lt;- sqrt(((n1 - 1) * s1^2 + (n2 - 1) * s2^2)/(n1 + n2 - 2))
 (x1 - x2) + c(-1, 1) * qt(0.95, n1 + n2 - 2) * s * sqrt(1/n1 + 1/n2) ## Power (c6-w4)
</code></pre></div>    </div>
  </li>
</ol>

<p>-<strong>Power is the probability of rejecting the null hypothesis when it is false</strong></p>
<ul>
  <li>Ergo, power (as its name would suggest) is a good thing; you want more power</li>
  <li>A type II error (a bad thing, as its name would suggest) is failing to reject the null hypothesis when it‚Äôs false; the probability of a type II error is usually called $\beta$</li>
  <li>Note Power  $= 1 - \beta$</li>
</ul>

<p><strong>H_a</strong> is true but you decide <strong>H0</strong>; for example, mu&gt;30 but you
decide mu=30.</p>

<hr />

<h3 id="khan-academy-notes">Khan academy notes</h3>

<p>https://www.khanacademy.org/math/ap-statistics/tests-significance-ap/error-probabilities-power/v/introduction-to-power-in-significance-tests</p>

<table>
  <thead>
    <tr>
      <th>¬†</th>
      <th>H0 true</th>
      <th>H0 False</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Reject H0</td>
      <td>Type I error</td>
      <td>Correct (POWER)</td>
    </tr>
    <tr>
      <td>Failing to reject H0</td>
      <td>Correct</td>
      <td>Type II error</td>
    </tr>
  </tbody>
</table>

<p>H0: mu=30</p>

<p>Ha: mu&gt;30</p>

<p><strong>Type I error:</strong> when mu=30 but you reject H0.</p>

<p><strong>Type II error:</strong> When mu!=30 but you fail to reject the H0.</p>

<p>Imagine you take a random sample of n=100 from the population with
sigma = 4</p>

<p><strong>Under H0</strong>, N(30,4) you check where mu=mu.sample is?</p>

<p>If mu=mu.sample lies outside of 95% values, then you reject H0; This
<strong>5% is alpha</strong>.</p>

<p>If mu=mu.sample lies within 95% values, then you fail to reject H0.</p>

<p>i.e., there is a 95% chance that you will be right (fail to reject
H0|under H0)</p>

<p>or there is a 5% chance that you are wrong (reject H0 | under H0)
<strong>Type I error</strong></p>

<p><strong>Under !H0</strong>,   N(say 35,4),  you check for where mu=mu.sample is?</p>

<p>if mu.sample lies to the left of Z_alpha quantile, then you fail to
reject H0 <strong>(Type II error)</strong></p>

<p>if mu.sample lies to the right of Z_alpha quantile, then you reject H0
happily <strong>(POWER)</strong></p>

<h3 id="power-increase-when">Power increase when?</h3>

<p><strong>alpha</strong> ^ Power ^ And also Type I error ^</p>

<p><strong>n</strong> ^ Power ^</p>

<p><strong>Less variability</strong> ^ Power ^</p>

<p><strong>Mu</strong> far from null hypotheses the Power ^</p>

<hr />
<h3 id="example-continued-2">Example continued</h3>
<ul>
  <li>$\mu_a = 32$, $\mu_0 = 30$, $n =16$, $\sigma = 4$</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mu0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">;</span><span class="w"> </span><span class="n">mua</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">32</span><span class="p">;</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="w">
</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>You get alpha from the below:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pnorm</span><span class="p">(</span><span class="n">mu0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> 
      </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>You get Power from the below:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pnorm</span><span class="p">(</span><span class="n">mu0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mua</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> 
      </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="graphical-depiction-of-power">Graphical Depiction of Power</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">manipulate</span><span class="p">)</span><span class="w">
</span><span class="n">mu0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w">
</span><span class="n">myplot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">mua</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">){</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">27</span><span class="p">,</span><span class="w"> </span><span class="m">36</span><span class="p">)),</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="p">))</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">stat_function</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="n">dnorm</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"line"</span><span class="p">,</span><span class="w"> 
                          </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span><span class="w"> 
                          </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">stat_function</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="n">dnorm</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"line"</span><span class="p">,</span><span class="w"> 
                          </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mua</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span><span class="w"> 
                          </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
    </span><span class="n">xitc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">xitc</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
    </span><span class="n">g</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">manipulate</span><span class="p">(</span><span class="w">
    </span><span class="n">myplot</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">mua</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">),</span><span class="w">
    </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slider</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w">
    </span><span class="n">mua</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slider</span><span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="m">35</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">32</span><span class="p">),</span><span class="w">
    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slider</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">),</span><span class="w">
    </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slider</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<hr />
<h3 id="question-2">Question</h3>
<ul>
  <li>When testing $H_a : \mu &gt; \mu_0$, notice if power is $1 - \beta$, then 
\(1 - \beta = P\left(\bar X &gt; \mu_0 + z_{1-\alpha} \frac{\sigma}{\sqrt{n}} ; \mu = \mu_a \right)\)</li>
  <li>where $\bar X \sim N(\mu_a, \sigma^2 / n)$</li>
  <li><strong>Unknowns: $\mu_a$, $\sigma$, $n$, $\beta$</strong></li>
  <li><strong>Knowns: $\mu_0$, $\alpha$</strong></li>
  <li><strong>Specify any 3 of the unknowns and you can solve for the remainder</strong></li>
</ul>

<hr />
<h3 id="notes-2">Notes</h3>

<ul>
  <li>
    <p>Power doesn‚Äôt need <strong>$\mu_a$, $\sigma$ and $n$</strong>, instead only
 <strong>$\frac{\sqrt{n}(\mu_a - \mu_0)}{\sigma}$</strong></p>

    <ul>
      <li>The quantity <strong>$\frac{\mu_a - \mu_0}{\sigma}$</strong> is called the <strong>effect
size</strong></li>
    </ul>
  </li>
  <li><strong>Unknowns: $\mu_a$, $\sigma$, $n$, $\beta$</strong></li>
  <li><strong>Knowns: $\mu_0$, $\alpha$</strong></li>
  <li><strong>Specify any 3 of the unknowns and you can solve for the
remainder</strong></li>
</ul>

<hr />
<h3 id="t-test-power">T-test power</h3>
<ul>
  <li>Consider calculating power for a Gossett‚Äôs $T$ test for our example</li>
  <li>The power is
  \(P\left(\frac{\bar X - \mu_0}{S /\sqrt{n}} &gt; t_{1-\alpha, n-1} ~;~ \mu = \mu_a \right)\)</li>
  <li><strong>Calcuting this requires the non-central t distribution.</strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">power.t.test</code> does this very well</strong>
    <ul>
      <li>Omit one of the arguments and it solves for it</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="example-17">Example</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">power.t.test</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sample"</span><span class="p">,</span><span class="w">  </span><span class="n">alt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sided"</span><span class="p">)</span><span class="o">$</span><span class="n">power</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.604
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">power.t.test</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sample"</span><span class="p">,</span><span class="w">  </span><span class="n">alt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sided"</span><span class="p">)</span><span class="o">$</span><span class="n">power</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.604
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">power.t.test</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sample"</span><span class="p">,</span><span class="w"> </span><span class="n">alt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sided"</span><span class="p">)</span><span class="o">$</span><span class="n">power</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.604
</code></pre></div></div>

<hr />
<h3 id="example-18">Example</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">power.t.test</span><span class="p">(</span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.8</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sample"</span><span class="p">,</span><span class="w">  </span><span class="n">alt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sided"</span><span class="p">)</span><span class="o">$</span><span class="n">n</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 26.14
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">power.t.test</span><span class="p">(</span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.8</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sample"</span><span class="p">,</span><span class="w">  </span><span class="n">alt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sided"</span><span class="p">)</span><span class="o">$</span><span class="n">n</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 26.14
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">power.t.test</span><span class="p">(</span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.8</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sample"</span><span class="p">,</span><span class="w"> </span><span class="n">alt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"one.sided"</span><span class="p">)</span><span class="o">$</span><span class="n">n</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 26.14
</code></pre></div></div>
<h2 id="key-ideas-multiple-testing-c6-w4">Key ideas Multiple testing C6-w4</h2>

<ul>
  <li>Hypothesis testing/significance analysis is commonly overused</li>
  <li>Correcting for multiple testing avoids false positives or discoveries</li>
  <li>Two key components
    <ul>
      <li>Error measure</li>
      <li>Correction</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="three-eras-of-statistics">Three eras of statistics</h3>

<p><strong>The age of Quetelet and his successors, in which huge census-level
data sets were brought to bear on simple but important questions</strong>:
Are there more male than female births? Is the rate of insanity
rising?</p>

<p>The classical period of Pearson, Fisher, Neyman, Hotelling, and their
successors, intellectual giants who <strong>developed a theory of optimal
inference capable of wringing every drop of information out of a
scientific experiment</strong>. The questions dealt with still tended to be
simple Is treatment A better than treatment B?</p>

<p><strong>The era of scientific mass production</strong>, in which new technologies
typified by the microarray allow a single team of scientists to
produce data sets of a size Quetelet would envy. But now the flood of
data is accompanied by a deluge of questions, perhaps thousands of
estimates or hypothesis tests that the statistician is charged with
answering together; not at all what the classical masters had in
mind. Which variables matter among the thousands measured? How do you
relate unrelated information?</p>

<p><a href="http://www-stat.stanford.edu/~ckirby/brad/papers/2010LSIexcerpt.pdf">http://www-stat.stanford.edu/~ckirby/brad/papers/2010LSIexcerpt.pdf</a></p>

<p><a href="http://xkcd.com/882/">http://xkcd.com/882/</a> I don‚Äôt get this!</p>

<hr />

<h3 id="types-of-errors">Types of errors</h3>

<p>Suppose you are testing a hypothesis that a parameter $\beta$ equals zero versus the alternative that it does not equal zero. These are the possible outcomes. 
&lt;/br&gt;&lt;/br&gt;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                | $\beta=0$   | $\beta\neq0$   |  Hypotheses --------------------|-------------|----------------|--------- Claim $\beta=0$     |      $U$    |      $T$       |  $m-R$ Claim $\beta\neq 0$ |      $V$    |      $S$       |  $R$
Claims          |     $m_0$   |      $m-m_0$   |  $m$
</code></pre></div></div>

<p>&lt;/br&gt;&lt;/br&gt;</p>

<p><strong>Type I error or false positive ($V$)</strong> Say that the parameter does not equal zero when it does</p>

<p><strong>Type II error or false negative ($T$)</strong> Say that the parameter equals zero when it doesn‚Äôt</p>

<hr />

<h3 id="error-rates">Error rates</h3>

<p><strong>False positive rate</strong> - The rate at which false results ($\beta = 0$) are called significant: $E\left[\frac{V}{m_0}\right]$*</p>

<p><strong>Family wise error rate (FWER)</strong> - The probability of at least one false positive ${\rm Pr}(V \geq 1)$</p>

<p><strong>False discovery rate (FDR)</strong> - The rate at which claims of significance are false $E\left[\frac{V}{R}\right]$</p>

<ul>
  <li>The false positive rate is closely related to the type I error rate <a href="http://en.wikipedia.org/wiki/False_positive_rate">http://en.wikipedia.org/wiki/False_positive_rate</a></li>
</ul>

<hr />

<h3 id="controlling-the-false-positive-rate-fpr">Controlling the false positive rate <strong>FPR</strong></h3>

<p>If P-values are correctly calculated calling all $P &lt; \alpha$ significant will control the false positive rate at level $\alpha$ on average.</p>

<redtext>Problem</redtext>
<p>: Suppose that you perform 10,000 tests and $\beta = 0$ for all of them.</p>

<p>Suppose that you call all $P &lt; 0.05$ significant.</p>

<p>The expected number of false positives is: $10,000 \times 0.05 = 500$  false positives.</p>

<p><strong>How do we avoid so many false positives?</strong> reduce alpha!</p>

<hr />

<h3 id="controlling-family-wise-error-rate-fwer">Controlling family-wise error rate (FWER)</h3>

<p>The <a href="http://en.wikipedia.org/wiki/Bonferroni_correction">Bonferroni correction</a> is the oldest multiple testing correction.</p>

<p><strong>Basic idea</strong>:</p>
<ul>
  <li>Suppose you do $m$ tests</li>
  <li>You want to control FWER at level $\alpha$ so $Pr(V \geq 1) &lt; \alpha$</li>
  <li>Calculate P-values normally</li>
  <li>Set $\alpha_{fwer} = \alpha/m$</li>
  <li>Call all $P$-values less than $\alpha_{fwer}$ significant</li>
</ul>

<p><strong>Pros</strong>: Easy to calculate, conservative
<strong>Cons</strong>: May be very conservative</p>

<hr />

<h3 id="controlling-false-discovery-rate-fdr">Controlling false discovery rate (FDR)</h3>

<p>This is the most popular correction when performing <em>lots</em> of tests say in genomics, imaging, astronomy, or other signal-processing disciplines.</p>

<p><strong>Basic idea</strong>:</p>
<ul>
  <li>Suppose you do $m$ tests</li>
  <li>You want to control FDR at level $\alpha$ so $E\left[\frac{V}{R}\right]$</li>
  <li>Calculate P-values normally</li>
  <li>Order the P-values from smallest to largest $P_{(1)},‚Ä¶,P_{(m)}$</li>
  <li>Call any $P_{(i)} \leq \alpha \times \frac{i}{m}$ significant</li>
</ul>

<p><strong>Pros</strong>: Still pretty easy to calculate, less conservative (maybe much less)</p>

<p><strong>Cons</strong>: Allows for more false positives, may behave strangely under dependence</p>

<hr />

<h3 id="example-with-10-p-values">Example with 10 P-values</h3>

<p>&lt;img class=center src=fig/example10pvals.png height=450&gt;</p>

<p>Controlling all error rates at $\alpha = 0.20$</p>

<p>Controlling FDR results in a line.</p>

<p>Controlling FWER resutls in a very conservative cutoff</p>

<p><img src="./images/p-values.png" alt="p-values cut off" /></p>

<hr />

<h3 id="adjusted-p-values">Adjusted P-values</h3>

<ul>
  <li>One approach is to adjust the threshold $\alpha$</li>
  <li>A different approach is to calculate ‚Äúadjusted p-values‚Äù</li>
  <li>They <em>are not p-values</em> anymore</li>
  <li>But they can be used directly without adjusting $\alpha$</li>
</ul>

<p><strong>Example</strong>:</p>
<ul>
  <li>Suppose P-values are $P_1,\ldots,P_m$</li>
  <li>You could adjust them by taking $P_i^{fwer} = \max{m \times P_i,1}$ for each P-value.</li>
  <li>Then if you call all $P_i^{fwer} &lt; \alpha$ significant you will control the FWER.</li>
</ul>

<hr />

<h3 id="case-study-i-no-true-positives">Case study I: no true positives</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1010093</span><span class="p">)</span><span class="w">
</span><span class="n">pValues</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">)</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">)</span><span class="w">
    </span><span class="n">pValues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Controls false positive rate</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">pValues</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 51
</code></pre></div></div>

<hr />

<h3 id="case-study-i-no-true-positives-1">Case study I: no true positives</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Controls FWER</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">p.adjust</span><span class="p">(</span><span class="n">pValues</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bonferroni"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Controls FDR</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">p.adjust</span><span class="p">(</span><span class="n">pValues</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BH"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0
</code></pre></div></div>

<hr />

<h3 id="case-study-ii-50-true-positives">Case study II: 50% true positives</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1010093</span><span class="p">)</span><span class="w">
</span><span class="n">pValues</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">)</span><span class="w">
    </span><span class="c1"># First 500 beta=0, last 500 beta=2</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">500</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="n">pValues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">trueStatus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"zero"</span><span class="p">,</span><span class="w"> </span><span class="s2">"not zero"</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">pValues</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">trueStatus</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##        trueStatus
##         not zero zero
##   FALSE        0  476
##   TRUE       500   24
</code></pre></div></div>

<hr />

<h3 id="case-study-ii-50-true-positives-1">Case study II: 50% true positives</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Controls FWER</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">p.adjust</span><span class="p">(</span><span class="n">pValues</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bonferroni"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">trueStatus</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##        trueStatus
##         not zero zero
##   FALSE       23  500
##   TRUE       477    0
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Controls FDR</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">p.adjust</span><span class="p">(</span><span class="n">pValues</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BH"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">trueStatus</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##        trueStatus
##         not zero zero
##   FALSE        0  487
##   TRUE       500   13
</code></pre></div></div>

<hr />

<h3 id="case-study-ii-50-true-positives-2">Case study II: 50% true positives</h3>

<p><strong>P-values versus adjusted P-values</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">pValues</span><span class="p">,</span><span class="w"> </span><span class="n">p.adjust</span><span class="p">(</span><span class="n">pValues</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bonferroni"</span><span class="p">),</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">pValues</span><span class="p">,</span><span class="w"> </span><span class="n">p.adjust</span><span class="p">(</span><span class="n">pValues</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BH"</span><span class="p">),</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>For Bonferroni it is mostly 1 and for BH it increases with p-values!</p>

<hr />

<h3 id="notes-and-resources">Notes and resources</h3>

<p><strong>Notes</strong>:</p>
<ul>
  <li>Multiple testing is an entire subfield</li>
  <li>A basic Bonferroni/BH correction is usually enough</li>
  <li>If there is strong dependence between tests there may be problems
    <ul>
      <li>Consider method=‚ÄùBY‚Äù</li>
    </ul>
  </li>
</ul>

<p><strong>Further resources</strong>:</p>
<ul>
  <li><a href="http://www.amazon.com/Multiple-Procedures-Applications-Genomics-Statistics/dp/0387493166/ref=sr_1_2/102-3292576-129059?ie=UTF8&amp;s=books&amp;qid=1187394873&amp;sr=1-2">Multiple testing procedures with applications to genomics</a></li>
  <li><a href="http://www.pnas.org/content/100/16/9440.full">Statistical significance for genome-wide studies</a></li>
  <li><a href="http://ies.ed.gov/ncee/pubs/20084018/app_b.asp">Introduction to multiple testing</a>
    <h2 id="resampling-bootstrap-and-permutations-c6-w4">resampling: bootstrap and permutations c6-w4</h2>
  </li>
</ul>

<blockquote>
  <p>Both are popular and useful, but primarily for different uses. The
permutation test is best for testing hypotheses and bootstrapping is
best for estimating confidence intervals.</p>
</blockquote>

<p>Also look at this</p>

<blockquote>
  <p>If you are using R, then they are all easy to implement. See, for
instance,
http://www.burns-stat.com/pages/Tutor/bootstrap_resampling.html</p>
</blockquote>

<ul>
  <li>The bootstrap is a tremendously useful tool for constructing
confidence intervals and calculating standard errors for difficult
statistics</li>
  <li>For example, how would one derive a confidence interval for the median?</li>
  <li>The bootstrap procedure follows from the so called bootstrap
principle</li>
</ul>

<hr />
<h3 id="obtain-10k-datasets-from-the-same-dataset">Obtain 10k datasets from the same dataset!</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">(</span><span class="n">father.son</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">father.son</span><span class="o">$</span><span class="n">sheight</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">B</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="n">resamples</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w">
                           </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w">
                           </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
                    </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="n">resampledMedians</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">resamples</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Plot of sample distribution of the medians</p>

<hr />

<h3 id="the-bootstrap-principle">The bootstrap principle</h3>

<ul>
  <li>Suppose that I have a statistic that estimates some population
parameter, but I don‚Äôt know its sampling distribution</li>
  <li><strong>The bootstrap principle suggests using the distribution defined by
the data to approximate its sampling distribution</strong></li>
</ul>

<hr />

<h3 id="nonparametric-bootstrap-algorithm-example">Nonparametric bootstrap algorithm example</h3>

<ul>
  <li>
    <p><strong>Bootstrap procedure for calculating confidence interval for the
median from a data set of $n$ observations</strong></p>

    <p>i. Sample $n$ observations <strong>with replacement</strong> from the observed
data resulting in one simulated complete data set</p>

    <p>ii. Take the median of the simulated data set</p>

    <p>iii. Repeat these two steps $B$ times, resulting in $B$ simulated
medians</p>

    <p>iv. These medians are approximately drawn from the sampling
distribution of the median of $n$ observations; therefore we can</p>

    <ul>
      <li>Draw a histogram of them</li>
      <li>Calculate their standard deviation to estimate the standard
error of the median</li>
      <li>Take the $2.5^{th}$ and $97.5^{th}$ percentiles as a confidence
interval for the median</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="example-code">Example code</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">B</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="n">resamples</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w">
                           </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w">
                           </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
                    </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="n">medians</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">resamples</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">)</span><span class="w">
</span><span class="n">sd</span><span class="p">(</span><span class="n">medians</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0.08424
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">quantile</span><span class="p">(</span><span class="n">medians</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.025</span><span class="p">,</span><span class="w"> </span><span class="m">.975</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  2.5% 97.5% 
## 68.43 68.81
</code></pre></div></div>

<hr />
<h3 id="histogram-of-bootstrap-resamples">Histogram of bootstrap resamples</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">medians</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">medians</span><span class="p">),</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">medians</span><span class="p">))</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lightblue"</span><span class="p">,</span><span class="w"> </span><span class="n">binwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="notes-on-the-bootstrap">Notes on the bootstrap</h3>

<ul>
  <li>The bootstrap is non-parametric</li>
  <li><strong>Better percentile bootstrap confidence intervals correct for bias</strong></li>
  <li>There are lots of variations on bootstrap procedures; the book ‚ÄúAn
Introduction to the Bootstrap‚Äù‚Äù by Efron and Tibshirani is a great
place to start for both bootstrap and jackknife information</li>
</ul>

<hr />
<h3 id="group-comparisons">Group comparisons</h3>
<ul>
  <li>Consider comparing two independent groups.</li>
  <li>Example, comparing sprays B and C</li>
</ul>

<hr />
<h3 id="permutation-tests">Permutation tests</h3>
<ul>
  <li>Consider the null hypothesis that the distribution of the observations from each group is the same</li>
  <li>Then, the group labels are irrelevant</li>
  <li>Consider a data frome with count and spray</li>
  <li>Permute the spray (group) labels</li>
  <li>Recalculate the statistic
    <ul>
      <li>Mean difference in counts</li>
      <li>Geometric means</li>
      <li>T statistic</li>
    </ul>
  </li>
  <li>Calculate the percentage of simulations where
the simulated statistic was more extreme (toward
the alternative) than the observed</li>
</ul>

<hr />
<h3 id="variations-on-permutation-testing-apparently-too-much-info">Variations on permutation testing (apparently too much info)</h3>

<table>
  <thead>
    <tr>
      <th>Data type</th>
      <th>Statistic</th>
      <th>Test name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Ranks</td>
      <td>rank sum</td>
      <td>rank sum test</td>
    </tr>
    <tr>
      <td>Binary</td>
      <td>hypergeometric prob</td>
      <td>Fisher‚Äôs exact test</td>
    </tr>
    <tr>
      <td>Raw data</td>
      <td>¬†</td>
      <td>ordinary permutation test</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Also, so-called <em>randomization tests</em> are exactly permutation tests, with a different motivation.</li>
  <li>For matched data, one can randomize the signs
    <ul>
      <li>For ranks, this results in the signed rank test</li>
    </ul>
  </li>
  <li>Permutation strategies work for regression as well
    <ul>
      <li>Permuting a regressor of interest</li>
    </ul>
  </li>
  <li>Permutation tests work very well in multivariate settings</li>
</ul>

<hr />
<h3 id="permutation-test-b-v-c">Permutation test B v C</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">subdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">InsectSprays</span><span class="p">[</span><span class="n">InsectSprays</span><span class="o">$</span><span class="n">spray</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"C"</span><span class="p">),]</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subdata</span><span class="o">$</span><span class="n">count</span><span class="w">
</span><span class="n">group</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">subdata</span><span class="o">$</span><span class="n">spray</span><span class="p">)</span><span class="w">
</span><span class="n">testStat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">g</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"B"</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">g</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"C"</span><span class="p">])</span><span class="w">
</span><span class="n">observedStat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">testStat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">)</span><span class="w">
</span><span class="n">permutations</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="m">10000</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">testStat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">group</span><span class="p">)))</span><span class="w">
</span><span class="n">observedStat</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 13.25
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="n">permutations</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">observedStat</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 0
</code></pre></div></div>

<hr />
<h3 id="histogram-of-permutations-b-v-c">Histogram of permutations B v C</h3>
<p><img src="assets/fig/unnamed-chunk-9.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" style="display: block; margin: auto;" /></p>

<h2 id="quiz-4-c6-w4-lot-of-deaths">Quiz 4 (c6-w4) (lot of deaths)</h2>

<ol>
  <li>
    <p>A pharmaceutical company is interested in testing a potential blood
pressure lowering medication. Their first examination considers
only subjects that received the medication at baseline then two
weeks later. The data are as follows (SBP in mmHg)</p>

    <p>Consider testing the hypothesis that there was a mean reduction in
blood pressure? Give the P-value for the associated two sided T
test.</p>

    <p>(Hint, consider that the observations are paired.)</p>

    <p>0.087</p>

    <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">bl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">140</span><span class="p">,</span><span class="w"> </span><span class="m">138</span><span class="p">,</span><span class="w"> </span><span class="m">150</span><span class="p">,</span><span class="w"> </span><span class="m">148</span><span class="p">,</span><span class="w"> </span><span class="m">135</span><span class="p">)</span><span class="w">
 </span><span class="n">fu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">132</span><span class="p">,</span><span class="w"> </span><span class="m">135</span><span class="p">,</span><span class="w"> </span><span class="m">151</span><span class="p">,</span><span class="w"> </span><span class="m">146</span><span class="p">,</span><span class="w"> </span><span class="m">130</span><span class="p">)</span><span class="w">
 </span><span class="n">t.test</span><span class="p">(</span><span class="n">fu</span><span class="p">,</span><span class="w"> </span><span class="n">bl</span><span class="p">,</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"two.sided"</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
 </span><span class="n">t.test</span><span class="p">(</span><span class="n">fu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bl</span><span class="p">,</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"two.sided"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>A sample of 9 men yielded a sample average brain volume of 1,100cc
and a standard deviation of 30cc. What is the complete set of values
of \mu_0 Œº 0 ‚Äã that a test of H_0: \mu = \mu_0 H 0 ‚Äã :Œº=Œº 0 ‚Äã would fail
to reject the null hypothesis in a two sided 5% Students t-test?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 1100 + c(-1, 1) * qt(0.975, 8) * 30/sqrt(9)
</code></pre></div>    </div>

    <p>1077 to 1123</p>
  </li>
  <li>
    <p>Researchers conducted a blind taste test of Coke versus Pepsi. Each
of four people was asked which of two blinded drinks given in
random order that they preferred. The data was such that 3 of the 4
people chose Coke. Assuming that this sample is representative,
report a P-value for a test of the hypothesis that Coke is
preferred to Pepsi using a one sided exact test.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pbinom(2, size = 4, prob = 0.5, lower.tail = FALSE)
</code></pre></div>    </div>

    <p>What the hell was the point of the 3/4???? Nothing! PNN!</p>
  </li>
  <li>
    <p>Infection rates at a hospital above 1 infection per 100 person days
at risk are believed to be too high and are used as a benchmark. A
hospital that had previously been above the benchmark recently had
10 infections over the last 1,787 person days at risk. About what
is the one sided P-value for the relevant test of whether the
hospital is <em>below</em> the standard?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ppois(10, lambda = 0.01 * 1787)
</code></pre></div>    </div>

    <p>10 is on the left!</p>
  </li>
  <li>
    <p>Suppose that 18 obese subjects were randomized, 9 each, to a new
diet pill and a placebo. Subjects‚Äô body mass indices (BMIs) were
measured at a baseline and again after having received the
treatment or placebo for four weeks. The average difference from
follow-up to the baseline (followup - baseline) was ‚àí3 kg/m2 for
the treated group and 1 kg/m2 for the placebo group. The
corresponding standard deviations of the differences was 1.5 kg/m2
for the treatment group and 1.8 kg/m2 for the placebo group. Does
the change in BMI appear to differ between the treated and placebo
groups? Assuming normality of the underlying data and a common
population variance, give a pvalue for a two sided t test.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> n1 &lt;- n2 &lt;- 9
 x1 &lt;- -3 ##treated
 x2 &lt;- 1 ##placebo
 s1 &lt;- 1.5 ##treated
 s2 &lt;- 1.8 ##placebo
 s &lt;- sqrt(((n1 - 1) * s1^2 + (n2 - 1) * s2^2)/(n1 + n2 - 2))
 ts &lt;- (x1 - x2)/(s * sqrt(1/n1 + 1/n2))
 2 * pt(ts, n1 + n2 - 2)
</code></pre></div>    </div>

    <p><strong>Double p so that you get it on both sides!</strong></p>
  </li>
  <li>
    <p>Brain volumes for 9 men yielded a 90% confidence interval of 1,077
cc to 1,123 cc. Would you reject in a two sided 5% hypothesis test
of</p>

    <p>H_0 : \mu = 1,078 H 0 ‚Äã :Œº=1,078?</p>

    <p>Ans: No, you would fail to reject. The 95% interval would be wider
 than the 90% interval. Since 1,078 is in the narrower 90% interval, it
 would also be in the wider 95% interval. Thus, in either case it‚Äôs in
 the interval and so you would fail to reject.</p>
  </li>
  <li>
    <p>Researchers would like to conduct a study of 100 100 healthy adults
to detect a four year mean brain volume loss of .01~mm^3 .01 mm 3
. Assume that the standard deviation of four year volume loss in
this population is .04~mm^3 . About what would be the
power of the study for a 5\% 5% one sided test versus a null
hypothesis of no volume loss?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pnorm(1.645 * 0.004, mean = 0.01, sd = 0.004, lower.tail = FALSE)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Researchers would like to conduct a study of n n healthy adults to
detect a four year mean brain volume loss of .01~mm^3 .01 mm 3
. Assume that the standard deviation of four year volume loss in this
population is .04~mm^3 .04 mm 3 . About what would be the value of n n
needed for 90\% 90% power of type one error rate of 5\% 5% one sided
test versus a null hypothesis of no volume loss?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> power.t.test(delta=0.01,sd=0.04,sig.level=0.05,power=0.9,type="one.sample",alt="one.sided")
	
 ceiling((4 * (qnorm(0.95) - qnorm(0.1)))^2)
</code></pre></div>    </div>
  </li>
  <li>
    <p>As you increase the type one error rate, \alpha Œ±, what happens to
power?</p>

    <p>As you require less evidence to reject, i.e. your \alpha Œ± rate
goes up, you will have larger power.</p>
    <h2 id="regression-models-c7-w1">Regression Models c7-w1</h2>
  </li>
</ol>

<h3 id="perhaps-surprisingly-this-example-is-still-relevant">(Perhaps surprisingly, this example is still relevant)</h3>

<p><a href="http://www.nature.com/ejhg/journal/v17/n8/full/ejhg20095a.html">http://www.nature.com/ejhg/journal/v17/n8/full/ejhg20095a.html</a></p>

<p><a href="http://www.wired.com/wiredscience/2009/03/predicting-height-the-victorian-approach-beats-modern-genomics/">Predicting height: the Victorian approach beats modern genomics</a></p>

<hr />
<h3 id="recent-simply-statistics-post">Recent simply statistics post</h3>
<p>(Simply Statistics is a blog by Jeff Leek, Roger Peng and 
Rafael Irizarry, who wrote this post, link on the image)</p>

<ul>
  <li><strong>‚ÄúData supports claim that if Kobe stops ball hogging the Lakers
will win more‚Äù</strong></li>
  <li>‚ÄúLinear regression suggests that an increase of 1% in % of shots taken by Kobe results in a drop of 1.16 points (+/- 0.22)  in score differential.‚Äù</li>
  <li>How was it done? Do you agree with the analysis?</li>
</ul>

<hr />
<h3 id="questions-for-this-class-too-many-labels">Questions for this class (too many labels!!!)</h3>
<ul>
  <li>Consider trying to answer the following kinds of questions:
    <ul>
      <li>To use the parents‚Äô heights to predict childrens‚Äô heights.</li>
      <li>To try to find a parsimonious, easily described mean 
relationship between parent and children‚Äôs heights.</li>
      <li>To investigate the variation in childrens‚Äô heights that appears 
unrelated to parents‚Äô heights (residual variation).</li>
      <li>To quantify what impact genotype information has beyond parental height in explaining child height.</li>
      <li>To figure out how/whether and what assumptions are needed to
generalize findings beyond the data in question.</li>
      <li>Why do children of very tall parents tend to be 
tall, but a little shorter than their parents and why children of very short parents tend to be short, but a little taller than their parents? (This is a famous question called ‚ÄòRegression to the mean‚Äô.)</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="galtons-data">Galton‚Äôs Data</h3>

<ul>
  <li>Let‚Äôs look at the data first, used by Francis Galton in 1885.</li>
  <li>Galton was a statistician who invented the term and concepts
of regression and correlation, founded the journal Biometrika,
and was the cousin of Charles Darwin.</li>
  <li>You may need to run <code class="language-plaintext highlighter-rouge">install.packages("UsingR")</code> if the <code class="language-plaintext highlighter-rouge">UsingR</code> library is not installed.</li>
  <li>Let‚Äôs look at the marginal (parents disregarding children and children disregarding parents) distributions first.
    <ul>
      <li>Parent distribution is all heterosexual couples.</li>
      <li><strong>Correction for gender via multiplying female heights by 1.08.</strong></li>
      <li>Overplotting is an issue from discretization. (do not <a href="https://www.displayr.com/what-is-overplotting/">overplot</a>)</li>
    </ul>
  </li>
</ul>

<hr />

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">);</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">galton</span><span class="p">);</span><span class="w"> </span><span class="n">library</span><span class="p">(</span><span class="n">reshape</span><span class="p">);</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">galton</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variable</span><span class="p">))</span><span class="w"> 
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">binwidth</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> 
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w">
</span></code></pre></div></div>
<p><strong>plot of histograms of children heights and parents heights!</strong></p>

<hr />
<h3 id="finding-the-middle-via-least-squares">Finding the middle via least squares</h3>
<ul>
  <li>Consider only the children‚Äôs heights.
    <ul>
      <li>How could one describe the ‚Äúmiddle‚Äù?</li>
      <li>One definition, let $Y_i$ be the height of child $i$ for $i = 1,
\ldots, n = 928$, then define the middle as the value of $\mu$ that
minimizes \(\sum_{i=1}^n (Y_i - \mu)^2\)</li>
    </ul>
  </li>
  <li>This is physical center of mass of the histrogram.</li>
  <li>You might have guessed that the answer $\mu = \bar Y$.</li>
</ul>

<p><strong>Least squares finds a line with minimum ‚Äúerror‚Äù</strong></p>

<hr />
<h3 id="experiment">Experiment</h3>
<h4 id="use-r-studios-manipulate-to-see-what-value-of-mu-minimizes-the-sum-of-the-squared-deviations">Use R studio‚Äôs manipulate to see what value of $\mu$ minimizes the sum of the squared deviations.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(manipulate)
myHist &lt;- function(mu){
    mse &lt;- mean((galton$child - mu)^2)
    g &lt;- ggplot(galton, aes(x = child)) + geom_histogram(fill = "salmon", colour = "black", binwidth=1)
    g &lt;- g + geom_vline(xintercept = mu, size = 3)
    g &lt;- g + ggtitle(paste("mu = ", mu, ", MSE = ", round(mse, 2), sep = ""))
    g
}
manipulate(myHist(mu), mu = slider(62, 74, step = 0.5))
</code></pre></div></div>

<hr />
<h3 id="the-least-squares-est-is-the-empirical-mean-for-least-error"><strong>The least squares est. is the empirical mean for least error</strong></h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">galton</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"salmon"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">binwidth</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">galton</span><span class="o">$</span><span class="n">child</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w">
</span></code></pre></div></div>

<hr />
<h4 id="proof-that-least-squares-est-for-low-error-is-the-emperical-mean">Proof: that least squares est. for low error is the emperical mean!</h4>

\[\begin{align} 
\sum_{i=1}^n (Y_i - \mu)^2 &amp; = \
\sum_{i=1}^n (Y_i - \bar Y + \bar Y - \mu)^2 \\ 
&amp; = \sum_{i=1}^n (Y_i - \bar Y)^2 + \
2 \sum_{i=1}^n (Y_i - \bar Y)  (\bar Y - \mu) +\
\sum_{i=1}^n (\bar Y - \mu)^2 \\
&amp; = \sum_{i=1}^n (Y_i - \bar Y)^2 + \
2 (\bar Y - \mu) \sum_{i=1}^n (Y_i - \bar Y)  +\
\sum_{i=1}^n (\bar Y - \mu)^2 \\
&amp; = \sum_{i=1}^n (Y_i - \bar Y)^2 + \
2 (\bar Y - \mu)  (\sum_{i=1}^n Y_i - n \bar Y) +\
\sum_{i=1}^n (\bar Y - \mu)^2 \\
&amp; = \sum_{i=1}^n (Y_i - \bar Y)^2 + \sum_{i=1}^n (\bar Y - \mu)^2\\ 
&amp; \geq \sum_{i=1}^n (Y_i - \bar Y)^2 \
\end{align}\]

<hr />
<h3 id="comparing-childrens-heights-and-their-parents-heights">Comparing childrens‚Äô heights and their parents‚Äô heights</h3>

<p><a href="https://www.displayr.com/what-is-overplotting/">OVERPLOTTING!</a></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">galton</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<hr />
<p>Size of point represents number of points at that (X, Y) combination (See the Rmd file for the code).</p>

<p><strong>Plot code not given here about how not to Overplot!</strong></p>

<hr />
<h3 id="regression-through-the-origin">Regression through the origin</h3>
<ul>
  <li>Suppose that $X_i$ are the parents‚Äô heights.</li>
  <li>Consider picking the slope $\beta$ that minimizes \(\sum_{i=1}^n (Y_i - X_i \beta)^2\)</li>
  <li>This is exactly using the origin as a pivot point picking the
line that minimizes the sum of the squared vertical distances
of the points to the line</li>
  <li>Use R studio‚Äôs  manipulate function to experiment</li>
  <li>Subtract the means so that the origin is the mean of the parent
and children‚Äôs heights</li>
</ul>

<hr />

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">galton</span><span class="o">$</span><span class="n">child</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">galton</span><span class="o">$</span><span class="n">child</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">galton</span><span class="o">$</span><span class="n">parent</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">galton</span><span class="o">$</span><span class="n">parent</span><span class="p">)</span><span class="w">
</span><span class="n">freqData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">freqData</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"child"</span><span class="p">,</span><span class="w"> </span><span class="s2">"parent"</span><span class="p">,</span><span class="w"> </span><span class="s2">"freq"</span><span class="p">)</span><span class="w">
</span><span class="n">freqData</span><span class="o">$</span><span class="n">child</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">freqData</span><span class="o">$</span><span class="n">child</span><span class="p">))</span><span class="w">
</span><span class="n">freqData</span><span class="o">$</span><span class="n">parent</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">freqData</span><span class="o">$</span><span class="n">parent</span><span class="p">))</span><span class="w">
</span><span class="n">myPlot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">beta</span><span class="p">){</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">freqData</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="p">))</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">scale_size</span><span class="p">(</span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">),</span><span class="w"> </span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="w"> </span><span class="p">)</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"grey50"</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">freq</span><span class="m">+20</span><span class="p">,</span><span class="w"> </span><span class="n">show_guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">freq</span><span class="p">))</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_colour_gradient</span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lightblue"</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w">                     
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_abline</span><span class="p">(</span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
    </span><span class="n">mse</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="p">)</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggtitle</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"beta = "</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="s2">"mse = "</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mse</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)))</span><span class="w">
    </span><span class="n">g</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">manipulate</span><span class="p">(</span><span class="n">myPlot</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slider</span><span class="p">(</span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="m">1.2</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.02</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<hr />
<h3 id="the-solution">The solution</h3>
<h4 id="in-the-next-few-lectures-well-talk-about-why-this-is-the-solution">In the next few lectures we‚Äôll talk about why this is the solution</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lm</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">child</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">child</span><span class="p">))</span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">parent</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">galton</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Call:
lm(formula = I(child - mean(child)) ~ I(parent - mean(parent)) - 
    1, data = galton)

Coefficients:
I(parent - mean(parent))  
                   0.646  
</code></pre></div></div>

<p><strong>The -1 somehow gets rid of the intercepts!!!!???</strong></p>

<h3 id="summary-agent">Summary AGENT</h3>

<ul>
  <li>
    <p>Linear regression is line which minimizes error in ‚ÄúY‚Äù.</p>
  </li>
  <li>
\[\sum_{i=1}^n (Y_i - \mu)^2\]

    <ul>
      <li>mu is nothing but the mean (proof is available above!) so that
error is minimized</li>
    </ul>
  </li>
  <li>
    <p>For some reason we centre the line around the mean so to get better
estimates!</p>
  </li>
  <li>
    <p>This is done by using:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  lm(I(child - mean(child))~ I(parent - mean(parent)) - 1, data = galton)
</code></pre></div>    </div>

    <ul>
      <li>the <strong>-1</strong> somehow gets rid of the intercepts!</li>
    </ul>
  </li>
</ul>

<h2 id="notation-c7-w1">Notation c7-w1</h2>
<h3 id="some-basic-definitions">Some basic definitions</h3>

<ul>
  <li>In this module, we‚Äôll cover some basic definitions and notation used throughout the class.</li>
  <li>We will try to minimize the amount of mathematics required for this class.</li>
  <li>No calculus is required.</li>
</ul>

<hr />

<h3 id="notation-for-data">Notation for data</h3>

<ul>
  <li>We write $X_1, X_2, \ldots, X_n$ to describe $n$ data points.</li>
  <li>As an example, consider the data set ${1, 2, 5}$ then
    <ul>
      <li>$X_1 = 1$, $X_2 = 2$, $X_3 = 5$ and $n = 3$.</li>
    </ul>
  </li>
  <li>We often use a different letter than $X$, such as $Y_1, \ldots , Y_n$.</li>
  <li>We will typically use Greek letters for things we don‚Äôt know. 
Such as, $\mu$ is a mean that we‚Äôd like to estimate.</li>
</ul>

<hr />
<h3 id="the-empirical-mean">The empirical mean</h3>

<ul>
  <li>Define the empirical mean as
\(\bar X = \frac{1}{n}\sum_{i=1}^n X_i.\)</li>
  <li>Notice if we subtract the mean from data points, we get data that has mean 0. That is, if we define
\(**\tilde X_i = X_i - \bar X.**\)
The mean of the $\tilde X_i$ is 0.</li>
  <li>This process is called <strong>‚Äúcentering‚Äù the random variables</strong>.</li>
  <li>Recall from the previous lecture that the mean is 
the least squares solution for minimizing
\(\sum_{i=1}^n (X_i - \mu)^2\)</li>
</ul>

<hr />

<h3 id="the-empirical-standard-deviation-and-variance">The empirical standard deviation and variance</h3>

<ul>
  <li>Define the empirical variance as 
\(S^2 = \frac{1}{n-1} \sum_{i=1}^n (X_i - \bar X)^2 
= \frac{1}{n-1} \left( \sum_{i=1}^n X_i^2 - n \bar X ^ 2 \right)\)</li>
  <li>The empirical standard deviation is defined as
$S = \sqrt{S^2}$. Notice that the standard deviation has the same units as the data.</li>
  <li>The data defined by $X_i / s$ have empirical standard
deviation 1. This is called ‚Äúscaling‚Äù the data. i.e., <strong>SCALING</strong></li>
</ul>

<p><strong>Empirical seems to be associated with the sample!</strong></p>

<hr />
<h3 id="normalization">Normalization</h3>

<ul>
  <li>The data defined by
\(**Z_i = \frac{X_i - \bar X}{s}**\)
<strong>have empirical mean zero and empirical standard deviation 1</strong>.</li>
  <li>The process of centering then scaling the data is called <strong>‚Äúnormalizing‚Äù</strong> the data.</li>
  <li>Normalized data are centered at 0 and have units equal to standard deviations of the original data.</li>
  <li>Example, a value of 2 from normalized data means that data point
was two standard deviations larger than the mean.</li>
</ul>

<p><strong>SCALING AND CENTERING</strong></p>

<hr />
<h3 id="the-empirical-covariance">The empirical covariance</h3>
<ul>
  <li>Consider now when we have pairs of data, $(X_i, Y_i)$.</li>
  <li>Their empirical covariance is 
\(Cov(X, Y) = 
\frac{1}{n-1}\sum_{i=1}^n (X_i - \bar X) (Y_i - \bar Y)
= \frac{1}{n-1}\left( \sum_{i=1}^n X_i Y_i - n \bar X \bar Y\right)\)</li>
  <li>The correlation is defined is
\(Cor(X, Y) = \frac{Cov(X, Y)}{S_x S_y}\)
where $S_x$ and $S_y$ are the estimates of standard deviations 
for the $X$ observations and $Y$ observations, respectively.</li>
</ul>

<p><strong>Covariance</strong></p>

<p>It is the measure of deviation of X and Y from linear relationship
relationship. i.e., if X and Y are plotted on to a line with slope
‚Äúdoesn‚Äôt matter‚Äù degrees!</p>

<p><strong>Correlation</strong></p>

\[Cor(X, Y) = \frac{Cov(X, Y)}{S_x S_y}\]

<p>Just divide Covariance by emperical SD‚Äôs.</p>

<hr />
<h3 id="some-facts-about-correlation">Some facts about correlation</h3>
<ul>
  <li>$<strong>Cor(X, Y) = Cor(Y, X)</strong>$</li>
  <li><strong>$-1 \leq Cor(X, Y) \leq 1$</strong></li>
  <li>$Cor(X,Y) = 1$ and $Cor(X, Y) = -1$ only when the $X$ or $Y$ observations fall perfectly on a positive or negative sloped line, respectively.</li>
  <li>$Cor(X, Y)$ <strong>measures the strength of the linear relationship between the $X$ and $Y$</strong> data, with stronger relationships as $Cor(X,Y)$ heads towards -1 or 1.</li>
  <li>
    <p>$Cor(X, Y) = 0$ implies no linear relationship.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cor(x,2*x)=1
  cor(x,-x)=-1
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Cor measures ability to fall on straight line. Cov is not that
useful other than in getting Cov I think</strong></p>

<h2 id="ols-c7-w1">OLS c7-w1</h2>

<h3 id="fitting-the-best-line">Fitting the best line</h3>
<ul>
  <li>Let $Y_i$ be the $i^{th}$ child‚Äôs height and $X_i$ be the 
$i^{th}$ (average over the pair of) parents‚Äô heights.</li>
  <li>Consider finding the best line
    <ul>
      <li>Child‚Äôs Height = $\beta_0$ + Parent‚Äôs Height $\beta_1$</li>
    </ul>
  </li>
  <li>Use least squares
\(\sum_{i=1}^n \{Y_i - (\beta_0 + \beta_1 X_i)\}^2\)</li>
</ul>

<hr />
<h3 id="results-beta0-beta1">Results (beta0, beta1)</h3>
<ul>
  <li>The least squares model fit to the line $Y = \beta_0 + \beta_1 X$
through the data pairs $(X_i, Y_i)$ with $Y_i$ as the outcome
obtains the line $Y = \hat \beta_0 + \hat \beta_1 X$ where \(\hat
**\beta_1 = Cor(Y, X) \frac{Sd(Y)}{Sd(X)} ~~~ \hat \beta_0 = \bar Y -
\hat \beta_1 \bar X**\)</li>
  <li><strong>The line passes through the point $(\bar X, \bar Y$)</strong></li>
  <li>The slope of the regression line with $X$ as the outcome and $Y$ as
the predictor is $Cor(Y, X) Sd(X)/ Sd(Y)$.</li>
  <li>The slope is the same one you would get if you centered the data,
$(X_i - \bar X, Y_i - \bar Y)$, and did regression through the origin.</li>
  <li>
    <p>If you normalized the data, ${ \frac{X_i - \bar X}{Sd(X)},
\frac{Y_i - \bar Y}{Sd(Y)}}$, the slope is $Cor(Y, X)$.</p>
  </li>
  <li><strong>Regression line passes through the centre</strong></li>
  <li><strong>centered data also has the same slope as the actual data</strong>
      coef(lm(yc~xc))[2]==coef(lm(y~x))[2]</li>
</ul>

<p><strong>Normalizing the values results in slope beta1=cor(y,x)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	yn &lt;- (y - mean(y))/sd(y)
	xn &lt;- (x - mean(x))/sd(x)
	c(cor(y, x), cor(yn, xn), coef(lm(yn ~ xn))[2])
</code></pre></div></div>

<p><a href="https://www.youtube.com/watch?v=COVQX8WZVA8&amp;list=PLpl-gQkQivXjqHAJd2t-J_One_fYE55tC&amp;index=8">This lecture</a> gives more info on the derivations.</p>

<hr />
<h3 id="revisiting-galtons-data">Revisiting Galton‚Äôs data</h3>
<h4 id="double-check-our-calculations-using-r">Double check our calculations using R</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">galton</span><span class="o">$</span><span class="n">child</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">galton</span><span class="o">$</span><span class="n">parent</span><span class="w">
</span><span class="n">beta1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cor</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">sd</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">beta0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">beta1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">rbind</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">beta0</span><span class="p">,</span><span class="w"> </span><span class="n">beta1</span><span class="p">),</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     (Intercept)      x
[1,]       23.94 0.6463
[2,]       23.94 0.6463
</code></pre></div></div>

<hr />
<h3 id="revisiting-galtons-data-1">Revisiting Galton‚Äôs data</h3>
<h4 id="reversing-the-outcomepredictor-relationship">Reversing the outcome/predictor relationship</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">beta1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cor</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">beta0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">beta1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">rbind</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">beta0</span><span class="p">,</span><span class="w"> </span><span class="n">beta1</span><span class="p">),</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">y</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     (Intercept)      y
[1,]       46.14 0.3256
[2,]       46.14 0.3256
</code></pre></div></div>

<hr />
<h3 id="revisiting-galtons-data-2">Revisiting Galton‚Äôs data</h3>
<h4 id="regression-through-the-origin-yields-an-equivalent-slope-if-you-center-the-data-first">Regression through the origin yields an equivalent slope if you center the data first</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">xc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">beta1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">yc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xc</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">xc</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="nf">c</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">))[</span><span class="m">2</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            x 
0.6463 0.6463 
</code></pre></div></div>

<h3 id="forcing-the-regression-through-origin">Forcing the regression through origin</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x &lt;- c(0.8, 0.47, 0.51, 0.73, 0.36, 0.58, 0.57, 0.85, 0.44, 0.42)
y &lt;- c(1.39, 0.72, 1.55, 0.48, 1.19, -1.59, 1.23, -0.65, 1.49, 0.05)

sum(y*x)/sum(x^2)

or 

lm(y~0 + .,cbind(y,x))

lm(y~0 _ .,cbind(x,y)) also gives the same result PNN!
</code></pre></div></div>

<hr />
<h3 id="revisiting-galtons-data-3">Revisiting Galton‚Äôs data</h3>
<h4 id="normalizing-variables-results-in-the-slope-being-the-correlation">Normalizing variables results in the slope being the correlation</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">/</span><span class="n">sd</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">xn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="nf">c</span><span class="p">(</span><span class="n">cor</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">cor</span><span class="p">(</span><span class="n">yn</span><span class="p">,</span><span class="w"> </span><span class="n">xn</span><span class="p">),</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">yn</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">xn</span><span class="p">))[</span><span class="m">2</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                  xn 
0.4588 0.4588 0.4588 
</code></pre></div></div>

<hr />
<div class="rimage center"><img src="fig/unnamed-chunk-6.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div>

<h2 id="quiz-c7-w1">Quiz c7-w1</h2>

<ol>
  <li>
    <p>x &lt;- c(0.18, -1.54, 0.42, 0.95)
w &lt;- c(2, 1, 3, 1)</p>

    <p>w is weights, what is the value that minimizes?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sum(x * w)/sum(w)
</code></pre></div>    </div>
  </li>
  <li>
    <p>x &lt;- c(0.8, 0.47, 0.51, 0.73, 0.36, 0.58, 0.57, 0.85, 0.44, 0.42)
y &lt;- c(1.39, 0.72, 1.55, 0.48, 1.19, -1.59, 1.23, -0.65, 1.49, 0.05)</p>

    <p>it the regression through the origin and get the slope treating y
as the outcome and x as the regressor. (Hint, do not center the data
since we want regression through the origin, not through the means of
the data.)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> coef(lm(y ~ x - 1))
	
 sum(y * x)/sum(x^2)
	
 coef(lm(y~0 + . , cbind(x,y)))
</code></pre></div>    </div>
  </li>
  <li>
    <p>Do \verb|data(mtcars)|data(mtcars) from the datasets package and
fit the regression model with mpg as the outcome and weight as the
predictor. Give the slope coefficient.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cor(mpg, wt) * sd(mpg)/sd(wt)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Consider data with an outcome (Y) and a predictor (X). The standard
deviation of the predictor is one half that of the outcome. The
correlation between the two variables is .5. What value would the
slope coefficient for the regression model with YY as the outcome
and XX as the predictor?</p>

    <p>1</p>
  </li>
  <li>
    <p>Students were given two hard tests and scores were normalized to
have empirical mean 0 and variance 1. The correlation between the
scores on the two tests was 0.4. What would be the expected score
on Quiz 2 for a student who had a normalized score of 1.5 on Quiz
1?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 1.5 * 0.4
</code></pre></div>    </div>
  </li>
  <li>
    <p>x &lt;- c(8.58, 10.46, 9.01, 9.64, 8.86)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ((x - mean(x))/sd(x))[1]
</code></pre></div>    </div>
  </li>
  <li>
    <p>x &lt;- c(0.8, 0.47, 0.51, 0.73, 0.36, 0.58, 0.57, 0.85, 0.44, 0.42)
y &lt;- c(1.39, 0.72, 1.55, 0.48, 1.19, -1.59, 1.23, -0.65, 1.49,
0.05)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> coef(lm(y ~ x))[1]
</code></pre></div>    </div>
  </li>
  <li>
    <p>You know that both the predictor and response have mean 0. What can
be said about the intercept when you fit a linear regression?</p>

    <p>The intercept estimate is $\bar Y - \beta_1 \bar X$ and so will be
zero.</p>
  </li>
  <li>
    <p>x &lt;- c(0.8, 0.47, 0.51, 0.73, 0.36, 0.58, 0.57, 0.85, 0.44, 0.42)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> mean(x)
</code></pre></div>    </div>
  </li>
  <li>
    <p>beta1/ gamma1 ?</p>

    <p>when beta1 is y~x slope and gamma1 is x~y slope!</p>

    <p>Ans: var(y)/var(x)</p>
  </li>
</ol>

<h2 id="rttm-c7-w2">rttm c7-w2</h2>
<h3 id="regression-to-the-mean-examples-agent">Regression to the Mean <strong>examples Agent</strong></h3>
<ul>
  <li>Why is it that the children of tall parents tend to be tall, but not as tall as their parents?</li>
  <li>Why do children of short parents tend to be short, but not as short as their parents?</li>
  <li>Why do parents of very short children, tend to be short, but not a short as their child? And the same with parents of very tall children?</li>
  <li>Why do the best performing athletes this year tend to do a little worse the following?</li>
</ul>

<p><strong>RTTM is about ramdomness</strong></p>

<p>Consider the above examples‚Ä¶ where even though the athlete might
have worked the same, some randomness makes him better or worse is the
claim.</p>

<p><strong>100% rttm</strong></p>

<p>Think of a normal distribution, if in the first 100 numbers you get
maximum of 2. In the second 100 numbers (paired) the chance of getting
such a high number(in its pair)) is super low (mean=0, sd=1), (i.e., 2
sd‚Äôs apart aka &lt;5% chance in a bell curve).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x &lt;- rnorm(100)
y &lt;- rnorm(100)

odr &lt;- order(x)

x[odr[100]] is 2

y[odr[100]] is 0.5 or sumpin
</code></pre></div></div>

<p><strong>Exam tests rttm</strong></p>

<p>Test 1 has some mistakes but is still hard, Test 2 is also hard.</p>

<p>Good students score well in Test 1 compared to the second
test. Quizzes are imperfect to judge the potential of the kid.</p>

<p>Many people get by, by just doing the previous-exam questions for
example. Think of the poor students, they would have done better in
the tests with errors than their test 2 grades.</p>

<p>vaguely rttm!</p>

<p>Basically rttm is some randomness in your life that peaks and lowers
your true performance, it is the noise, that doesn‚Äôt allow to measure
your true potential.</p>

<hr />
<h3 id="regression-to-the-mean">Regression to the mean</h3>
<ul>
  <li>These phenomena are all examples of so-called regression to the mean</li>
  <li>Invented by Francis Galton in the paper ‚ÄúRegression towards
mediocrity in hereditary stature‚Äù The Journal of the Anthropological
Institute of Great Britain and Ireland , Vol. 15, (1886).</li>
  <li>Think of it this way, imagine if you simulated pairs of random normals
    <ul>
      <li>The largest first ones would be the largest by chance, and the
probability that there are smaller for the second simulation is
high.</li>
      <li>In other words $P(Y &lt; x | X = x)$ gets bigger as $x$ heads into
the very large values.</li>
      <li>Similarly $P(Y &gt; x | X = x)$ gets bigger as $x$ heads to very
small values.</li>
    </ul>
  </li>
  <li>Think of the regression line as the intrisic part.
    <ul>
      <li>Unless $Cor(Y, X) = 1$ the intrinsic part isn‚Äôt perfect</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="regression-to-the-mean-1">Regression to the mean</h3>
<ul>
  <li>Suppose that we normalize $X$ (child‚Äôs height) and $Y$ (parent‚Äôs
height) so that they both have mean 0 and variance 1.</li>
  <li>Then, recall, our regression line passes through $(0, 0)$ (the mean of the X and Y).</li>
  <li>If the slope of the regression line is $Cor(Y,X)$, regardless of
which variable is the outcome (recall, both standard deviations are
1).</li>
  <li>Notice if $X$ is the outcome and you create a plot where $X$ is the
horizontal axis, the slope of the least squares line that you plot
is $1/Cor(Y, X)$.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">father.son</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">father.son</span><span class="o">$</span><span class="n">sheight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">father.son</span><span class="o">$</span><span class="n">sheight</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">father.son</span><span class="o">$</span><span class="n">sheight</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">father.son</span><span class="o">$</span><span class="n">fheight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">father.son</span><span class="o">$</span><span class="n">fheight</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">father.son</span><span class="o">$</span><span class="n">fheight</span><span class="p">)</span><span class="w">
</span><span class="n">rho</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">

</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"salmon"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xlim</span><span class="p">(</span><span class="m">-4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylim</span><span class="p">(</span><span class="m">-4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_abline</span><span class="p">(</span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_abline</span><span class="p">(</span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_abline</span><span class="p">(</span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">rho</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="discussion-2">Discussion</h3>
<ul>
  <li>If you had to predict a son‚Äôs normalized height, it would be
$Cor(Y, X) * X_i$</li>
  <li>If you had to predict a father‚Äôs normalized height, it would be
$Cor(Y, X) * Y_i$</li>
  <li>Multiplication by this correlation shrinks toward 0 (regression toward the mean)</li>
  <li>If the correlation is 1 there is no regression to the mean (if father‚Äôs height perfectly determine‚Äôs child‚Äôs height and vice versa)</li>
  <li>Note, regression to the mean has been thought about quite a bit and
generalized</li>
</ul>

<h2 id="linear-regression-c7-w2">Linear regression c7-w2</h2>
<h3 id="basic-regression-model-with-additive-gaussian-errors">Basic regression model with additive Gaussian errors.</h3>
<ul>
  <li>Least squares is an estimation tool, how do we do inference?</li>
  <li>Consider developing a probabilistic model for linear regression
\(Y_i = \beta_0 + \beta_1 X_i + **\epsilon_{i}**\)</li>
  <li>Here the $\epsilon_{i}$ are assumed iid $N(0, \sigma^2)$.</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Note, $E[Y_i ~</td>
          <td>~ X_i = x_i] = \mu_i = \beta_0 + \beta_1 x_i$</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Note, $Var(Y_i ~</td>
          <td>~ X_i = x_i) = \sigma^2$. <strong>variance for a given X</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<hr />
<h3 id="recap">Recap</h3>
<ul>
  <li>Model $Y_i =  \mu_i + \epsilon_i = \beta_0 + \beta_1 X_i + \epsilon_i$ where $\epsilon_i$ are iid $N(0, \sigma^2)$</li>
  <li>ML estimates of $\beta_0$ and $\beta_1$ are the least squares estimates
\(\hat \beta_1 = Cor(Y, X) \frac{Sd(Y)}{Sd(X)} ~~~ \hat \beta_0 = \bar Y - \hat \beta_1 \bar X\)</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>$E[Y ~</td>
          <td>~ X = x] = \beta_0 + \beta_1 x$</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>$Var(Y ~</td>
          <td>~ X = x) = \sigma^2$</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<hr />
<h3 id="changing-regression-coefficients-beta1-beta0">Changing regression coefficients beta1 beta0</h3>

<p><strong>if you multiply the X axis by 10, then you divide the units
by 10. It changes the slope by 10</strong></p>

\[Y_i = \beta_0 + \beta_1 X_i + \epsilon_i
= \beta_0 + \frac{\beta_1}{a} (X_i a) + \epsilon_i
= \beta_0 + \tilde \beta_1 (X_i a) + \epsilon_i\]

<ul>
  <li>Example: $X$ is height in $m$ and $Y$ is weight in $kg$. Then $\beta_1$ is $kg/m$. Converting $X$ to $cm$ implies multiplying $X$ by $100 cm/m$. To get $\beta_1$ in the right units, we have to divide by $100 cm /m$ to get it to have the right units.</li>
</ul>

<p><strong>Subtracting the X axis by ‚Äòa‚Äô changes the intercept but not the
slope.</strong></p>

<hr />
<h3 id="example-19">Example</h3>
<h4 id="diamond-data-set-from-usingr"><code class="language-plaintext highlighter-rouge">diamond</code> data set from <code class="language-plaintext highlighter-rouge">UsingR</code></h4>
<p>Data is diamond prices (Singapore dollars) and diamond weight in
carats (standard measure of diamond mass, 0.2 $g$). To get the data
use</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">);</span><span class="w"> 
</span><span class="n">data</span><span class="p">(</span><span class="n">diamond</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">diamond</span><span class="o">$</span><span class="n">carat</span><span class="p">,</span><span class="w"> </span><span class="n">diamond</span><span class="o">$</span><span class="n">price</span><span class="p">,</span><span class="w">
</span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Mass (carats)"</span><span class="p">,</span><span class="w">
</span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Price (SIN $)"</span><span class="p">,</span><span class="w">
</span><span class="n">bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lightblue"</span><span class="p">,</span><span class="w">
</span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.1</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">price</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">carat</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diamond</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<hr />
<h3 id="fitting-the-linear-regression-model">Fitting the linear regression model</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">price</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">carat</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diamond</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(Intercept)       carat 
     -259.6      3721.0 
</code></pre></div></div>

<ul>
  <li>We estimate an expected 3721.02 (SIN) dollar increase in price for every carat increase in mass of diamond.</li>
  <li>The intercept -259.63 is the expected price
of a 0 carat diamond.</li>
</ul>

<hr />
<h3 id="0-carats-value-is-worthless-to-you-so-you-center-the-carats">0 carats value is worthless to you so you <strong>Center</strong> the Carats!</h3>

<p><strong>Subtracting the X axis by ‚Äòa‚Äô changes the intercept but not the
slope.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fit2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">price</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">carat</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">carat</span><span class="p">)),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diamond</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">fit2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           (Intercept) I(carat - mean(carat)) 
                 500.1                 3721.0 
</code></pre></div></div>

<p>Thus $500.1 is the expected price for 
the average sized diamond of the data (0.2042 carats).</p>

<hr />
<h3 id="changing-scale">Changing scale</h3>
<ul>
  <li>A one carat increase in a diamond is pretty big, what about
changing units to 1/10th of a carat?</li>
  <li>We can just do this by just dividing the coeficient by 10.
    <ul>
      <li>We expect  a 372.102 (SIN) dollar   change in price for every 1/10th of a carat increase in mass of diamond.</li>
    </ul>
  </li>
  <li>Showing that it‚Äôs the same if we rescale the Xs and refit</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fit3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">price</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">carat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diamond</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">fit3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  (Intercept) I(carat * 10) 
       -259.6         372.1 
</code></pre></div></div>

<hr />
<h3 id="predicting-the-price-of-a-diamond">Predicting the price of a diamond</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">newx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.16</span><span class="p">,</span><span class="w"> </span><span class="m">0.27</span><span class="p">,</span><span class="w"> </span><span class="m">0.34</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">fit</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">fit</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">newx</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  335.7  745.1 1005.5
</code></pre></div></div>
<p><strong>Use Predict next time!</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">carat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newx</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     1      2      3 
 335.7  745.1 1005.5 
</code></pre></div></div>

<h3 id="plot-with-lm">Plot with lm</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">diamond</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">diamond</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carat</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">price</span><span class="p">))</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Mass (carats)"</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Price (SIN $)"</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w">
</span></code></pre></div></div>

<h2 id="residual-variation-c7-w2">residual variation c7-w2</h2>

<h3 id="motivating-example">Motivating example</h3>
<h4 id="diamond-data-set-from-usingr-1"><code class="language-plaintext highlighter-rouge">diamond</code> data set from <code class="language-plaintext highlighter-rouge">UsingR</code></h4>
<p>Data is diamond prices (Singapore dollars) and diamond weight
in carats (standard measure of diamond mass, 0.2 $g$). To get the data use <code class="language-plaintext highlighter-rouge">library(UsingR); data(diamond)</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">UsingR</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">diamond</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">diamond</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carat</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">price</span><span class="p">))</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Mass (carats)"</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Price (SIN $)"</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w">
</span></code></pre></div></div>

<h3 id="residuals">Residuals</h3>
<ul>
  <li>
    <p>Model <strong>$Y_i = \beta_0 + \beta_1 X_i + \epsilon_i$</strong> where
$\epsilon_i \sim N(0, \sigma^2)$.</p>
  </li>
  <li>Observed outcome $i$ is $Y_i$ at predictor value $X_i$</li>
  <li>Predicted outcome $i$ is $\hat Y_i$ at predictor valuve $X_i$ is
\(\hat Y_i = \hat \beta_0 + \hat \beta_1 X_i\)</li>
  <li>
    <p>Residual, the between the observed and predicted outcome
\(e_i = Y_i - \hat Y_i\)</p>

    <p><strong>Residual is nothing but the difference between data and linear
regressor line</strong></p>

    <ul>
      <li>The vertical distance between the observed data point and the
regression line</li>
    </ul>
  </li>
  <li>Least squares minimizes $\sum_{i=1}^n e_i^2$</li>
  <li>The $e_i$ can be thought of as estimates of the $\epsilon_i$.</li>
</ul>

<hr />
<h3 id="properties-of-the-residuals">Properties of the residuals</h3>
<ul>
  <li>
    <p>$E[e_i] = 0$. <strong>Intuitively if everything stands on either sides of
the mean, then the sum shall be equal to 0</strong></p>
  </li>
  <li>
    <p>If an intercept is included, $\sum_{i=1}^n e_i = 0$ !!! Convinced by
intuitive explanation <a href="https://stats.stackexchange.com/a/189613/217983">here</a>. <strong>Regression line is in some sense a
mean around which to the left are certain values which are exactly
equal to the right. PNN!</strong></p>

    <p>I think when they say <em>including the intercept</em> I think we should
not force the center through other points like the origin, in which
case residual might be different?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  sum(resid(lm(price~diamond$carat-1))) != 0 (tested)
  sum(resid(lm(price~diamond$carat))) = 0 
  sum(resid(lm(xc~yc))) == 0 True!
</code></pre></div>    </div>
  </li>
  <li>
    <p>If a regressor variable, $X_i$, is included in the model
$\sum_{i=1}^n e_i X_i = 0$. ???</p>
  </li>
  <li>
    <p>Residuals are useful for investigating poor model fit by zooming in
on the locations.</p>
  </li>
  <li>
    <p>Positive residuals are above the line, negative residuals are below.</p>
  </li>
  <li>
    <p>Residuals can be thought of as the outcome ($Y$) with the
linear association of the predictor ($X$) removed.</p>
  </li>
  <li>One differentiates residual variation (variation after removing
the predictor) from systematic variation (variation explained by the regression model).</li>
  <li>Residual plots highlight poor model fit.</li>
</ul>

<p>Residual variation is a random error like the one that occurs when you
take the same measurement over and over again but your reading varies ‚Äúrandomly‚Äù</p>

<hr />
<h3 id="calculate-residuals-in-3-ways">Calculate Residuals in 3 ways!</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">(</span><span class="n">diamond</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">diamond</span><span class="o">$</span><span class="n">price</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">diamond</span><span class="o">$</span><span class="n">carat</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">resid</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="w">
</span><span class="n">yhat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="w">
</span><span class="nf">max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yhat</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 9.486e-13
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">fit</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">fit</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 9.486e-13
</code></pre></div></div>

<p><strong>Important properties</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="w">
</span></code></pre></div></div>

<h3 id="residuals-are-the-assigned-length-of-the-red-lines">Residuals are the assigned length of the red lines</h3>
<p>```{r, echo = FALSE, fig.height=5, fig.width=5}
plot(diamond$carat, diamond$price,<br />
     xlab = ‚ÄúMass (carats)‚Äù, 
     ylab = ‚ÄúPrice (SIN $)‚Äù, 
     bg = ‚Äúlightblue‚Äù, 
     col = ‚Äúblack‚Äù, cex = 2, pch = 21,frame = FALSE)
abline(fit, lwd = 2)
for (i in 1 : n) 
  lines(c(x[i], x[i]), c(y[i], yhat[i]), col = ‚Äúred‚Äù , lwd = 2)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Residuals versus X
```{r, echo = FALSE, fig.height=5, fig.width=5}
plot(x, e,  
     xlab = "Mass (carats)", 
     ylab = "Residuals (SIN $)", 
     bg = "lightblue", 
     col = "black", cex = 2, pch = 21,frame = FALSE)
abline(h = 0, lwd = 2)
for (i in 1 : n) 
  lines(c(x[i], x[i]), c(e[i], 0), col = "red" , lwd = 2)
</code></pre></div></div>

<hr />
<h3 id="non-linear-data">Non-linear data</h3>
<p>```{r, echo = FALSE, fig.height=5, fig.width=5}
x = runif(100, -3, 3); y = x + sin(x) + rnorm(100, sd = .2); 
library(ggplot2)
g = ggplot(data.frame(x = x, y = y), aes(x = x, y = y))
g = g + geom_smooth(method = ‚Äúlm‚Äù, colour = ‚Äúblack‚Äù)
g = g + geom_point(size = 7, colour = ‚Äúblack‚Äù, alpha = 0.4)
g = g + geom_point(size = 5, colour = ‚Äúred‚Äù, alpha = 0.4)
g</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Residual plot
```{r, echo = FALSE, fig.height=5, fig.width=5}
g = ggplot(data.frame(x = x, y = resid(lm(y ~ x))), 
           aes(x = x, y = y))
g = g + geom_hline(yintercept = 0, size = 2); 
g = g + geom_point(size = 7, colour = "black", alpha = 0.4)
g = g + geom_point(size = 5, colour = "red", alpha = 0.4)
g = g + xlab("X") + ylab("Residual")
g
</code></pre></div></div>

<hr />
<h3 id="heteroskedasticity">Heteroskedasticity</h3>
<p>```{r, echo = FALSE, fig.height=4.5, fig.width=4.5}
x &lt;- runif(100, 0, 6); y &lt;- x + rnorm(100,  mean = 0, sd = .001 * x); 
g = ggplot(data.frame(x = x, y = y), aes(x = x, y = y))
g = g + geom_smooth(method = ‚Äúlm‚Äù, colour = ‚Äúblack‚Äù)
g = g + geom_point(size = 7, colour = ‚Äúblack‚Äù, alpha = 0.4)
g = g + geom_point(size = 5, colour = ‚Äúred‚Äù, alpha = 0.4)
g</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>**When residual increases with X**

---
### Getting rid of the blank space can be helpful
```{r, echo = FALSE, fig.height=4.5, fig.width=4.5}
g = ggplot(data.frame(x = x, y = resid(lm(y ~ x))), 
           aes(x = x, y = y))
g = g + geom_hline(yintercept = 0, size = 2); 
g = g + geom_point(size = 7, colour = "black", alpha = 0.4)
g = g + geom_point(size = 5, colour = "red", alpha = 0.4)
g = g + xlab("X") + ylab("Residual")
g
</code></pre></div></div>

<hr />
<h3 id="diamond-data-residual-plot">Diamond data residual plot</h3>

<p>```{r, echo = FALSE, fig.height=4.5, fig.width=4.5}
diamond$e &lt;- resid(lm(price ~ carat, data = diamond))
g = ggplot(diamond, aes(x = carat, y = e))
g = g + xlab(‚ÄúMass (carats)‚Äù)
g = g + ylab(‚ÄúResidual price (SIN $)‚Äù)
g = g + geom_hline(yintercept = 0, size = 2)
g = g + geom_point(size = 7, colour = ‚Äúblack‚Äù, alpha=0.5)
g = g + geom_point(size = 5, colour = ‚Äúblue‚Äù, alpha=0.2)
g</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Diamond data residual plot

```{r, echo = FALSE, fig.height=4.5, fig.width=4.5}
## price~1 gives variation about average
e = c(resid(lm(price ~ 1, data = diamond)), 
      resid(lm(price ~ carat, data = diamond)))
fit = factor(c(rep("Itc", nrow(diamond)),
               rep("Itc, slope", nrow(diamond))))
g = ggplot(data.frame(e = e, fit = fit), aes(y = e, x = fit, fill = fit))
g = g + geom_dotplot(binaxis = "y", size = 2, stackdir = "center", binwidth = 20)
g = g + xlab("Fitting approach")
g = g + ylab("Residual price")
g
</code></pre></div></div>

<hr />

<hr />
<h3 id="estimating-residual-variation-n-2-dof">Estimating residual variation (n-2 dof)</h3>
<ul>
  <li>Model $Y_i = \beta_0 + \beta_1 X_i + \epsilon_i$ where $\epsilon_i \sim N(0, \sigma^2)$.</li>
  <li>The ML estimate of $\sigma^2$ is <strong>$\frac{1}{n}\sum_{i=1}^n
e_i^2$</strong>, the average squared residual.</li>
  <li>Most people use
\(\hat \sigma^2 = \frac{1}{n-2}\sum_{i=1}^n e_i^2.\)</li>
  <li>The <strong>$n-2$</strong> instead of $n$ is so that $E[\hat \sigma^2] =
\sigma^2$</li>
</ul>

<hr />
<h3 id="diamond-example">Diamond example</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">diamond</span><span class="o">$</span><span class="n">price</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">diamond</span><span class="o">$</span><span class="n">carat</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="o">$</span><span class="n">sigma</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 31.84
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">resid</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 31.84
</code></pre></div></div>

<hr />
<h3 id="total-variation--regression-variation--residual-variation">Total variation = regression variation + residual variation</h3>

<ul>
  <li>The <strong>total variability</strong> in our response is the variability around an intercept
(think mean only regression) $\sum_{i=1}^n (Y_i - \bar Y)^2$</li>
  <li>The <strong>regression variability</strong> is the variability that is explained
by adding the predictor $\sum_{i=1}^n (\hat Y_i - \bar Y)^2$</li>
  <li>The <strong>error variability(residual))</strong> is what‚Äôs leftover around the
regression line $\sum_{i=1}^n (Y_i - \hat Y_i)^2$</li>
  <li>Neat fact
\(\sum_{i=1}^n (Y_i - \bar Y)^2 
= \sum_{i=1}^n (Y_i - \hat Y_i)^2 + \sum_{i=1}^n  (\hat Y_i - \bar Y)^2\)</li>
</ul>

<hr />
<h3 id="r-squared">R squared</h3>

<p>https://www.youtube.com/watch?v=w2FKXOa0HGA</p>

<ul>
  <li>R squared is the percentage of the <strong>total variability that is
explained by the linear relationship with the predictor</strong></li>
</ul>

\[R^2 =
\frac{\sum_{i=1}^n (\hat Y_i - \bar Y)^2}{\sum_{i=1}^n (Y_i - \bar
Y)^2}\]

<p><strong>1-R^2 = residual variation(intercept and slope) / total variation
(only intercept (lm(y~1))))</strong></p>

<p>R^2 = sum_squared(actual-estimate with
regression)/sum_squared(actual-mean without any regressors) =
1-residvariation/total variation</p>

<hr />

<h3 id="some-facts-about-r2">Some facts about $R^2$</h3>
<ul>
  <li>$R^2$ is the percentage of variation explained by the regression model.</li>
  <li>$0 \leq R^2 \leq 1$</li>
  <li><strong>$R^2$ is the sample correlation squared. ???</strong></li>
  <li>$R^2$ can be a <strong>misleading summary of model fit.</strong> Look in the
<strong>anscombe</strong> library for data and the below subsection!
    <ul>
      <li>Deleting data can inflate $R^2$.</li>
      <li>(For later.) Adding terms to a regression model always increases $R^2$.</li>
    </ul>
  </li>
  <li>Do <code class="language-plaintext highlighter-rouge">example(anscombe)</code> to see the following data.
    <ul>
      <li>Basically same mean and variance of X and Y.</li>
      <li>Identical correlations (hence same $R^2$ ).</li>
      <li>Same linear regression relationship.</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="dataanscombeexampleanscombe"><code class="language-plaintext highlighter-rouge">data(anscombe);example(anscombe)</code></h3>

<p>```{r, echo = FALSE, fig.height=5, fig.width=5, results=‚Äôhide‚Äô}
require(stats); require(graphics); data(anscombe)
ff &lt;- y ~ x
mods &lt;- setNames(as.list(1:4), paste0(‚Äúlm‚Äù, 1:4))
for(i in 1:4) {
  ff[2:3] &lt;- lapply(paste0(c(‚Äúy‚Äù,‚Äùx‚Äù), i), as.name)
  ## or   ff[[2]] &lt;- as.name(paste0(‚Äúy‚Äù, i))
  ##      ff[[3]] &lt;- as.name(paste0(‚Äúx‚Äù, i))
  mods[[i]] &lt;- lmi &lt;- lm(ff, data = anscombe)
  #print(anova(lmi))
}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### How to derive R squared (Not required!)
#### For those that are interested
$$
\begin{align}
\sum_{i=1}^n (Y_i - \bar Y)^2 
&amp; = \sum_{i=1}^n (Y_i - \hat Y_i + \hat Y_i - \bar Y)^2 \\
&amp; = \sum_{i=1}^n (Y_i - \hat Y_i)^2 + 
2 \sum_{i=1}^n  (Y_i - \hat Y_i)(\hat Y_i - \bar Y) + 
\sum_{i=1}^n  (\hat Y_i - \bar Y)^2 \\
\end{align}
$$

****
#### Scratch work
$(Y_i - \hat Y_i) = \{Y_i - (\bar Y - \hat \beta_1 \bar X) - \hat \beta_1 X_i\} = (Y_i - \bar Y) - \hat \beta_1 (X_i - \bar X)$

$(\hat Y_i - \bar Y) = (\bar Y - \hat \beta_1 \bar X - \hat \beta_1 X_i - \bar Y )
= \hat \beta_1  (X_i - \bar X)$

$\sum_{i=1}^n  (Y_i - \hat Y_i)(\hat Y_i - \bar Y) 
= \sum_{i=1}^n  \{(Y_i - \bar Y) - \hat \beta_1 (X_i - \bar X))\}\{\hat \beta_1  (X_i - \bar X)\}$

$=\hat \beta_1 \sum_{i=1}^n (Y_i - \bar Y)(X_i - \bar X) -\hat\beta_1^2\sum_{i=1}^n (X_i - \bar X)^2$

$= \hat \beta_1^2 \sum_{i=1}^n (X_i - \bar X)^2-\hat\beta_1^2\sum_{i=1}^n (X_i - \bar X)^2 = 0$


---
### The relation between R squared and r(not required?)
#### (Again not required)
Recall that $(\hat Y_i - \bar Y) = \hat \beta_1  (X_i - \bar X)$
so that
$$
R^2 = \frac{\sum_{i=1}^n  (\hat Y_i - \bar Y)^2}{\sum_{i=1}^n (Y_i - \bar Y)^2}
= \hat \beta_1^2  \frac{\sum_{i=1}^n(X_i - \bar X)^2}{\sum_{i=1}^n (Y_i - \bar Y)^2}
= Cor(Y, X)^2
$$
Since, recall, 
$$
\hat \beta_1 = Cor(Y, X)\frac{Sd(Y)}{Sd(X)}
$$
So, $R^2$ is literally $r$ squared.

## Inference c7-w1
### Recall our model and fitted values
* Consider the model
$$
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i
$$
* $\epsilon \sim N(0, \sigma^2)$. 

* We assume that the true model is known.
* We assume that you've seen confidence intervals and hypothesis tests before.
* $\hat \beta_0 = \bar Y - \hat \beta_1 \bar X$
* $\hat \beta_1 = Cor(Y, X) \frac{Sd(Y)}{Sd(X)}$.

---
### Review (not required! hypothesis testing and condifence intervals)
* Statistics like $\frac{\hat \theta - \theta}{\hat \sigma_{\hat \theta}}$ often have the following properties.
    1. Is normally distributed and has a finite sample Student's T distribution if the  variance is replaced with a sample estimate (under normality assumptions).
    3. Can be used to test $H_0 : \theta = \theta_0$ versus $H_a : \theta &gt;, &lt;, \neq \theta_0$.
    4. Can be used to create a confidence interval for $\theta$ via $\hat \theta \pm Q_{1-\alpha/2} \hat \sigma_{\hat \theta}$
    where $Q_{1-\alpha/2}$ is the relevant quantile from either a normal or T distribution.
* In the case of regression with iid sampling assumptions and normal errors, our inferences will follow
very similarily to what you saw in your inference class.
* We won't cover asymptotics for regression analysis, but suffice it to say that under assumptions 
on the ways in which the $X$ values are collected, the iid sampling model, and mean model, 
the normal results hold to create intervals and confidence intervals

---
### Results
**Variation of the slope is dependent of \sigma and inversely on
variation of the X**

* $\sigma_{\hat \beta_1}^2 = Var(\hat \beta_1) = \sigma^2 /
  \sum_{i=1}^n (X_i - \bar X)^2$
  
**variation of intercepts**
  
* $\sigma_{\hat \beta_0}^2 = Var(\hat \beta_0)  = \left(\frac{1}{n} +
  \frac{\bar X^2}{\sum_{i=1}^n (X_i - \bar X)^2 }\right)\sigma^2$
  
  
* **In practice, $\sigma$ is replaced by its estimate.**

	
* It's probably not surprising that under iid Gaussian errors
$$
\frac{\hat \beta_j - \beta_j}{\hat \sigma_{\hat \beta_j}}
$$
follows a $t$ distribution with $n-2$ degrees of freedom and a normal distribution for large $n$.
* This can be used to create confidence intervals and perform
hypothesis tests.

---
### Understand output of lm(y~x) table

```r
library(UsingR); data(diamond)
y &lt;- diamond$price; x &lt;- diamond$carat; n &lt;- length(y)
beta1 &lt;- cor(y, x) * sd(y) / sd(x)
beta0 &lt;- mean(y) - beta1 * mean(x)
e &lt;- y - beta0 - beta1 * x
sigma &lt;- sqrt(sum(e^2) / (n-2)) 
ssx &lt;- sum((x - mean(x))^2)
seBeta0 &lt;- (1 / n + mean(x) ^ 2 / ssx) ^ .5 * sigma 
seBeta1 &lt;- sigma / sqrt(ssx)
tBeta0 &lt;- beta0 / seBeta0; tBeta1 &lt;- beta1 / seBeta1
pBeta0 &lt;- 2 * pt(abs(tBeta0), df = n - 2, lower.tail = FALSE)
pBeta1 &lt;- 2 * pt(abs(tBeta1), df = n - 2, lower.tail = FALSE)
coefTable &lt;- rbind(c(beta0, seBeta0, tBeta0, pBeta0), c(beta1, seBeta1, tBeta1, pBeta1))
colnames(coefTable) &lt;- c("Estimate", "Std. Error", "t value", "P(&gt;|t|)")
rownames(coefTable) &lt;- c("(Intercept)", "x")
</code></pre></div></div>
<p><strong>t-statistic is computed based on 0 intercept and 0 slope being the
null hypothesis value</strong></p>

<p><strong>Residual variation</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a &lt;- resid(lm(y~x))
sqrt(sum(a^2)/46)
</code></pre></div></div>

<hr />
<h3 id="manually-calculated-coeftable-compared-with-lmyx">Manually calculated coefTable compared with lm(y~x)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coefTable</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            Estimate Std. Error t value   P(&gt;|t|)
(Intercept)   -259.6      17.32  -14.99 2.523e-19
x             3721.0      81.79   45.50 6.751e-40
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"> 
</span><span class="n">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="o">$</span><span class="n">coefficients</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)   -259.6      17.32  -14.99 2.523e-19
x             3721.0      81.79   45.50 6.751e-40
</code></pre></div></div>

<hr />
<h3 id="getting-a-confidence-interval">Getting a confidence interval</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sumCoef</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="o">$</span><span class="n">coefficients</span><span class="w">
</span><span class="n">sumCoef</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="m">.975</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sumCoef</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] -294.5 -224.8
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">sumCoef</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="m">.975</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sumCoef</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 355.6 388.6
</code></pre></div></div>
<p>With 95% confidence, we estimate that a 0.1 carat increase in
diamond size results in a 355.6 to 388.6 increase in price in (Singapore) dollars.</p>

<hr />
<h3 id="prediction-of-outcomes">Prediction of outcomes</h3>
<ul>
  <li>Consider predicting $Y$ at a value of $X$
    <ul>
      <li>Predicting the price of a diamond given the carat</li>
      <li>Predicting the height of a child given the height of the parents</li>
    </ul>
  </li>
  <li>The obvious estimate for prediction at point $x_0$ is 
\(\hat \beta_0 + \hat \beta_1 x_0\)</li>
  <li>A standard error is needed to create a prediction interval.</li>
  <li>There‚Äôs a distinction between intervals for the regression
line at point $x_0$ and the prediction of what a $y$ would be
at point $x_0$.</li>
  <li>Line at $x_0$ se, $\hat \sigma\sqrt{\frac{1}{n} +  \frac{(x_0 - \bar X)^2}{\sum_{i=1}^n (X_i - \bar X)^2}}$</li>
  <li>
    <p>Prediction interval se at $x_0$, $\hat \sigma\sqrt{1 + \frac{1}{n} + \frac{(x_0 - \bar X)^2}{\sum_{i=1}^n (X_i - \bar X)^2}}$</p>
  </li>
  <li>
    <p>There are two things we are interested as part of the prediction
interval we see in the lm plots with ggplot,</p>

    <ul>
      <li>
        <p>The confidence interval for the line itself at x0 keeping in
mind a population</p>
      </li>
      <li>
        <p>the prediction interval at x0 keeping in mind the population.</p>
      </li>
    </ul>
  </li>
</ul>

<p><strong>Prediction variance varies with the following:</strong></p>

<ul>
  <li>
    <p>$\hat \sigma$; Increases with less R^2 error.</p>
  </li>
  <li>
    <p>$\frac{1}{n}$ goes down with more samples! sqrt(1/n) is always part
of it.</p>
  </li>
  <li>
    <p>$\frac{(x_0 - \bar X)^2$; Best prediction when x0 is closest to average</p>
  </li>
  <li>
    <p>$\sum_{i=1}^n (X_i - \bar X)^2}$ More variability in the X term
leads to less variability in the in the interval.</p>
  </li>
</ul>

<hr />
<h3 id="plotting-the-prediction-intervals-and-confidence-intervals">Plotting the prediction intervals and confidence intervals</h3>

<p>```{r, fig.height=5, fig.width==5, echo = FALSE, results=‚Äôhide‚Äô}
library(ggplot2)
newx = data.frame(x = seq(min(x), max(x), length = 100))
p1 = data.frame(predict(fit, newdata= newx,interval = (‚Äúconfidence‚Äù)))
p2 = data.frame(predict(fit, newdata = newx,interval = (‚Äúprediction‚Äù)))
p1$interval = ‚Äúconfidence‚Äù
p2$interval = ‚Äúprediction‚Äù
p1$x = newx$x
p2$x = newx$x
dat = rbind(p1, p2)
names(dat)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a> = ‚Äúy‚Äù
g = ggplot(dat, aes(x = x, y = y))
g = g + geom_ribbon(aes(ymin = lwr, ymax = upr, fill = interval), alpha = 0.2) 
g = g + geom_line()
g = g + geom_point(data = data.frame(x = x, y=y), aes(x = x, y = y), size = 4)
g</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
http://www2.stat.duke.edu/~tjl13/s101/slides/unit6lec3H.pdf

Is very important especially this following line:

&gt; Two type of intervals available:
&gt; - Confidence interval for the average foster twin‚Äôs IQ
&gt; - Prediction interval for a single foster twin‚Äôs IQ

Average or slope is associated with confidence interval, and
prediction is associated with single or expected value


&gt; A confidence interval gives a range for $\text{E}[y \mid x]$, as you
&gt; say. A prediction interval gives a range for $y$ itself. Naturally,
&gt; our best guess for $y$ is $\text{E}[y \mid x]$, so the intervals
&gt; will both be centered around the same value, $x\hat{\beta}$.


### Predicting with new data

Absolute nonsense with respect to R's way of work!
https://stackoverflow.com/questions/15115909/feeding-newdata-to-r-predict-function

	
	 Note:

     Variables are first looked for in ‚Äònewdata‚Äô and then searched for
     in the usual way (which will include the environment of the
     formula used in the fit).  A warning will be given if the
     variables found are not of the same length as those in ‚Äònewdata‚Äô
     if it was supplied.
  
So if you do 
	
	newx &lt;- 3
	predict(fit, newdata=newx, interval=("prediction")) 

This wont work. R is looking for the x variable name in newX

	newx&lt;-data.frame(x=x0)
	predict(fit, newdata=newx, interval=("prediction")) 
	
works! my god!

---
### Discussion an agent and Bcaffo's understanding!

* Both intervals have varying widths.
  * Least width at the mean of the Xs.
* We are quite confident in the regression line, so that 
  interval is very narrow.
  * If we knew $\beta_0$ and $\beta_1$ this interval would have zero width.
* The prediction interval must incorporate the variabilibity
  in the data around the line.
  * Even if we knew $\beta_0$ and $\beta_1$ this interval would still have width.


**Plotting this shows a couple of things:**

- salmon bands are thin and represent the prediction of the line
  itself (confidence)
  
  - the confidence bands are thinner than the prediction bands.
  
- confidence bands (salmon)

	- The confidence bands  show the uncertainty in predicting the
      line itself. If there are more and more points this uncertainty
      would reduce. It is about beta1 the slope. 

	
	- the prediction bands show the uncertainty in predicting Y0. They
      will always exist even when there are a million points as the
      linear regression cannot account for everything.
	  
- they grow smaller at the mean and then become big away from the
  center.
  
---

### In R
```{r, fig.height=5, fig.width=5, echo=FALSE,results='hide'}
newdata &lt;- data.frame(x = xVals)
p1 &lt;- predict(fit, newdata, interval = ("confidence"))
p2 &lt;- predict(fit, newdata, interval = ("prediction"))
plot(x, y, frame=FALSE,xlab="Carat",ylab="Dollars",pch=21,col="black", bg="lightblue", cex=2)
abline(fit, lwd = 2)
lines(xVals, p1[,2]); lines(xVals, p1[,3])
lines(xVals, p2[,2]); lines(xVals, p2[,3])
</code></pre></div></div>

<h3 id="based-on-khan-academy">Based on khan academy</h3>

<h2 id="quiz-c7-w2">Quiz c7-w2</h2>

<ol>
  <li>
    <p>Consider the following data with x as the predictor and y as as the
outcome. Give a P-value for the two sided hypothesis test of
whether Œ≤1 ‚Äãfrom a linear regression model is 0 or not.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> x &lt;- c(0.61, 0.93, 0.83, 0.35, 0.54, 0.16, 0.91, 0.62, 0.62)
 y &lt;- c(0.67, 0.84, 0.6, 0.18, 0.85, 0.47, 1.1, 0.65, 0.36)
	

 summary(lm(y ~ x))$coef
</code></pre></div>    </div>
  </li>
  <li>
    <p>Consider the previous problem, give the estimate of the residual
standard deviation.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> summary(lm(y ~ x))$sigma
</code></pre></div>    </div>
  </li>
  <li>
    <p>In the \verb|mtcars|mtcars data set, fit a linear regression model
of weight (predictor) on mpg (outcome). Get a 95% confidence
interval for the <strong>expected mpg</strong> at the average weight. What is the
lower endpoint?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> data(mtcars)
 fit &lt;- lm(mpg ~ I(wt - mean(wt)), data = mtcars)
 confint(fit)
	
 or
 fit &lt;- lm(mpg~wt,data=mtcars)
 predict(fit,newdata=data.frame(wt=mean(df$wt)),
 interval="confidence")
</code></pre></div>    </div>
  </li>
  <li>
    <p>Refer to the previous question. Read the help file for
\verb|mtcars|mtcars. What is the weight coefficient interpreted as?</p>

    <p>The estimated expected change in mpg per 1,000 lb increase in
weight.</p>
  </li>
  <li>
    <p>Consider again the \verb|mtcars|mtcars data set and a linear
regression model with mpg as predicted by weight (1,000 lbs). A new
car is coming weighing 3000 pounds. Construct a 95% prediction
interval for its mpg. What is the upper endpoint?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> fit &lt;- lm(mpg ~ wt, data = mtcars)
 predict(fit, newdata = data.frame(wt = 3), interval = "prediction")
</code></pre></div>    </div>
  </li>
  <li>
    <p>Consider again the \verb|mtcars|mtcars data set and a linear
regression model with mpg as predicted by weight (in 1,000 lbs). A
‚Äúshort‚Äù ton is defined as 2,000 lbs. Construct a 95% confidence
interval for the expected change in mpg per 1 short ton increase in
weight. Give the lower endpoint.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> fit &lt;- lm(mpg ~ wt, data = mtcars)
 confint(fit)[2, ] * 2
	
 fit &lt;- lm(mpg ~ I(wt * 0.5), data = mtcars)
 confint(fit)[2, ]
</code></pre></div>    </div>

    <p>confint gives info about confidence of the slope and intercept as
 is asked in the question‚Ä¶</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>             Estimate Std. Error t value Pr(&gt;|t|)    
 (Intercept)   37.285      1.878  19.858  &lt; 2e-16 ***
 x            -10.689      1.118  -9.559 1.29e-10 ***
	
	
 -10.689+ c(1,-1)*1.118* qt(0.975,30) gives the same values!
</code></pre></div>    </div>
  </li>
  <li>
    <p>If my X from a linear regression is measured in centimeters and I
convert it to meters what would happen to the slope coefficient?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> It would get multiplied by 100
</code></pre></div>    </div>
  </li>
  <li>
    <p>I have an outcome, YY, and a predictor, XX and fit a linear
regression model with Y=Œ≤0+Œ≤1X+œµ to obtain Œ≤^0 and Œ≤^1. What would
be the consequence to the subsequent slope and intercept if I were
to refit the model with a new regressor, X + cX+c for some
constant, cc?</p>

    <p>The new intercept would be Œ≤^0‚àícŒ≤^1</p>
  </li>
  <li>
    <p>Refer back to the mtcars data set with mpg as an outcome and weight
(wt) as the predictor. About what is the ratio of the the sum of
the squared errors, ‚àëni=1(Yi‚àíY^i)2 when comparing a model with just
an intercept (denominator) to the model with the intercept and
slope (numerator)?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> fit1 &lt;- lm(mpg ~ wt, data = mtcars)
 fit2 &lt;- lm(mpg ~ 1, data = mtcars)
 1 - summary(fit1)$r.squared
	
	
 sse1 &lt;- sum((predict(fit1) - mtcars$mpg)^2)
 sse2 &lt;- sum((predict(fit2) - mtcars$mpg)^2)
 sse1/sse2
</code></pre></div>    </div>
  </li>
  <li>
    <p>Do the residuals always have to sum to 0 in linear regression?</p>

    <p>If an intercept is included, then they will sum to 0</p>
  </li>
</ol>

<p>3, <del>6</del> except for Xa and beta/a, 7, and 5 with the confidence intervals are quite a mistery!</p>

<h3 id="summary-of-inference">Summary of inference</h3>

<p>There seem to be 3 confidence intervals:</p>

<ol>
  <li>
    <p>Confint of slope</p>

    <p>Can be found from <code class="language-plaintext highlighter-rouge">confint(fit)</code> or from summary of fit</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> fit &lt;- lm(mpg ~ I(wt * 0.5), data = mtcars)
 confint(fit)[2, ]
		
 OR
	
             Estimate Std. Error t value Pr(&gt;|t|)    
 (Intercept)   37.285      1.878  19.858  &lt; 2e-16 ***
 x            -10.689      1.118  -9.559 1.29e-10 ***
	
	
 -10.689+ c(1,-1)*1.118* qt(0.975,30) gives the same values!
</code></pre></div>    </div>
  </li>
  <li>
    <p>Conf interval of expected value (aka, average)</p>

    <p>This is when you want to find the variation of the avg of Y at an
 x_i</p>

    <p>This can be found with predict variable, but sometimes also with
 confint which is confusing to me. The relation between expected
 value and slope is not clear!</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> data(mtcars)
 fit &lt;- lm(mpg ~ I(wt - mean(wt)), data = mtcars)
 confint(fit)
	
 or
 fit &lt;- lm(mpg~wt,data=mtcars)
 predict(fit,newdata=data.frame(wt=mean(df$wt)),
 interval="confidence")
</code></pre></div>    </div>

    <p><em>I don‚Äôt get the difference but whatever</em></p>
  </li>
  <li>
    <p>Prediction interval for the actual value of Y and not the expected
value</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> fit &lt;- lm(mpg ~ wt, data = mtcars)
 predict(fit, newdata = data.frame(wt = 3), interval = "prediction")
</code></pre></div>    </div>
  </li>
</ol>

<p>This is it! for now. As needed we can go into depths!</p>

<p><strong>Note</strong></p>

<p>Ths summary of fit gives a lot of info. The t.value is the value under
the null hypothesis and not the 95% confidence interval thingy!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	            Estimate Std. Error t value Pr(&gt;|t|)    
	(Intercept)   37.285      1.878  19.858  &lt; 2e-16 ***
	x            -10.689      1.118  -9.559 1.29e-10 ***
</code></pre></div></div>

<p>That about sums it up! Cheers!</p>

<h2 id="c7-w3-multivariate-regression">c7-w3 multivariate regression</h2>

<h3 id="multivariable-regression-analyses-why">Multivariable regression analyses Why?</h3>
<ul>
  <li>If I were to present evidence of a relationship between breath mint
useage (mints per day, X) and pulmonary function (measured in FEV),
you would be skeptical.
    <ul>
      <li>Likely, you would say, ‚Äòsmokers tend to use more breath mints than
non smokers, smoking is related to a loss in pulmonary
function. That‚Äôs probably the culprit.‚Äô</li>
      <li>If asked what would convince you, you would likely say, ‚ÄòIf
non-smoking breath mint users had lower lung function than
non-smoking non-breath mint users and, similarly, if smoking
breath mint users had lower lung function than smoking non-breath
mint users, I‚Äôd be more inclined to believe you‚Äô.</li>
    </ul>
  </li>
  <li>In other words, to even consider my results, I would have to
demonstrate that they hold while holding smoking status fixed.</li>
</ul>

<hr />
<h3 id="multivariable-regression-analyses-why-people-are-interested">Multivariable regression analyses Why people are interested?</h3>
<ul>
  <li>An insurance company is interested in how last year‚Äôs claims can
predict a person‚Äôs time in the hospital this year.
    <ul>
      <li>They want to use an enormous amount of data contained in claims to
predict a single number. Simple linear regression is not equipped
to handle more than one predictor.</li>
    </ul>
  </li>
  <li>How can one generalize SLR to incoporate lots of regressors for the
purpose of prediction?</li>
  <li>
    <p>What are the consequences of adding lots of regressors?</p>

    <ul>
      <li>Surely there must be consequences to throwing variables in that
aren‚Äôt related to Y?</li>
      <li>Surely there must be consequences to omitting variables that are?</li>
    </ul>
  </li>
</ul>

<p><strong>With sufficient random vectors you can come up with 0 residuals</strong></p>

<hr />
<h3 id="the-linear-model-equations">The linear model Equations</h3>

<ul>
  <li>
    <p>The general linear model extends simple linear regression (SLR) by
adding terms linearly into the model.  \(Y_i = \beta_1 X_{1i} +
\beta_2 X_{2i} + \ldots + \beta_{p} X_{pi} + \epsilon_{i} =
\sum_{k=1}^p X_{ik} \beta_j + \epsilon_{i}\)</p>

    <p><strong>Outcome = Predictor * coefficients</strong></p>
  </li>
  <li>
    <p>Here $X_{1i}=1$ typically, so that an intercept is included.</p>
  </li>
  <li>
    <p><strong>Least squares</strong> (and hence ML estimates under iid Gaussianity of
the errors) minimizes</p>

    <p><strong>\(\sum_{i=1}^n \left(Y_i - \sum_{k=1}^p X_{ki} \beta_j\right)^2\)</strong></p>

    <p><strong>Minimizing overall error by looking at error at each point ‚Äòi‚Äô,
  and over</strong></p>
  </li>
  <li>
    <p>Note, the important linearity is linearity in the coefficients.
Thus \(Y_i = \beta_1 X_{1i}^2 + \beta_2 X_{2i}^2 + \ldots + \beta_{p}
X_{pi}^2 + \epsilon_{i}\) is still a linear model. (We‚Äôve just
squared the elements of the predictor variables.)</p>

    <p><strong>Whether the same beta holds when you square the variable, am not
sure! but moving on!</strong></p>
  </li>
</ul>

<hr />

<h3 id="how-to-get-estimates-expected-values-least-squares">How to get estimates Expected values Least squares!</h3>

<ul>
  <li>Recall that the LS estimate for regression through the origin,
$E[Y_i]=X_{1i}\beta_1$, was $\sum X_i Y_i / \sum X_i^2$.</li>
  <li>Let‚Äôs consider two regressors, $E[Y_i] = X_{1i}\beta_1 +
X_{2i}\beta_2 = \mu_i$.</li>
</ul>

<p><strong>* Least squares tries to minimize</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$$ \sum_{i=1}^n (Y_i - X_{1i} \beta_1 - X_{2i} \beta_2)^2 $$
</code></pre></div></div>

<hr />
<h3 id="result">Result</h3>

\[\hat \beta_1 = \frac{\sum_{i=1}^n e_{i, Y | X_2} e_{i, X_1 |
X_2}}{\sum_{i=1}^n e_{i, X_1 | X_2}^2}\]

<ul>
  <li>
    <p><strong>That is, the regression estimate for $\beta_1$ is the regression
through the origin estimate having regressed $X_2$ out of both the
response and the predictor.</strong></p>

    <p><strong>What does this even mean?</strong></p>
  </li>
  <li>(Similarly, the regression estimate for $\beta_2$ is the regression
through the origin estimate having regressed $X_1$ out of both the
response and the predictor.)</li>
  <li>More generally, multivariate regression estimates are exactly those
having removed the linear relationship of the other variables from
both the regressor and response.</li>
</ul>

<hr />
<h3 id="example-with-two-variables-simple-linear-regression-important">Example with two variables, simple linear regression (<strong>important</strong>)</h3>

<ul>
  <li>
    <p>$Y_{i} = \beta_1 X_{1i} + \beta_2 X_{2i}$ where <strong>$X_{2i} = 1$ is an
intercept term.</strong></p>

    <p>Think of X2 as the number of people who smoke, you fix it at 1
person smoking (aka the intercept term!)</p>
  </li>
  <li>Notice the fitted coefficient of $X_{2i}$ on $Y_{i}$ is $\bar Y$
    <ul>
      <li>
        <table>
          <tbody>
            <tr>
              <td>The residuals $e_{i, Y</td>
              <td>X_2} = Y_i - \bar Y$</td>
            </tr>
          </tbody>
        </table>
      </li>
    </ul>
  </li>
  <li>Notice the fitted coefficient of $X_{2i}$ on $X_{1i}$ is $\bar X_1$
    <ul>
      <li>
        <table>
          <tbody>
            <tr>
              <td>The residuals $e_{i, X_1</td>
              <td>X_2}= X_{1i} - \bar X_1$</td>
            </tr>
          </tbody>
        </table>
      </li>
    </ul>
  </li>
  <li>
    <p>Thus \(\hat \beta_1 = \frac{\sum_{i=1}^n e_{i, Y | X_2} e_{i, X_1 |
X_2}}{\sum_{i=1}^n e_{i, X_1 | X_2}^2} = \frac{\sum_{i=1}^n (X_i -
\bar X)(Y_i - \bar Y)}{\sum_{i=1}^n (X_i - \bar X)^2} = Cor(X, Y)
\frac{Sd(Y)}{Sd(X)}\)</p>
  </li>
  <li>
    <p>choose an intercept value for X2?</p>
  </li>
  <li>
    <p>get rid of X2 by centering Y and X</p>
  </li>
  <li>compute the ‚Äúorigin intercept lm‚Äù for yc~xc,</li>
</ul>

<p>I don‚Äôt get it though!</p>

<ul>
  <li>and same beta formula with correlation</li>
</ul>

<hr />
<h3 id="the-general-case">The general case</h3>
<ul>
  <li>Least squares solutions have to minimize \(\sum_{i=1}^n (Y_i -
X_{1i}\beta_1 - \ldots - X_{pi}\beta_p)^2\)</li>
  <li>The least squares estimate for the coefficient of a multivariate
regression model is exactly regression through the origin with the
linear relationships with the other regressors removed from both the
regressor and outcome by taking residuals.?????????????</li>
  <li>In this sense, multivariate regression ‚Äúadjusts‚Äù a coefficient for
the linear impact of the other variables.</li>
</ul>

<p>beta 1 -&gt; All the variable from X2 to Xp have been ‚Äúlinearly‚Äù removed
from Y and X1</p>

<hr />

<h3 id="demonstration-that-it-works-using-an-example">Demonstration that it works using an example</h3>
<h4 id="linear-model-with-two-variables">Linear model with two variables</h4>
<pre><code class="language-{r}">n = 100; x = rnorm(n); x2 = rnorm(n); x3 = rnorm(n)
y = 1 + x + x2 + x3 + rnorm(n, sd = .1)
ey = resid(lm(y ~ x2 + x3))
ex = resid(lm(x ~ x2 + x3))
sum(ey * ex) / sum(ex ^ 2)
coef(lm(ey ~ ex - 1))
coef(lm(y ~ x + x2 + x3)) 
</code></pre>

<p>So what you do is remove x2 and x3 aka, take residuals from a fit on
them. This way the residuals ey and ex are without x2 and x3
contribution. and why we then do <strong>-1</strong> is beyond me!</p>

<hr />
<h3 id="interpretation-of-the-coeficients">Interpretation of the coeficients</h3>
<p>\(E[Y | X_1 = **x_1**, \ldots, X_p = x_p] = \sum_{k=1}^p x_{k}
\beta_k\)</p>

\[E[Y | X_1 = **x_1 + 1**, \ldots, X_p = x_p] = (x_1 + 1) \beta_1 +
\sum_{k=2}^p x_{k} \beta_k\]

<p>\(**E[Y**| X_1 = **x_1 + 1**, \ldots, X_p = x_p] **-** **E[Y |** X_1
= **x_1**, \ldots, X_p = x_p]\) \(= (x_1 + 1) \beta_1 + \sum_{k=2}^p
x_{k} \beta_k + \sum_{k=1}^p x_{k} \beta_k **= \beta_1**\)</p>

<p><strong>So that the interpretation of a multivariate regression coefficient is
the expected change in the response per unit change in the regressor,
holding all of the other regressors fixed.</strong></p>

<p>In the next lecture, we‚Äôll do examples and go over context-specific
interpretations.</p>

<hr />
<h3 id="fitted-values-residuals-and-residual-variation">Fitted values, residuals and residual variation</h3>
<p>All of our SLR quantities can be extended to linear models</p>
<ul>
  <li>Model $Y_i = \sum_{k=1}^p X_{ik} \beta_{k} + \epsilon_{i}$ where
$\epsilon_i \sim N(0, \sigma^2)$</li>
  <li>Fitted responses $\hat Y_i = \sum_{k=1}^p X_{ik} \hat \beta_{k}$</li>
  <li>Residuals $e_i = Y_i - \hat Y_i$</li>
  <li>Variance estimate $\hat \sigma^2 = \frac{1}{n-p} \sum_{i=1}^n e_i
^2$</li>
  <li>To get predicted responses at new values, $x_1, \ldots, x_p$, simply
plug them into the linear model $\sum_{k=1}^p x_{k} \hat \beta_{k}$</li>
  <li>Coefficients have standard errors, $\hat \sigma_{\hat \beta_k}$, and
$\frac{\hat \beta_k - \beta_k}{\hat \sigma_{\hat \beta_k}}$ follows a
$T$ distribution with $n-p$ degrees of freedom.</li>
  <li>Predicted responses have standard errors and we can calculate
predicted and expected response intervals.</li>
</ul>

<hr />
<h3 id="linear-models">Linear models</h3>
<ul>
  <li>Linear models are the single most important applied statistical and
machine learning techniqe, <em>by far</em>.</li>
  <li>Some amazing things that you can accomplish with linear models
    <ul>
      <li>Decompose a signal into its harmonics.</li>
      <li>Flexibly fit complicated functions.</li>
      <li>Fit factor variables as predictors.</li>
      <li>Uncover complex multivariate relationships with the response.</li>
      <li>Build accurate prediction models.
        <h2 id="multivariate-examples-c7-w3">Multivariate examples (c7-w3)</h2>
        <h3 id="data-set-for-discussion">Data set for discussion</h3>
        <h4 id="requiredatasets-dataswiss-swiss"><code class="language-plaintext highlighter-rouge">require(datasets); data(swiss); ?swiss</code></h4>
        <p>Standardized fertility measure and socio-economic indicators for each of 47 French-speaking provinces of Switzerland at about 1888.</p>
      </li>
    </ul>
  </li>
</ul>

<p>A data frame with 47 observations on 6 variables, each of which is in percent, i.e., in [0, 100].</p>

<ul>
  <li>[,1]   Fertility          a common standardized fertility measure</li>
  <li>[,2]   Agriculture        % of males involved in agriculture as occupation</li>
  <li>[,3]	 Examination        % draftees receiving highest mark on army examination</li>
  <li>[,4]	 Education          % education beyond primary school for draftees</li>
  <li>[,5]	 Catholic           % catholic (as opposed to protestant)</li>
  <li>[,6]	 Infant.Mortality   live births who live less than 1 year</li>
</ul>

<p>All variables but Fertility give proportions of the population.</p>

<hr />

<p><strong>Nice plot that shows all variations</strong></p>

<p>```{r, fig.height=6, fig.width=10, echo = FALSE}
require(datasets); data(swiss); require(GGally); require(ggplot2)
g = ggpairs(swiss, lower = list(continuous = ‚Äúsmooth‚Äù),params = c(method = ‚Äúloess‚Äù))
g</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Calling `lm` for all variables "lm(y~.)"

`summary(lm(Fertility ~ . , data = swiss))`

```{r, echo = FALSE}
summary(lm(Fertility ~ . , data = swiss))$coefficients
</code></pre></div></div>
<p>Agriculture -0.17 slope without the contributions of other variables!</p>

<hr />
<h3 id="example-interpretation-importance-of-removing-variables">Example interpretation (importance of removing variables)</h3>

<ul>
  <li>Agriculture is expressed in percentages (0 - 100)</li>
  <li><strong>Estimate is -0.1721.</strong></li>
  <li>Our models estimates an expected 0.17 decrease in standardized
fertility for every 1% increase in percentage of males involved in
agriculture in holding the remaining variables constant.</li>
  <li>The t-test for $H_0: \beta_{Agri} = 0$ versus $H_a: \beta_{Agri} \neq 0$ is  significant.</li>
  <li>Interestingly, the unadjusted estimate is</li>
</ul>

<pre><code class="language-{r}">summary(lm(Fertility ~ Agriculture, data = swiss))$coefficients
</code></pre>

<p><strong>0.19</strong></p>

<p>‚ÄúIf there hasn‚Äôt been randomization to protect you from the founding
you are going to have to come up with a dynamic process of choosing
which variables etc‚Ä¶‚Äù</p>

<hr />
<p><strong>How can adjustment reverse the sign of an effect? Let‚Äôs try a
simulation.</strong></p>

<p>```{r, echo = TRUE}
n &lt;- 100; x2 &lt;- 1 : n; x1 &lt;- .01 * x2 + runif(n, -.1, .1); y = -x1 + x2 + rnorm(n, sd = .01)
summary(lm(y ~ x1))$coef
summary(lm(y ~ x1 + x2))$coef</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**First output coeff is 95 instead of "-1". Quite a blunder! The linear
model is picking up on the large contribution of x2 on Y and making
its own fit which is absolutely not correct. x2 is uniform noise which
spikes up the value of x1**

---

**Plot of y vs x1 and x2 to see all trends in one image!**

Does show the "fake relationship" between y and x1, we also see how y
is dependent on x2 and x1 is dependent on x2.

```{r, echo = FALSE, fig.height=5, fig.width=10, results = 'show'}
dat = data.frame(y = y, x1 = x1, x2 = x2, ey = resid(lm(y ~ x2)), ex1
= resid(lm(x1 ~ x2)))

library(ggplot2)
g = ggplot(dat, aes(y = y, x = x1, colour = x2))
g = g + geom_point(colour="grey50", size = 5) + geom_smooth(method = lm, se = FALSE, colour = "black") 
g = g + geom_point(size = 4) 
g
</code></pre></div></div>

<p>So we need to remove the effect of x2 from both y and x1 i.e., by
taking the residual, which is the left over data.
```{r, echo = FALSE, fig.height=5, fig.width=10, results = ‚Äòshow‚Äô}
g2 = ggplot(dat, aes(y = ey, x = ex1, colour = x2))<br />
g2 = g2 + geom_point(colour=‚Äùgrey50‚Äù, size = 5) + geom_smooth(method = lm, se = FALSE, colour = ‚Äúblack‚Äù) + geom_point(size = 4) 
g2</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
It is very clear with this plot that, x2 is now properly randomized
and the true relationship pops out.

---
	
### Back to this data set
* The sign reverses itself with the inclusion of Examination and
  Education.
* The percent of males in the province working in agriculture is
  negatively related to educational attainment (correlation of `r
  cor(swiss$Agriculture, swiss$Education)`) and Education and
  Examination (correlation of `r cor(swiss$Education,
  swiss$Examination)`) are obviously measuring similar things.
  * Is the positive marginal an artifact for not having accounted for,
    say, Education level? (Education does have a stronger effect, by
    the way.)
* At the minimum, anyone claiming that provinces that are more
  agricultural have higher fertility rates would immediately be open
  to criticism.

---
### What if we include an unnecessary variable?
z adds no new linear information, since it's a linear
combination of variables already included. R just drops 
terms that are linear combinations of other terms.
```{r, echo = TRUE}
z &lt;- swiss$Agriculture + swiss$Education
lm(Fertility ~ . + z, data = swiss)
</code></pre></div></div>

<p>When Z is a linear combination of other variables then you get NA when
you remove the components of z to do lm(y~z).</p>

<hr />
<h3 id="dummy-variables-are-smart">Dummy variables are smart</h3>

<ul>
  <li>Consider the linear model \(Y_i = \beta_0 + X_{i1} \beta_1 +
\epsilon_{i}\) where each <strong>$X_{i1}$ is binary</strong> so that it is a 1 if
measurement $i$ is in a group and 0 otherwise. (Treated versus not in
a clinical trial, for example.)</li>
  <li>Then for people in the group $E[Y_i] = \beta_0 + \beta_1$</li>
  <li>And for people not in the group $E[Y_i] = \beta_0$</li>
  <li>The LS fits work out to be $\hat \beta_0 + \hat \beta_1$ is the mean
for those in the group and $\hat \beta_0$ is the mean for those not
in the group.</li>
  <li>$\beta_1$ is interpretted as the increase or decrease in the mean
comparing those in the group to those not.</li>
  <li>
    <p>Note including a binary variable that is 1 for those not in the
group would be redundant. It would create three parameters to
describe two means. ???</p>
  </li>
  <li>basically we can lm binary factor variables too!  They give means
and change compared to the lower group!</li>
</ul>

<hr />
<h3 id="more-than-2-levels">More than 2 levels</h3>

<ul>
  <li>Consider a multilevel factor level. For didactic reasons, let‚Äôs say
a three level factor (example, US political party affiliation:
Republican, Democrat, Independent)</li>
  <li>$Y_i = \beta_0 + X_{i1} \beta_1 + X_{i2} \beta_2 + \epsilon_i$.</li>
  <li>$X_{i1}$ is 1 for Republicans and 0 otherwise.</li>
  <li>$X_{i2}$ is 1 for Democrats and 0 otherwise.</li>
  <li>If $i$ is Republican $E[Y_i] = \beta_0 +\beta_1$</li>
  <li>If $i$ is Democrat $E[Y_i] = \beta_0 + \beta_2$.</li>
  <li>If $i$ is Independent $E[Y_i] = \beta_0$.</li>
  <li>$\beta_1$ compares Republicans to Independents.</li>
  <li>$\beta_2$ compares Democrats to Independents.</li>
  <li>$\beta_1 - \beta_2$ compares Republicans to Democrats.</li>
  <li>(Choice of reference category changes the interpretation.)</li>
</ul>

<p><strong>Warning:</strong>What you choose as your reference somehow has big effect on how you
interpret! What does it mean? maybe the examples show more info!</p>

<hr />
<h3 id="insect-sprays-understanding-factors-and-dummy-variables">Insect Sprays (Understanding factors and dummy variables!)</h3>
<p>```{r, echo = FALSE, fig.height=5, fig.width=5}
require(datasets);data(InsectSprays); require(stats); require(ggplot2)
g = ggplot(data = InsectSprays, aes(y = count, x = spray, fill  = spray))
g = g + geom_violin(colour = ‚Äúblack‚Äù, size = 2)
g = g + xlab(‚ÄúType of spray‚Äù) + ylab(‚ÄúInsect count‚Äù)
g</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        Estimate Std. Error t value  Pr(&gt;|t|) (Intercept)  14.5000      1.132 12.8074 1.471e-19 sprayB        0.8333      1.601  0.5205 6.045e-01 sprayC      -12.4167      1.601 -7.7550 7.267e-11 sprayD       -9.5833      1.601 -5.9854 9.817e-08 sprayE      -11.0000      1.601 -6.8702 2.754e-09 sprayF        2.1667      1.601  1.3532 1.806e-01 ```
</code></pre></div></div>

<p>Spray is missing as it is the reference B0 with mean of 14.5 and
everything else is compared to it, i.e., mean of spray b is 14.5+0.833
etc‚Ä¶</p>

<p>Spray A is the dummy variable!</p>

<hr />
<h4 id="linear-model-fit-group-a-is-the-reference">Linear model fit, group A is the reference</h4>
<p>```{r, echo= TRUE}
summary(lm(count ~ spray, data = InsectSprays))$coef</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
#### Hard coding the dummy variables
```{r, echo= TRUE}
summary(lm(count ~ 
             I(1 * (spray == 'B')) + I(1 * (spray == 'C')) + 
             I(1 * (spray == 'D')) + I(1 * (spray == 'E')) +
             I(1 * (spray == 'F'))
           , data = InsectSprays))$coef
</code></pre></div></div>

<hr />
<h4 id="what-if-we-include-all-6">What if we include all 6?</h4>
<p>```{r, echo= TRUE}
summary(lm(count ~ 
   I(1 * (spray == ‚ÄòB‚Äô)) + I(1 * (spray == ‚ÄòC‚Äô)) +<br />
   I(1 * (spray == ‚ÄòD‚Äô)) + I(1 * (spray == ‚ÄòE‚Äô)) +
   I(1 * (spray == ‚ÄòF‚Äô)) + I(1 * (spray == ‚ÄòA‚Äô)), data = InsectSprays))$coef</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
#### What if we omit the intercept?
```{r, echo= TRUE}
summary(lm(count ~ spray - 1, data = InsectSprays))$coef
library(dplyr)
summarise(group_by(InsectSprays, spray), mn = mean(count))
</code></pre></div></div>
<p>When you omit the intercept its all about 0. All the P values and t
statistics are about a null hypothesis 0 instead of spray A.</p>

<hr />
<h3 id="reordering-the-levels">Reordering the levels</h3>
<pre><code class="language-{r}">spray2 &lt;- relevel(InsectSprays$spray, "C")
summary(lm(count ~ spray2, data = InsectSprays))$coef
</code></pre>

<hr />

<h4 id="summary-9">Summary</h4>
<ul>
  <li>If we treat Spray as a factor, R includes an intercept and omits the alphabetically first level of the factor.
    <ul>
      <li>All t-tests are for comparisons of Sprays versus Spray A.</li>
      <li>Emprirical mean for A is the intercept.</li>
      <li>Other group means are the itc plus their coefficient.</li>
    </ul>
  </li>
  <li>If we omit an intercept, then it includes terms for all levels of the factor.
    <ul>
      <li>Group means are the coefficients.</li>
      <li>Tests are tests of whether the groups are different than zero. (Are the expected counts zero for that spray.)</li>
    </ul>
  </li>
  <li>If we want comparisons between, Spray B and C, say we could refit the model with C (or B) as the reference level.</li>
</ul>

<hr />
<h3 id="other-thoughts-on-this-data">Other thoughts on this data</h3>
<ul>
  <li>Counts are bounded from below by 0, violates the assumption of normality of the errors.
    <ul>
      <li>Also there are counts near zero, so both the actual assumption and the intent of the assumption are violated.</li>
    </ul>
  </li>
  <li>Variance does not appear to be constant.</li>
  <li>Perhaps taking logs of the counts would help.
    <ul>
      <li>There are 0 counts, so maybe log(Count + 1)</li>
    </ul>
  </li>
  <li>Also, we‚Äôll cover Poisson GLMs for fitting count data.</li>
</ul>

<hr />

<h3 id="modelling-the-data-as-b0b1x1b2x2-and-b0b3x1x2">Modelling the data as b0+b1X1+b2X2 and b0+‚Ä¶+b3X1X2</h3>

<p>Two types of modelling is possible leading to either</p>

<p>one intercept and one slope</p>

<p>or</p>

<p>2 intercepts and 2 different slopes</p>

<h4 id="recall-the-swiss-data-set">Recall the <code class="language-plaintext highlighter-rouge">swiss</code> data set</h4>

<pre><code class="language-{r}">library(datasets); data(swiss)
head(swiss)
</code></pre>

<hr />
<h4 id="create-a-binary-variable">Create a binary variable</h4>
<pre><code class="language-{r}">library(dplyr); 
swiss = mutate(swiss, CatholicBin = 1 * (Catholic &gt; 50))
</code></pre>

<hr />
<h4 id="plot-the-data">Plot the data</h4>

<p>```{r, fig.height=5, fig.width=8, echo = FALSE}
g = ggplot(swiss, aes(x = Agriculture, y = Fertility, colour = factor(CatholicBin)))
g = g + geom_point(size = 6, colour = ‚Äúblack‚Äù) + geom_point(size = 4)
g = g + xlab(‚Äú% in Agriculture‚Äù) + ylab(‚ÄúFertility‚Äù)
g</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
#### No effect of religion
```{r, echo = TRUE}
summary(lm(Fertility ~ Agriculture, data = swiss))$coef
</code></pre></div></div>

<hr />
<h4 id="the-associated-fitted-line">The associated fitted line</h4>
<p>```{r, echo = FALSE, fig.width=8, fig.height=5}
fit = lm(Fertility ~ Agriculture, data = swiss)
g1 = g
g1 = g1 + geom_abline(intercept = coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>, slope = coef(fit)[2], size = 2)
g1</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---
#### Parallel lines, i.e., same slope different intercepts (using +)
```{r, echo = TRUE}
summary(lm(Fertility ~ Agriculture + factor(CatholicBin), data = swiss))$coef
</code></pre></div></div>

<p>```{r, echo = FALSE, fig.width=5, fig.height=4}
fit = lm(Fertility ~ Agriculture + factor(CatholicBin), data = swiss)
g1 = g
g1 = g1 + geom_abline(intercept = coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>, slope = coef(fit)[2], size = 2)
g1 = g1 + geom_abline(intercept = coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a> + coef(fit)[3], slope = coef(fit)[2], size = 2)
g1</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
1. b0 + b1 X + b2 *0
2. b0 + b1 X + b2 *1

---
#### Lines with different slopes and intercepts (using * instead of +)

```{r, echo = TRUE}
summary(lm(Fertility ~ Agriculture * factor(CatholicBin), data = swiss))$coef
</code></pre></div></div>

<p>```{r, echo = FALSE, fig.width=5, fig.height=4}
fit = lm(Fertility ~ Agriculture * factor(CatholicBin), data = swiss)
g1 = g
g1 = g1 + geom_abline(intercept = coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>, slope = coef(fit)[2], size = 2)
g1 = g1 + geom_abline(intercept = coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a> + coef(fit)[3], 
                          slope = coef(fit)[2] + coef(fit)[4], size = 2)
g1</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
#### Just to show you it can be done
```{r, echo = TRUE}
summary(lm(Fertility ~ Agriculture + Agriculture : factor(CatholicBin), data = swiss))$coef
</code></pre></div></div>
<h2 id="adjustment-playing-with-different-variables-in-lm-c7-w3">adjustment (playing with different variables in lm) c7-w3</h2>

<h3 id="consider-the-following-simulated-data">Consider the following simulated data</h3>
<p>Code for the first plot, rest omitted
(See the git repo for the rest of the code.)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>n &lt;- 100; t &lt;- rep(c(0, 1), c(n/2, n/2)); x &lt;- c(runif(n/2), runif(n/2));
beta0 &lt;- 0; beta1 &lt;- 2; tau &lt;- 1; sigma &lt;- .2
y &lt;- beta0 + x * beta1 + t * tau + rnorm(n, sd = sigma)
plot(x, y, type = "n", frame = FALSE)
abline(lm(y ~ x), lwd = 2)
abline(h = mean(y[1 : (n/2)]), lwd = 3)
abline(h = mean(y[(n/2 + 1) : n]), lwd = 3)
fit &lt;- lm(y ~ x + t)
abline(coef(fit)[1], coef(fit)[2], lwd = 3)
abline(coef(fit)[1] + coef(fit)[3], coef(fit)[2], lwd = 3)
points(x[1 : (n/2)], y[1 : (n/2)], pch = 21, col = "black", bg = "lightblue", cex = 2)
points(x[(n/2 + 1) : n], y[(n/2 + 1) : n], pch = 21, col = "black", bg = "salmon", cex = 2)
</code></pre></div></div>

<hr />
<h3 id="simulation-1">Simulation 1</h3>
<p>```{r, fig.height=5, fig.width=5, echo = FALSE, results=‚Äôhide‚Äô}
n &lt;- 100; t &lt;- rep(c(0, 1), c(n/2, n/2)); x &lt;- c(runif(n/2), runif(n/2));
beta0 &lt;- 0; beta1 &lt;- 2; tau &lt;- 1; sigma &lt;- .2
y &lt;- beta0 + x * beta1 + t * tau + rnorm(n, sd = sigma)
plot(x, y, type = ‚Äún‚Äù, frame = FALSE)
abline(lm(y ~ x), lwd = 2)
abline(h = mean(y[1 : (n/2)]), lwd = 3)
abline(h = mean(y[(n/2 + 1) : n]), lwd = 3)
fit &lt;- lm(y ~ x + t)
abline(coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>, coef(fit)[2], lwd = 3)
abline(coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a> + coef(fit)[3], coef(fit)[2], lwd = 3)
points(x[1 : (n/2)], y[1 : (n/2)], pch = 21, col = ‚Äúblack‚Äù, bg = ‚Äúlightblue‚Äù, cex = 2)
points(x[(n/2 + 1) : n], y[(n/2 + 1) : n], pch = 21, col = ‚Äúblack‚Äù, bg = ‚Äúsalmon‚Äù, cex = 2)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Discussion
#### Some things to note in this simulation
* The X variable is unrelated to group status
* The X variable is related to Y, but the intercept depends
  on group status.
* The group variable is related to Y.
  * The relationship between group status and Y is constant depending on X.
  * The relationship between group and Y disregarding X is about the same as holding X constant

---
### Simulation 2
```{r, fig.height=5, fig.width=5, echo = FALSE, results='hide'}
n &lt;- 100; t &lt;- rep(c(0, 1), c(n/2, n/2)); x &lt;- c(runif(n/2), 1.5 + runif(n/2));
beta0 &lt;- 0; beta1 &lt;- 2; tau &lt;- 0; sigma &lt;- .2
y &lt;- beta0 + x * beta1 + t * tau + rnorm(n, sd = sigma)
plot(x, y, type = "n", frame = FALSE)
abline(lm(y ~ x), lwd = 2)
abline(h = mean(y[1 : (n/2)]), lwd = 3)
abline(h = mean(y[(n/2 + 1) : n]), lwd = 3)
fit &lt;- lm(y ~ x + t)
abline(coef(fit)[1], coef(fit)[2], lwd = 3)
abline(coef(fit)[1] + coef(fit)[3], coef(fit)[2], lwd = 3)
points(x[1 : (n/2)], y[1 : (n/2)], pch = 21, col = "black", bg = "lightblue", cex = 2)
points(x[(n/2 + 1) : n], y[(n/2 + 1) : n], pch = 21, col = "black", bg = "salmon", cex = 2)
</code></pre></div></div>

<hr />
<h3 id="discussion-3">Discussion</h3>
<h4 id="some-things-to-note-in-this-simulation">Some things to note in this simulation</h4>
<ul>
  <li>The X variable is highly related to group status</li>
  <li>The X variable is related to Y, the intercept
doesn‚Äôt depend on the group variable.
    <ul>
      <li>The X variable remains related to Y holding group status constant</li>
    </ul>
  </li>
  <li>The group variable is marginally related to Y disregarding X.</li>
  <li>The model would estimate no adjusted effect due to group.
    <ul>
      <li>There isn‚Äôt any data to inform the relationship between
group and Y.</li>
      <li>This conclusion is entirely based on the model.</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="simulation-3">Simulation 3</h3>
<p>```{r, fig.height=5, fig.width=5, echo = FALSE, results=‚Äôhide‚Äô}
n &lt;- 100; t &lt;- rep(c(0, 1), c(n/2, n/2)); x &lt;- c(runif(n/2), .9 + runif(n/2));
beta0 &lt;- 0; beta1 &lt;- 2; tau &lt;- -1; sigma &lt;- .2
y &lt;- beta0 + x * beta1 + t * tau + rnorm(n, sd = sigma)
plot(x, y, type = ‚Äún‚Äù, frame = FALSE)
abline(lm(y ~ x), lwd = 2)
abline(h = mean(y[1 : (n/2)]), lwd = 3)
abline(h = mean(y[(n/2 + 1) : n]), lwd = 3)
fit &lt;- lm(y ~ x + t)
abline(coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>, coef(fit)[2], lwd = 3)
abline(coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a> + coef(fit)[3], coef(fit)[2], lwd = 3)
points(x[1 : (n/2)], y[1 : (n/2)], pch = 21, col = ‚Äúblack‚Äù, bg = ‚Äúlightblue‚Äù, cex = 2)
points(x[(n/2 + 1) : n], y[(n/2 + 1) : n], pch = 21, col = ‚Äúblack‚Äù, bg = ‚Äúsalmon‚Äù, cex = 2)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Discussion
#### Some things to note in this simulation
* Marginal association has red group higher than blue.
* Adjusted relationship has blue group higher than red.
* Group status related to X.
* There is some direct evidence for comparing red and blue
holding X fixed.



---
### Simulation 4
```{r, fig.height=5, fig.width=5, echo = FALSE, results='hide'}
n &lt;- 100; t &lt;- rep(c(0, 1), c(n/2, n/2)); x &lt;- c(.5 + runif(n/2), runif(n/2));
beta0 &lt;- 0; beta1 &lt;- 2; tau &lt;- 1; sigma &lt;- .2
y &lt;- beta0 + x * beta1 + t * tau + rnorm(n, sd = sigma)
plot(x, y, type = "n", frame = FALSE)
abline(lm(y ~ x), lwd = 2)
abline(h = mean(y[1 : (n/2)]), lwd = 3)
abline(h = mean(y[(n/2 + 1) : n]), lwd = 3)
fit &lt;- lm(y ~ x + t)
abline(coef(fit)[1], coef(fit)[2], lwd = 3)
abline(coef(fit)[1] + coef(fit)[3], coef(fit)[2], lwd = 3)
points(x[1 : (n/2)], y[1 : (n/2)], pch = 21, col = "black", bg = "lightblue", cex = 2)
points(x[(n/2 + 1) : n], y[(n/2 + 1) : n], pch = 21, col = "black", bg = "salmon", cex = 2)
</code></pre></div></div>

<hr />
<h3 id="discussion-4">Discussion</h3>
<h4 id="some-things-to-note-in-this-simulation-1">Some things to note in this simulation</h4>
<ul>
  <li>No marginal association between group status and Y.</li>
  <li>Strong adjusted relationship.</li>
  <li>Group status not related to X.</li>
  <li>There is lots of direct evidence for comparing red and blue
holding X fixed.</li>
</ul>

<hr />
<h3 id="simulation-5">Simulation 5</h3>
<p>```{r, fig.height=5, fig.width=5, echo = FALSE, results=‚Äôhide‚Äô}
n &lt;- 100; t &lt;- rep(c(0, 1), c(n/2, n/2)); x &lt;- c(runif(n/2, -1, 1), runif(n/2, -1, 1));
beta0 &lt;- 0; beta1 &lt;- 2; tau &lt;- 0; tau1 &lt;- -4; sigma &lt;- .2
y &lt;- beta0 + x * beta1 + t * tau + t * x * tau1 + rnorm(n, sd = sigma)
plot(x, y, type = ‚Äún‚Äù, frame = FALSE)
abline(lm(y ~ x), lwd = 2)
abline(h = mean(y[1 : (n/2)]), lwd = 3)
abline(h = mean(y[(n/2 + 1) : n]), lwd = 3)
fit &lt;- lm(y ~ x + t + I(x * t))
abline(coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>, coef(fit)[2], lwd = 3)
abline(coef(fit)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a> + coef(fit)[3], coef(fit)[2] + coef(fit)[4], lwd = 3)
points(x[1 : (n/2)], y[1 : (n/2)], pch = 21, col = ‚Äúblack‚Äù, bg = ‚Äúlightblue‚Äù, cex = 2)
points(x[(n/2 + 1) : n], y[(n/2 + 1) : n], pch = 21, col = ‚Äúblack‚Äù, bg = ‚Äúsalmon‚Äù, cex = 2)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Discussion
#### Some things to note from this simulation
* There is no such thing as a group effect here.
  * The impact of group reverses itself depending on X.
  * Both intercept and slope depends on group.
* Group status and X unrelated.
  * There's lots of information about group effects holding X fixed.

---
#### Simulation 6
```{r, fig.height=5, fig.width=5, echo = FALSE, results='hide'}
p &lt;- 1
n &lt;- 100; x2 &lt;- runif(n); x1 &lt;- p * runif(n) - (1 - p) * x2
beta0 &lt;- 0; beta1 &lt;- 1; tau &lt;- 4 ; sigma &lt;- .01
y &lt;- beta0 + x1 * beta1 + tau * x2 + rnorm(n, sd = sigma)
plot(x1, y, type = "n", frame = FALSE)
abline(lm(y ~ x1), lwd = 2)
co.pal &lt;- heat.colors(n)
points(x1, y, pch = 21, col = "black", bg = co.pal[round((n - 1) * x2 + 1)], cex = 2)
</code></pre></div></div>

<hr />
<h4 id="do-this-to-investigate-the-bivariate-relationship">Do this to investigate the bivariate relationship</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(rgl)
plot3d(x1, x2, y)
</code></pre></div></div>

<hr />
<h4 id="residual-relationship">Residual relationship</h4>
<p>```{r, fig.height=5, fig.width=5, echo = FALSE, results=‚Äôhide‚Äô}
plot(resid(lm(x1 ~ x2)), resid(lm(y ~ x2)), frame = FALSE, col = ‚Äúblack‚Äù, bg = ‚Äúlightblue‚Äù, pch = 21, cex = 2)
abline(lm(I(resid(lm(x1 ~ x2))) ~ I(resid(lm(y ~ x2)))), lwd = 2)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---
### Discussion
#### Some things to note from this simulation

* X1 unrelated to X2
* X2 strongly related to Y
* Adjusted relationship between X1 and Y largely unchanged
  by considering X2.
  * Almost no residual variability after accounting for X2.

---
### Some final thoughts
* Modeling multivariate relationships is difficult.
* Play around with simulations to see how the
  inclusion or exclusion of another variable can
  change analyses.
* The results of these analyses deal with the
impact of variables on associations.
  * Ascertaining mechanisms or cause are difficult subjects
    to be added on top of difficulty in understanding multivariate associations.
¬© 
## Diagnostics c7-w3

### The linear model
* Specified as $Y_i =  \sum_{k=1}^p X_{ik} \beta_j + \epsilon_{i}$
* We'll also assume here that $\epsilon_i \stackrel{iid}{\sim} N(0, \sigma^2)$
* Define the residuals as
$e_i = Y_i -  \hat Y_i =  Y_i - \sum_{k=1}^p X_{ik} \hat \beta_j$
* Our estimate of residual variation is $\hat \sigma^2 = \frac{\sum_{i=1}^n e_i^2}{n-p}$, the $n-p$ so that $E[\hat \sigma^2] = \sigma^2$

---
```{r, fig.height = 5, fig.width = 5}
data(swiss); par(mfrow = c(2, 2))
fit &lt;- lm(Fertility ~ . , data = swiss); plot(fit)
</code></pre></div></div>

<hr />
<h3 id="influential-high-leverage-and-outlying-points">Influential, high leverage and outlying points</h3>
<p>```{r, fig.height = 5, fig.width=5, echo = FALSE, results=‚Äôhide‚Äô}
n &lt;- 100; x &lt;- rnorm(n); y &lt;- x + rnorm(n, sd = .3)
plot(c(-3, 6), c(-3, 6), type = ‚Äún‚Äù, frame = FALSE, xlab = ‚ÄúX‚Äù, ylab = ‚ÄúY‚Äù)
abline(lm(y ~ x), lwd = 2)
points(x, y, cex = 2, bg = ‚Äúlightblue‚Äù, col = ‚Äúblack‚Äù, pch = 21)
points(0, 0, cex = 2, bg = ‚Äúdarkorange‚Äù, col = ‚Äúblack‚Äù, pch = 21)
points(0, 5, cex = 2, bg = ‚Äúdarkorange‚Äù, col = ‚Äúblack‚Äù, pch = 21)
points(5, 5, cex = 2, bg = ‚Äúdarkorange‚Äù, col = ‚Äúblack‚Äù, pch = 21)
points(5, 0, cex = 2, bg = ‚Äúdarkorange‚Äù, col = ‚Äúblack‚Äù, pch = 21)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Summary of the plot
Calling a point an outlier is vague. 
  * Outliers can be the result of spurious or real processes.
  * Outliers can have varying degrees of influence.
  * Outliers can conform to the regression relationship (i.e being marginally outlying in X or Y, but not outlying given the regression relationship).
* Upper left hand point has low leverage, low influence, outlies in a way not conforming to the regression relationship.
* Lower left hand point has low leverage, low influence and is not to be an outlier in any sense.
* Upper right hand point has high leverage, but chooses not to extert it and thus would have low actual influence by conforming to the regresison relationship of the other points.
* Lower right hand point has high leverage and would exert it if it were included in the fit.

---
### Influence measures of points! of data not variables
* Do `?influence.measures` to see the full suite of influence measures
  in stats. The measures include
  * `rstandard` - standardized residuals, residuals divided by their
    standard deviations)
  * `rstudent` - standardized residuals, residuals divided by their
    standard deviations, where the ith data point was deleted in the
    calculation of the standard deviation for the residual to follow a
    t distribution
  * `hatvalues` - measures of leverage
  * `dffits` - change in the predicted response when the $i^{th}$
    point is deleted in fitting the model. **one data for one point**.
  * `dfbetas` - change in **individual coefficients** when the $i^{th}$
    point is deleted in fitting the model.
  * `cooks.distance` - overall change in teh coefficients when the
    $i^{th}$ point is deleted.
  * `resid` - returns the ordinary residuals
  * `resid(fit) / (1 - hatvalues(fit))` where `fit` is the linear
    model fit returns the PRESS residuals, i.e. the leave one out
    cross validation residuals - the difference in the response and
    the predicted response at data point $i$, where it was not
    included in the model fitting.

---
### How do I use all of these things?
* Be wary of simplistic rules for diagnostic plots and measures. The
  use of these tools is context specific. It's better to understand
  what they are trying to accomplish and use them judiciously.
* Not all of the measures have meaningful absolute scales. You can
  look at them relative to the values across the data.
* They probe your data in different ways to diagnose different
  problems.
* Patterns in your residual plots generally indicate some poor aspect
  of model fit. These can include:
  * Heteroskedasticity (non constant variance).
  * Missing model terms.
  * Temporal patterns (plot residuals versus collection order).
* Residual QQ plots investigate normality of the errors.
* Leverage measures (hat values) can be useful for diagnosing data
  entry errors.
* Influence measures get to the bottom line, 'how does deleting or
  including this point impact a particular aspect of the model'.


**Plot residual vs fitted values** to check for systematic patterns
that you are missing

---


### Case 1
```{r, fig.height=5, fig.width=5, echo=FALSE}
x &lt;- c(10, rnorm(n)); y &lt;- c(10, c(rnorm(n)))
plot(x, y, frame = FALSE, cex = 2, pch = 21, bg = "lightblue", col = "black")
abline(lm(y ~ x))            
</code></pre></div></div>

<hr />
<h3 id="the-code">The code</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>n &lt;- 100; x &lt;- c(10, rnorm(n)); y &lt;- c(10, c(rnorm(n)))
plot(x, y, frame = FALSE, cex = 2, pch = 21, bg = "lightblue", col = "black")
abline(lm(y ~ x))            
</code></pre></div></div>
<ul>
  <li>The point <code class="language-plaintext highlighter-rouge">c(10, 10)</code> has created a strong regression relationship where there shouldn‚Äôt be one.</li>
</ul>

<hr />
<h3 id="showing-a-couple-of-the-diagnostic-values">Showing a couple of the diagnostic values</h3>
<pre><code class="language-{r}">fit &lt;- lm(y ~ x)
round(dfbetas(fit)[1 : 10, 2], 3)
round(hatvalues(fit)[1 : 10], 3)
</code></pre>

<hr />
<h3 id="case-2">Case 2</h3>
<p>```{r, fig.height=5, fig.width=5, echo=FALSE}
x &lt;- rnorm(n); y &lt;- x + rnorm(n, sd = .3)
x &lt;- c(5, x); y &lt;- c(5, y)
plot(x, y, frame = FALSE, cex = 2, pch = 21, bg = ‚Äúlightblue‚Äù, col = ‚Äúblack‚Äù)
fit2 &lt;- lm(y ~ x)
abline(fit2)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Looking at some of the diagnostics
```{r, echo = TRUE}
round(dfbetas(fit2)[1 : 10, 2], 3)
round(hatvalues(fit2)[1 : 10], 3)
</code></pre></div></div>

<hr />
<h3 id="example-described-by-stefanski-tas-2007-vol-61">Example described by Stefanski TAS 2007 Vol 61.</h3>
<p>```{r, fig.height=4, fig.width=4}</p>
<h2 id="dont-everyone-hit-this-server-at-once--read-the-paper-first">Don‚Äôt everyone hit this server at once.  Read the paper first.</h2>
<p>dat &lt;- read.table(‚Äòhttp://www4.stat.ncsu.edu/~stefanski/NSF_Supported/Hidden_Images/orly_owl_files/orly_owl_Lin_4p_5_flat.txt‚Äô, header = FALSE)
pairs(dat)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Got our P-values, should we bother to do a residual plot?
```{r}
summary(lm(V1 ~ . -1, data = dat))$coef
</code></pre></div></div>
<p>Residual plots zoom in on poor model fits, they show ys how much we
have covered the systematic part. Run the above to see more!</p>

<hr />
<h3 id="residual-plot">Residual plot</h3>
<h4 id="p-values-significant-o-rly">P-values significant, O RLY?</h4>
<p>```{r, fig.height=4, fig.width=4, echo = TRUE}
fit &lt;- lm(V1 ~ . - 1, data = dat); plot(predict(fit), resid(fit), pch = ‚Äò.‚Äô)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Shows how bad the fit is as we completely missed the systematic
patterns!

---
### Back to the Swiss data
```{r, fig.height = 5, fig.width = 5, echo=FALSE}
data(swiss); par(mfrow = c(2, 2))
fit &lt;- lm(Fertility ~ . , data = swiss); plot(fit)
</code></pre></div></div>
<h2 id="multiple-variables-regression-c7-w3">Multiple variables regression (c7-w3)</h2>

<h3 id="multivariable-regression">Multivariable regression</h3>
<ul>
  <li>We have an entire class on prediction and machine learning, so we‚Äôll
focus on modeling.
    <ul>
      <li>Prediction has a different set of criteria, needs for
interpretability and standards for generalizability.</li>
      <li>In modeling, our interest lies in parsimonious, interpretable
representations of the data that enhance our understanding of the
phenomena under study.</li>
      <li>A model is a lense through which to look at your data. (I
attribute this quote to Scott Zeger)</li>
      <li>Under this philosophy, what‚Äôs the right model? Whatever model
connects the data to a true, parsimonious statement about what
you‚Äôre studying.</li>
    </ul>
  </li>
  <li>There are nearly uncountable ways that a model can be wrong, in this
lecture, we‚Äôll <strong>focus on variable inclusion and exclusion</strong>.</li>
  <li>Like nearly all aspects of statistics, good modeling decisions are
context dependent.
    <ul>
      <li><strong>A good model for prediction versus one for studying mechanisms
versus one for trying to establish causal effects may not be the
same.</strong> if only I could gve an example!</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="the-rumsfeldian-triplet">The Rumsfeldian triplet</h3>

<p><em>There are known knowns. These are things we know that we know. There
are known unknowns. That is to say, there are things that we know we
don‚Äôt know. But there are also unknown unknowns. There are things we
don‚Äôt know we don‚Äôt know.</em> Donald Rumsfeld</p>

<p>In our context</p>
<ul>
  <li>(Known knowns) Regressors that we know we should check to include in
the model and have.</li>
  <li>(Known Unknowns) Regressors that we would like to include in the
model, but don‚Äôt have.</li>
  <li>(Unknown Unknowns) Regressors that we don‚Äôt even know about that we
should have included in the model.</li>
</ul>

<hr />
<h3 id="general-rules-very-important">General rules (very important!)</h3>
<ul>
  <li><strong>Omitting variables results in bias</strong> in the coeficients of
interest - unless their regressors are uncorrelated with the omitted
ones.
    <ul>
      <li>
        <p><strong>This is why we randomize treatments, it attempts to uncorrelate
our treatment indicator with variables that we don‚Äôt have to put
in the model.</strong> <strong>WE need to make out own example for this one!
during writing</strong> Thats why AB testing and clinical trials are so
powerful. but if there are too many confounding things then even
randomization is not going to help you!</p>
      </li>
      <li>
        <p>(If there‚Äôs too many unobserved confounding variables, even
randomization won‚Äôt help you.)</p>
      </li>
    </ul>
  </li>
  <li><strong>Including variables that we shouldn‚Äôt have increases standard errors
of the regression variables.</strong> No BIAS!!!!!!
    <ul>
      <li>Actually, including any <strong>new variables increasese</strong> (actual, not
estimated) <strong>standard errors</strong> of other regressors. So we don‚Äôt
want to idly throw variables into the model.</li>
    </ul>
  </li>
  <li>The model must tend toward perfect fit as the number of
non-redundant regressors approaches $n$.</li>
  <li><strong>$R^2$ increases monotonically as more regressors are included.</strong></li>
  <li>The SSE decreases monotonically as more regressors are included.</li>
</ul>

<p>Need to check these out!</p>

<hr />
<h3 id="plot-of-r2-versus-n">Plot of $R^2$ versus $n$</h3>
<p>For simulations as the number of variables included equals increases to $n=100$. 
No actual regression relationship exist in any simulation
```{r, fig.height=5, fig.width=5, echo=FALSE}
 n &lt;- 100
plot(c(1, n), 0 : 1, type = ‚Äún‚Äù, frame = FALSE, xlab = ‚Äúp‚Äù, ylab = ‚ÄúR^2‚Äù)
r &lt;- sapply(1 : n, function(p)
      {
        y &lt;- rnorm(n); x &lt;- matrix(rnorm(n * p), n, p)
        summary(lm(y ~ x))$r.squared 
      }
    )
lines(1 : n, r, lwd = 2)
abline(h = 1)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Awesome! shows exactly what the problem is during my DP sessions!

---
### Variance inflation; all three are rnormed; including variables!
```{r, echo = TRUE}
n &lt;- 100; nosim &lt;- 1000
x1 &lt;- rnorm(n); x2 &lt;- rnorm(n); x3 &lt;- rnorm(n); 
betas &lt;- sapply(1 : nosim, function(i){
  y &lt;- x1 + rnorm(n, sd = .3)
  c(coef(lm(y ~ x1))[2], 
    coef(lm(y ~ x1 + x2))[2], 
    coef(lm(y ~ x1 + x2 + x3))[2])
})
round(apply(betas, 1, sd), 5)
</code></pre></div></div>
<p><strong>Apparently, the actual variance is inflated and maybe not the estimated variance. I am not sure what this means and what is the consequence for us!</strong></p>

<p>Monte carlo error?</p>

<p>As long as variables are independent, we seem to be cool!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x1      x1      x1 
0.02839 0.02872 0.02884 
</code></pre></div></div>

<hr />
<h3 id="variance-inflation-when-there-is-a-relation-between-x1-and-x3">Variance inflation (when there is a relation between x1 and x3)</h3>
<p>```{r, echo = TRUE}
n &lt;- 100; nosim &lt;- 1000
x1 &lt;- rnorm(n); x2 &lt;- x1/sqrt(2) + rnorm(n) /sqrt(2)
x3 &lt;- x1 * 0.95 + rnorm(n) * sqrt(1 - 0.95^2); 
betas &lt;- sapply(1 : nosim, function(i){
  y &lt;- x1 + rnorm(n, sd = .3)
  c(coef(lm(y ~ x1))[2], 
    coef(lm(y ~ x1 + x2))[2], 
    coef(lm(y ~ x1 + x2 + x3))[2])
})
round(apply(betas, 1, sd), 5)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> x1      x1      x1  0.03131 0.04270 0.09653  ```
</code></pre></div></div>

<p>If the variable you include (x3) is highly correlated with variable
you are interested in (x1), then you are going to inflat the fuck out
of it (aka 3 times as shown above!)</p>

<p>Think about what you wanna include and why!</p>

<p>If you included height and weight in the same model! both of them are
highly corelated. Maybe we check the correlation before adding
variables!</p>

<p>As long as they are randomized it is still ok? or it somehow reduces
the correlation (investigate!)</p>

<hr />
<h3 id="variance-inflation-factors-dp">Variance inflation factors (dp!)</h3>
<ul>
  <li>Notice variance inflation was much worse when we included a variable
that was highly related to <code class="language-plaintext highlighter-rouge">x1</code>.</li>
  <li>We don‚Äôt know $\sigma$, so we can only estimate the increase in the
actual standard error of the coefficients for including a regressor.</li>
  <li>However, $\sigma$ drops out of the relative standard errors. If one
sequentially adds variables, one can check the variance (or sd)
inflation for including each one.</li>
  <li>When the other regressors are actually orthogonal to the regressor
of interest, then there is no variance inflation.</li>
  <li>
    <p>The <strong>variance inflation factor (VIF)</strong> is the increase in the
variance for the ith regressor compared to the ideal setting where
it is orthogonal to the other regressors.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ratio of current case with all regressors and the case with
non-correlated regressors! Look into how this works out!
  
Shown below! * (The square root of the VIF is the increase in the sd ...)
</code></pre></div>    </div>
  </li>
  <li>Remember, variance inflation is only part of the picture. We want to
include certain variables, even if they dramatically inflate our
variance.</li>
</ul>

<hr />
<h3 id="revisting-our-previous-simulation">Revisting our previous simulation</h3>
<p>```{r, echo = TRUE}
##doesn‚Äôt depend on which y you use,
y &lt;- x1 + rnorm(n, sd = .3)
a &lt;- summary(lm(y ~ x1))$cov.unscaled[2,2]
c(summary(lm(y ~ x1 + x2))$cov.unscaled[2,2],
  summary(lm(y~ x1 + x2 + x3))$cov.unscaled[2,2]) / a
temp &lt;- apply(betas, 1, var); temp[2 : 3] / temp<a href="https://i.stack.imgur.com/Y8qyz.png">1</a></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Swiss data
```{r}
data(swiss); 
fit1 &lt;- lm(Fertility ~ Agriculture, data = swiss)
a &lt;- summary(fit1)$cov.unscaled[2,2]
fit2 &lt;- update(fit, Fertility ~ Agriculture + Examination)
fit3 &lt;- update(fit, Fertility ~ Agriculture + Examination + Education)
  c(summary(fit2)$cov.unscaled[2,2],
    summary(fit3)$cov.unscaled[2,2]) / a 
</code></pre></div></div>

<hr />
<h3 id="swiss-data-vifs">Swiss data VIFs,</h3>
<pre><code class="language-{r}">library(car)
fit &lt;- lm(Fertility ~ . , data = swiss)
vif(fit)
sqrt(vif(fit)) #I prefer sd 
</code></pre>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     Agriculture      Examination        Education         Catholic Infant.Mortality 
           1.511            1.917            1.666            1.392            1.052 
</code></pre></div></div>

<p>WE see infant mortality and expect it to be not too bothered by other
variables! but examination and edumacation, PNN.</p>

<hr />
<h3 id="what-about-residual-variance-estimation">What about residual variance estimation?</h3>
<ul>
  <li>Assuming that the model is linear with additive iid errors (with
finite variance), we can mathematically describe the impact of
omitting necessary variables or including unnecessary ones.
    <ul>
      <li>If we underfit the model, the variance estimate is biased.</li>
      <li>If we correctly or overfit the model, including all necessary
covariates and/or unnecessary covariates, the variance estimate is
unbiased.
        <ul>
          <li>However, the variance of the variance is larger if we include
unnecessary variables.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="covariate-model-selection">Covariate model selection</h3>
<ul>
  <li>Automated covariate selection is a difficult topic. It depends
heavily on how rich of a covariate space one wants to explore.
    <ul>
      <li>The space of models explodes quickly as you add interactions and
polynomial terms.</li>
    </ul>
  </li>
  <li>In the prediction class, we‚Äôll cover many modern methods for
traversing large model spaces for the purposes of prediction.</li>
  <li>Principal components or factor analytic models on covariates are
often useful for reducing complex covariate spaces.</li>
  <li>
    <p>Good design can often eliminate the need for complex model searches
at analyses; though often control over the design is limited;
Randomization for example‚Ä¶</p>

    <p>For example in bio statistics, when you want to measure
effectiveness of the aspirin, they try to give the drug to one
person and use a washout period to test the drug the next time!</p>
  </li>
  <li>If the models of interest are nested and without lots of parameters
differentiating them, it‚Äôs fairly uncontroversial to use nested
likelihood ratio tests. (Example to follow.)</li>
  <li>My favoriate approach is as follows. Given a coefficient that I‚Äôm
interested in, I like to use covariate adjustment and multiple
models to probe that effect to evaluate it for robustness and to see
what other covariates knock it out.  This isn‚Äôt a terribly
systematic approach, but it tends to teach you a lot about the the
data as you get your hands dirty.</li>
</ul>

<hr />
<h3 id="how-to-do-nested-model-testing-in-r">How to do nested model testing in R</h3>
<pre><code class="language-{r}">fit1 &lt;- lm(Fertility ~ Agriculture, data = swiss)
fit3 &lt;- update(fit, Fertility ~ Agriculture + Examination + Education)
fit5 &lt;- update(fit, Fertility ~ Agriculture + Examination + Education + Catholic + Infant.Mortality)
anova(fit1, fit3, fit5)
</code></pre>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Analysis of Variance Table

Model 1: Fertility ~ Agriculture
Model 2: Fertility ~ Agriculture + Examination + Education
Model 3: Fertility ~ Agriculture + Examination + Education + Catholic + 
    Infant.Mortality
  Res.Df  RSS Df Sum of Sq    F  Pr(&gt;F)    
1     45 6283                              
2     43 3181  2      3102 30.2 8.6e-09 ***
3     41 2105  2      1076 10.5 0.00021 ***

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</code></pre></div></div>

<p>This looks like a good way to understand again, what is a good
parameter to include! Use above only when there is possibility of
nesting.</p>
<h3 id="summary-10">Summary</h3>

<ul>
  <li>
    <p>use anova of 2 fits to determine in a nested fashion if a variable
adds value or not!</p>
  </li>
  <li>
    <p>otherwise just look at the slopes to determine if they have impact
of not</p>
  </li>
  <li>
    <p>use influence measures to determine if certain points influence the
data!</p>
  </li>
  <li>
    <p>vis is to measure variance extra!</p>
  </li>
  <li>more variables =&gt; more variance if not truly randomized
    <ul>
      <li>example, examination and education!</li>
    </ul>
  </li>
  <li>
    <p>less variables =&gt; more error in result due to spurious additions</p>

    <ul>
      <li>always try to removed contributions of other variables by
looking at residuals!</li>
    </ul>
  </li>
</ul>

<h3 id="quiz">Quiz</h3>
<ol>
  <li>
    <p>Consider the \verb| mtcars|mtcars data set. Fit a model with mpg as
the outcome that includes number of cylinders as a factor variable
and weight as confounder. Give the adjusted estimate for the
expected change in mpg comparing 8 cylinders to 4.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> fit &lt;- lm(mpg ~ factor(cyl) + wt, data = mtcars)
 summary(fit)$coef
</code></pre></div>    </div>
  </li>
  <li>
    <p>Consider the \verb| mtcars|mtcars data set. Fit a model with mpg as
the outcome that includes number of cylinders as a factor variable
and weight as a possible confounding variable. Compare the effect
of 8 versus 4 cylinders on mpg for the adjusted and unadjusted by
weight models. Here, adjusted means including the weight variable
as a term in the regression model and unadjusted means the model
without weight included. What can be said about the effect
comparing 8 and 4 cylinders after looking at models with and
without weight included?.</p>

    <p>Holding weight constant, cylinder appears to have less of an
 impact on mpg than if weight is disregarded.</p>

    <p>It is both true and sensible that including weight would attenuate
 the effect of number of cylinders on mpg.</p>

    <p>Not sure what they mean by more impact (p-value or anova tests or
 slopes etc‚Ä¶)</p>
  </li>
  <li>
    <p>Consider the \verb|mtcars|mtcars data set. Fit a model with mpg as
the outcome that considers number of cylinders as a factor variable
and weight as confounder. Now fit a second model with mpg as the
outcome model that considers the interaction between number of
cylinders (as a factor variable) and weight. Give the P-value for
the likelihood ratio test comparing the two models and suggest a
model using 0.05 as a type I error rate significance benchmark.</p>

    <p>The P-value is larger than 0.05. So, according to our criterion, we
would fail to reject, which suggests that the interaction terms may
not be necessary.</p>

    <p>fit1 &lt;- lm(mpg ~ factor(cyl) + wt, data = mtcars)
fit2 &lt;- lm(mpg ~ factor(cyl) * wt, data = mtcars)
summary(fit1)$coef</p>

    <p>summary(fit2)$coef</p>

    <p>anova(fit1, fit2)</p>
  </li>
  <li>
    <p>Consider the \verb|mtcars|mtcars data set. Fit a model with mpg as
the outcome that includes number of cylinders as a factor variable
and weight inlcuded in the model as</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> lm(mpg ~ I(wt * 0.5) + factor(cyl), data = mtcars)
</code></pre></div>    </div>

    <p>The estimated expected change in MPG per one ton increase in
 weight for a specific number of cylinders (4, 6, 8).</p>
  </li>
  <li>
    <p>Consider the following data set</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> x &lt;- c(0.586, 0.166, -0.042, -0.614, 11.72)
 y &lt;- c(0.549, -0.026, -0.127, -0.751, 1.344)
</code></pre></div>    </div>

    <p>Give the hat diagonal for the most influential point</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> influence(lm(y ~ x))$hat
 ## showing how it's actually calculated
 xm &lt;- cbind(1, x)
 diag(xm %*% solve(t(xm) %*% xm) %*% t(xm))
</code></pre></div>    </div>
  </li>
  <li>
    <p>Consider the following data set</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> x &lt;- c(0.586, 0.166, -0.042, -0.614, 11.72)
 y &lt;- c(0.549, -0.026, -0.127, -0.751, 1.344)
</code></pre></div>    </div>

    <p>Give the slope dfbeta for the point with the highest hat value.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> influence.measures(lm(y ~ x))
</code></pre></div>    </div>
  </li>
  <li>
    <p>Consider a regression relationship between Y and X with and without
adjustment for a third variable Z. Which of the following is true
about comparing the regression coefficient between Y and X with and
without adjustment for Z.</p>

    <p>It is possible for the coefficient to reverse sign after
adjustment. For example, it can be strongly significant and
positive before adjustment and strongly significant and negative
after adjustment.</p>

    <p>See lecture 02_03 for various examples.</p>
  </li>
</ol>

<h3 id="optional-quiz">optional quiz</h3>

<p>Your assignment is to study how income varies across college major
categories. Specifically answer: ‚ÄúIs there an association between
college major category and income?‚Äù</p>

<p>To get started, start a new R/RStudio session with a clean
workspace. To do this in R, you can use the q() function to quit, then
reopen R. The easiest way to do this in RStudio is to quit RStudio
entirely and reopen it. After you have started a new session, run the
following commands. This will load a data.frame called college for you
to work with.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>install.packages("devtools")
devtools::install_github("jhudsl/collegeIncome")
library(collegeIncome)
data(college)

devtools::install_github("jhudsl/matahari")
library(matahari)

##	To start and end
dance_start(value = FALSE, contents = FALSE)
dance_save("~/Desktop/college_major_analysis.rds")
</code></pre></div></div>

<p>Based on your analysis, would you conclude that there is a significant
association between college major category and income?</p>

<p>Ans: NO as for one, p-values are way higher indicating similarity!</p>

<p>Mean and boxplots don‚Äôt seem to show variability</p>

<h4 id="my-answer">My answer</h4>

<p>df$ranks doesn‚Äôt seem to be coming from df$medianl in that case I
don‚Äôt understand the rank variable! So I almost don‚Äôt look at it!</p>

<p>with this, I look at only the variables in isolation , i.e., removing
all residuals needed: fit &lt;- lm(median ~ . -major - major_code,
data=df) ; summary(fit)</p>

<p>Result:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>major_categoryAgriculture &amp; Natural Resources       0.8917    
major_categoryBiology &amp; Life Science                0.4126    
major_categoryBusiness                              0.2229    
major_categoryCommunications &amp; Journalism           0.1541    
major_categoryComputers &amp; Mathematics               0.0680  

</code></pre></div></div>
<p>Most of the categories are above a 20 % significance level and all
above 5%. This goes to show that when I look at median income, and the
categories, there is not a ‚Äúsignificant‚Äù level of association!</p>

<p>Also the same output shows the corelation between p25th and p75th. I
guess this is enough! Using a lot of variables (as I have done above)
might increase the variance, but I am not sure what is the
significance of it for this case!</p>

<p>my work: published: in rds matahari stuff:
https://github.com/agent18/linear-regression/blob/master/college_major_analysis.rds</p>

<h4 id="better-solution-by-prof-for-later-consumption">better solution by prof for later consumption!</h4>

<p>https://d3c33hcgiwev3.cloudfront.net/<em>fd9c88bac4ae1ea84e1994f141541ef2_solution.pdf?Expires=1556064000&amp;Signature=X-bGR26cRgoTYnJe209LjxxU4U1T~edPw7Ri0akbYlaX70aQodTO10w6YTlSRv~38qwJXFgL6AIcQpBLdKwg-r~r8KkJhi6iXBME4iLJGcvNmnfcpaED6RFYH4Y1jy36CcKWJx9l6uHDSt5yzyRfH6qCUgStRsrHexcTw7Nh~BM</em>&amp;Key-Pair-Id=APKAJLTNE6QMUY6HBC5A</p>

<p>I have also saved this here: https://github.com/agent18/linear-regression/commit/a91f8a84668e3201146281ebbd65e8b35792509b</p>

<h3 id="p-hacking">p hacking</h3>

<p>Your assignment is to study how income varies across different
categories of college majors. You will be using data from a study of
recent college graduates. Make sure to use good practices that you
have learned so far in this course and previous courses in the
specialization.In particular, it is good practice to specify an
analysis plan early in the process to avoid the ‚Äúp-hacking‚Äù behavior
of trying many analyses to find one that has desired results. If you
want to learn more about ‚Äúp-hacking‚Äù, you can visit
https://projects.fivethirtyeight.com/p-hacking/</p>

<h2 id="glm--dont-read-horrible-lecture-and-notes-0-ex-c7-w4">GLM ‚Äì Don‚Äôt read Horrible lecture and notes 0 EX (C7-w4)</h2>

<h3 id="linear-models-1">Linear models</h3>
<ul>
  <li>Linear models are the most useful applied statistical
technique. However, they are not without their limitations.
    <ul>
      <li>Additive response models don‚Äôt make much sense if the response is
discrete, or stricly positive.</li>
      <li>Additive error models often don‚Äôt make sense, for example if the
outcome has to be positive.</li>
      <li>Transformations are often hard to interpret.
        <ul>
          <li>There‚Äôs value in modeling the data on the scale that it was
collected.</li>
          <li>Particularly interpetable transformations, natural logarithms in
specific, aren‚Äôt applicable for negative or zero values.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="generalized-linear-models">Generalized linear models</h3>
<ul>
  <li>Introduced in a 1972 RSSB paper by Nelder and Wedderburn.</li>
  <li>Involves three components
    <ul>
      <li>An <em>exponential family</em> model for the response.
        <ul>
          <li>includes normal, binom and poisson</li>
        </ul>
      </li>
      <li>A systematic component via a linear predictor.</li>
      <li>A link function that connects the means of the response to the
linear predictor.</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="example-linear-models">Example, linear models</h3>
<ul>
  <li>Assume that $Y_i \sim N(\mu_i, \sigma^2)$ (the Gaussian distribution is an exponential family distribution.)</li>
  <li>Define the linear predictor to be $\eta_i = \sum_{k=1}^p X_{ik} \beta_k$.</li>
  <li>The link function as $g$ so that $g(\mu) = \eta$.
    <ul>
      <li>For linear models $g(\mu) = \mu$ so that $\mu_i = \eta_i$</li>
    </ul>
  </li>
  <li>This yields the same likelihood model as our additive error Gaussian linear model
\(Y_i = \sum_{k=1}^p X_{ik} \beta_k + \epsilon_{i}\)
where $\epsilon_i \stackrel{iid}{\sim} N(0, \sigma^2)$</li>
</ul>

<hr />
<h3 id="example-logistic-regression">Example, logistic regression</h3>
<ul>
  <li>Assume that $Y_i \sim Bernoulli(\mu_i)$ so that $E[Y_i] = \mu_i$ where $0\leq \mu_i \leq 1$.</li>
  <li>Linear predictor $\eta_i = \sum_{k=1}^p X_{ik} \beta_k$</li>
  <li>Link function 
$g(\mu) = \eta = \log\left( \frac{\mu}{1 - \mu}\right)$
$g$ is the (natural) log odds, referred to as the <strong>logit</strong>.</li>
  <li>Note then we can invert the logit function as
\(\mu_i = \frac{\exp(\eta_i)}{1 + \exp(\eta_i)} ~~~\mbox{and}~~~
1 - \mu_i = \frac{1}{1 + \exp(\eta_i)}\)
Thus the likelihood is
\(\prod_{i=1}^n \mu_i^{y_i} (1 - \mu_i)^{1-y_i}
= \exp\left(\sum_{i=1}^n y_i \eta_i \right)
\prod_{i=1}^n (1 + \eta_i)^{-1}\)</li>
</ul>

<hr />
<h3 id="example-poisson-regression">Example, Poisson regression</h3>
<ul>
  <li>Assume that $Y_i \sim Poisson(\mu_i)$ so that $E[Y_i] = \mu_i$ where $0\leq \mu_i$</li>
  <li>Linear predictor $\eta_i = \sum_{k=1}^p X_{ik} \beta_k$</li>
  <li>Link function 
$g(\mu) = \eta = \log(\mu)$</li>
  <li>Recall that $e^x$ is the inverse of $\log(x)$ so that 
\(\mu_i = e^{\eta_i}\)
Thus, the likelihood is
\(\prod_{i=1}^n (y_i !)^{-1} \mu_i^{y_i}e^{-\mu_i}
\propto \exp\left(\sum_{i=1}^n y_i \eta_i - \sum_{i=1}^n \mu_i\right)\)</li>
</ul>

<hr />
<h3 id="some-things-to-note">Some things to note</h3>
<ul>
  <li>In each case, the only way in which the likelihood depends on the data is through 
\(\sum_{i=1}^n y_i \eta_i =
\sum_{i=1}^n y_i\sum_{k=1}^p X_{ik} \beta_k = 
\sum_{k=1}^p \beta_k\sum_{i=1}^n X_{ik} y_i\)
Thus if we don‚Äôt need the full data, only $\sum_{i=1}^n X_{ik} y_i$. This simplification is a consequence of chosing so-called ‚Äòcanonical‚Äô link functions.</li>
  <li>(This has to be derived). All models achieve their maximum at the root of the so called normal equations
\(0=\sum_{i=1}^n \frac{(Y_i - \mu_i)}{Var(Y_i)}W_i\)
where $W_i$ are the derivative of the inverse of the link function.</li>
</ul>

<hr />
<h3 id="about-variances">About variances</h3>
<p>\(0=\sum_{i=1}^n \frac{(Y_i - \mu_i)}{Var(Y_i)}W_i\)</p>
<ul>
  <li>For the linear model $Var(Y_i) = \sigma^2$ is constant.</li>
  <li>For Bernoulli case $Var(Y_i) = \mu_i (1 - \mu_i)$</li>
  <li>For the Poisson case $Var(Y_i) = \mu_i$.</li>
  <li>In the latter cases, it is often relevant to have a more flexible variance model, even if it doesn‚Äôt correspond to an actual likelihood
\(0=\sum_{i=1}^n \frac{(Y_i - \mu_i)}{\phi \mu_i (1 - \mu_i ) } W_i ~~~\mbox{and}~~~
0=\sum_{i=1}^n \frac{(Y_i - \mu_i)}{\phi \mu_i} W_i\)</li>
  <li>These are called ‚Äòquasi-likelihood‚Äô normal equations</li>
</ul>

<hr />
<h3 id="odds-and-ends">Odds and ends</h3>
<ul>
  <li>The normal equations have to be solved iteratively. Resulting in 
$\hat \beta_k$ and, if included, $\hat \phi$.</li>
  <li>Predicted linear predictor responses can be obtained as $\hat \eta = \sum_{k=1}^p X_k \hat \beta_k$</li>
  <li>Predicted mean responses as $\hat \mu = g^{-1}(\hat \eta)$</li>
  <li>Coefficients are interpretted as 
\(g(E[Y | X_k = x_k + 1, X_{\sim k} = x_{\sim k}]) - g(E[Y | X_k = x_k, X_{\sim k}=x_{\sim k}]) = \beta_k\)
or the change in the link function of the expected response per unit
change in $X_k$ holding other regressors constant.</li>
  <li>Variations on Newon/Raphson‚Äôs algorithm are used to do it.</li>
  <li>Asymptotics are used for inference usually.</li>
  <li>Many of the ideas from linear models can be brought over to GLMs.</li>
</ul>

<h2 id="logistic-regressionc7-w4">Logistic regression(c7-w4)</h2>
<h3 id="key-ideas">Key ideas</h3>

<ul>
  <li>Frequently we care about outcomes that have two values
    <ul>
      <li>Alive/dead</li>
      <li>Win/loss</li>
      <li>Success/Failure</li>
      <li>etc</li>
    </ul>
  </li>
  <li>Called binary, Bernoulli or 0/1 outcomes</li>
  <li>Collection of exchangeable binary outcomes for the same covariate data are called binomial outcomes.</li>
</ul>

<hr />

<h3 id="example-baltimore-ravens-winloss">Example Baltimore Ravens win/loss</h3>
<h4 id="ravens-data">Ravens Data</h4>

<p>```{r loadRavens,cache=TRUE}
download.file(‚Äúhttps://dl.dropboxusercontent.com/u/7710864/data/ravensData.rda‚Äù
              , destfile=‚Äù./data/ravensData.rda‚Äù,method=‚Äùcurl‚Äù) #
			  doesn‚Äôt work
load(‚Äú./data/ravensData.rda‚Äù)
head(ravensData)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Download from here! 

https://github.com/jtleek/dataanalysis/blob/master/week5/002binaryOutcomes/data/ravensData.rda?raw=true

---

### Linear regression 

$$ RW_i = b_0 + b_1 RS_i + e_i $$

$RW_i$ - 1 if a Ravens win, 0 if not

$RS_i$ - Number of points Ravens scored

$b_0$ - probability of a Ravens win if they score 0 points ( because
winning is a binary variable, values between o and 1 imply a
probability I think!)

$b_1$ - increase in probability of a Ravens win for each additional point

$e_i$ - residual variation due 

---

### Linear regression in R

```{r linearReg, dependson = "loadRavens", cache=TRUE}
lmRavens &lt;- lm(ravensData$ravenWinNum ~ ravensData$ravenScore)
summary(lmRavens)$coef
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">ravensData</span><span class="o">$</span><span class="n">ravenWinNum</span><span class="o">~</span><span class="n">ravensData</span><span class="o">$</span><span class="n">ravenScore</span><span class="p">))</span><span class="w">


</span><span class="n">plot</span><span class="p">(</span><span class="n">ravensData</span><span class="o">$</span><span class="n">ravenScore</span><span class="p">,</span><span class="n">ravensData</span><span class="o">$</span><span class="n">ravenWinNum</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">ravensData</span><span class="o">$</span><span class="n">ravenWinNum</span><span class="o">~</span><span class="n">ravensData</span><span class="o">$</span><span class="n">ravenScore</span><span class="p">))</span><span class="w">

</span></code></pre></div></div>

<hr />

<h3 id="odds">Odds</h3>

<p><strong>Binary Outcome 0/1</strong></p>

\[RW_i\]

<p><strong>Probability (0,1)</strong></p>

\[\rm{Pr}(RW_i | RS_i, b_0, b_1 )\]

<p><strong>Odds $(0,\infty)$</strong>
\(\frac{\rm{Pr}(RW_i | RS_i, b_0, b_1 )}{1-\rm{Pr}(RW_i | RS_i, b_0, b_1)}\)</p>

<p><strong>Log odds $(-\infty,\infty)$</strong></p>

\[\log\left(\frac{\rm{Pr}(RW_i | RS_i, b_0, b_1 )}{1-\rm{Pr}(RW_i | RS_i, b_0, b_1)}\right)\]

<p>^^ is the <strong>LOGIT</strong></p>

<hr />

<h3 id="linear-vs-logistic-regression">Linear vs. logistic regression</h3>

<p><strong>Linear</strong></p>

<p><em>Modeling it as linear</em></p>

\[RW_i = b_0 + b_1 RS_i + e_i\]

<p>or</p>

\[E[RW_i | RS_i, b_0, b_1] = b_0 + b_1 RS_i\]

<p>Expected value of a fair coin is a probability, i.e., 0.5 fair coin</p>

<p><strong>Logistic</strong></p>

<p><em>Modelling it as odds!</em></p>

<p>x = b0+b1*RSi</p>

<p>p  = e^x/(1+e^x) ‚Äî exfit</p>

<p>or</p>

<p>log(p/(1-p)) = x ‚Äî logit‚Äî log odds</p>

<p><strong>LOG ODDS OF PROBABILITY = f(regressors) = b0+b1*RSi</strong></p>

\[\rm{Pr}(RW_i | RS_i, b_0, b_1) = \frac{\exp(b_0 + b_1 RS_i)}{1 + \exp(b_0 + b_1 RS_i)}\]

\[\log\left(\frac{\rm{Pr}(RW_i | RS_i, b_0, b_1 )}{1-\rm{Pr}(RW_i | RS_i, b_0, b_1)}\right) = b_0 + b_1 RS_i\]

<hr />

<h3 id="interpreting-logistic-regression">Interpreting Logistic Regression</h3>

\[\log\left(\frac{\rm{Pr}(RW_i | RS_i, b_0, b_1 )}{1-\rm{Pr}(RW_i | RS_i, b_0, b_1)}\right) = b_0 + b_1 RS_i\]

<p>log(p/(1-p)) = x ‚Äî logit‚Äî log odds ; x = b0+b1*RSi</p>

<p>p  = e^x/(1+e^x)</p>

<p>$b_0$ - Log odds of a Ravens win if they score zero points</p>

<p>$b_1$ - Log odds ratio of win probability for each point scored (compared to zero points)</p>

<p>$\exp(b_1)$ - Odds ratio of win probability for each point scored (compared to zero points)</p>

<p>A better explanation on the actual logic of exp(beta1) is given
<a href="https://stats.stackexchange.com/questions/35013/exponentiated-logistic-regression-coefficient-different-than-odds-ratio">here</a>.</p>

<p>In the end exp(beta1) gives Odds ratio!</p>

<hr />

<h3 id="odds-1">Odds</h3>
<ul>
  <li>Imagine that you are playing a game where you flip a coin with
success probability $p$.</li>
  <li>If it comes up heads, you win $X$. If it comes up tails, you lose
$Y$.</li>
  <li>
    <p>What should we set $X$ and $Y$ for the game to be fair?</p>

    <p><strong>\(E[earnings]= X p - Y (1 - p) = 0\)</strong></p>
  </li>
  <li>
    <p>Implies</p>

    <p><strong>\(\frac{Y}{X} = \frac{p}{1 - p}\)</strong></p>
  </li>
  <li>The odds can be said as ‚ÄúHow much should you be willing to pay for a
$p$ probability of winning a dollar?‚Äù
    <ul>
      <li>(If $p &gt; 0.5$ you have to pay more if you lose than you get if you win.)</li>
      <li>(If $p &lt; 0.5$ you have to pay less if you lose than you get if you win.)</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="visualizing-fitting-logistic-regression-curves">Visualizing fitting logistic regression curves</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x &lt;- seq(-10, 10, length = 1000)
manipulate(
    plot(x, exp(beta0 + beta1 * x) / (1 + exp(beta0 + beta1 * x)), 
         type = "l", lwd = 3, frame = FALSE),
    beta1 = slider(-2, 2, step = .1, initial = 2),
    beta0 = slider(-2, 2, step = .1, initial = 0)
    )
</code></pre></div></div>

<p>Its an S curve when you plot, <strong>e^x/(1-e^x)</strong></p>

<hr />

<h3 id="ravens-logistic-regression">Ravens logistic regression</h3>

<p>```{r logReg, dependson = ‚ÄúloadRavens‚Äù}
logRegRavens &lt;- glm(ravensData$ravenWinNum ~ ravensData$ravenScore,family=‚Äùbinomial‚Äù)
summary(logRegRavens)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**It automatically assumes that the link function is the logit function!**

---

### Ravens fitted values

```{r dependson = "logReg",fig.height=4,fig.width=4}
plot(ravensData$ravenScore,logRegRavens$fitted,pch=19,col="blue",xlab="Score",ylab="Prob Ravens Win")
</code></pre></div></div>

<p><strong>It‚Äôs actually a complete S curve but it is not shown here.</strong></p>

<hr />

<h3 id="odds-ratios-and-confidence-intervals">Odds ratios and confidence intervals</h3>

<p>```{r dependson = ‚ÄúlogReg‚Äù,fig.height=4,fig.width=4}
exp(logRegRavens$coeff)
exp(confint(logRegRavens))</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**The above gives the coefficients for the probabilities**

---

### ANOVA for logistic regression

```{r dependson = "logReg",fig.height=4,fig.width=4}
anova(logRegRavens,test="Chisq")
</code></pre></div></div>

<hr />

<h3 id="interpreting-odds-ratios">Interpreting Odds Ratios</h3>

<ul>
  <li>Not probabilities</li>
  <li>Odds ratio of 1 = no difference in odds</li>
  <li>Log odds ratio of 0 = no difference in odds</li>
  <li>Odds ratio &lt; 0.5 or &gt; 2 commonly a ‚Äúmoderate effect‚Äù</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Relative risk $\frac{\rm{Pr}(RW_i</td>
          <td>RS_i = 10)}{\rm{Pr}(RW_i</td>
          <td>RS_i = 0)}$ often easier to interpret, harder to estimate</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>For small probabilities RR $\approx$ OR but <strong>they are not the same</strong>!</li>
</ul>

<p><a href="http://en.wikipedia.org/wiki/Odds_ratio">Wikipedia on Odds Ratio</a></p>

<hr />

<h3 id="further-resources-2">Further resources</h3>

<ul>
  <li><a href="http://en.wikipedia.org/wiki/Logistic_regression">Wikipedia on Logistic Regression</a></li>
  <li><a href="http://data.princeton.edu/R/glms.html">Logistic regression and glms in R</a></li>
  <li>Brian Caffo‚Äôs lecture notes on: <a href="http://ocw.jhsph.edu/courses/MethodsInBiostatisticsII/PDFs/lecture23.pdf">Simpson‚Äôs paradox</a>, <a href="http://ocw.jhsph.edu/courses/MethodsInBiostatisticsII/PDFs/lecture24.pdf">Case-control studies</a></li>
  <li><a href="http://www.openintro.org/stat/down/oiStat2_08.pdf">Open Intro Chapter on Logistic Regression</a></li>
</ul>

<h3 id="logistic-regression-and-linear-regression-for-factors--agent">Logistic regression and linear Regression for factors ‚Äî Agent</h3>

<h4 id="linear-regression-with-x-as-factor">Linear regression with X as factor</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="o">$</span><span class="n">mpg</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="w">

</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">x</span><span class="o">!=</span><span class="m">0</span><span class="p">])</span><span class="w"> </span><span class="n">shows</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">X</span><span class="w">
</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="o">~</span><span class="n">x</span><span class="p">)</span><span class="w">


</span></code></pre></div></div>

<p>All LM can do is predict mpg if the vs is 0 or 1. That‚Äôs it and it
does so based on means!</p>

<p>The equation is <code class="language-plaintext highlighter-rouge">Y = mean_0 + (mean_1 - mean_0)*x$</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predict</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">as.factor</span><span class="p">(</span><span class="m">1</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Ans: 24</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predict</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">as.factor</span><span class="p">(</span><span class="m">0</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Ans: 16.</p>

<p>Ans are nothing but the means!</p>

<p>In LM the Y is a continuous variable! In logistic regression Y is 0 or
1 as well.</p>

<p><a href="https://youtu.be/vN5cNN2-HWE?t=842">Source</a> with timestamp!</p>

<h4 id="linear-regression-with-x-continuous-and-y-factor">Linear regression with X continuous and Y factor</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="w"> </span><span class="c1">## v-model</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w">

</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="o">$</span><span class="n">mpg</span><span class="w"> </span><span class="c1">## v-model</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">~</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="w">

</span><span class="n">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="o">=</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w">
</span><span class="n">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="o">=</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>
<p><strong>Y is a probability of getting a 1. Higher the X higher the
probability. But probability cannot be greater than 1</strong></p>

<h4 id="logistic-regression-y-factor-and-x-continuous">Logistic regression y factor and X continuous</h4>

<p><code class="language-plaintext highlighter-rouge">log(p/(1-p)) = beta0 + beta1*x = out</code></p>

<p>beta0 is the intercept of the log odds plot vs X.</p>

<p><strong>beta1 is the slope of the line, i.e., change in log odds per change in
X.</strong></p>

<p><strong>Change is log odds is nothing but the log odds ratio. logA - logB =
Log A/B</strong></p>

<p><code class="language-plaintext highlighter-rouge">p = e^(out)/(1+e^(out))</code></p>

<p>The probability is given as above!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fit</span><span class="o">-&gt;</span><span class="n">glm</span><span class="p">(</span><span class="n">y</span><span class="o">~</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">)</span><span class="w"> </span><span class="c1">## gives beta0 and beta1</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">fit</span><span class="o">$</span><span class="n">fitted.values</span><span class="p">,</span><span class="n">pch</span><span class="o">=</span><span class="s2">"-"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>
<p>We see an S curve!</p>

<h4 id="logistic-regression-y-factor-and-x-also-factor">Logistic regression y factor and X also Factor!</h4>

<p>The greatest and most useful source was:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="o">$</span><span class="n">am</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="w">

</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
</span><span class="n">glm</span><span class="p">(</span><span class="n">y</span><span class="o">~</span><span class="n">x</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">)</span><span class="w">

</span><span class="n">table</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="nf">c</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="m">7</span><span class="o">/</span><span class="m">12</span><span class="p">),</span><span class="o">-</span><span class="nf">log</span><span class="p">(</span><span class="m">7</span><span class="o">/</span><span class="m">12</span><span class="p">)</span><span class="o">+</span><span class="nf">log</span><span class="p">(</span><span class="m">7</span><span class="o">/</span><span class="m">6</span><span class="p">))</span><span class="w"> </span><span class="c1">## glm manual</span><span class="w">
</span></code></pre></div></div>

<p>Quiz 4: q1</p>

<blockquote>
  <p>Consider the space shuttle data \verb|?shuttle|?shuttle in the
\verb|MASS|MASS library. Consider modeling the use of the autolander
as the outcome (variable name \verb|use|use). Fit a logistic
regression model with autolander (variable auto) use (labeled as
‚Äúauto‚Äù 1) versus not (0) as predicted by wind sign (variable
wind). Give the estimated odds ratio for autolander use comparing
head winds, labeled as ‚Äúhead‚Äù in the variable headwind (numerator)
to tail winds (denominator).</p>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shuttle</span><span class="o">$</span><span class="n">use2</span><span class="o">&lt;-</span><span class="nf">as.integer</span><span class="p">(</span><span class="n">shuttle</span><span class="o">$</span><span class="n">use</span><span class="o">==</span><span class="s2">"auto"</span><span class="p">)</span><span class="w">
</span><span class="n">shuttle</span><span class="o">$</span><span class="n">wind2</span><span class="o">&lt;-</span><span class="nf">as.integer</span><span class="p">(</span><span class="n">shuttle</span><span class="o">$</span><span class="n">wind</span><span class="o">==</span><span class="s2">"head"</span><span class="p">)</span><span class="w">
</span><span class="n">logRegShuttle</span><span class="o">&lt;-</span><span class="n">glm</span><span class="p">(</span><span class="n">use2</span><span class="o">~</span><span class="n">wind2</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">,</span><span class="w"> </span><span class="n">shuttle</span><span class="p">)</span><span class="w">

</span><span class="c1">## or</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="nf">log</span><span class="p">(</span><span class="m">55</span><span class="o">/</span><span class="m">73</span><span class="p">)</span><span class="o">-</span><span class="nf">log</span><span class="p">(</span><span class="m">56</span><span class="o">/</span><span class="m">72</span><span class="p">)</span><span class="w"> </span><span class="c1">## slope</span><span class="w">
</span><span class="nf">log</span><span class="p">(</span><span class="m">56</span><span class="o">/</span><span class="m">72</span><span class="p">)</span><span class="w"> </span><span class="c1">## intercept</span><span class="w">
</span></code></pre></div></div>

<h2 id="poissons-logistic-regression-c7-w4">Poisson‚Äôs logistic regression c7-w4</h2>
<h3 id="key-ideas-1">Key ideas</h3>

<ul>
  <li>Many data take the form of counts
    <ul>
      <li>Calls to a call center</li>
      <li>Number of flu cases in an area</li>
      <li>Number of cars that cross a bridge</li>
    </ul>
  </li>
  <li>Data may also be in the form of rates
    <ul>
      <li>Percent of children passing a test</li>
      <li>Percent of hits to a website from a country</li>
    </ul>
  </li>
  <li>Linear regression with transformation is an option</li>
</ul>

<hr />

<h3 id="poisson-distribution">Poisson distribution</h3>
<ul>
  <li>The Poisson distribution is a useful model for counts and rates</li>
  <li>Here a rate is count per some monitoring time</li>
  <li>Some examples uses of the Poisson distribution
    <ul>
      <li>Modeling web traffic hits</li>
      <li>Incidence rates</li>
      <li>Approximating binomial probabilities with small $p$ and large $n$</li>
      <li>Analyzing contigency table data</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="the-poisson-mass-function">The Poisson mass function</h3>
<ul>
  <li>$X \sim Poisson(t\lambda)$ if
\(P(X = x) = \frac{(t\lambda)^x e^{-t\lambda}}{x!}\)
For $x = 0, 1, \ldots$.</li>
  <li>The mean of the Poisson is $E[X] = t\lambda$, thus $E[X / t] = \lambda$</li>
  <li>The variance of the Poisson is $Var(X) = t\lambda$.</li>
  <li>The Poisson tends to a normal as $t\lambda$ gets large.</li>
</ul>

<hr />

<p>```{r simPois,fig.height=4,fig.width=8, cache=TRUE}
par(mfrow = c(1, 3))
plot(0 : 10, dpois(0 : 10, lambda = 2), type = ‚Äúh‚Äù, frame = FALSE)
plot(0 : 20, dpois(0 : 20, lambda = 10), type = ‚Äúh‚Äù, frame = FALSE)
plot(0 : 200, dpois(0 : 200, lambda = 100), type = ‚Äúh‚Äù, frame = FALSE)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Poisson distribution
#### Sort of, showing that the mean and variance are equal
```{r}
x &lt;- 0 : 10000; lambda = 3
mu &lt;- sum(x * dpois(x, lambda = lambda))
sigmasq &lt;- sum((x - mu)^2 * dpois(x, lambda = lambda))
c(mu, sigmasq)
</code></pre></div></div>

<hr />

<h3 id="example-leek-group-website-traffic">Example: Leek Group Website Traffic</h3>
<ul>
  <li>Consider the daily counts to Jeff Leek‚Äôs web site</li>
</ul>

<p><a href="http://biostat.jhsph.edu/~jleek/">http://biostat.jhsph.edu/~jleek/</a></p>

<ul>
  <li><strong>Since the unit of time is always one day, set $t = 1$ and then
the Poisson mean is interpretted as web hits per day. (If we set $t = 24$, it would
be web hits per hour).</strong></li>
</ul>

<hr />

<h3 id="website-data">Website data</h3>

<p>```{r leekLoad,cache=TRUE}
download.file(‚Äúhttps://dl.dropboxusercontent.com/u/7710864/data/gaData.rda‚Äù,destfile=‚Äù./data/gaData.rda‚Äù,method=‚Äùcurl‚Äù)
load(‚Äú./data/gaData.rda‚Äù)
gaData$julian &lt;- julian(gaData$date)
head(gaData)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
[http://skardhamar.github.com/rga/](http://skardhamar.github.com/rga/)


---

### Plot data

```{r, dependson="leekLoad",fig.height=4.5,fig.width=4.5}
plot(gaData$julian,gaData$visits,pch=19,col="darkgrey",xlab="Julian",ylab="Visits")
</code></pre></div></div>

<hr />

<h3 id="linear-regression">Linear regression</h3>

\[NH_i = b_0 + b_1 JD_i + e_i\]

<p>$NH_i$ - number of hits to the website</p>

<p>$JD_i$ - day of the year (Julian day)</p>

<p>$b_0$ - number of hits on Julian day 0 (1970-01-01)</p>

<p>$b_1$ - increase in number of hits per unit day</p>

<p>$e_i$ - variation due to everything we didn‚Äôt measure</p>

<hr />

<h3 id="linear-regression-line">Linear regression line</h3>

<p>```{r linReg, dependson=‚ÄùleekLoad‚Äù,fig.height=4,fig.width=4, cache=TRUE}
plot(gaData$julian,gaData$visits,pch=19,col=‚Äùdarkgrey‚Äù,xlab=‚ÄùJulian‚Äù,ylab=‚ÄùVisits‚Äù)
lm1 &lt;- lm(gaData$visits ~ gaData$julian)
abline(lm1,col=‚Äùred‚Äù,lwd=3)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Aside, taking the log of the outcome
- Taking the natural log of the outcome has a specific interpretation.
- Consider the model

$$ \log(NH_i) = b_0 + b_1 JD_i + e_i $$ 

**We take log because exp(E(log(Y))) = is [geometric mean](https://www.mathsisfun.com/numbers/geometric-mean.html)**

$NH_i$ - number of hits to the website

$JD_i$ - day of the year (Julian day)

$b_0$ - log number of hits on Julian day 0 (1970-01-01)

$b_1$ - increase in log number of hits per unit day

$e_i$ - variation due to everything we didn't measure

---
### Exponentiating coefficients
- **$e^{E[\log(Y)]}$ geometric mean of $Y$**.
    - With no covariates, this is estimated by
      $e^{\frac{1}{n}\sum_{i=1}^n \log(y_i)} = (\prod_{i=1}^n
      y_i)^{1/n}$
- **When you take the natural log of outcomes and fit a regression
model, your exponentiated coefficients estimate things about geometric
means.**
- $e^{\beta_0}$ estimated geometric mean hits on day 0
- $e^{\beta_1}$ estimated relative increase or decrease in geometric
  mean hits per day
- **There's a problem with logs with you have zero counts**, adding a constant works
```{r}
round(exp(coef(lm(I(log(gaData$visits + 1)) ~ gaData$julian))), 5)
</code></pre></div></div>

<hr />

<h3 id="linear-vs-poisson-regression">Linear vs. Poisson regression</h3>

<p><strong>Linear</strong></p>

\[NH_i = b_0 + b_1 JD_i + e_i\]

<p>or</p>

\[E[NH_i | JD_i, b_0, b_1] = b_0 + b_1 JD_i\]

<p><strong>Poisson/log-linear</strong></p>

\[\log\left(E[NH_i | JD_i, b_0, b_1]\right) = b_0 + b_1 JD_i\]

<p><strong>Log of expected value NOT LOG OF VALUE!</strong></p>

<p>or</p>

\[E[NH_i | JD_i, b_0, b_1] = \exp\left(b_0 + b_1 JD_i\right)\]

<hr />

<h3 id="multiplicative-differences">Multiplicative differences</h3>

<p><br /><br />
\(E[NH_i | JD_i, b_0, b_1] = \exp\left(b_0 + b_1 JD_i\right)\)</p>

<p><br /><br /></p>

\[E[NH_i | JD_i, b_0, b_1] = \exp\left(b_0 \right)\exp\left(b_1 JD_i\right)\]

<p><br /><br /></p>

<p><strong>If $JD_i$ is increased by one unit, $E[NH_i | JD_i, b_0, b_1]$ is
multiplied by $\exp\left(b_1\right)$</strong> https://youtu.be/hg51LjG1xIc?t=205</p>

<hr />

<h3 id="poisson-regression-in-r">Poisson regression in R</h3>

<p>```{r poisReg, dependson=‚ÄùlinReg‚Äù,fig.height=4.5,fig.width=4.5, cache=TRUE}
plot(gaData$julian,gaData$visits,pch=19,col=‚Äùdarkgrey‚Äù,xlab=‚ÄùJulian‚Äù,ylab=‚ÄùVisits‚Äù)
glm1 &lt;- glm(gaData$visits ~ gaData$julian,family=‚Äùpoisson‚Äù)
abline(lm1,col=‚Äùred‚Äù,lwd=3); lines(gaData$julian,glm1$fitted,col=‚Äùblue‚Äù,lwd=3)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>**We see the difference between lm and glm**

---

### Mean-variance relationship?

```{r, dependson="poisReg",fig.height=4.5,fig.width=4.5}
plot(glm1$fitted,glm1$residuals,pch=19,col="grey",ylab="Residuals",xlab="Fitted")
</code></pre></div></div>

<p>If we look at the residuals for a given fitted value, the mean seems
to increase and the variance seems to increase. But we would like the
mean == Variance.</p>

<hr />

<h3 id="model-agnostic-standard-errors">Model agnostic standard errors</h3>

<p>```{r agnostic}
library(sandwich)
confint.agnostic &lt;- function (object, parm, level = 0.95, ‚Ä¶)
{
    cf &lt;- coef(object); pnames &lt;- names(cf)
    if (missing(parm))
        parm &lt;- pnames
    else if (is.numeric(parm))
        parm &lt;- pnames[parm]
    a &lt;- (1 - level)/2; a &lt;- c(a, 1 - a)
    pct &lt;- stats:::format.perc(a, 3)
    fac &lt;- qnorm(a)
    ci &lt;- array(NA, dim = c(length(parm), 2L), dimnames = list(parm,
                                                               pct))
    ses &lt;- sqrt(diag(sandwich::vcovHC(object)))[parm]
    ci[] &lt;- cf[parm] + ses %o% fac
    ci
}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[http://stackoverflow.com/questions/3817182/vcovhc-and-confidence-interval](http://stackoverflow.com/questions/3817182/vcovhc-and-confidence-interval)

---

### Estimating confidence intervals

```{r}
confint(glm1)
confint.agnostic(glm1)
</code></pre></div></div>

<hr />

<h3 id="add-log-offset-in-glm-to-account-for-ratios">Add log offset in glm to account for ratios</h3>

<p><br /><br /></p>

\[E[NHSS_i | JD_i, b_0, b_1]/NH_i = \exp\left(b_0 + b_1 JD_i\right)\]

<p><br /><br /></p>

\[\log\left(E[NHSS_i | JD_i, b_0, b_1]\right) - \log(NH_i)  =  b_0 + b_1 JD_i\]

<p><br /><br /></p>

\[\log\left(E[NHSS_i | JD_i, b_0, b_1]\right) = \log(NH_i) + b_0 + b_1 JD_i\]

<hr />

<h3 id="fitting-rates-in-r">Fitting rates in R</h3>

<p>```{r ratesFit,dependson=‚Äùagnostic‚Äù, cache=TRUE,fig.height=4,fig.width=4}
glm2 &lt;- glm(gaData$simplystats ~ julian(gaData$date),offset=log(visits+1),
            family=‚Äùpoisson‚Äù,data=gaData)
plot(julian(gaData$date),glm2$fitted,col=‚Äùblue‚Äù,pch=19,xlab=‚ÄùDate‚Äù,ylab=‚ÄùFitted Counts‚Äù)
points(julian(gaData$date),glm1$fitted,col=‚Äùred‚Äù,pch=19)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Fitting rates in R 

```{r,dependson="ratesFit",fig.height=4,fig.width=4}
glm2 &lt;- glm(gaData$simplystats ~ julian(gaData$date),offset=log(visits+1),
            family="poisson",data=gaData)
plot(julian(gaData$date),gaData$simplystats/(gaData$visits+1),col="grey",xlab="Date",
     ylab="Fitted Rates",pch=19)
lines(julian(gaData$date),glm2$fitted/(gaData$visits+1),col="blue",lwd=3)
</code></pre></div></div>

<hr />

<h3 id="more-information-1">More information</h3>

<ul>
  <li><a href="http://ww2.coastal.edu/kingw/statistics/R-tutorials/loglin.html">Log-linear models and multiway tables</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Poisson_regression">Wikipedia on Poisson regression</a>, <a href="http://en.wikipedia.org/wiki/Overdispersion">Wikipedia on overdispersion</a></li>
  <li><a href="http://cran.r-project.org/web/packages/pscl/vignettes/countreg.pdf">Regression models for count data in R</a></li>
  <li><a href="http://cran.r-project.org/web/packages/pscl/index.html">pscl package</a> - the function <em>zeroinfl</em> fits zero inflated models.</li>
</ul>

<h2 id="hodgepodge-c7-w4">Hodgepodge (c7-w4)</h2>

<h3 id="how-to-fit-functions-using-linear-models">How to fit functions using linear models</h3>
<ul>
  <li>Consider a model $Y_i = f(X_i) + \epsilon$.</li>
  <li>How can we fit such a model using linear models (called scatterplot smoothing)</li>
  <li>Consider the model 
\(Y_i = \beta_0 + \beta_1 X_i + \sum_{k=1}^d (x_i - \xi_k)_+ \gamma_k + \epsilon_{i}\)
where $(a)_+ = a$ if $a &gt; 0$ and $0$ otherwise and $\xi_1 \leq ‚Ä¶ \leq \xi_d$ are known knot points.</li>
  <li>Prove to yourelf that the mean function
\(\beta_0 + \beta_1 X_i + \sum_{k=1}^d (x_i - \xi_k)_+ \gamma_k\)
is continuous at the knot points.</li>
</ul>

<hr />
<h3 id="simulated-example">Simulated example</h3>
<p>```{r, fig.height=4, fig.width=4}
n &lt;- 500; x &lt;- seq(0, 4 * pi, length = n); y &lt;- sin(x) + rnorm(n, sd = .3)
knots &lt;- seq(0, 8 * pi, length = 20); 
splineTerms &lt;- sapply(knots, function(knot) (x &gt; knot) * (x - knot))
xMat &lt;- cbind(1, x, splineTerms)
yhat &lt;- predict(lm(y ~ xMat - 1))
plot(x, y, frame = FALSE, pch = 21, bg = ‚Äúlightblue‚Äù, cex = 2)
lines(x, yhat, col = ‚Äúred‚Äù, lwd = 2)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
### Adding squared terms
* Adding squared terms makes it continuously differentiable at the knot points.
* Adding cubic terms makes it twice continuously differentiable at the knot points; etcetera.
$$
  Y_i = \beta_0 + \beta_1 X_i + \beta_2 X_i^2 + \sum_{k=1}^d (x_i - \xi_k)_+^2 \gamma_k + \epsilon_{i}
$$

---
```{r, fig.height=4, fig.width=4}  
splineTerms &lt;- sapply(knots, function(knot) (x &gt; knot) * (x - knot)^2)
xMat &lt;- cbind(1, x, x^2, splineTerms)
yhat &lt;- predict(lm(y ~ xMat - 1))
plot(x, y, frame = FALSE, pch = 21, bg = "lightblue", cex = 2)
lines(x, yhat, col = "red", lwd = 2)
</code></pre></div></div>

<hr />
<h3 id="notes-3">Notes</h3>
<ul>
  <li>The collection of regressors is called a basis.
    <ul>
      <li>People have spent <strong>a lot</strong> of time thinking about bases for this kind of problem. So, consider this as just a teaser.</li>
    </ul>
  </li>
  <li>Single knot point terms can fit hockey stick like processes.</li>
  <li>These bases can be used in GLMs as well.</li>
  <li>An issue with these approaches is the large number of parameters introduced.
    <ul>
      <li>Requires some method of so called regularization.</li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="harmonics-using-linear-models">Harmonics using linear models</h3>
<pre><code class="language-{r}">##Chord finder, playing the white keys on a piano from octave c4 - c5
notes4 &lt;- c(261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88, 523.25)
t &lt;- seq(0, 2, by = .001); n &lt;- length(t)
c4 &lt;- sin(2 * pi * notes4[1] * t); e4 &lt;- sin(2 * pi * notes4[3] * t); 
g4 &lt;- sin(2 * pi * notes4[5] * t)
chord &lt;- c4 + e4 + g4 + rnorm(n, 0, 0.3)
x &lt;- sapply(notes4, function(freq) sin(2 * pi * freq * t))
fit &lt;- lm(chord ~ x - 1)
</code></pre>

<hr />
<p>```{r, fig.height=5,fig.width=5, echo=FALSE}
plot(c(0, 9), c(0, 1.5), xlab = ‚ÄúNote‚Äù, ylab = ‚ÄúCoef^2‚Äù, axes = FALSE, frame = TRUE, type = ‚Äún‚Äù)
axis(2)
axis(1, at = 1 : 8, labels = c(‚Äúc4‚Äù, ‚Äúd4‚Äù, ‚Äúe4‚Äù, ‚Äúf4‚Äù, ‚Äúg4‚Äù, ‚Äúa4‚Äù, ‚Äúb4‚Äù, ‚Äúc5‚Äù))
for (i in 1 : 8) abline(v = i, lwd = 3, col = grey(.8))
lines(c(0, 1 : 8, 9), c(0, coef(fit)^2, 0), type = ‚Äúl‚Äù, lwd = 3, col = ‚Äúred‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---
```{r, fig.height=5, fig.wdith=5}
##(How you would really do it)
a &lt;- fft(chord); plot(Re(a)^2, type = "l")
</code></pre></div></div>
<h3 id="quiz-c7-w4">Quiz c7-w4</h3>
<p>http://rstudio-pubs-static.s3.amazonaws.com/147494_3a252a05553c4bac9770f4582e9f770a.html</p>

<h2 id="c7-w4-assignment">C7-w4 assignment</h2>
<p>```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, message=F, warning=F, cache=T)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>### Executive Summary

We start with the exploratory analysis (boxplots), to see how the Mean
of MPG varies with transmissions. Next, we attempt to fit models with
one variable and many variables to get more realistic results. Finally
we look at some diagnostic plots to comment on our data and
findings. **Throughout the analysis we expect Manual transmissions to be
better than Automatic.**

### Exploratory Analysis

`?mtcars` gives the variable names. `mpg` stands for miles per
gallon. `am` is 1 for automatic and 0 for manual. `summary` shows us
that `mpg` varies from 10 to 34 Miles per gallon! We make a boxplot
which helps us frame out hypothesis to answer which is better for MPG,
automatic or manual. Due to space constraints further exploration is
not shown

```{r plot, fig.width=4, fig.height=3 }
#par(mfrow=c(1,2))
x &lt;- mtcars$am 
y &lt;- mtcars$mpg
boxplot(y[x==0],y[x==1], names=c("Automatic","Manual"))
</code></pre></div></div>

<hr />

<h3 id="is-an-automatic-or-manual-transmission-better-for-mpg-">Is an automatic or manual transmission better for MPG ?</h3>

<p>We do a one sided T test with the following hypothesis:</p>

<p><strong>H0:</strong> $\mu_{automatic} \leq \mu_{manual}$<br />
<strong>H1:</strong> $\mu_{automatic} \geq \mu_{manual}$</p>

<p>```{r }
y &lt;- mtcars$mpg
x &lt;- mtcars$am
ya &lt;- y[x==0]
ym &lt;- y[x==1]
t.test(ym,ya,paired=F, var.equal=F, alternative=‚Äùgreater‚Äù)$p.value
t.test(ym,ya,paired=F, var.equal=F, alternative=‚Äùgreater‚Äù)$conf.int</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>We reject H0 based on the p-value (&lt;&lt;&lt; 5%) and the confidence intervals not
containing values $\leq 0$. We are inclined to think that **Manual is
better than Automatic**

---

### Fitting models
**Strategy for model selection**: It appears that lm a decent tool for
this. Poisson seems to not make sense here as the data is not discrete
and is not a rate (per time). We start with 1 variable lm and then
follow it up with some anova tests to identify the variables that make
an impact and then make the final model with those variables.

**Lm with one variable**
```{r linreg}
fit &lt;- lm(y~x)
summary(fit)$coefficients
</code></pre></div></div>
<p><strong>The intercept is the mean of automatic and the coefficient of X is the
difference between the means.</strong> With this we are able to predict that
MPG is <code class="language-plaintext highlighter-rouge">17.14</code> for automatic and <code class="language-plaintext highlighter-rouge">24.39</code> for manual. The intercept and
the coefficient of X are both significant based on the p-values.</p>

<p><strong>Lm Anova multiple variables</strong>:<br />
We check the influence of other parameters by sequentially adding more
variables to determine which model adds Sum Square value as shown below.</p>

<p>Checking influence of other parameters. Anova is not done to save
time!</p>

<p>```{r anova, echo=T}
fit3 &lt;- lm(mpg~ factor(am),data=mtcars)
fit4 &lt;- lm(mpg~ factor(am)+cyl,data=mtcars)
fit5 &lt;- lm(mpg~ factor(am)+cyl+disp,data=mtcars)
fit6 &lt;- lm(mpg~ factor(am)+cyl+disp+hp,data=mtcars)
fit7 &lt;- lm(mpg~ factor(am)+cyl+disp+hp+drat,data=mtcars)
fit8 &lt;- lm(mpg~ factor(am)+cyl+disp+hp+drat+wt,data=mtcars)
fit9 &lt;- lm(mpg~ factor(am)+cyl+disp+hp+drat+wt+qsec,data=mtcars)
fit10 &lt;- lm(mpg~
               factor(am)+cyl+disp+hp+drat+wt+qsec+factor(vs),data=mtcars)
fit11 &lt;- lm(mpg~
               factor(am)+cyl+disp+hp+drat+wt+qsec+factor(vs)+gear,data=mtcars)
fit12 &lt;- lm(mpg~
                factor(am)+cyl+disp+hp+drat+wt+qsec+factor(vs)+gear+carb,data=mtcars)
anova(fit3, fit4, fit5, fit6, fit7, fit8, fit9, fit10,fit11,fit12)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>From looking at the `Sum of Squares` the `Pr` column **we select `cyl`, `hp` and
`wt`** which seem to be the contributing factors based on the
p-value. **Based on sum of squares the other variables seem to account for `93%`
of residual variation.**

So final model is:
```{r }
fit.final &lt;- lm(mpg~ factor(am)+cyl+hp+wt,data=mtcars)
summary(fit.final)$coefficients

</code></pre></div></div>

<hr />

<h3 id="conclusions-quantifying-the-mpg-difference">Conclusions: <strong>Quantifying the MPG difference</strong></h3>

<p>It appears that the <strong>manual transmission on average has 1.47 MPG more
than automatic and NOT 7 MPG more as estimated by
1-variable-linear-regression</strong>, when accounting for other variables
using Anova. This current value is much higher than the value we got
initially without considering other variables. The anova test and
subsequent variables account for 93% of the residual variation.</p>

<p>The residual plots and diagnostics info are shown in Appendix.</p>

<hr />

<h3 id="appendix-diagnostics-and-residual-plots">Appendix: Diagnostics and residual plots</h3>

<p>```{r, include=F }
plot(fit.final$fitted.values,resid(fit.final))
abline(h=0)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

```{r, echo=F }
par(mfrow=c(2,3))
plot(fit.final, which=1)
plot(fit.final, which=2)
plot(fit.final, which=3)
plot(fit.final, which=4)
plot(fit.final, which=5)
plot(fit.final, which=6)
</code></pre></div></div>
<p>The residual plot shows a small pattern (variation of +-2) probably
due to variables that are not measured or the small sample size, as I
tested adding a few more of the anova variables and the pattern didn‚Äôt go. The Q-Q plot is
expected to be on the dotted line, it shows deviation towards the
end. Probably due to the small size of the sample that we see the
deviation. The Scale location shows that the residuals are equally
spread along the ranges of the predictor.</p>

<p>Looking at the Leverage we agree that there is not much possibility of
data entry issues as the points are away from the dotted lines on the
right (above and below).</p>

<h3 id="appendix-poissons">Appendix: Poisson‚Äôs</h3>

<p>Poisson‚Äôs model is expected to be used for counts or rates (with
time). But I check the results of this as well, to see if we get a
different picture. It looks like the results are very different than
the lm with several variables.</p>

<p>```{r }
gfit &lt;- glm(y~as.factor(x), family=‚Äùpoisson‚Äù)
exp(gfit$coefficients)
summary(gfit)
##boxplot(y[x==0],y[x==1])</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

## C8-w1 Machine Learning
## Prediction Motivation

https://github.com/DataScienceSpecialization/courses/blob/master/08_PracticalMachineLearning/001predictionMotivation/index.md
### About this course

* This course covers the basic ideas behind machine learning/prediction
  * Study design - training vs. test sets
  * Conceptual issues - out of sample error, ROC curves
  * Practical implementation - the caret package
* What this course depends on
  * The Data Scientist's Toolbox
  * R Programming
* What would be useful
  * Exploratory analysis
  * Reporting Data and Reproducible Research
  * Regression models

---

### Who predicts?

* Local governments -&gt; pension payments
* Google -&gt; whether you will click on an ad
* Amazon -&gt; what movies you will watch
* Insurance companies -&gt; what your risk of death is
* Johns Hopkins -&gt; who will succeed in their programs

---


### Why predict? Glory!

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/volinsky.png height=450&gt;


[http://www.zimbio.com/photos/Chris+Volinsky](http://www.zimbio.com/photos/Chris+Volinsky)



---

### Why predict? Riches!

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/heritage.png height=450&gt;


[http://www.heritagehealthprize.com/c/hhp](http://www.heritagehealthprize.com/c/hhp)



---

### Why predict? For sport!

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/kaggle.png height=350&gt;


[http://www.kaggle.com/](http://www.kaggle.com/)

---

### Why predict? To save lives!

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/oncotype.png height=350&gt;

[http://www.oncotypedx.com/en-US/Home](http://www.oncotypedx.com/en-US/Home)

---

### A useful (if a bit advanced) book

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/elemlearn.png height=350&gt;


[The elements of statistical learning](http://statweb.stanford.edu/~tibs/ElemStatLearn/)

---

### A useful package

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/caret.png height=350&gt;


[http://caret.r-forge.r-project.org/](http://caret.r-forge.r-project.org/)


---

### Machine learning (more advanced material)

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/machinelearning.png height=350&gt;


[https://www.coursera.org/course/ml](https://www.coursera.org/course/ml)


---

### Even more resources

* [List of machine learning resources on Quora](http://www.quora.com/Machine-Learning/What-are-some-good-resources-for-learning-about-machine-learning-Why)
* [List of machine learning resources from Science](http://www.sciencemag.org/site/feature/data/compsci/machine_learning.xhtml)
* [Advanced notes from MIT open courseware](http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-867-machine-learning-fall-2006/lecture-notes/)
* [Advanced notes from CMU](http://www.stat.cmu.edu/~cshalizi/350/)
* [Kaggle - machine learning competitions](http://www.kaggle.com/)
## What is prediction
### The central dogma of prediction

&lt;img class="center" src=../../assets/img/08_PredictionAndMachineLearning/centraldogma.png height=450&gt;

---

### What can go wrong

&lt;img class="center" src=../../assets/img/08_PredictionAndMachineLearning/googleflu.png height=450&gt;


http://www.sciencemag.org/content/343/6176/1203.full.pdf

---

### Components of a predictor

&lt;/br&gt;

&lt;center&gt; question -&gt; input data -&gt; features -&gt; algorithm -&gt; parameters -&gt; evaluation  &lt;/center&gt;


---

### SPAM Example

&lt;/br&gt;

&lt;center&gt; &lt;redtext&gt;question&lt;/redtext&gt; -&gt; input data -&gt; features -&gt; algorithm -&gt; parameters -&gt; evaluation  &lt;/center&gt;

&lt;/br&gt;

__Start with a general question__

Can I automatically detect emails that are SPAM that are not?

__Make it concrete__

Can I use quantitative characteristics of the emails to classify them as SPAM/HAM?


---

### SPAM Example

&lt;/br&gt;

&lt;center&gt; question -&gt; &lt;redtext&gt;input data &lt;/redtext&gt; -&gt; features -&gt; algorithm -&gt; parameters -&gt; evaluation  &lt;/center&gt;

&lt;img class=center src=../../assets/img/spamR.png height='400' /&gt;

[http://rss.acs.unt.edu/Rdoc/library/kernlab/html/spam.html](http://rss.acs.unt.edu/Rdoc/library/kernlab/html/spam.html)



---

### SPAM Example

&lt;/br&gt;

&lt;center&gt; question -&gt; input data  -&gt; &lt;redtext&gt;features&lt;/redtext&gt; -&gt; algorithm -&gt; parameters -&gt; evaluation  &lt;/center&gt;

&lt;/br&gt;



&lt;b&gt;
Dear Jeff, 

Can you send me your address so I can send you the invitation? 

Thanks,

Ben
&lt;/b&gt;




---

### SPAM Example

&lt;/br&gt;

&lt;center&gt; question -&gt; input data  -&gt; &lt;redtext&gt;features&lt;/redtext&gt; -&gt; algorithm -&gt; parameters -&gt; evaluation  &lt;/center&gt;

&lt;/br&gt;

&lt;b&gt; 

Dear Jeff, 

Can &lt;rt&gt;you&lt;/rt&gt; send me your address so I can send &lt;rt&gt;you&lt;/rt&gt; the invitation? 

Thanks,

Ben
&lt;/b&gt;

&lt;/br&gt;

Frequency of you $= 2/17 = 0.118$

---

### SPAM Example

&lt;/br&gt;

&lt;center&gt; question -&gt; input data  -&gt; &lt;redtext&gt;features&lt;/redtext&gt; -&gt; algorithm -&gt; parameters -&gt; evaluation  &lt;/center&gt;


```{r loadData}
library(kernlab)
data(spam)
head(spam)
</code></pre></div></div>

<hr />

<h3 id="spam-example">SPAM Example</h3>

<center> question -&gt; input data  -&gt; features -&gt; <redtext>algorithm</redtext> -&gt; parameters -&gt; evaluation  </center>

<pre><code class="language-{r,dependson=&quot;loadData&quot;,fig.height=3.5,fig.width=3.5}">plot(density(spam$your[spam$type=="nonspam"]),
     col="blue",main="",xlab="Frequency of 'your'")
lines(density(spam$your[spam$type=="spam"]),col="red")
</code></pre>

<hr />

<h3 id="spam-example-1">SPAM Example</h3>

<center> question -&gt; input data  -&gt; features -&gt; <redtext>algorithm</redtext> -&gt; parameters -&gt; evaluation  </center>

<p>&lt;/br&gt;&lt;/br&gt;</p>

<p><strong>Our algorithm</strong></p>

<ul>
  <li>Find a value $C$.</li>
  <li><strong>frequency of ‚Äòyour‚Äô $&gt;$ C</strong> predict ‚Äúspam‚Äù</li>
</ul>

<hr />

<h3 id="spam-example-2">SPAM Example</h3>

<center> question -&gt; input data  -&gt; features -&gt; algorithm -&gt; <redtext>parameters</redtext> -&gt; evaluation  </center>

<pre><code class="language-{r,dependson=&quot;loadData&quot;,fig.height=3.5,fig.width=3.5}">plot(density(spam$your[spam$type=="nonspam"]),
     col="blue",main="",xlab="Frequency of 'your'")
lines(density(spam$your[spam$type=="spam"]),col="red")
abline(v=0.5,col="black")
</code></pre>

<hr />

<h3 id="spam-example-3">SPAM Example</h3>

<center> question -&gt; input data  -&gt; features -&gt; algorithm -&gt; parameters -&gt; <redtext>evaluation</redtext></center>

<pre><code class="language-{r,dependson=&quot;loadData&quot;,fig.height=3.5,fig.width=3.5}">prediction &lt;- ifelse(spam$your &gt; 0.5,"spam","nonspam")
table(prediction,spam$type)/length(spam$type)
</code></pre>

<p>Accuracy$ \approx 0.459 + 0.292 = 0.751$</p>
<h2 id="importantce-of-steps">Importantce of steps</h2>
<h3 id="relative-order-of-importance">Relative order of importance</h3>

<p>&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;</p>

<center> question &gt; data &gt; features &gt; algorithms </center>

<hr />

<h3 id="an-important-point">An important point</h3>

<p><q>The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.</q></p>

<center> John Tukey </center>

<hr />

<h3 id="garbage-in--garbage-out">Garbage in = Garbage out</h3>

<center> question -&gt; <rt>input data</rt> -&gt; features -&gt; algorithm -&gt; parameters -&gt; evaluation  </center>

<ol>
  <li>May be easy (movie ratings -&gt; new movie ratings)</li>
  <li>May be harder (gene expression data -&gt; disease)</li>
  <li>Depends on what is a ‚Äúgood prediction‚Äù.</li>
  <li>Often <a href="http://www.youtube.com/watch?v=yvDCzhbjYWs">more data &gt; better models</a></li>
  <li>The most important step!</li>
</ol>

<hr />

<h3 id="features-matter">Features matter!</h3>

<center> question -&gt; input data -&gt; <rt>features</rt> -&gt; algorithm -&gt; parameters -&gt; evaluation  </center>

<p><strong>Properties of good features</strong></p>

<ul>
  <li>Lead to data compression</li>
  <li>Retain relevant information</li>
  <li>Are created based on expert application knowledge</li>
</ul>

<p><strong>Common mistakes</strong></p>

<ul>
  <li>Trying to automate feature selection</li>
  <li>Not paying attention to data-specific quirks</li>
  <li>Throwing away information unnecessarily</li>
</ul>

<hr />

<h3 id="may-be-automated-with-care">May be automated with care</h3>

<center> question -&gt; input data -&gt; <rt>features</rt> -&gt; algorithm -&gt; parameters -&gt; evaluation  </center>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/autofeatures.jpeg height=300&gt;</p>

<p><a href="http://arxiv.org/pdf/1112.6209v5.pdf">http://arxiv.org/pdf/1112.6209v5.pdf</a></p>

<hr />

<h3 id="algorithms-matter-less-than-youd-think">Algorithms matter less than you‚Äôd think</h3>

<center> question -&gt; input data -&gt; features -&gt; <rt>algorithm</rt> -&gt; parameters -&gt; evaluation  </center>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/illusiontable.png height=400&gt;</p>

<p><a href="http://arxiv.org/pdf/math/0606441.pdf">http://arxiv.org/pdf/math/0606441.pdf</a></p>

<hr />

<h3 id="issues-to-consider">Issues to consider</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/mlconsiderations.jpg height=400&gt;</p>

<p><a href="http://strata.oreilly.com/2013/09/gaining-access-to-the-best-machine-learning-methods.html">http://strata.oreilly.com/2013/09/gaining-access-to-the-best-machine-learning-methods.html</a></p>

<hr />

<h3 id="prediction-is-about-accuracy-tradeoffs">Prediction is about accuracy tradeoffs</h3>

<ul>
  <li>Interpretability versus accuracy</li>
  <li>Speed versus accuracy</li>
  <li>Simplicity versus accuracy</li>
  <li>Scalability versus accuracy</li>
</ul>

<hr />

<h3 id="interpretability-matters">Interpretability matters</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/interpretable.png height=150&gt;</p>

<p>&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;</p>

<p><a href="http://www.cs.cornell.edu/~chenhao/pub/mldg-0815.pdf">http://www.cs.cornell.edu/~chenhao/pub/mldg-0815.pdf</a></p>

<hr />

<h3 id="scalability-matters">Scalability matters</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/netflixno.png height=250&gt;
&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;</p>

<p><a href="http://www.techdirt.com/blog/innovation/articles/20120409/03412518422/">http://www.techdirt.com/blog/innovation/articles/20120409/03412518422/</a></p>

<p><a href="http://techblog.netflix.com/2012/04/netflix-recommendations-beyond-5-stars.html">http://techblog.netflix.com/2012/04/netflix-recommendations-beyond-5-stars.html</a></p>

<h2 id="in-and-out-of-sample-errors-c8-w1">In and out of sample errors (c8-w1)</h2>

<h3 id="in-sample-versus-out-of-sample">In sample versus out of sample</h3>

<p><strong>In Sample Error</strong>: The error rate you get on the same
data set you used to build your predictor. Sometimes
called resubstitution error.</p>

<p><strong>Out of Sample Error</strong>: The error rate you get on a new
data set. Sometimes called generalization error.</p>

<p><strong>Key ideas</strong></p>

<ol>
  <li>Out of sample error is what you care about</li>
  <li>In sample error $&lt;$ out of sample error</li>
  <li>The reason is overfitting
    <ul>
      <li>Matching your algorithm to the data you have</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="in-sample-versus-out-of-sample-errors">In sample versus out of sample errors</h3>

<p>```{r loadData, fig.height=3.5,fig.width=3.5}
library(kernlab); data(spam); set.seed(333)
smallSpam &lt;- spam[sample(dim(spam)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>,size=10),]
spamLabel &lt;- (smallSpam$type==‚Äùspam‚Äù)*1 + 1
plot(smallSpam$capitalAve,col=spamLabel)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Prediction rule 1

* capitalAve $&gt;$ 2.7 = "spam"
* capitalAve $&lt;$ 2.40 = "nonspam"
* capitalAve between 2.40 and 2.45 = "spam"
* capitalAve between 2.45 and 2.7 = "nonspam"

---

### Apply Rule 1 to smallSpam

```{r, dependson="loadData"}
rule1 &lt;- function(x){
  prediction &lt;- rep(NA,length(x))
  prediction[x &gt; 2.7] &lt;- "spam"
  prediction[x &lt; 2.40] &lt;- "nonspam"
  prediction[(x &gt;= 2.40 &amp; x &lt;= 2.45)] &lt;- "spam"
  prediction[(x &gt; 2.45 &amp; x &lt;= 2.70)] &lt;- "nonspam"
  return(prediction)
}
table(rule1(smallSpam$capitalAve),smallSpam$type)
</code></pre></div></div>

<hr />

<h3 id="prediction-rule-2">Prediction rule 2</h3>

<ul>
  <li>capitalAve $&gt;$ 2.40 = ‚Äúspam‚Äù</li>
  <li>capitalAve $\leq$ 2.40 = ‚Äúnonspam‚Äù</li>
</ul>

<hr />

<h3 id="apply-rule-2-to-smallspam">Apply Rule 2 to smallSpam</h3>

<p>```{r, dependson=‚ÄùloadData‚Äù}
rule2 &lt;- function(x){
  prediction &lt;- rep(NA,length(x))
  prediction[x &gt; 2.8] &lt;- ‚Äúspam‚Äù
  prediction[x &lt;= 2.8] &lt;- ‚Äúnonspam‚Äù
  return(prediction)
}
table(rule2(smallSpam$capitalAve),smallSpam$type)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Apply to complete spam data

```{r, dependson="loadData"}
table(rule1(spam$capitalAve),spam$type)
table(rule2(spam$capitalAve),spam$type)
mean(rule1(spam$capitalAve)==spam$type)
mean(rule2(spam$capitalAve)==spam$type)
</code></pre></div></div>

<hr />

<h3 id="look-at-accuracy">Look at accuracy</h3>

<p>```{r, dependson=‚ÄùloadData‚Äù}
sum(rule1(spam$capitalAve)==spam$type)
sum(rule2(spam$capitalAve)==spam$type)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### What's going on? 

&lt;center&gt;&lt;rt&gt; Overfitting &lt;/rt&gt;&lt;/center&gt;

* Data have two parts
  * Signal
  * Noise
* The goal of a predictor is to find signal
* You can always design a perfect in-sample predictor
* You capture both signal + noise when you do that
* Predictor won't perform as well on new samples

[http://en.wikipedia.org/wiki/Overfitting](http://en.wikipedia.org/wiki/Overfitting)

## Prediction study design (c8-w1)
### Prediction study design

1. Define your error rate
2. Split data into:
  * Training, Testing, Validation (optional)
3. On the training set pick features
  * Use cross-validation
4. On the training set pick prediction function
  * Use cross-validation
6. If no validation 
  * Apply 1x to test set
7. If validation
  * Apply to test set and refine
  * Apply 1x to validation 


---

### Know the benchmarks

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/benchmark.png height=400&gt;

[http://www.heritagehealthprize.com/c/hhp/leaderboard](http://www.heritagehealthprize.com/c/hhp/leaderboard)


---

### Study design

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/studyDesign.png height=400&gt;


[http://www2.research.att.com/~volinsky/papers/ASAStatComp.pdf](http://www2.research.att.com/~volinsky/papers/ASAStatComp.pdf)

---

### Used by the professionals

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/kagglefront.png height=400&gt;

[http://www.kaggle.com/](http://www.kaggle.com/)

---

### Avoid small sample sizes

* Suppose you are predicting a binary outcome 
  * Diseased/healthy
  * Click on ad/not click on ad 
* One classifier is flipping a coin
* Probability of perfect classification is approximately:
  * $\left(\frac{1}{2}\right)^{sample \; size}$
  * $n = 1$ flipping coin 50% chance of 100% accuracy
  * $n = 2$ flipping coin 25% chance of 100% accuracy
  * $n = 10$ flipping coin 0.10% chance of 100% accuracy

---

### Rules of thumb for prediction study design

* If you have a large sample size
  * 60% training
  * 20% test
  * 20% validation
* If you have a medium sample size
  * 60% training
  * 40% testing
* If you have a small sample size
  * Do cross validation
  * Report caveat of small sample size

---

### Some principles to remember

* Set the test/validation set aside and _don't look at it_
* In general _randomly_ sample training and test
* Your data sets must reflect structure of the problem
  * If predictions evolve with time split train/test in time chunks (called[backtesting](http://en.wikipedia.org/wiki/Backtesting) in finance)
* All subsets should reflect as much diversity as possible
  * Random assignment does this
  * You can also try to balance by features - but this is tricky
## Types of errors (c8-w1)
### Basic terms

In general, __Positive__ = identified and __negative__ = rejected. Therefore:

__True positive__ = correctly identified

__False positive__ = incorrectly identified

__True negative__ = correctly rejected

__False negative__ = incorrectly rejected

_Medical testing example_:

__True positive__ = Sick people correctly diagnosed as sick

__False positive__= Healthy people incorrectly identified as sick

__True negative__ = Healthy people correctly identified as healthy

__False negative__ = Sick people incorrectly identified as healthy.

[http://en.wikipedia.org/wiki/Sensitivity_and_specificity](http://en.wikipedia.org/wiki/Sensitivity_and_specificity)


---

### Key quantities


&lt;img class=center src=../../assets/img/keyquantities.png height=500&gt;


[http://en.wikipedia.org/wiki/Sensitivity_and_specificity](http://en.wikipedia.org/wiki/Sensitivity_and_specificity)

http://www.biostat.jhsph.edu/~iruczins/teaching/140.615/

---

### Key quantities as fractions


&lt;img class=center src=../../assets/img/keyquantfrac.png height=500&gt;
http://www.biostat.jhsph.edu/~iruczins/teaching/140.615/


---

### Screening tests


&lt;img class=center src=../../assets/img/predpos1.png height=500&gt;
http://www.biostat.jhsph.edu/~iruczins/teaching/140.615/

---

### General population


&lt;img class=center src=../../assets/img/predpos2.png height=500&gt;
http://www.biostat.jhsph.edu/~iruczins/teaching/140.615/

---

### General population as fractions


&lt;img class=center src=../../assets/img/predpos3.png height=500&gt;
http://www.biostat.jhsph.edu/~iruczins/teaching/140.615/

---

### At risk subpopulation

&lt;img class=center src=../../assets/img/predpos4.png height=500&gt;
http://www.biostat.jhsph.edu/~iruczins/teaching/140.615/

---

### At risk subpopulation as fraction

&lt;img class=center src=../../assets/img/predpos5.png height=500&gt;
http://www.biostat.jhsph.edu/~iruczins/teaching/140.615/


---

### Key public health issue 

&lt;img class=center src=../../assets/img/mammograms.png height=500&gt;
http://www.biostat.jhsph.edu/~iruczins/teaching/140.615/

---

### Key public health issue 

&lt;img class=center src=../../assets/img/prostatescreen.png height=500&gt;



---

### For continuous data

__Mean squared error (MSE)__:

$$\frac{1}{n} \sum_{i=1}^n (Prediction_i - Truth_i)^2$$

__Root mean squared error (RMSE)__:

$$\sqrt{\frac{1}{n} \sum_{i=1}^n(Prediction_i - Truth_i)^2}$$

---

### Common error measures

1. Mean squared error (or root mean squared error)
  * Continuous data, sensitive to outliers
2. Median absolute deviation 
  * Continuous data, often more robust
3. Sensitivity (recall)
  * If you want few missed positives
4. Specificity
  * If you want few negatives called positives
5. Accuracy
  * Weights false positives/negatives equally
6. Concordance
  * One example is [kappa](http://en.wikipedia.org/wiki/Cohen%27s_kappa)
5. Predictive value of a positive (precision)
  * When you are screeing and prevelance is low
  
## Receiver operating characteristic (c8-w1)
### Why a curve?

* In binary classification you are predicting one of two categories
  * Alive/dead
  * Click on ad/don't click
* But your predictions are often quantitative
  * Probability of being alive
  * Prediction on a scale from 1 to 10
* The _cutoff_  you choose gives different results

---

### ROC curves Agent and Statquest

Very well explained by [StatQuest](https://www.youtube.com/watch?v=xugjARegisk)!

The below is the confusion table:

|     | D  | Dc |
|-----|----|----|
| +ve | TP | FP |
| -ve | FN | TN |
	
Sensitivity = TP/(TP/FN); It is the P(+ve|D)
Specificity = FP/(FP+TN); It is the P(-ve|Dc)

TP Rate = Sensitivity

FP Rate = 1-Sensitivity

Basically it is about choosing cutoff. Imagine an S curve for a
logistic regression with Determining obesity and weight. 

Obesity vs Weight.

When the cut off is really low to determine if something is obese
then, 

|     | D | Dc |
|-----|---|----|
| +ve | 4 | 4  |
| -ve | 0 | 0  |

i.e., TP rate of 1 and FP rate of 1. 

For ROC we plot Sensitivity vs 1-Specificity i.e., TP rate vs FP rate.

What we want is TP rate to be high and FP rate to be low. This is what
we will choose as the CutOff.


[http://en.wikipedia.org/wiki/Receiver_operating_characteristic](http://en.wikipedia.org/wiki/Receiver_operating_characteristic)

---

### Bayes

https://stats.stackexchange.com/a/185260/217983

Shows the formula for bayes: Post odds = Likelihood ratio * prior
odds.

i.e., P(D|+)/P(Dc|+) = P(+|D)/P(-|Dc) * P(D)/P(Dc)

P(+|D)/P(-|Dc) = likelihood ratio = sensitivity / 1- specificity

### An example

[http://en.wikipedia.org/wiki/Receiver_operating_characteristic](http://en.wikipedia.org/wiki/Receiver_operating_characteristic)

---

### Area under the curve

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/roc1.png height=200&gt;

* AUC = 0.5: random guessing
* AUC = 1: perfect classifer
* In general AUC of above 0.8 considered "good"

[http://en.wikipedia.org/wiki/Receiver_operating_characteristic](http://en.wikipedia.org/wiki/Receiver_operating_characteristic)

---

### What is good?

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/roc3.png height=400&gt;

[http://en.wikipedia.org/wiki/Receiver_operating_characteristic](http://en.wikipedia.org/wiki/Receiver_operating_characteristic)

## cross validation (c8-w1)
### Study design

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/studyDesign.png height=400&gt;


[http://www2.research.att.com/~volinsky/papers/ASAStatComp.pdf](http://www2.research.att.com/~volinsky/papers/ASAStatComp.pdf)

---

### Key idea

1. Accuracy on the training set (resubstitution accuracy) is optimistic
2. A better estimate comes from an independent set (test set accuracy)
3. But we can't use the test set when building the model or it becomes part of the training set
4. So we estimate the test set accuracy with the training set. 


---

### Cross-validation

_Approach_:

1. Use the training set

2. Split it into training/test sets 

3. Build a model on the training set

4. Evaluate on the test set

5. Repeat and average the estimated errors

_Used for_:

1. Picking variables to include in a model

2. Picking the type of prediction function to use

3. Picking the parameters in the prediction function

4. Comparing different predictors

---

### Random subsampling


&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/random.png height=400&gt;


---

### K-fold


&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/kfold.png height=400&gt;

---

### Leave one out

Leaving 1 data point out and using everything else, i.e., its like
k-fold but when k=N

### Considerations

* For time series data data must be used in "chunks"
* For k-fold cross validation
  * Larger k = less bias, more variance
  * Smaller k = more bias, less variance
* Random sampling must be done _without replacement_
* Random sampling with replacement is the _bootstrap_
  * Underestimates of the error
  * Can be corrected, but it is complicated ([0.632 Bootstrap](http://www.jstor.org/discover/10.2307/2965703?uid=2&amp;uid=4&amp;sid=21103054448997))
* If you cross-validate to pick predictors estimate you must estimate
  errors on independent data. 
### Why should we Cross Validate: Agent's

**Why do we need CV? CV is only for model checking, not building! PNN!**
https://stats.stackexchange.com/questions/52274/how-to-choose-a-predictive-model-after-k-fold-cross-validation


**Hold-out-validation vs cross-validation**
https://stats.stackexchange.com/questions/104713/hold-out-validation-vs-cross-validation

**Need to look into this**
http://stats.stackexchange.com/questions/18856/is-cross-validation-a-proper-substitute-for-validation-set

**For now:**

&gt; There are pros and cons to estimating error with both CV and
&gt; hold-out validation (the test set you mention). Both are different
&gt; ways of estimating error on unseen data. In some cases, such as
&gt; limited training data, CV might be the only realistic option. Though
&gt; out-of-sample error estimates for CV will be biased toward the
&gt; training set (these are averaged over each fold) and can lead to
&gt; lower estimated error. If you are using random forest there is
&gt; something called 'out of bag error' which is intended to compensate
&gt; for this and can be more accurate.

https://www.coursera.org/learn/practical-machine-learning/discussions/weeks/4/threads/sJN_F-wlEeaYmQ7DfRQSPg

## What data should you use? (c8-w1)
### A succcessful predictor

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/fivethirtyeight.png height=400&gt;

[fivethirtyeight.com](fivethirtyeight.com)

---

### Polling data

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/gallup.png height=400&gt;

[http://www.gallup.com/](http://www.gallup.com/)

---

### Weighting the data

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/538.png height=400&gt;

[http://www.fivethirtyeight.com/2010/06/pollster-ratings-v40-methodology.html](http://www.fivethirtyeight.com/2010/06/pollster-ratings-v40-methodology.html)

---

### Key idea

&lt;center&gt;To predict X use data related to X&lt;/center&gt;


---

### Key idea

&lt;center&gt;To predict player performance use data about player performance&lt;/center&gt;

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/moneyball.jpg height=400&gt;

---

### Key idea

&lt;center&gt;To predict movie preferences use data about movie preferences&lt;/center&gt;

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/netflix.png height=400&gt;

---

### Key idea

&lt;center&gt;To predict hospitalizations use data about hospitalizations&lt;/center&gt;

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/heritage.png height=400&gt;

---

### Not a hard rule

&lt;center&gt;To predict flu outbreaks use Google searches&lt;/center&gt;

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/flutrends.png height=400&gt;

[http://www.google.org/flutrends/](http://www.google.org/flutrends/)

---

### Looser connection = harder prediction

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/oncotype.png height=300&gt;

---

### Data properties matter

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/fluproblems.jpg height=400&gt;

---

### Unrelated data is the most common mistake

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/choc.png height=400&gt;

[http://www.nejm.org/doi/full/10.1056/NEJMon1211064](http://www.nejm.org/doi/full/10.1056/NEJMon1211064)
## Quiz
https://rpubs.com/delermando/PracticalMachineLearning-Quiz1

## Caret package (c8-w2)
### The caret R package

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/caret.png height=400&gt;

[http://caret.r-forge.r-project.org/](http://caret.r-forge.r-project.org/)

---

### Caret functionality

* Some preprocessing (cleaning)
  * preProcess
* Data splitting
  * createDataPartition
  * createResample
  * createTimeSlices
* Training/testing functions
  * train
  * predict
* Model comparison
  * confusionMatrix

---

### Machine learning algorithms in R

* Linear discriminant analysis
* Regression
* Naive Bayes
* Support vector machines
* Classification and regression trees
* Random forests
* Boosting
* etc. 

---

### Why caret? 

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/predicttable.png height=250&gt;

http://www.edii.uclm.es/~useR-2013/Tutorials/kuhn/user_caret_2up.pdf


--- 

### SPAM Example: Data splitting

```{r loadPackage}
library(caret); library(kernlab); data(spam)
inTrain &lt;- createDataPartition(y=spam$type,
                              p=0.75, list=FALSE)
training &lt;- spam[inTrain,]
testing &lt;- spam[-inTrain,]
dim(training)
</code></pre></div></div>

<hr />

<h3 id="spam-example-fit-a-model">SPAM Example: Fit a model</h3>

<p>```{r training, dependson=‚ÄùloadPackage‚Äù,cache=TRUE}
set.seed(32343)
modelFit &lt;- train(type ~.,data=training, method=‚Äùglm‚Äù)
modelFit</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

--- 

### SPAM Example: Final model

```{r finalModel, dependson="training",cache=TRUE}
modelFit &lt;- train(type ~.,data=training, method="glm")
modelFit$finalModel
</code></pre></div></div>

<hr />

<h3 id="spam-example-prediction">SPAM Example: Prediction</h3>

<p>```{r predictions, dependson=‚Äùtraining‚Äù,cache=TRUE}
predictions &lt;- predict(modelFit,newdata=testing)
predictions</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
--- 

### SPAM Example: Confusion Matrix

```{r confusion, dependson="predictions",cache=TRUE}
confusionMatrix(predictions,testing$type)
</code></pre></div></div>

<hr />

<h3 id="further-information">Further information</h3>

<ul>
  <li>Caret tutorials:
    <ul>
      <li><a href="http://www.edii.uclm.es/~useR-2013/Tutorials/kuhn/user_caret_2up.pdf">http://www.edii.uclm.es/~useR-2013/Tutorials/kuhn/user_caret_2up.pdf</a></li>
      <li><a href="http://cran.r-project.org/web/packages/caret/vignettes/caret.pdf">http://cran.r-project.org/web/packages/caret/vignettes/caret.pdf</a></li>
    </ul>
  </li>
  <li>A paper introducing the caret package
    <ul>
      <li><a href="http://www.jstatsoft.org/v28/i05/paper">http://www.jstatsoft.org/v28/i05/paper</a></li>
    </ul>
  </li>
</ul>

<h2 id="data-slicing-c8-w2">Data Slicing (c8-w2)</h2>

<h3 id="spam-example-data-splitting">SPAM Example: Data splitting</h3>

<p>DATA Splitting: just split data to have equal 75% training and 25%
sample and trying to keep the ratio of spam and non spam in the same
order.</p>

<p>```{r loadPackage}
library(caret); library(kernlab); data(spam)
inTrain &lt;- createDataPartition(y=spam$type,
                              p=0.75, list=FALSE)
training &lt;- spam[inTrain,]
testing &lt;- spam[-inTrain,]
dim(training)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### SPAM Example: K-fold

K partitions are made on radmomized order of sample. Then we choose
first k partition as test and the rest of the data as training and so
on.


```{r kfold,dependson="loadPackage"}
set.seed(32323)
folds &lt;- createFolds(y=spam$type,k=10,
                             list=TRUE,returnTrain=TRUE)
sapply(folds,length)
folds[[1]][1:10]
</code></pre></div></div>

<hr />

<h3 id="spam-example-return-test">SPAM Example: Return test</h3>

<p>```{r kfoldtest,dependson=‚ÄùloadPackage‚Äù}
set.seed(32323)
folds &lt;- createFolds(y=spam$type,k=10,
                             list=TRUE,returnTrain=FALSE)
sapply(folds,length)
folds[<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>][1:10]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### SPAM Example: Resampling

Here we are talking about pure resampling of the entire data with repitition
```{r resample,dependson="loadPackage"}
set.seed(32323)
folds &lt;- createResample(y=spam$type,times=10,
                             list=TRUE)
sapply(folds,length)
folds[[1]][1:10]
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Resample01</span><span class="w"> </span><span class="n">Resample02</span><span class="w"> </span><span class="n">Resample03</span><span class="w"> </span><span class="n">Resample04</span><span class="w"> </span><span class="n">Resample05</span><span class="w"> </span><span class="n">Resample06</span><span class="w"> </span><span class="n">Resample07</span><span class="w"> </span><span class="n">Resample08</span><span class="w"> </span><span class="n">Resample09</span><span class="w"> 
      </span><span class="m">4601</span><span class="w">       </span><span class="m">4601</span><span class="w">       </span><span class="m">4601</span><span class="w">       </span><span class="m">4601</span><span class="w">       </span><span class="m">4601</span><span class="w">       </span><span class="m">4601</span><span class="w">       </span><span class="m">4601</span><span class="w">       </span><span class="m">4601</span><span class="w">       </span><span class="m">4601</span><span class="w"> 
</span><span class="n">Resample10</span><span class="w"> 
      </span><span class="m">4601</span><span class="w"> 
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">  </span><span class="m">1</span><span class="w">  </span><span class="m">2</span><span class="w">  </span><span class="m">3</span><span class="w">  </span><span class="m">3</span><span class="w">  </span><span class="m">3</span><span class="w">  </span><span class="m">5</span><span class="w">  </span><span class="m">5</span><span class="w">  </span><span class="m">7</span><span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">12</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="spam-example-time-slices">SPAM Example: Time Slices</h3>

<p>```{r time,dependson=‚ÄùloadPackage‚Äù}
set.seed(32323)
tme &lt;- 1:1000
folds &lt;- createTimeSlices(y=tme,initialWindow=20,
                          horizon=10)
names(folds)
folds$train[<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>]
folds$test[<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
``` r
 [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="further-information-1">Further information</h3>

<ul>
  <li>Caret tutorials:
    <ul>
      <li><a href="http://www.edii.uclm.es/~useR-2013/Tutorials/kuhn/user_caret_2up.pdf">http://www.edii.uclm.es/~useR-2013/Tutorials/kuhn/user_caret_2up.pdf</a></li>
      <li><a href="http://cran.r-project.org/web/packages/caret/vignettes/caret.pdf">http://cran.r-project.org/web/packages/caret/vignettes/caret.pdf</a></li>
    </ul>
  </li>
  <li>A paper introducing the caret package
    <ul>
      <li><a href="http://www.jstatsoft.org/v28/i05/paper">http://www.jstatsoft.org/v28/i05/paper</a></li>
    </ul>
  </li>
</ul>

<h2 id="training-options-c8-w2-train-command">Training options (c8-w2) Train command</h2>
<h3 id="spam-example-4">SPAM Example</h3>

<p>```{r loadPackage,cache=TRUE}
library(caret); library(kernlab); data(spam)
inTrain &lt;- createDataPartition(y=spam$type,
                              p=0.75, list=FALSE)
training &lt;- spam[inTrain,]
testing &lt;- spam[-inTrain,]
modelFit &lt;- train(type ~.,data=training, method=‚Äùglm‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Train options

```{r ,dependson="loadPackage"}
args(train.default) ## does not work
args(caret:::train.default) ##works
</code></pre></div></div>

<p>the above command is not found</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rf"</span><span class="p">,</span><span class="w"> </span><span class="n">preProcess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="n">weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> 
    </span><span class="n">metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">is.factor</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="s2">"Accuracy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"RMSE"</span><span class="p">),</span><span class="w"> </span><span class="n">maximize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">metric</span><span class="w"> </span><span class="o">==</span><span class="w"> 
        </span><span class="s2">"RMSE"</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">trControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainControl</span><span class="p">(),</span><span class="w"> </span><span class="n">tuneGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> 
    </span><span class="n">tuneLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> 
</span><span class="kc">NULL</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="metric-options">Metric options</h3>

<p><strong>Continous outcomes</strong>:</p>
<ul>
  <li><em>RMSE</em> = Root mean squared error</li>
  <li><em>RSquared</em> = $R^2$ from regression models</li>
</ul>

<p><strong>Categorical outcomes</strong>:</p>
<ul>
  <li><em>Accuracy</em> = Fraction correct</li>
  <li><em>Kappa</em> = A measure of <a href="http://en.wikipedia.org/wiki/Cohen%27s_kappa">concordance</a></li>
</ul>

<hr />

<h3 id="traincontrol">trainControl</h3>

<p>```{r , dependson=‚ÄùloadPackage‚Äù,cache=TRUE}
args(trainControl)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
``` r
function (method = "boot", number = ifelse(method %in% c("cv", 
    "repeatedcv"), 10, 25), repeats = ifelse(method %in% c("cv", 
    "repeatedcv"), 1, number), p = 0.75, initialWindow = NULL, 
    horizon = 1, fixedWindow = TRUE, verboseIter = FALSE, returnData = TRUE, 
    returnResamp = "final", savePredictions = FALSE, classProbs = FALSE, 
    summaryFunction = defaultSummary, selectionFunction = "best", 
    custom = NULL, preProcOptions = list(thresh = 0.95, ICAcomp = 3, 
        k = 5), index = NULL, indexOut = NULL, timingSamps = 0, 
    predictionBounds = rep(FALSE, 2), seeds = NA, allowParallel = TRUE) 
NULL
</code></pre></div></div>

<hr />

<h3 id="traincontrol-resampling">trainControl resampling</h3>

<ul>
  <li><em>method</em>
    <ul>
      <li><em>boot</em> = bootstrapping</li>
      <li><em>boot632</em> = bootstrapping with adjustment</li>
      <li><em>cv</em> = cross validation</li>
      <li><em>repeatedcv</em> = repeated cross validation</li>
      <li><em>LOOCV</em> = leave one out cross validation</li>
    </ul>
  </li>
  <li><em>number</em>
    <ul>
      <li>For boot/cross validation</li>
      <li>Number of subsamples to take</li>
    </ul>
  </li>
  <li><em>repeats</em>
    <ul>
      <li>Number of times to repeate subsampling</li>
      <li>If big this can <em>slow things down</em></li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="setting-the-seed">Setting the seed</h3>

<ul>
  <li>It is often useful to set an overall seed</li>
  <li>You can also set a seed for each resample</li>
  <li>Seeding each resample is useful for parallel fits</li>
</ul>

<hr />

<h3 id="seed-example">seed example</h3>

<p>```{r , dependson=‚ÄùseedExample‚Äù,cache=TRUE}
set.seed(1235)
modelFit2 &lt;- train(type ~.,data=training, method=‚Äùglm‚Äù)
modelFit2</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

--- 

### seed example

```{r , dependson="seedExample",cache=TRUE}
set.seed(1235)
modelFit3 &lt;- train(type ~.,data=training, method="glm")
modelFit3
</code></pre></div></div>

<hr />

<h3 id="further-resources-3">Further resources</h3>

<ul>
  <li><a href="http://www.edii.uclm.es/~useR-2013/Tutorials/kuhn/user_caret_2up.pdf">Caret tutorial</a></li>
  <li><a href="http://caret.r-forge.r-project.org/training.html">Model training and tuning</a></li>
</ul>

<h2 id="plotting-predictors-c8-w2-exploratory-analysis-points">Plotting predictors (c8-w2) exploratory analysis points</h2>
<h3 id="example-predicting-wages">Example: predicting wages</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/wages.jpg height=350&gt;</p>

<p>Image Credit <a href="http://www.cahs-media.org/the-high-cost-of-low-wages">http://www.cahs-media.org/the-high-cost-of-low-wages</a></p>

<p>Data from: <a href="http://cran.r-project.org/web/packages/ISLR">ISLR package</a> from the book: <a href="http://www-bcf.usc.edu/~gareth/ISL/">Introduction to statistical learning</a></p>

<hr />

<h3 id="example-wage-data">Example: Wage data</h3>

<p>```{r loadData,cache=TRUE}
library(ISLR); library(ggplot2); library(caret);
data(Wage)
summary(Wage)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>


---

### Get training/test sets

```{r trainingTest,dependson="loadData",cache=TRUE}
inTrain &lt;- createDataPartition(y=Wage$wage,
                              p=0.7, list=FALSE)
training &lt;- Wage[inTrain,]
testing &lt;- Wage[-inTrain,]
dim(training); dim(testing)
</code></pre></div></div>

<hr />

<h3 id="feature-plot-caret-package">Feature plot (<em>caret</em> package)</h3>

<p>```{r ,dependson=‚ÄùtrainingTest‚Äù,fig.height=4,fig.width=4}
featurePlot(x=training[,c(‚Äúage‚Äù,‚Äùeducation‚Äù,‚Äùjobclass‚Äù)],
            y = training$wage,
            plot=‚Äùpairs‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Plot every variable against each other!

---

### Qplot (*ggplot2* package)


```{r ,dependson="trainingTest",fig.height=4,fig.width=6}
qplot(age,wage,data=training)
</code></pre></div></div>

<hr />

<h3 id="qplot-with-color-ggplot2-package">Qplot with color (<em>ggplot2</em> package)</h3>

<p>```{r ,dependson=‚ÄùtrainingTest‚Äù,fig.height=4,fig.width=6}
qplot(age,wage,colour=jobclass,data=training)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Add regression smoothers (*ggplot2* package)


```{r ,dependson="trainingTest",fig.height=4,fig.width=6}
qq &lt;- qplot(age,wage,colour=education,data=training)
qq +  geom_smooth(method='lm',formula=y~x)
</code></pre></div></div>

<hr />

<h3 id="cut2-making-factors-hmisc-package">cut2, making factors (<em>Hmisc</em> package)</h3>

<p>```{r cut2,dependson=‚ÄùtrainingTest‚Äù,fig.height=4,fig.width=6,cache=TRUE}
cutWage &lt;- cut2(training$wage,g=3)
table(cutWage)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Boxplots with cut2


```{r ,dependson="cut2plot",fig.height=4,fig.width=6,cache=TRUE}
p1 &lt;- qplot(cutWage,age, data=training,fill=cutWage,
      geom=c("boxplot"))
p1
</code></pre></div></div>

<hr />

<h3 id="boxplots-with-points-overlayed">Boxplots with points overlayed</h3>
<h2 id="basic-preprocessing-c8-w2">Basic preprocessing (c8-w2)</h2>
<h3 id="why-preprocess">Why preprocess?</h3>

<p>```{r loadPackage,cache=TRUE,fig.height=3.5,fig.width=3.5}
library(caret); library(kernlab); data(spam)
inTrain &lt;- createDataPartition(y=spam$type,
                              p=0.75, list=FALSE)
training &lt;- spam[inTrain,]
testing &lt;- spam[-inTrain,]
hist(training$capitalAve,main=‚Äù‚Äú,xlab=‚Äùave. capital run length‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Histogram shows large variance which might affect the algorithms! how
exactly?

---

### Why preprocess?

```{r ,dependson="loadPackage",cache=TRUE,fig.height=3.5,fig.width=3.5}
mean(training$capitalAve)
sd(training$capitalAve)
</code></pre></div></div>

<hr />

<h3 id="standardizing"><strong>Standardizing</strong></h3>

<p>```{r ,dependson=‚ÄùloadPackage‚Äù,cache=TRUE,fig.height=3.5,fig.width=3.5}
trainCapAve &lt;- training$capitalAve
trainCapAveS &lt;- (trainCapAve  - mean(trainCapAve))/sd(trainCapAve) 
mean(trainCapAveS)
sd(trainCapAveS)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Standardizing - test set

```{r ,dependson="loadPackage",cache=TRUE,fig.height=3.5,fig.width=3.5}
testCapAve &lt;- testing$capitalAve
testCapAveS &lt;- (testCapAve  - mean(trainCapAve))/sd(trainCapAve) 
mean(testCapAveS)
sd(testCapAveS)
</code></pre></div></div>

<p>https://stats.stackexchange.com/questions/29781/when-conducting-multiple-regression-when-should-you-center-your-predictor-varia</p>

<hr />

<h3 id="standardizing---preprocess-function">Standardizing - <em>preProcess</em> function</h3>

<p>```{r preprocess,dependson=‚ÄùloadPackage‚Äù,cache=TRUE,fig.height=3.5,fig.width=3.5}
preObj &lt;- preProcess(training[,-58],method=c(‚Äúcenter‚Äù,‚Äùscale‚Äù)) 
trainCapAveS &lt;- predict(preObj,training[,-58])$capitalAve
mean(trainCapAveS)
sd(trainCapAveS)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**`preProcess` takes the values from training set and makes the model,
which is then predicted for either training or test data set!**

---

### Standardizing - _preProcess_ function

```{r ,dependson="preprocess",cache=TRUE,fig.height=3.5,fig.width=3.5}
testCapAveS &lt;- predict(preObj,testing[,-58])$capitalAve
mean(testCapAveS)
sd(testCapAveS)
</code></pre></div></div>

<hr />

<h3 id="standardizing---preprocess-argument">Standardizing - <em>preProcess</em> argument</h3>

<p>```{r training, dependson=‚ÄùloadPackage‚Äù,cache=TRUE}
set.seed(32343)
modelFit &lt;- train(type ~.,data=training,
                  preProcess=c(‚Äúcenter‚Äù,‚Äùscale‚Äù),method=‚Äùglm‚Äù)
modelFit</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Standardizing - Box-Cox transforms

```{r ,dependson="loadPackage",cache=TRUE,fig.height=3.5,fig.width=7}
preObj &lt;- preProcess(training[,-58],method=c("BoxCox"))
trainCapAveS &lt;- predict(preObj,training[,-58])$capitalAve
par(mfrow=c(1,2)); hist(trainCapAveS); qqnorm(trainCapAveS)
</code></pre></div></div>

<p>Centering and scaling reduces variability. Another think we can do is
remove high variability values and another thing following that we can
do is to use another transformation like BOXCOX. What is it? NO
IDEA. When to use it? NO IDEA!</p>

<hr />

<h3 id="standardizing---imputing-data---handling-na">Standardizing - Imputing data - handling NA</h3>

<p>```{r knn,dependson=‚ÄùloadPackage‚Äù,cache=TRUE,fig.height=3.5,fig.width=7}
set.seed(13343)</p>
<h1 id="make-some-values-na">Make some values NA</h1>
<p>training$capAve &lt;- training$capitalAve
selectNA &lt;- rbinom(dim(training)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>,size=1,prob=0.05)==1
training$capAve[selectNA] &lt;- NA</p>

<h1 id="impute-and-standardize">Impute and standardize</h1>
<p>preObj &lt;- preProcess(training[,-58],method=‚ÄùknnImpute‚Äù)
capAve &lt;- predict(preObj,training[,-58])$capAve</p>

<h1 id="standardize-true-values">Standardize true values</h1>
<p>capAveTruth &lt;- training$capitalAve
capAveTruth &lt;- (capAveTruth-mean(capAveTruth))/sd(capAveTruth)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**knnimpute also seems to change the columns that don't have NA**

---

### Standardizing - Imputing data

```{r ,dependson="knn",cache=TRUE,fig.height=3.5,fig.width=7}
quantile(capAve - capAveTruth)
quantile((capAve - capAveTruth)[selectNA])
quantile((capAve - capAveTruth)[!selectNA])
</code></pre></div></div>

<p><strong>Why is !selectNA not completely equal to 0</strong> because of KNNIMPUTE?</p>

<h3 id="notes-and-further-reading-1">Notes and further reading</h3>

<ul>
  <li><strong>Training and test must be processed in the same way</strong></li>
  <li>Test transformations will likely be imperfect
    <ul>
      <li>Especially if the test/training sets collected at different times</li>
    </ul>
  </li>
  <li>Careful when transforming factor variables!</li>
  <li><a href="http://caret.r-forge.r-project.org/preprocess.html">preprocessing with caret</a></li>
</ul>

<h3 id="agents-notes-on-cleaning-data">Agent‚Äôs notes on cleaning data</h3>

<p>Based on <a href="https://machinelearningmastery.com/pre-process-your-dataset-in-r/">here</a>. All in caret!</p>

<p>‚ÄúBoxCox‚Äú: apply a Box‚ÄìCox transform, values must be non-zero and positive.
‚ÄúYeoJohnson‚Äú: apply a Yeo-Johnson transform, like a BoxCox, but values can be negative.
‚ÄúexpoTrans‚Äú: apply a power transform like BoxCox and YeoJohnson.
‚Äúzv‚Äú: remove attributes with a zero variance (all the same value).
‚Äúnzv‚Äú: remove attributes with a near zero variance (close to the same value).
‚Äúcenter‚Äú: subtract mean from values.
‚Äúscale‚Äú: divide values by standard deviation.
‚Äúrange‚Äú: normalize values.
‚Äúpca‚Äú: transform data to the principal components.
‚Äúica‚Äú: transform data to the independent components.
‚ÄúspatialSign‚Äú: project data onto a unit circle.</p>

<h2 id="covariate-creation-c8-w2">Covariate creation (c8-w2)</h2>
<h3 id="two-levels-of-covariate-creation">Two levels of covariate creation</h3>

<p><strong>Level 1: From raw data to covariate</strong></p>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/covCreation1.png height=200&gt;</p>

<p><strong>Level 2: Transforming tidy covariates</strong></p>

<p>```{r spamData,fig.height=4,fig.width=4}
library(kernlab);data(spam)
spam$capitalAveSq &lt;- spam$capitalAve^2</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Level 1, Raw data -&gt; covariates

* Depends heavily on application
* The balancing act is summarization vs. information loss
* Examples:
  * Text files: frequency of words, frequency of phrases ([Google ngrams](https://books.google.com/ngrams)), frequency of capital letters.
  * Images: Edges, corners, blobs, ridges ([computer vision feature detection](http://en.wikipedia.org/wiki/Feature_detection_(computer_vision)))
  * Webpages: Number and type of images, position of elements, colors, videos ([A/B Testing](http://en.wikipedia.org/wiki/A/B_testing))
  * People: Height, weight, hair color, sex, country of origin. 
* **The more knowledge of the system you have the better the job you will do.** 
* **When in doubt, err on the side of more features**
* Can be automated, but use caution!


---

### Level 2, Tidy covariates -&gt; new covariates

* More necessary for some methods (regression, svms) than for others (classification trees).
* **Should be done _only on the training set_**
* The **best approach is through exploratory analysis** (plotting/tables)
* New covariates should be added to data frames

**Only on the training set? but then how do you use it on the test
variables?** Later discussed?

---

### Load example data


```{r loadData,cache=TRUE}
library(ISLR); library(caret); data(Wage);
inTrain &lt;- createDataPartition(y=Wage$wage,
                              p=0.7, list=FALSE)
training &lt;- Wage[inTrain,]; testing &lt;- Wage[-inTrain,]
</code></pre></div></div>

<hr />

<h3 id="common-covariates-to-add-dummy-variables">Common covariates to add, dummy variables</h3>

<p><strong>Basic idea - convert factor variables to <a href="http://bit.ly/19ZhWB6">indicator variables</a></strong></p>

<p>```{r dummyVar,dependson=‚ÄùloadData‚Äù}
table(training$jobclass)
dummies &lt;- dummyVars(wage ~ jobclass,data=training)
head(predict(dummies,newdata=training))</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Removing zero covariates

```{r ,dependson="dummyVar"}
nsv &lt;- nearZeroVar(training,saveMetrics=TRUE)
nsv
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">           </span><span class="n">freqRatio</span><span class="w"> </span><span class="n">percentUnique</span><span class="w"> </span><span class="n">zeroVar</span><span class="w">   </span><span class="n">nzv</span><span class="w">
</span><span class="n">year</span><span class="w">           </span><span class="m">1.029</span><span class="w">       </span><span class="m">0.33302</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="n">age</span><span class="w">            </span><span class="m">1.122</span><span class="w">       </span><span class="m">2.80685</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="n">sex</span><span class="w">            </span><span class="m">0.000</span><span class="w">       </span><span class="m">0.04757</span><span class="w">    </span><span class="kc">TRUE</span><span class="w">  </span><span class="kc">TRUE</span><span class="w">
</span><span class="n">maritl</span><span class="w">         </span><span class="m">3.159</span><span class="w">       </span><span class="m">0.23787</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="n">race</span><span class="w">           </span><span class="m">8.529</span><span class="w">       </span><span class="m">0.19029</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="n">education</span><span class="w">      </span><span class="m">1.492</span><span class="w">       </span><span class="m">0.23787</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="n">region</span><span class="w">         </span><span class="m">0.000</span><span class="w">       </span><span class="m">0.04757</span><span class="w">    </span><span class="kc">TRUE</span><span class="w">  </span><span class="kc">TRUE</span><span class="w">
</span><span class="n">jobclass</span><span class="w">       </span><span class="m">1.077</span><span class="w">       </span><span class="m">0.09515</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="n">health</span><span class="w">         </span><span class="m">2.452</span><span class="w">       </span><span class="m">0.09515</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="n">health_ins</span><span class="w">     </span><span class="m">2.269</span><span class="w">       </span><span class="m">0.09515</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="n">logwage</span><span class="w">        </span><span class="m">1.198</span><span class="w">      </span><span class="m">17.26927</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="n">wage</span><span class="w">           </span><span class="m">1.185</span><span class="w">      </span><span class="m">18.07802</span><span class="w">   </span><span class="kc">FALSE</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span></code></pre></div></div>

<p>Removing low variability covariates!</p>

<hr />

<h3 id="spline-basis">Spline basis</h3>

<p>```{r splines,dependson=‚ÄùdummyVar‚Äù,cache=TRUE}
library(splines)
bsBasis &lt;- bs(training$age,df=3) 
bsBasis</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
_See also_: ns(),poly()

---

### Fitting curves with splines

```{r ,dependson="splines",fig.height=4,fig.width=4}
lm1 &lt;- lm(wage ~ bsBasis,data=training)
plot(training$age,training$wage,pch=19,cex=0.5)
points(training$age,predict(lm1,newdata=training),col="red",pch=19,cex=0.5)
</code></pre></div></div>

<hr />

<h3 id="splines-on-the-test-set">Splines on the test set</h3>

<p>```{r ,dependson=‚Äùsplines‚Äù,fig.height=4,fig.width=4}
predict(bsBasis,age=testing$age)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Notes and further reading

* Level 1 feature creation (raw data to covariates)
  * Science is key. Google "**feature extraction for [data type]"**
  * Err on overcreation of features
  * In some applications (images, voices) automated feature creation is possible/necessary
    * http://www.cs.nyu.edu/~yann/talks/lecun-ranzato-icml2013.pdf
* Level 2 feature creation (covariates to new covariates)
  * The function _preProcess_ in _caret_ will handle some preprocessing.
  * Create new covariates if you think they will improve fit
  * Use exploratory analysis on the training set for creating them
  * Be careful about overfitting!
* [preprocessing with caret](http://caret.r-forge.r-project.org/preprocess.html)
* If you want to fit spline models, use the _gam_ method in the _caret_ package which allows smoothing of multiple variables.
* More on feature creation/data tidying in the Obtaining Data course
  from the Data Science course track. 
  
## Preprocessing with principal components (c8-w2)
### Correlated predictors

```{r loadPackage,cache=TRUE,fig.height=3.5,fig.width=3.5}
library(caret); library(kernlab); data(spam)
inTrain &lt;- createDataPartition(y=spam$type,
                              p=0.75, list=FALSE)
training &lt;- spam[inTrain,]
testing &lt;- spam[-inTrain,]
M &lt;- abs(cor(training[,-58]))
diag(M) &lt;- 0
which(M &gt; 0.8,arr.ind=T)
</code></pre></div></div>

<p>Check which variables have high correalation</p>

<hr />

<h3 id="correlated-predictors">Correlated predictors</h3>

<pre><code class="language-{r,dependson=&quot;loadPackage&quot;,cache=TRUE,fig.height=3.5,fig.width=3.5}">names(spam)[c(34,32)]
plot(spam[,34],spam[,32])
</code></pre>

<hr />

<h3 id="basic-pca-idea">Basic PCA idea</h3>

<ul>
  <li>We might not need every predictor ???</li>
  <li>A weighted combination of predictors might be better Why? how?</li>
  <li>We should pick this combination to capture the ‚Äúmost information‚Äù possible</li>
  <li>Benefits
    <ul>
      <li>Reduced number of predictors; computation wise?</li>
      <li>Reduced noise (due to averaging);</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="we-could-rotate-the-plot--rotate">We could rotate the plot ??? rotate?</h3>

\[X = 0.71 \times {\rm num 415} + 0.71 \times {\rm num857}\]

\[Y = 0.71 \times {\rm num 415} - 0.71 \times {\rm num857}\]

<pre><code class="language-{r,dependson=&quot;loadPackage&quot;,cache=TRUE,fig.height=3.5,fig.width=3.5}">X &lt;- 0.71*training$num415 + 0.71*training$num857
Y &lt;- 0.71*training$num415 - 0.71*training$num857
plot(X,Y)
</code></pre>

<hr />

<h3 id="related-problems-1">Related problems</h3>

<p>You have multivariate variables $X_1,\ldots,X_n$ so $X_1 =
(X_{11},\ldots,X_{1m})$</p>

<ul>
  <li>Find a new set of multivariate variables that are uncorrelated and
explain as much variance as possible.</li>
  <li>If you put all the variables together in one matrix, find the best
matrix created with fewer variables (lower rank) that explains the
original data. (as you do not want to overfit? or ?)</li>
</ul>

<p>The first goal is <font color="#330066">statistical</font> and the
second goal is <font color="#993300">data compression</font>.</p>

<hr />

<h3 id="related-solutions---pcasvd-1">Related solutions - PCA/SVD</h3>

<p><strong>SVD</strong></p>

<p>If $X$ is a matrix with each variable in a column and each observation in a row then the SVD is a ‚Äúmatrix decomposition‚Äù</p>

\[X = UDV^T\]

<p>where the columns of $U$ are orthogonal (left singular vectors), the columns of $V$ are orthogonal (right singluar vectors) and $D$ is a diagonal matrix (singular values).</p>

<p><strong>PCA</strong></p>

<p>The principal components are equal to the right singular values if you first scale (subtract the mean, divide by the standard deviation) the variables.</p>

<hr />

<h3 id="principal-components-in-r---prcomp">Principal components in R - prcomp</h3>

<p>```{r prcomp,dependson=‚ÄùloadPackage‚Äù,cache=TRUE,fig.height=3.5,fig.width=3.5}
smallSpam &lt;- spam[,c(34,32)]
prComp &lt;- prcomp(smallSpam)
plot(prComp$x[,1],prComp$x[,2])</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Principal components in R - prcomp

```{r ,dependson="prcomp",cache=TRUE,fig.height=3.5,fig.width=3.5}
prComp$rotation
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">          </span><span class="n">PC1</span><span class="w">     </span><span class="n">PC2</span><span class="w">
</span><span class="n">num415</span><span class="w"> </span><span class="m">0.7081</span><span class="w">  </span><span class="m">0.7061</span><span class="w">
</span><span class="n">num857</span><span class="w"> </span><span class="m">0.7061</span><span class="w"> </span><span class="m">-0.7081</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="pca-on-spam-data">PCA on SPAM data</h3>

<p>```{r spamPC,dependson=‚ÄùloadPackage‚Äù,cache=TRUE,fig.height=3.5,fig.width=3.5}
typeColor &lt;- ((spam$type==‚Äùspam‚Äù)*1 + 1)
prComp &lt;- prcomp(log10(spam[,-58]+1))
plot(prComp$x[,1],prComp$x[,2],col=typeColor,xlab=‚ÄùPC1‚Äù,ylab=‚ÄùPC2‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**Why Log10? Because this will make the data look more gaussion! So
what? No idea, why would rd peng explain these things?** Some of the
variables are skewed and not normal looking? so ? What is the issue?

---

### PCA with caret

```{r ,dependson="spamPC",cache=TRUE,fig.height=3.5,fig.width=3.5}
preProc &lt;- preProcess(log10(spam[,-58]+1),method="pca",pcaComp=2)
spamPC &lt;- predict(preProc,log10(spam[,-58]+1))
plot(spamPC[,1],spamPC[,2],col=typeColor)
</code></pre></div></div>

<hr />

<h3 id="preprocessing-with-pca">Preprocessing with PCA</h3>

<p>```{r pcaCaret,dependson=‚ÄùspamPC‚Äù,cache=TRUE,fig.height=3.5,fig.width=3.5}
preProc &lt;- preProcess(log10(training[,-58]+1),method=‚Äùpca‚Äù,pcaComp=2)
trainPC &lt;- predict(preProc,log10(training[,-58]+1))
modelFit &lt;- train(training$type ~ .,method=‚Äùglm‚Äù,data=trainPC)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Also can be done with `prcomp(log10(training[,-58]),scale=TRUE)`,
preProcess seems to already use `Scale` in it! Needs to be
investigated as needed!

---

### Preprocessing with PCA

```{r ,dependson="pcaCaret",cache=TRUE,fig.height=3.5,fig.width=3.5}
testPC &lt;- predict(preProc,log10(testing[,-58]+1))
confusionMatrix(testing$type,predict(modelFit,testPC))
</code></pre></div></div>

<hr />

<h3 id="alternative-sets--of-pcs">Alternative (sets # of PCs)</h3>

<p>```{r ,dependson=‚ÄùpcaCaret‚Äù,cache=TRUE,fig.height=3.5,fig.width=3.5}
modelFit &lt;- train(training$type ~ .,method=‚Äùglm‚Äù,preProcess=‚Äùpca‚Äù,data=training)
confusionMatrix(testing$type,predict(modelFit,testing))</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Final thoughts on PCs

* Most useful for linear-type models
* **Can make it harder to interpret predictors**
* Watch out for outliers! 
  * Transform first (with logs/Box Cox)
  * Plot predictors to identify problems
* For more info see 
  * Exploratory Data Analysis
  * [Elements of Statistical Learning](http://statweb.stanford.edu/~tibs/ElemStatLearn/)
  

## predicting with regression (c8-w2)

### Key ideas

* Fit a simple regression model
* Plug in new covariates and multiply by the coefficients
* Useful when the linear model is (nearly) correct

__Pros__:
* Easy to implement
* Easy to interpret

__Cons__:
* Often poor performance in nonlinear settings


---

### Example: Old faithful eruptions

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/yellowstone.png height=400&gt;

Image Credit/Copyright Wally Pacholka [http://www.astropics.com/](http://www.astropics.com/)

---

### Example: Old faithful eruptions

```{r faith}
library(caret);data(faithful); set.seed(333)
inTrain &lt;- createDataPartition(y=faithful$waiting,
                              p=0.5, list=FALSE)
trainFaith &lt;- faithful[inTrain,]; testFaith &lt;- faithful[-inTrain,]
head(trainFaith)
</code></pre></div></div>

<hr />

<h3 id="eruption-duration-versus-waiting-time">Eruption duration versus waiting time</h3>

<p>```{r dependson=‚Äùfaith‚Äù,fig.height=4,fig.width=4}
plot(trainFaith$waiting,trainFaith$eruptions,pch=19,col=‚Äùblue‚Äù,xlab=‚ÄùWaiting‚Äù,ylab=‚ÄùDuration‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Fit a linear model 

$$ ED_i = b_0 + b_1 WT_i + e_i $$

```{r faithlm,dependson="faith",fig.height=4,fig.width=4}
lm1 &lt;- lm(eruptions ~ waiting,data=trainFaith)
summary(lm1)
</code></pre></div></div>

<hr />
<h3 id="model-fit">Model fit</h3>

<p>```{r dependson=‚Äùfaithlm‚Äù,fig.height=4,fig.width=4}
plot(trainFaith$waiting,trainFaith$eruptions,pch=19,col=‚Äùblue‚Äù,xlab=‚ÄùWaiting‚Äù,ylab=‚ÄùDuration‚Äù)
lines(trainFaith$waiting,lm1$fitted,lwd=3)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Predict a new value

$$\hat{ED} = \hat{b}_0 + \hat{b}_1 WT$$

```{r ,dependson="faithlm",fig.height=4,fig.width=4}
coef(lm1)[1] + coef(lm1)[2]*80
newdata &lt;- data.frame(waiting=80)
predict(lm1,newdata)
</code></pre></div></div>

<hr />

<h3 id="plot-predictions---training-and-test">Plot predictions - training and test</h3>

<p>```{r ,dependson=‚Äùfaithlm‚Äù,fig.height=4,fig.width=8}
par(mfrow=c(1,2))
plot(trainFaith$waiting,trainFaith$eruptions,pch=19,col=‚Äùblue‚Äù,xlab=‚ÄùWaiting‚Äù,ylab=‚ÄùDuration‚Äù)
lines(trainFaith$waiting,predict(lm1),lwd=3)
plot(testFaith$waiting,testFaith$eruptions,pch=19,col=‚Äùblue‚Äù,xlab=‚ÄùWaiting‚Äù,ylab=‚ÄùDuration‚Äù)
lines(testFaith$waiting,predict(lm1,newdata=testFaith),lwd=3)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Get training set/test set errors

```{r ,dependson="faithlm",fig.height=4,fig.width=4}
# Calculate RMSE on training
sqrt(sum((lm1$fitted-trainFaith$eruptions)^2))
# Calculate RMSE on test
sqrt(sum((predict(lm1,newdata=testFaith)-testFaith$eruptions)^2))
</code></pre></div></div>

<hr />

<h3 id="prediction-intervals">Prediction intervals</h3>

<p>```{r ,dependson=‚Äùfaithlm‚Äù,fig.height=4,fig.width=4}
pred1 &lt;- predict(lm1,newdata=testFaith,interval=‚Äùprediction‚Äù)
ord &lt;- order(testFaith$waiting)
plot(testFaith$waiting,testFaith$eruptions,pch=19,col=‚Äùblue‚Äù)
matlines(testFaith$waiting[ord],pred1[ord,],type=‚Äùl‚Äù,,col=c(1,2,2),lty = c(1,1,1), lwd=3)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**matlines somehow gives prediction interval. Need to see how it comes
about**

---

### Same process with caret

```{r caretfaith,dependson="faith",fig.height=4,fig.width=4}
modFit &lt;- train(eruptions ~ waiting,data=trainFaith,method="lm")
summary(modFit$finalModel)
</code></pre></div></div>

<hr />

<h3 id="notes-and-further-reading-2">Notes and further reading</h3>

<ul>
  <li>Regression models with multiple covariates can be included</li>
  <li>Often useful in combination with other models</li>
  <li><a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/">Elements of statistical learning</a></li>
  <li><a href="http://www.amazon.com/Modern-Applied-Statistics-W-N-Venables/dp/0387954570">Modern applied statistics with S</a></li>
  <li><a href="http://www-bcf.usc.edu/~gareth/ISL/">Introduction to statistical learning</a></li>
</ul>

<h2 id="predicting-with-regression-multiple-covariates-c8-w2">Predicting with regression multiple covariates (c8-w2)</h2>

<h3 id="example-predicting-wages-1">Example: predicting wages</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/wages.jpg height=350&gt;</p>

<p>Image Credit <a href="http://www.cahs-media.org/the-high-cost-of-low-wages">http://www.cahs-media.org/the-high-cost-of-low-wages</a></p>

<p>Data from: <a href="http://cran.r-project.org/web/packages/ISLR">ISLR package</a> from the book: <a href="http://www-bcf.usc.edu/~gareth/ISL/">Introduction to statistical learning</a></p>

<hr />

<h3 id="example-wage-data-1">Example: Wage data</h3>

<p>```{r loadData,cache=TRUE}
library(ISLR); library(ggplot2); library(caret);
data(Wage); Wage &lt;- subset(Wage,select=-c(logwage))
summary(Wage)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>


---

### Get training/test sets

```{r trainingTest,dependson="loadData",cache=TRUE}
inTrain &lt;- createDataPartition(y=Wage$wage,
                              p=0.7, list=FALSE)
training &lt;- Wage[inTrain,]; testing &lt;- Wage[-inTrain,]
dim(training); dim(testing)
</code></pre></div></div>

<hr />

<h3 id="feature-plot">Feature plot</h3>

<p>```{r ,dependson=‚ÄùtrainingTest‚Äù,fig.height=4,fig.width=4}
featurePlot(x=training[,c(‚Äúage‚Äù,‚Äùeducation‚Äù,‚Äùjobclass‚Äù)],
            y = training$wage,
            plot=‚Äùpairs‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Plot age versus wage


```{r ,dependson="trainingTest",fig.height=4,fig.width=6}
qplot(age,wage,data=training)
</code></pre></div></div>

<hr />

<h3 id="plot-age-versus-wage-colour-by-jobclass">Plot age versus wage colour by jobclass</h3>

<p>```{r ,dependson=‚ÄùtrainingTest‚Äù,fig.height=4,fig.width=6}
qplot(age,wage,colour=jobclass,data=training)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Plot age versus wage colour by education


```{r ,dependson="trainingTest",fig.height=4,fig.width=6}
qplot(age,wage,colour=education,data=training)
</code></pre></div></div>

<hr />

<h3 id="fit-a-linear-model">Fit a linear model</h3>

\[ED_i = b_0 + b_1 age + b_2 I(Jobclass_i="Information") + \sum_{k=1}^4 \gamma_k I(education_i= level k)\]

<p>```{r modelFit,dependson=‚ÄùtrainingTest‚Äù, cache=TRUE,fig.height=4,fig.width=4}
modFit&lt;- train(wage ~ age + jobclass + education,
               method = ‚Äúlm‚Äù,data=training)
finMod &lt;- modFit$finalModel
print(modFit)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Education levels: 1 = HS Grad, 2 = Some College, 3 = College Grad, 4 = Advanced Degree

---

### Diagnostics

```{r,dependson="modelFit",fig.height=5,fig.width=5}
plot(finMod,1,pch=19,cex=0.5,col="#00000010")
</code></pre></div></div>

<hr />

<h3 id="color-by-variables-not-used-in-the-model">Color by variables not used in the model</h3>

<pre><code class="language-{r,dependson=&quot;modelFit&quot;,fig.height=4,fig.width=6}">qplot(finMod$fitted,finMod$residuals,colour=race,data=training)
</code></pre>

<hr />

<h3 id="plot-by-index">Plot by index</h3>

<pre><code class="language-{r,dependson=&quot;modelFit&quot;,fig.height=5,fig.width=5}">plot(finMod$residuals,pch=19)
</code></pre>

<hr />

<h3 id="predicted-versus-truth-in-test-set">Predicted versus truth in test set</h3>

<p>```{r predictions, dependson=‚ÄùmodelFit‚Äù,fig.height=4,fig.width=6}
pred &lt;- predict(modFit, testing)
qplot(wage,pred,colour=year,data=testing)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### If you want to use all covariates

```{r allCov,dependson="trainingTest",fig.height=4,fig.width=4,warning=FALSE}
modFitAll&lt;- train(wage ~ .,data=training,method="lm")
pred &lt;- predict(modFitAll, testing)
qplot(wage,pred,data=testing)
</code></pre></div></div>

<hr />

<h3 id="notes-and-further-reading-3">Notes and further reading</h3>

<ul>
  <li>Often useful in combination with other models</li>
  <li><a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/">Elements of statistical learning</a></li>
  <li><a href="http://www.amazon.com/Modern-Applied-Statistics-W-N-Venables/dp/0387954570">Modern applied statistics with S</a></li>
  <li><a href="http://www-bcf.usc.edu/~gareth/ISL/">Introduction to statistical learning</a>
    <h2 id="quiz-c8-w2">Quiz c8-w2</h2>
    <ol>
      <li>Load the Alzheimer‚Äôs disease data using the commands:</li>
    </ol>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
  </span><span class="n">data</span><span class="p">(</span><span class="n">AlzheimerDisease</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Which of the following commands will create non-overlapping
  training and test sets with about 50% of the observations assigned
  to each?</p>

    <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">adData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">,</span><span class="n">predictors</span><span class="p">)</span><span class="w">
  </span><span class="n">trainIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.50</span><span class="p">,</span><span class="n">list</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
  </span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="n">trainIndex</span><span class="p">,]</span><span class="w">
  </span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="o">-</span><span class="n">trainIndex</span><span class="p">,]</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<ol>
  <li>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">concrete</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">mixtures</span><span class="o">$</span><span class="n">CompressiveStrength</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mixtures</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mixtures</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span></code></pre></div>    </div>

    <p>Make a plot of the outcome (CompressiveStrength) versus the index
of the samples. Color by each of the variables in the data set
(you may find the cut2() function in the Hmisc package useful for
turning continuous covariates into factors). What do you notice in
these plots?</p>

    <p>Ans: There is a non-random pattern in the plot of the outcome
versus index that does not appear to be perfectly explained by any
predictor suggesting a variable may be missing.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">training</span><span class="p">)[[</span><span class="m">1</span><span class="p">]],</span><span class="n">CompressiveStrength</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">Water</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">concrete</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">mixtures</span><span class="o">$</span><span class="n">CompressiveStrength</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mixtures</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mixtures</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span></code></pre></div>    </div>

    <p>Make a histogram and confirm the SuperPlasticizer variable is
skewed. Normally you might use the log transform to try to make
the data more symmetric. Why would that be a poor choice for this
variable?</p>

    <p>There are a large number of values that are the same and even if
you took the log(SuperPlasticizer + 1) they would still all be
identical so the distribution would not be symmetric.</p>
  </li>
  <li>
    <p>Load the Alzheimer‚Äôs disease data using the commands:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
 </span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
 </span><span class="n">set.seed</span><span class="p">(</span><span class="m">3433</span><span class="p">)</span><span class="w">
 </span><span class="n">data</span><span class="p">(</span><span class="n">AlzheimerDisease</span><span class="p">)</span><span class="w">
 </span><span class="n">adData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">,</span><span class="n">predictors</span><span class="p">)</span><span class="w">
 </span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">adData</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
 </span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
 </span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span></code></pre></div>    </div>

    <p>Find all the predictor variables in the training set that begin
 with IL. Perform principal components on these variables with the
 preProcess() function from the caret package. Calculate the number
 of principal components needed to capture 90% of the variance. How
 many are there?</p>

    <p>Ans: 9</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">pca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">prcomp</span><span class="p">(</span><span class="n">training</span><span class="p">[,</span><span class="n">cnam</span><span class="p">],</span><span class="n">scale</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
 </span><span class="n">eigs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pca</span><span class="o">$</span><span class="n">sdev</span><span class="o">^</span><span class="m">2</span><span class="w">
 </span><span class="nf">sum</span><span class="p">(</span><span class="n">eigs</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">])</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">eigs</span><span class="p">)</span><span class="w">
	
 </span><span class="c1">## or </span><span class="w">
	
 </span><span class="n">summary</span><span class="p">(</span><span class="n">pca</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p>Note: Scale=TRUE has to be given if you want it to match with the
 pre-Processing PCA!</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">preProc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">preProcess</span><span class="p">(</span><span class="n">training</span><span class="p">[,</span><span class="n">cnam</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="s2">"pca"</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="m">0.9</span><span class="p">)</span><span class="w">
 </span><span class="n">preProc</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">3433</span><span class="p">)</span><span class="n">data</span><span class="p">(</span><span class="n">AlzheimerDisease</span><span class="p">)</span><span class="w">
</span><span class="n">adData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">,</span><span class="n">predictors</span><span class="p">)</span><span class="w">
</span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">adData</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span></code></pre></div>    </div>

    <p>Create a training data set consisting of only the predictors with
variable names beginning with IL and the diagnosis. Build two
predictive models, one using the predictors as they are and one
using PCA with principal components explaining 80% of the variance
in the predictors. Use method=‚Äùglm‚Äù in the train function.</p>

    <p>What is the accuracy of each method in the test set? Which is more
accurate?</p>

    <p><strong>Ans:</strong></p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">3433</span><span class="p">);</span><span class="n">data</span><span class="p">(</span><span class="n">AlzheimerDisease</span><span class="p">)</span><span class="w">
</span><span class="n">adData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">,</span><span class="n">predictors</span><span class="p">)</span><span class="w">
</span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">adData</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]];</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
	
	
</span><span class="n">cnam</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">training</span><span class="p">[</span><span class="n">grep</span><span class="p">(</span><span class="s2">"^IL"</span><span class="p">,</span><span class="n">colnames</span><span class="p">(</span><span class="n">training</span><span class="p">))])</span><span class="w">
	
</span><span class="n">modelFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">training</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">training</span><span class="p">[,</span><span class="n">cnam</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"glm"</span><span class="p">)</span><span class="w">
</span><span class="n">predictions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">modelFit</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">testing</span><span class="p">[,</span><span class="n">cnam</span><span class="p">])</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="w">
	
</span><span class="n">preProc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">preProcess</span><span class="p">(</span><span class="n">training</span><span class="p">[,</span><span class="n">cnam</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="s2">"pca"</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span><span class="n">trainPC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">preProc</span><span class="p">,</span><span class="n">training</span><span class="p">[,</span><span class="n">cnam</span><span class="p">])</span><span class="w">
</span><span class="n">modelFitPC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">training</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">trainPC</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"glm"</span><span class="p">)</span><span class="w">
	
</span><span class="n">predictionsPC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">modelFitPC</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">predict</span><span class="p">(</span><span class="n">preProc</span><span class="p">,</span><span class="n">testing</span><span class="p">[,</span><span class="n">cnam</span><span class="p">]))</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">predictionsPC</span><span class="p">,</span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="w">

</span></code></pre></div>    </div>

    <p>This works as the same as this solution
(http://www.rpubs.com/ryantillis/Machine_Learning_2) and this
solution (https://rpubs.com/Chuk_Yong/248560) but I do not
get the 65% but I get 72% for PCA, but the rpubs guys seems to get it!
WTF?????</p>

    <p>https://rpubs.com/Chuk_Yong/248560 ; reported answer 65% and 72%,
actual answer when I run it: 75% and 72%</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">3433</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">AlzheimerDisease</span><span class="p">)</span><span class="w">
</span><span class="n">adData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">,</span><span class="n">predictors</span><span class="p">)</span><span class="w">
</span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">adData</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">

</span><span class="c1"># grep all columns with IL and diagnosis in the traning and testing set</span><span class="w">
</span><span class="n">trainingIL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">training</span><span class="p">[,</span><span class="n">grep</span><span class="p">(</span><span class="s2">"^IL|diagnosis"</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">training</span><span class="p">))]</span><span class="w">
</span><span class="n">testingIL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">testing</span><span class="p">[,</span><span class="n">grep</span><span class="p">(</span><span class="s2">"^IL|diagnosis"</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">testing</span><span class="p">))]</span><span class="w">

</span><span class="c1"># non-PCA</span><span class="w">
</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainingIL</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"glm"</span><span class="p">)</span><span class="w">
</span><span class="n">predict_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="o">=</span><span class="w"> </span><span class="n">testingIL</span><span class="p">)</span><span class="w">
</span><span class="n">matrix_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">predict_model</span><span class="p">,</span><span class="w"> </span><span class="n">testingIL</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="w">
</span><span class="n">matrix_model</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
	
	
</span><span class="n">modelPCA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainingIL</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"glm"</span><span class="p">,</span><span class="w"> </span><span class="n">preProcess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pca"</span><span class="p">,</span><span class="n">trControl</span><span class="o">=</span><span class="n">trainControl</span><span class="p">(</span><span class="n">preProcOptions</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="m">0.8</span><span class="p">)))</span><span class="w">
</span><span class="n">matrix_modelPCA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">testingIL</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">,</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">modelPCA</span><span class="p">,</span><span class="w"> </span><span class="n">testingIL</span><span class="p">))</span><span class="w">
</span><span class="n">matrix_modelPCA</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ol>

<h2 id="c8-w3">c8-w3</h2>

<p><strong>Predicting with Trees</strong></p>

<p>https://www.youtube.com/watch?v=eKD5gxPPeY0&amp;list=PLBv09BD7ez_4temBw7vLA19p3tdQH6FYO</p>

<p>So basically you look at different variables and try to classify them
as groups. i.e., If it is sunny, heavy winds and rainy, will tom go to
work?</p>

<p><strong>With Bagging</strong></p>

<p>We do bootstrapping (mulitple resampling with replacement), then
average the results of multiple fits to reduce variability but keeps
the bias the same!</p>

<p><strong>Random forests</strong></p>

<p>Bootstrapping and then taking each set to make own decision tree and
prediction. Now we average the prediction.</p>

<h2 id="predicting-with-trees-c8-w3">Predicting with trees (c8-w3)</h2>
<h3 id="key-ideas-2">Key ideas</h3>

<ul>
  <li>Iteratively split variables into groups</li>
  <li>Evaluate ‚Äúhomogeneity‚Äù within each group</li>
  <li>Split again if necessary</li>
</ul>

<p><strong>Pros</strong>:</p>

<ul>
  <li>Easy to interpret</li>
  <li>Better performance in nonlinear settings</li>
</ul>

<p><strong>Cons</strong>:</p>

<ul>
  <li>Without pruning/cross-validation can lead to overfitting</li>
  <li>Harder to estimate uncertainty</li>
  <li>Results may be variable</li>
</ul>

<hr />

<h3 id="example-tree">Example Tree</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/obamaTree.png height=450&gt;</p>

<p><a href="http://graphics8.nytimes.com/images/2008/04/16/us/0416-nat-subOBAMA.jpg">http://graphics8.nytimes.com/images/2008/04/16/us/0416-nat-subOBAMA.jpg</a></p>

<hr />

<h3 id="basic-algorithm">Basic algorithm</h3>

<ol>
  <li>Start with all variables in one group</li>
  <li>Find the variable/split that best separates the outcomes</li>
  <li>Divide the data into two groups (‚Äúleaves‚Äù) on that split (‚Äúnode‚Äù)</li>
  <li>Within each split, find the best variable/split that separates the outcomes</li>
  <li>Continue until the groups are too small or sufficiently ‚Äúpure‚Äù</li>
</ol>

<hr />

<h3 id="measures-of-impurity">Measures of impurity</h3>

\[\hat{p}_{mk} = \frac{1}{N_m}\sum_{x_i\; in \; Leaf \; m}\mathbb{1}(y_i = k)\]

<p><strong>Misclassification Error</strong>: 
\(1 - \hat{p}_{m k(m)}; k(m) = {\rm most; common; k}\)</p>
<ul>
  <li>0 = perfect purity</li>
  <li>0.5 = no purity</li>
</ul>

<p><strong>Gini index</strong>:
\(\sum_{k \neq k'} \hat{p}_{mk} \times \hat{p}_{mk'} = \sum_{k=1}^K \hat{p}_{mk}(1-\hat{p}_{mk}) = 1 - \sum_{k=1}^K p_{mk}^2\)</p>

<ul>
  <li>0 = perfect purity</li>
  <li>0.5 = no purity</li>
</ul>

<p>http://en.wikipedia.org/wiki/Decision_tree_learning</p>

<hr />

<h3 id="measures-of-impurity-1">Measures of impurity</h3>

<p><strong>Deviance/information gain</strong>:</p>

<p>\(-\sum_{k=1}^K \hat{p}_{mk} \log_2\hat{p}_{mk}\)</p>
<ul>
  <li>0 = perfect purity</li>
  <li>1 = no purity</li>
</ul>

<p>http://en.wikipedia.org/wiki/Decision_tree_learning</p>

<p>‚Äî &amp;twocol w1:50% w2:50%</p>
<h3 id="measures-of-impurity-2">Measures of impurity</h3>

<p>*** =left</p>

<p>```{r leftplot,fig.height=3,fig.width=4,echo=FALSE,fig.align=‚Äùcenter‚Äù}
par(mar=c(0,0,0,0)); set.seed(1234); x = rep(1:4,each=4); y = rep(1:4,4)
plot(x,y,xaxt=‚Äùn‚Äù,yaxt=‚Äùn‚Äù,cex=3,col=c(rep(‚Äúblue‚Äù,15),rep(‚Äúred‚Äù,1)),pch=19)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
* __Misclassification:__ $1/16 = 0.06$
* __Gini:__ $1 - [(1/16)^2 + (15/16)^2] = 0.12$
* __Information:__$-[1/16 \times log2(1/16) + 15/16 \times log2(15/16)] = 0.34$

*** =right

```{r,dependson="leftplot",fig.height=3,fig.width=4,echo=FALSE,fig.align="center"}
par(mar=c(0,0,0,0)); 
plot(x,y,xaxt="n",yaxt="n",cex=3,col=c(rep("blue",8),rep("red",8)),pch=19)
</code></pre></div></div>

<ul>
  <li><strong>Misclassification:</strong> $8/16 = 0.5$</li>
  <li><strong>Gini:</strong> $1 - [(8/16)^2 + (8/16)^2] = 0.5$</li>
  <li><strong>Information:</strong>$-[1/16 \times log2(1/16) + 15/16 \times log2(15/16)] = 1$</li>
</ul>

<hr />

<h3 id="example-iris-data">Example: Iris Data</h3>

<p>```{r iris, cache=TRUE}
data(iris); library(ggplot2)
names(iris)
table(iris$Species)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Create training and test sets

```{r trainingTest, dependson="iris",cache=TRUE}
inTrain &lt;- createDataPartition(y=iris$Species,
                              p=0.7, list=FALSE)
training &lt;- iris[inTrain,]
testing &lt;- iris[-inTrain,]
dim(training); dim(testing)
</code></pre></div></div>

<hr />

<h3 id="iris-petal-widthssepal-width">Iris petal widths/sepal width</h3>

<p>```{r, dependson=‚ÄùtrainingTest‚Äù,fig.height=4,fig.width=6}
qplot(Petal.Width,Sepal.Width,colour=Species,data=training)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Iris petal widths/sepal width

```{r createTree, dependson="trainingTest", cache=TRUE}
library(caret)
modFit &lt;- train(Species ~ .,method="rpart",data=training)
print(modFit$finalModel)
</code></pre></div></div>

<hr />

<h3 id="plot-tree">Plot tree</h3>

<p>```{r, dependson=‚ÄùcreateTree‚Äù, fig.height=4.5, fig.width=4.5}
plot(modFit$finalModel, uniform=TRUE, 
      main=‚ÄùClassification Tree‚Äù)
text(modFit$finalModel, use.n=TRUE, all=TRUE, cex=.8)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Prettier plots

```{r, dependson="createTree", fig.height=4.5, fig.width=4.5}
library(rattle)
fancyRpartPlot(modFit$finalModel)
</code></pre></div></div>

<hr />

<h3 id="predicting-new-values">Predicting new values</h3>

<p>```{r newdata, dependson=‚ÄùcreateTree‚Äù, fig.height=4.5, fig.width=4.5, cache=TRUE}
predict(modFit,newdata=testing)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Notes and further resources

* Classification trees are non-linear models
  * They use interactions between variables
  * Data transformations may be less important (monotone transformations)
  * Trees can also be used for regression problems (continuous outcome)
* Note that there are multiple tree building options
in R both in the caret package - [party](http://cran.r-project.org/web/packages/party/index.html), [rpart](http://cran.r-project.org/web/packages/rpart/index.html) and out of the caret package - [tree](http://cran.r-project.org/web/packages/tree/index.html)
* [Introduction to statistical learning](http://www-bcf.usc.edu/~gareth/ISL/)
* [Elements of Statistical Learning](http://www-stat.stanford.edu/~tibs/ElemStatLearn/)
* [Classification and regression trees](http://www.amazon.com/Classification-Regression-Trees-Leo-Breiman/dp/0412048418)
## Bagging (c8-w3)
### Bootstrap aggregating (bagging)

__Basic idea__: 

1. Resample cases and recalculate predictions
2. Average or majority vote

__Notes__:

* Similar bias 
* Reduced variance
* More useful for non-linear functions


---

### Ozone data

```{r ozoneData, cache=TRUE}
library(ElemStatLearn); data(ozone,package="ElemStatLearn")
ozone &lt;- ozone[order(ozone$ozone),]
head(ozone)
</code></pre></div></div>
<p><a href="http://en.wikipedia.org/wiki/Bootstrap_aggregating">http://en.wikipedia.org/wiki/Bootstrap_aggregating</a></p>

<hr />

<h3 id="bagged-loess">Bagged loess</h3>

<p>```{r baggedOzone, dependson=‚ÄùozoneData‚Äù,cache=TRUE}
ll &lt;- matrix(NA,nrow=10,ncol=155)
for(i in 1:10){
  ss &lt;- sample(1:dim(ozone)<a href="https://i.stack.imgur.com/Y8qyz.png">1</a>,replace=T)
  ozone0 &lt;- ozone[ss,]; ozone0 &lt;- ozone0[order(ozone0$ozone),]
  loess0 &lt;- loess(temperature ~ ozone,data=ozone0,span=0.2)
  ll[i,] &lt;- predict(loess0,newdata=data.frame(ozone=1:155))
}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Bagged loess

```{r, dependson="baggedOzone",fig.height=4.5,fig.width=4.5}
plot(ozone$ozone,ozone$temperature,pch=19,cex=0.5)
for(i in 1:10){lines(1:155,ll[i,],col="grey",lwd=2)}
lines(1:155,apply(ll,2,mean),col="red",lwd=2)
</code></pre></div></div>

<hr />

<h3 id="bagging-in-caret">Bagging in caret</h3>

<ul>
  <li>Some models perform bagging for you, in <code class="language-plaintext highlighter-rouge">train</code> function consider <code class="language-plaintext highlighter-rouge">method</code> options
    <ul>
      <li><code class="language-plaintext highlighter-rouge">bagEarth</code></li>
      <li><code class="language-plaintext highlighter-rouge">treebag</code></li>
      <li><code class="language-plaintext highlighter-rouge">bagFDA</code></li>
    </ul>
  </li>
  <li>Alternatively you can bag any model you choose using the <code class="language-plaintext highlighter-rouge">bag</code> function</li>
</ul>

<hr />

<h3 id="more-bagging-in-caret">More bagging in caret</h3>

<p>```{r bag1}
predictors = data.frame(ozone=ozone$ozone)
temperature = ozone$temperature
treebag &lt;- bag(predictors, temperature, B = 10,
                bagControl = bagControl(fit = ctreeBag$fit,
                                        predict = ctreeBag$pred,
                                        aggregate = ctreeBag$aggregate))</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
http://www.inside-r.org/packages/cran/caret/docs/nbBag


---

### Example of custom bagging (continued)

```{r,dependson="bag1",fig.height=4,fig.width=4}
plot(ozone$ozone,temperature,col='lightgrey',pch=19)
points(ozone$ozone,predict(treebag$fits[[1]]$fit,predictors),pch=19,col="red")
points(ozone$ozone,predict(treebag,predictors),pch=19,col="blue")
</code></pre></div></div>

<hr />

<h3 id="parts-of-bagging">Parts of bagging</h3>

<pre><code class="language-{r}">ctreeBag$fit
</code></pre>

<hr />

<h3 id="parts-of-bagging-1">Parts of bagging</h3>

<pre><code class="language-{r}">ctreeBag$pred
</code></pre>

<hr />

<h3 id="parts-of-bagging-2">Parts of bagging</h3>

<pre><code class="language-{r}">ctreeBag$aggregate
</code></pre>

<hr />

<h3 id="notes-and-further-resources-4">Notes and further resources</h3>

<p><strong>Notes</strong>:</p>

<ul>
  <li>Bagging is most useful for nonlinear models</li>
  <li>Often used with trees - an extension is random forests</li>
  <li>Several models use bagging in caret‚Äôs <em>train</em> function</li>
</ul>

<p><strong>Further resources</strong>:</p>

<ul>
  <li><a href="http://en.wikipedia.org/wiki/Bootstrap_aggregating">Bagging</a></li>
  <li><a href="http://stat.ethz.ch/education/semesters/FS_2008/CompStat/sk-ch8.pdf">Bagging and boosting</a></li>
  <li><a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/">Elements of Statistical Learning</a></li>
</ul>

<h2 id="random-forests-c8-w3">Random Forests (c8-w3)</h2>
<h3 id="random-forests">Random forests</h3>

<ol>
  <li>Bootstrap samples</li>
  <li>At each split, bootstrap variables</li>
  <li>Grow multiple trees and vote</li>
</ol>

<p><strong>Pros</strong>:</p>

<ol>
  <li>Accuracy</li>
</ol>

<p><strong>Cons</strong>:</p>

<ol>
  <li>Speed</li>
  <li>Interpretability</li>
  <li>Overfitting</li>
</ol>

<hr />

<h3 id="random-forests-1">Random forests</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/forests.png height=400&gt;</p>

<p><a href="http://www.robots.ox.ac.uk/~az/lectures/ml/lect5.pdf">http://www.robots.ox.ac.uk/~az/lectures/ml/lect5.pdf</a></p>

<hr />

<h3 id="iris-data">Iris data</h3>

<p>```{r iris, cache=TRUE}
data(iris); library(ggplot2)
inTrain &lt;- createDataPartition(y=iris$Species,
                              p=0.7, list=FALSE)
training &lt;- iris[inTrain,]
testing &lt;- iris[-inTrain,]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Random forests

```{r forestIris, dependson="irisData",fig.height=4,fig.width=4,cache=TRUE}
library(caret)
modFit &lt;- train(Species~ .,data=training,method="rf",prox=TRUE)
modFit
</code></pre></div></div>

<hr />

<h3 id="getting-a-single-tree">Getting a single tree</h3>

<p>```{r , dependson=‚ÄùforestIris‚Äù,fig.height=4,fig.width=4}
getTree(modFit$finalModel,k=2)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Class "centers"

```{r centers, dependson="forestIris",fig.height=4,fig.width=4}
irisP &lt;- classCenter(training[,c(3,4)], training$Species, modFit$finalModel$prox)
irisP &lt;- as.data.frame(irisP); irisP$Species &lt;- rownames(irisP)
p &lt;- qplot(Petal.Width, Petal.Length, col=Species,data=training)
p + geom_point(aes(x=Petal.Width,y=Petal.Length,col=Species),size=5,shape=4,data=irisP)
</code></pre></div></div>

<hr />

<h3 id="predicting-new-values-1">Predicting new values</h3>

<p>```{r predForest, dependson=‚Äùcenters‚Äù,fig.height=4,fig.width=4,cache=TRUE}
pred &lt;- predict(modFit,testing); testing$predRight &lt;- pred==testing$Species
table(pred,testing$Species)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Predicting new values

```{r, dependson="predForest",fig.height=4,fig.width=4}
qplot(Petal.Width,Petal.Length,colour=predRight,data=testing,main="newdata Predictions")
</code></pre></div></div>

<hr />

<h3 id="notes-and-further-resources-5">Notes and further resources</h3>

<p><strong>Notes</strong>:</p>

<ul>
  <li>Random forests are usually one of the two top
performing algorithms along with boosting in prediction contests.</li>
  <li>Random forests are difficult to interpret but often very accurate.</li>
  <li>Care should be taken to avoid overfitting (see <a href="http://cran.r-project.org/web/packages/randomForest/randomForest.pdf">rfcv</a> funtion)</li>
</ul>

<p><strong>Further resources</strong>:</p>

<ul>
  <li><a href="http://www.stat.berkeley.edu/~breiman/RandomForests/cc_home.htm">Random forests</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Random_forest">Random forest Wikipedia</a></li>
  <li><a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/">Elements of Statistical Learning</a>
    <h2 id="boosting-c8-w3">Boosting (c8-w3)</h2>
    <h3 id="basic-idea">Basic idea</h3>
  </li>
</ul>

<ol>
  <li>Take lots of (possibly) weak predictors</li>
  <li>Weight them and add them up</li>
  <li>Get a stronger predictor</li>
</ol>

<hr />

<h3 id="basic-idea-behind-boosting">Basic idea behind boosting</h3>

<ol>
  <li>Start with a set of classifiers $h_1,\ldots,h_k$
    <ul>
      <li>Examples: All possible trees, all possible regression models, all possible cutoffs.</li>
    </ul>
  </li>
  <li>Create a classifier that combines classification functions:
$f(x) = \rm{sgn}\left(\sum_{t=1}^T \alpha_t h_t(x)\right)$.
    <ul>
      <li>Goal is to minimize error (on training set)</li>
      <li>Iterative, select one $h$ at each step</li>
      <li>Calculate weights based on errors</li>
      <li>Upweight missed classifications and select next $h$</li>
    </ul>
  </li>
</ol>

<p><a href="http://en.wikipedia.org/wiki/AdaBoost">Adaboost on Wikipedia</a></p>

<p><a href="http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf">http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf</a></p>

<hr />

<h3 id="simple-example">Simple example</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/ada1.png height=450&gt;</p>

<p><a href="http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf">http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf</a></p>

<hr />

<h3 id="round-1-adaboost">Round 1: adaboost</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/adar1.png height=450&gt;</p>

<p><a href="http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf">http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf</a></p>

<hr />

<h3 id="round-2--3">Round 2 &amp; 3</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/ada2.png height=450&gt;</p>

<p><a href="http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf">http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf</a></p>

<hr />

<h3 id="completed-classifier">Completed classifier</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/ada3.png height=450&gt;</p>

<p><a href="http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf">http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf</a></p>

<hr />

<h3 id="boosting-in-r">Boosting in R</h3>

<ul>
  <li>Boosting can be used with any subset of classifiers</li>
  <li>One large subclass is <a href="http://en.wikipedia.org/wiki/Gradient_boosting">gradient boosting</a></li>
  <li>R has multiple boosting libraries. Differences include the choice of basic classification functions and combination rules.
    <ul>
      <li><a href="http://cran.r-project.org/web/packages/gbm/index.html">gbm</a> - boosting with trees.</li>
      <li><a href="http://cran.r-project.org/web/packages/mboost/index.html">mboost</a> - model based boosting</li>
      <li><a href="http://cran.r-project.org/web/packages/ada/index.html">ada</a> - statistical boosting based on <a href="http://projecteuclid.org/DPubS?service=UI&amp;version=1.0&amp;verb=Display&amp;handle=euclid.aos/1016218223">additive logistic regression</a></li>
      <li><a href="http://cran.r-project.org/web/packages/GAMBoost/index.html">gamBoost</a> for boosting generalized additive models</li>
    </ul>
  </li>
  <li>Most of these are available in the caret package</li>
</ul>

<hr />

<h3 id="wage-example">Wage example</h3>

<p>```{r wage, cache=TRUE}
library(ISLR); data(Wage); library(ggplot2); library(caret);
Wage &lt;- subset(Wage,select=-c(logwage))
inTrain &lt;- createDataPartition(y=Wage$wage,
                              p=0.7, list=FALSE)
training &lt;- Wage[inTrain,]; testing &lt;- Wage[-inTrain,]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Fit the model

```{r, dependson="wage", cache=TRUE}
modFit &lt;- train(wage ~ ., method="gbm",data=training,verbose=FALSE)
print(modFit)
</code></pre></div></div>

<hr />

<h3 id="plot-the-results">Plot the results</h3>

<p>```{r, dependson=‚Äùwage‚Äù, fig.height=4,fig.width=4}
qplot(predict(modFit,testing),wage,data=testing)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>


---

### Notes and further reading

* A couple of nice tutorials for boosting
  * Freund and Shapire - [http://www.cc.gatech.edu/~thad/6601-gradAI-fall2013/boosting.pdf](http://www.cc.gatech.edu/~thad/6601-gradAI-fall2013/boosting.pdf)
  * Ron Meir- [http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf](http://webee.technion.ac.il/people/rmeir/BoostingTutorial.pdf)
* Boosting, random forests, and model ensembling are the most common tools that win Kaggle and other prediction contests. 
  * [http://www.netflixprize.com/assets/GrandPrize2009_BPC_BigChaos.pdf](http://www.netflixprize.com/assets/GrandPrize2009_BPC_BigChaos.pdf)
  * [https://kaggle2.blob.core.windows.net/wiki-files/327/09ccf652-8c1c-4a3d-b979-ce2369c985e4/Willem%20Mestrom%20-%20Milestone%201%20Description%20V2%202.pdf](https://kaggle2.blob.core.windows.net/wiki-files/327/09ccf652-8c1c-4a3d-b979-ce2369c985e4/Willem%20Mestrom%20-%20Milestone%201%20Description%20V2%202.pdf)
  

## Model Based Prediction (c8-w3)
### Basic idea

1. Assume the data follow a probabilistic model
2. Use Bayes' theorem to identify optimal classifiers

__Pros:__

* Can take advantage of structure of the data
* May be computationally convenient
* Are reasonably accurate on real problems

__Cons:__

* Make additional assumptions about the data
* When the model is incorrect you may get reduced accuracy

---

### Model based approach


1. Our goal is to build parametric model for conditional distribution $P(Y = k | X = x)$

2. A typical approach is to apply [Bayes theorem](http://en.wikipedia.org/wiki/Bayes'_theorem):
$$ Pr(Y = k | X=x) = \frac{Pr(X=x|Y=k)Pr(Y=k)}{\sum_{\ell=1}^K Pr(X=x |Y = \ell) Pr(Y=\ell)}$$
$$Pr(Y = k | X=x) = \frac{f_k(x) \pi_k}{\sum_{\ell = 1}^K f_{\ell}(x) \pi_{\ell}}$$

3. Typically prior probabilities $\pi_k$ are set in advance.

4. A common choice for $f_k(x) = \frac{1}{\sigma_k \sqrt{2 \pi}}e^{-\frac{(x-\mu_k)^2}{\sigma_k^2}}$, a Gaussian distribution

5. Estimate the parameters ($\mu_k$,$\sigma_k^2$) from the data.

6. Classify to the class with the highest value of $P(Y = k | X = x)$

---

### Classifying using the model

A range of models use this approach

* Linear discriminant analysis assumes $f_k(x)$ is multivariate Gaussian with same covariances
* Quadratic discrimant analysis assumes $f_k(x)$ is multivariate Gaussian with different covariances
* [Model based prediction](http://www.stat.washington.edu/mclust/) assumes more complicated versions for the covariance matrix 
* Naive Bayes assumes independence between features for model building

http://statweb.stanford.edu/~tibs/ElemStatLearn/


---

### Why linear discriminant analysis?

$$log \frac{Pr(Y = k | X=x)}{Pr(Y = j | X=x)}$$
$$ = log \frac{f_k(x)}{f_j(x)} + log \frac{\pi_k}{\pi_j}$$
$$ = log \frac{\pi_k}{\pi_j} - \frac{1}{2}(\mu_k + \mu_j)^T \Sigma^{-1}(\mu_k + \mu_j)$$
$$ + x^T \Sigma^{-1} (\mu_k - \mu_j)$$

http://statweb.stanford.edu/~tibs/ElemStatLearn/


---

### Decision boundaries

&lt;img class="center" src="../../assets/img/ldaboundary.png" height=500&gt;

---

### Discriminant function

$$\delta_k(x) = x^T \Sigma^{-1} \mu_k - \frac{1}{2}\mu_k \Sigma^{-1}\mu_k + log(\mu_k)$$


* Decide on class based on $\hat{Y}(x) = argmax_k \delta_k(x)$
* We usually estimate parameters with maximum likelihood


---

### Naive Bayes

Suppose we have many predictors, we would want to model: $P(Y = k | X_1,\ldots,X_m)$

We could use Bayes Theorem to get:

$$P(Y = k | X_1,\ldots,X_m) = \frac{\pi_k P(X_1,\ldots,X_m| Y=k)}{\sum_{\ell = 1}^K P(X_1,\ldots,X_m | Y=k) \pi_{\ell}}$$
$$ \propto \pi_k P(X_1,\ldots,X_m| Y=k)$$

This can be written:

$$P(X_1,\ldots,X_m, Y=k) = \pi_k P(X_1 | Y = k)P(X_2,\ldots,X_m | X_1,Y=k)$$
$$ = \pi_k P(X_1 | Y = k) P(X_2 | X_1, Y=k) P(X_3,\ldots,X_m | X_1,X_2, Y=k)$$
$$ = \pi_k P(X_1 | Y = k) P(X_2 | X_1, Y=k)\ldots P(X_m|X_1\ldots,X_{m-1},Y=k)$$

We could make an assumption to write this:

$$ \approx \pi_k P(X_1 | Y = k) P(X_2 | Y = k)\ldots P(X_m |,Y=k)$$

---

### Example: Iris Data

```{r iris, cache=TRUE}
data(iris); library(ggplot2)
names(iris)
table(iris$Species)
</code></pre></div></div>

<hr />

<h3 id="create-training-and-test-sets">Create training and test sets</h3>

<p>```{r trainingTest, dependson=‚Äùiris‚Äù,cache=TRUE}
inTrain &lt;- createDataPartition(y=iris$Species,
                              p=0.7, list=FALSE)
training &lt;- iris[inTrain,]
testing &lt;- iris[-inTrain,]
dim(training); dim(testing)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Build predictions

```{r fit,dependson="trainingTest"}
modlda = train(Species ~ .,data=training,method="lda")
modnb = train(Species ~ ., data=training,method="nb")
plda = predict(modlda,testing); pnb = predict(modnb,testing)
table(plda,pnb)
</code></pre></div></div>

<hr />

<h3 id="comparison-of-results">Comparison of results</h3>

<pre><code class="language-{r,dependson=&quot;fit&quot;,fig.height=4,fig.width=4}">equalPredictions = (plda==pnb)
qplot(Petal.Width,Sepal.Width,colour=equalPredictions,data=testing)
</code></pre>

<hr />

<h3 id="notes-and-further-reading-4">Notes and further reading</h3>

<ul>
  <li><a href="http://www-bcf.usc.edu/~gareth/ISL/">Introduction to statistical learning</a></li>
  <li><a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/">Elements of Statistical Learning</a></li>
  <li><a href="http://www.stat.washington.edu/raftery/Research/PDF/fraley2002.pdf">Model based clustering</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Linear_discriminant_analysis">Linear Discriminant Analysis</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Quadratic_classifier">Quadratic Discriminant Analysis</a></li>
</ul>

<h2 id="agents-notes-c8-w3">Agent‚Äôs notes c8-w3</h2>

<p>Very depressing lecture set!</p>

<p>Check this out for Cross validation and how to perform it using <a href="http://www.sthda.com/english/articles/38-regression-model-validation/157-cross-validation-essentials-in-r/">trainControl</a>.</p>

<h2 id="quiz-3">Quiz 3</h2>

<h3 id="question-1">question 1</h3>
<p>For this quiz we will be using several R packages. R package versions change over time, the right answers have been checked using the following versions of the packages.
AppliedPredictiveModeling: v1.1.6</p>

<p>caret: v6.0.47</p>

<p>ElemStatLearn: v2012.04-0</p>

<p>pgmm: v1.1</p>

<p>rpart: v4.1.8</p>

<p>If you aren‚Äôt using these versions of the packages, your answers may not exactly match the right answer, but hopefully should be close.</p>

<p>Load the cell segmentation data from the AppliedPredictiveModeling package using the commands:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(AppliedPredictiveModeling)
data("segmentationOriginal")
library(caret)
</code></pre></div></div>

<ol>
  <li>
    <p>Subset the data to a training set and testing set based on the Case variable in the data set.</p>
  </li>
  <li>
    <p>Set the seed to 125 and fit a CART model with the rpart method using all predictor variables and default caret settings.</p>
  </li>
  <li>
    <p>In the final model what would be the final model prediction for cases with the following variable values:</p>
  </li>
</ol>

<p>a. TotalIntench2 = 23,000; FiberWidthCh1 = 10; PerimStatusCh1=2</p>

<p>b. TotalIntench2 = 50,000; FiberWidthCh1 = 10;VarIntenCh4 = 100</p>

<p>c. TotalIntench2 = 57,000; FiberWidthCh1 = 8;VarIntenCh4 = 100</p>

<p>d. FiberWidthCh1 = 8;VarIntenCh4 = 100; PerimStatusCh1=2</p>

<p>Ans: I did not get answer: PS, <strong>WS</strong>,PS, Not possible to predict!</p>

<p>With a tree you cannot predict whats not in the tree and you always
have to start from the top. If you don‚Äôt have the top variable then
there is no point!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> 
</span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">segmentationOriginal</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">


</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">segmentationOriginal</span><span class="w">

</span><span class="n">trainSet</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">segmentationOriginal</span><span class="p">[</span><span class="n">segmentationOriginal</span><span class="o">$</span><span class="n">Case</span><span class="w"> </span><span class="o">==</span><span class="s2">"Train"</span><span class="p">,]</span><span class="w">
</span><span class="n">testSet</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">segmentationOriginal</span><span class="p">[</span><span class="n">segmentationOriginal</span><span class="o">$</span><span class="n">Case</span><span class="w"> </span><span class="o">==</span><span class="s2">"Test"</span><span class="p">,]</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">125</span><span class="p">)</span><span class="w">
</span><span class="n">model_rpart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">Class</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">trainSet</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"rpart"</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">rattle</span><span class="p">)</span><span class="w">
</span><span class="n">fancyRpartPlot</span><span class="p">(</span><span class="n">modFit</span><span class="o">$</span><span class="n">finalModel</span><span class="p">)</span><span class="w">

</span><span class="n">predict</span><span class="p">(</span><span class="n">modFit</span><span class="p">,</span><span class="w"> </span><span class="n">newata</span><span class="o">=</span><span class="n">te</span><span class="p">)</span><span class="w">
</span><span class="c1">## it doesn't show more than 2 trees, don't know why! And the second</span><span class="w">
</span><span class="n">tree</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">slightly</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="n">giving</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">results</span><span class="o">!</span><span class="w">
</span></code></pre></div></div>

<h3 id="question-2">Question 2</h3>

<p>If K is small in a K-fold cross validation is the bias in the estimate
of out-of-sample (test set) accuracy smaller or bigger? If K is small
is the variance in the estimate of out-of-sample (test set) accuracy
smaller or bigger. Is K large or small in leave one out cross
validation?</p>

<p>Ans:</p>

<p>The bias is larger and the variance is smaller. Under leave one out
cross validation K is equal to the sample size.</p>

<p>Why?</p>

<p>Based on <a href="https://stats.stackexchange.com/questions/61783/bias-and-variance-in-leave-one-out-vs-k-fold-cross-validation">this</a>, it appears that as k increases bias decreases and
variance increases!</p>

<h3 id="question-3">Question 3</h3>

<p>Load the olive oil data using the commands:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">pgmm</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">olive</span><span class="p">)</span><span class="w">
</span><span class="n">olive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">olive</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>These data contain information on 572 different Italian olive oils
from multiple regions in Italy. Fit a classification tree where Area
is the outcome variable. Then predict the value of area for the
following data frame using the tree command with all defaults</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">colMeans</span><span class="p">(</span><span class="n">olive</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>What is the resulting prediction? Is the resulting prediction strange?
Why or why not?</p>

<p>Ans:</p>

<p>2.783. It is strange because Area should be a qualitative variable -
but tree is reporting the average value of Area as a numeric variable
in the leaf predicted for newdata</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">pgmm</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">olive</span><span class="p">)</span><span class="w">
</span><span class="n">olive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">olive</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span><span class="w">

</span><span class="n">olive_rpart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">Area</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">olive</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"rpart"</span><span class="p">)</span><span class="w">
</span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">colMeans</span><span class="p">(</span><span class="n">olive</span><span class="p">)))</span><span class="w">
</span><span class="n">predict</span><span class="p">(</span><span class="n">olive_rpart</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">newdata</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<h3 id="question-4">Question 4</h3>

<p>Load the South Africa Heart Disease Data and create training and test
sets with the following code:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ElemStatLearn</span><span class="p">)</span><span class="w">
</span><span class="c1">## Warning: package 'ElemStatLearn' was built under R version 3.3.2</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">SAheart</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">8484</span><span class="p">)</span><span class="w">
</span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">SAheart</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="nf">dim</span><span class="p">(</span><span class="n">SAheart</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="o">/</span><span class="m">2</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">trainSA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SAheart</span><span class="p">[</span><span class="n">train</span><span class="p">,]</span><span class="w">
</span><span class="n">testSA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SAheart</span><span class="p">[</span><span class="o">-</span><span class="n">train</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<p>Then set the seed to 13234 and fit a logistic regression model
(method=‚Äúglm‚Äù, be sure to specify family=‚Äúbinomial‚Äù) with Coronary
Heart Disease (chd) as the outcome and age at onset, current alcohol
consumption, obesity levels, cumulative tabacco, type-A behavior, and
low density lipoprotein cholesterol as predictors. Calculate the
misclassification rate for your model using this function and a
prediction on the ‚Äúresponse‚Äù scale:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">missClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">prediction</span><span class="p">){</span><span class="nf">sum</span><span class="p">(((</span><span class="n">prediction</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="o">*</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w">
</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="n">values</span><span class="p">)}</span><span class="w">
</span></code></pre></div></div>

<p>What is the misclassification rate on the training set? What is the misclassification rate on the test set?</p>

<p>Test Set Misclassification: 0.27
Training Set: 0.31
Test Set Misclassification: 0.43
Training Set: 0.31
Test Set Misclassification: 0.31
Training Set: 0.27
Test Set Misclassification: 0.35
Training Set: 0.31</p>

<p>ANS:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">13234</span><span class="p">)</span><span class="w">

</span><span class="c1"># definition of the training model</span><span class="w">
</span><span class="n">regModel</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
</span><span class="n">train</span><span class="p">(</span><span class="n">chd</span><span class="o">~</span><span class="n">age</span><span class="o">+</span><span class="n">alcohol</span><span class="o">+</span><span class="n">obesity</span><span class="o">+</span><span class="n">tobacco</span><span class="o">+</span><span class="n">typea</span><span class="o">+</span><span class="n">ldl</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">trainSA</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"glm"</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">)</span><span class="w">

</span><span class="c1">## Warning in train.default(x, y, weights = w, ...): You are trying to do</span><span class="w">
</span><span class="c1">## regression and your outcome only has two possible values Are you trying to</span><span class="w">
</span><span class="c1">## do classification? If so, use a 2 level factor as your outcome column.</span><span class="w">
</span><span class="c1"># computation of the misclasssification on the training set and test</span><span class="w">
</span><span class="n">set</span><span class="w">

</span><span class="n">missClassTrain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">missClass</span><span class="p">(</span><span class="n">trainSA</span><span class="o">$</span><span class="n">chd</span><span class="p">,</span><span class="n">predict</span><span class="p">(</span><span class="n">regModel</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">trainSA</span><span class="p">))</span><span class="w">
</span><span class="n">missClassTest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">missClass</span><span class="p">(</span><span class="n">testSA</span><span class="o">$</span><span class="n">chd</span><span class="p">,</span><span class="n">predict</span><span class="p">(</span><span class="n">regModel</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">testSA</span><span class="p">))</span><span class="w">
</span><span class="n">missClassTrain</span><span class="w">
</span><span class="n">missClassTest</span><span class="w">

</span></code></pre></div></div>
<p>You will get warnings but we don‚Äôt care for now!</p>

<h3 id="question-5">Question 5</h3>

<p>Load the vowel.train and vowel.test data sets:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ElemStatLearn</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">vowel.train</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">vowel.test</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Set the variable y to be a factor variable in both the training and test set. Then set the seed to 33833. Fit a random forest predictor relating the factor variable y to the remaining variables. Read about variable importance in random forests here: http://www.stat.berkeley.edu/~breiman/RandomForests/cc_home.htm#ooberr.</p>

<p>The caret package uses by default the Gini importance.</p>

<p>Calculate the variable importance using the varImp function in the caret package. What is the order of variable importance?</p>

<p>[NOTE: Use randomForest() specifically, not caret, as there‚Äôs been some issues reported with that approach. 11/6/2016]</p>

<p>The order of the variables is:
x.1, x.2, x.3, x.8, x.6, x.4, x.5, x.9, x.7,x.10
The order of the variables is:
x.10, x.7, x.9, x.5, x.8, x.4, x.6, x.3, x.1,x.2
The order of the variables is:
x.2, x.1, x.5, x.6, x.8, x.4, x.9, x.3, x.7,x.10
The order of the variables is:
x.10, x.7, x.5, x.6, x.8, x.4, x.9, x.3, x.1,x.2</p>

<p>ANS:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">.Random.seed</span><span class="p">,</span><span class="w"> </span><span class="n">envir</span><span class="o">=</span><span class="nf">globalenv</span><span class="p">())</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ElemStatLearn</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">vowel.train</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">vowel.test</span><span class="p">)</span><span class="w">

</span><span class="n">vowel.train</span><span class="o">$</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">vowel.train</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">vowel.test</span><span class="o">$</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">vowel.test</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">33833</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span><span class="w">

</span><span class="n">modvowel</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vowel.train</span><span class="p">)</span><span class="w">
</span><span class="n">order</span><span class="p">(</span><span class="n">varImp</span><span class="p">(</span><span class="n">modvowel</span><span class="p">),</span><span class="w"> </span><span class="n">decreasing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Produces results differently based on the setting of the seed at
different points. What ever I did I was never able to match the quiz
answer!</p>

<h2 id="regularized-regression-c8-w4">Regularized Regression (c8-w4)</h2>
<h3 id="basic-idea-1">Basic idea</h3>

<ol>
  <li>Fit a regression model</li>
  <li>Penalize (or shrink) large coefficients</li>
</ol>

<p><strong>Pros:</strong></p>

<ul>
  <li>Can help with the bias/variance tradeoff</li>
  <li>Can help with model selection</li>
</ul>

<p><strong>Cons:</strong></p>

<ul>
  <li>May be computationally demanding on large data sets</li>
  <li>Does not perform as well as random forests and boosting</li>
</ul>

<hr />

<h3 id="a-motivating-example">A motivating example</h3>

\[Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \epsilon\]

<p>where $X_1$ and $X_2$ are nearly perfectly correlated (co-linear). You can approximate this model by:</p>

\[Y = \beta_0 + (\beta_1 + \beta_2)X_1 + \epsilon\]

<p>The result is:</p>

<ul>
  <li>You will get a good estimate of $Y$</li>
  <li>The estimate (of $Y$) will be biased</li>
  <li>We may reduce variance in the estimate</li>
</ul>

<p>**For some reason it appears that lesser variables lesser variance? So
what if there is more variance? What is the impact action! And lesser
variables more BIAS!
**</p>

<hr />

<h3 id="prostate-cancer">Prostate cancer</h3>

<p>```{r prostate}
library(ElemStatLearn); data(prostate)
str(prostate)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>


---

### Subset selection

&lt;img class="center" src="../../assets/img/prostate.png" height="450"&gt;

[Code here](http://www.cbcb.umd.edu/~hcorrada/PracticalML/src/selection.R)


---

### Most common pattern

&lt;img class="center" src="../../assets/img/trainingandtest.png" height="450"&gt;

http://www.biostat.jhsph.edu/~ririzarr/Teaching/649/

---

### Model selection approach: split samples

* No method better when data/computation time permits it

* Approach
  1. Divide data into training/test/validation
  2. Treat validation as test data, train all competing models on the train data and pick the best one on validation. 
  3. To appropriately assess performance on new data apply to test set
  4. You may re-split and reperform steps 1-3

* Two common problems
  * Limited data
  * Computational complexity
  
http://www.biostat.jhsph.edu/~ririzarr/Teaching/649/
http://www.cbcb.umd.edu/~hcorrada/PracticalML/


---

### Decomposing expected prediction error

Assume $Y_i = f(X_i) + \epsilon_i$

$EPE(\lambda) = E\left[\{Y - \hat{f}_{\lambda}(X)\}^2\right]$

Suppose $\hat{f}_{\lambda}$ is the estimate from the training data and look at a new data point $X = x^*$
$$E\left[\{Y - \hat{f}_{\lambda}(x^*)\}^2\right] = \sigma^2 + \{E[\hat{f}_{\lambda}(x^*)] - f(x^*)\}^2 + var[\hat{f}_\lambda(x_0)]$$

**&lt;center&gt; = Irreducible error + Bias$^2$ + Variance &lt;/center&gt;**

http://www.biostat.jhsph.edu/~ririzarr/Teaching/649/
http://www.cbcb.umd.edu/~hcorrada/PracticalML/

---

### Another issue for high-dimensional data

```{r ,dependson="prostate"}
small = prostate[1:5,]
lm(lpsa ~ .,data =small)
</code></pre></div></div>

<p>http://www.biostat.jhsph.edu/~ririzarr/Teaching/649/
http://www.cbcb.umd.edu/~hcorrada/PracticalML/</p>

<hr />

<h3 id="hard-thresholding">Hard thresholding</h3>

<ul>
  <li>
    <p>Model $Y = f(X) + \epsilon$</p>
  </li>
  <li>
    <p>Set $\hat{f}_{\lambda}(x) = x‚Äô\beta$</p>
  </li>
  <li>
    <p>Constrain only $\lambda$ coefficients to be nonzero.</p>
  </li>
  <li>
    <p>Selection problem is after chosing $\lambda$ figure out which $p - \lambda$ coefficients to make nonzero</p>
  </li>
</ul>

<p>http://www.biostat.jhsph.edu/~ririzarr/Teaching/649/
http://www.cbcb.umd.edu/~hcorrada/PracticalML/</p>

<hr />

<h3 id="regularization-for-regression">Regularization for regression</h3>

<p>If the $\beta_j$‚Äôs are unconstrained:</p>
<ul>
  <li>They can explode</li>
  <li>And hence are susceptible to very high variance</li>
</ul>

<p>To control variance, we might regularize/shrink the coefficients.</p>

\[PRSS(\beta) = \sum_{j=1}^n (Y_j - \sum_{i=1}^m \beta_{1i} X_{ij})^2 + P(\lambda; \beta)\]

<p>where $PRSS$ is a penalized form of the sum of squares. Things that are commonly looked for</p>

<ul>
  <li>Penalty reduces complexity</li>
  <li>Penalty reduces variance</li>
  <li>Penalty respects structure of the problem</li>
</ul>

<hr />

<h3 id="ridge-regression">Ridge regression</h3>

<p>Solve:</p>

\[\sum_{i=1}^N \left(y_i - \beta_0 + \sum_{j=1}^p x_{ij}\beta_j \right)^2 + \lambda \sum_{j=1}^p \beta_j^2\]

<p>equivalent to solving</p>

<p>$\sum_{i=1}^N \left(y_i - \beta_0 + \sum_{j=1}^p x_{ij}\beta_j \right)^2$ subject to $\sum_{j=1}^p \beta_j^2 \leq s$ where $s$ is inversely proportional to $\lambda$</p>

<p>Inclusion of $\lambda$ makes the problem non-singular even if $X^TX$ is not invertible.</p>

<p>http://www.biostat.jhsph.edu/~ririzarr/Teaching/649/
http://www.cbcb.umd.edu/~hcorrada/PracticalML/</p>

<hr />

<h3 id="ridge-coefficient-paths">Ridge coefficient paths</h3>

<p><img class="center" src="../../assets/img/ridgepath.png" height="450" /></p>

<p>http://www.biostat.jhsph.edu/~ririzarr/Teaching/649/
http://www.cbcb.umd.edu/~hcorrada/PracticalML/</p>

<hr />

<h3 id="tuning-parameter-lambda">Tuning parameter $\lambda$</h3>

<ul>
  <li>$\lambda$ controls the size of the coefficients</li>
  <li>$\lambda$ controls the amount of {\bf regularization}</li>
  <li>As $\lambda \rightarrow 0$ we obtain the least square solution</li>
  <li>As $\lambda \rightarrow \infty$ we have $\hat{\beta}_{\lambda=\infty}^{ridge} = 0$</li>
</ul>

<hr />

<h3 id="lasso">Lasso</h3>

<table>
  <tbody>
    <tr>
      <td>$\sum_{i=1}^N \left(y_i - \beta_0 + \sum_{j=1}^p x_{ij}\beta_j \right)^2$ subject to $\sum_{j=1}^p</td>
      <td>\beta_j</td>
      <td>\leq s$</td>
    </tr>
  </tbody>
</table>

<p>also has a lagrangian form</p>

\[\sum_{i=1}^N \left(y_i - \beta_0 + \sum_{j=1}^p x_{ij}\beta_j \right)^2 + \lambda \sum_{j=1}^p |\beta_j|\]

<p>For orthonormal design matrices (not the norm!) this has a closed form solution</p>

\[\hat{\beta}_j = sign(\hat{\beta}_j^0)(|\hat{\beta}_j^0 - \gamma)^{+}\]

<p>but not in general.</p>

<p>http://www.biostat.jhsph.edu/~ririzarr/Teaching/649/
http://www.cbcb.umd.edu/~hcorrada/PracticalML/</p>

<hr />

<h3 id="notes-and-further-reading-5">Notes and further reading</h3>

<ul>
  <li><a href="http://www.cbcb.umd.edu/~hcorrada/PracticalML/">Hector Corrada Bravo‚Äôs Practical Machine Learning lecture notes</a></li>
  <li><a href="http://www.cbcb.umd.edu/~hcorrada/AMSC689.html#readings">Hector‚Äôs penalized regression reading list</a></li>
  <li><a href="http://statweb.stanford.edu/~tibs/ElemStatLearn/">Elements of Statistical Learning</a></li>
  <li>In <code class="language-plaintext highlighter-rouge">caret</code> methods are:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">ridge</code></li>
      <li><code class="language-plaintext highlighter-rouge">lasso</code></li>
      <li><code class="language-plaintext highlighter-rouge">relaxo</code>
        <h2 id="combining-predictors-c8-w4">Combining Predictors (c8-w4)</h2>
        <h3 id="key-ideas-3">Key ideas</h3>
      </li>
    </ul>
  </li>
  <li>You can combine classifiers by averaging/voting</li>
  <li>Combining classifiers improves accuracy</li>
  <li>Combining classifiers reduces interpretability</li>
  <li>Boosting, bagging, and random forests are variants on this theme</li>
</ul>

<hr />

<h3 id="netflix-prize">Netflix prize</h3>

<p>BellKor = Combination of 107 predictors</p>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/netflix.png height=450&gt;</p>

<p><a href="http://www.netflixprize.com//leaderboard">http://www.netflixprize.com//leaderboard</a></p>

<hr />

<h3 id="heritage-health-prize---progress-prize-1">Heritage health prize - Progress Prize 1</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/makers.png height=200&gt;
<a href="https://kaggle2.blob.core.windows.net/wiki-files/327/e4cd1d25-eca9-49ca-9593-b254a773fe03/Market%20Makers%20-%20Milestone%201%20Description%20V2%201.pdf">Market Makers</a></p>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/mestrom.png height=200&gt;</p>

<p><a href="https://kaggle2.blob.core.windows.net/wiki-files/327/09ccf652-8c1c-4a3d-b979-ce2369c985e4/Willem%20Mestrom%20-%20Milestone%201%20Description%20V2%202.pdf">Mestrom</a></p>

<hr />

<h3 id="basic-intuition---majority-vote">Basic intuition - majority vote</h3>

<p>Suppose we have 5 completely independent classifiers</p>

<p>If accuracy is 70% for each:</p>
<ul>
  <li>$10\times(0.7)^3(0.3)^2 + 5\times(0.7)^4(0.3)^2 + (0.7)^5$</li>
  <li>83.7% majority vote accuracy</li>
</ul>

<p>With 101 independent classifiers</p>
<ul>
  <li>99.9% majority vote accuracy</li>
</ul>

<hr />

<h3 id="approaches-for-combining-classifiers">Approaches for combining classifiers</h3>

<ol>
  <li>Bagging, boosting, random forests
    <ul>
      <li>Usually combine similar classifiers</li>
    </ul>
  </li>
  <li>Combining different classifiers
    <ul>
      <li>Model stacking</li>
      <li>Model ensembling</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="example-with-wage-data">Example with Wage data</h3>

<p><strong>Create training, test and validation sets</strong></p>

<p>```{r wage}
library(ISLR); data(Wage); library(ggplot2); library(caret);
Wage &lt;- subset(Wage,select=-c(logwage))</p>
<h1 id="create-a-building-data-set-and-validation-set">Create a building data set and validation set</h1>
<p>inBuild &lt;- createDataPartition(y=Wage$wage,
                              p=0.7, list=FALSE)
validation &lt;- Wage[-inBuild,]; buildData &lt;- Wage[inBuild,]
inTrain &lt;- createDataPartition(y=buildData$wage,
                              p=0.7, list=FALSE)
training &lt;- buildData[inTrain,]; testing &lt;- buildData[-inTrain,]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Wage data sets

__Create training, test and validation sets__

```{r, dependson="wage"}
dim(training)
dim(testing)
dim(validation)
</code></pre></div></div>

<hr />

<h3 id="build-two-different-models">Build two different models</h3>

<p>```{r modFit,dependson=‚Äùwage‚Äù}
mod1 &lt;- train(wage ~.,method=‚Äùglm‚Äù,data=training)
mod2 &lt;- train(wage ~.,method=‚Äùrf‚Äù,
              data=training, 
              trControl = trainControl(method=‚Äùcv‚Äù),number=3)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Predict on the testing set 

```{r predict,dependson="modFit",fig.height=4,fig.width=6}
pred1 &lt;- predict(mod1,testing); pred2 &lt;- predict(mod2,testing)
qplot(pred1,pred2,colour=wage,data=testing)
</code></pre></div></div>

<hr />

<h3 id="fit-a-model-that-combines-predictors">Fit a model that combines predictors</h3>

<p>```{r combine,dependson=‚Äùpredict‚Äù}
predDF &lt;- data.frame(pred1,pred2,wage=testing$wage)
combModFit &lt;- train(wage ~.,method=‚Äùgam‚Äù,data=predDF)
combPred &lt;- predict(combModFit,predDF)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Testing errors

```{r ,dependson="combine"}
sqrt(sum((pred1-testing$wage)^2))
sqrt(sum((pred2-testing$wage)^2))
sqrt(sum((combPred-testing$wage)^2))
</code></pre></div></div>

<hr />

<h3 id="predict-on-validation-data-set">Predict on validation data set</h3>

<p>```{r validation,dependson=‚Äùcombine‚Äù}
pred1V &lt;- predict(mod1,validation); pred2V &lt;- predict(mod2,validation)
predVDF &lt;- data.frame(pred1=pred1V,pred2=pred2V)
combPredV &lt;- predict(combModFit,predVDF)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Evaluate on validation

```{r ,dependson="validation"}
sqrt(sum((pred1V-validation$wage)^2))
sqrt(sum((pred2V-validation$wage)^2))
sqrt(sum((combPredV-validation$wage)^2))
</code></pre></div></div>

<hr />

<h3 id="notes-and-further-resources-6">Notes and further resources</h3>

<ul>
  <li>Even simple blending can be useful</li>
  <li>Typical model for binary/multiclass data
    <ul>
      <li>Build an odd number of models</li>
      <li>Predict with each model</li>
      <li>Predict the class by majority vote</li>
    </ul>
  </li>
  <li>This can get dramatically more complicated
    <ul>
      <li>Simple blending in caret: <a href="https://github.com/zachmayer/caretEnsemble">caretEnsemble</a> (use at your own risk!)</li>
      <li>Wikipedia <a href="http://en.wikipedia.org/wiki/Ensemble_learning">ensemble learning</a></li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="recall---scalability-matters">Recall - scalability matters</h3>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/netflixno.png height=250&gt;
&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;</p>

<p><a href="http://www.techdirt.com/blog/innovation/articles/20120409/03412518422/">http://www.techdirt.com/blog/innovation/articles/20120409/03412518422/</a></p>

<p><a href="http://techblog.netflix.com/2012/04/netflix-recommendations-beyond-5-stars.html">http://techblog.netflix.com/2012/04/netflix-recommendations-beyond-5-stars.html</a></p>

<h2 id="unsupervised-prediction-c8-w4">Unsupervised Prediction (c8-w4)</h2>
<h3 id="key-ideas-4">Key ideas</h3>

<ul>
  <li>Sometimes you don‚Äôt know the labels for prediction</li>
  <li>To build a predictor
    <ul>
      <li>Create clusters</li>
      <li>Name clusters</li>
      <li>Build predictor for clusters</li>
    </ul>
  </li>
  <li>In a new data set
    <ul>
      <li>Predict clusters</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="iris-example-ignoring-species-labels">Iris example ignoring species labels</h3>

<p>```{r iris}
data(iris); library(ggplot2)
inTrain &lt;- createDataPartition(y=iris$Species,
                              p=0.7, list=FALSE)
training &lt;- iris[inTrain,]
testing &lt;- iris[-inTrain,]
dim(training); dim(testing)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Cluster with k-means

```{r kmeans,dependson="iris",fig.height=4,fig.width=6}
kMeans1 &lt;- kmeans(subset(training,select=-c(Species)),centers=3)
training$clusters &lt;- as.factor(kMeans1$cluster)
qplot(Petal.Width,Petal.Length,colour=clusters,data=training)
</code></pre></div></div>

<hr />

<h3 id="compare-to-real-labels">Compare to real labels</h3>

<p>```{r ,dependson=‚Äùkmeans‚Äù}
table(kMeans1$cluster,training$Species)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>


---

### Build predictor

```{r modelFit,dependson="kmeans"}
modFit &lt;- train(clusters ~.,data=subset(training,select=-c(Species)),method="rpart")
table(predict(modFit,training),training$Species)
</code></pre></div></div>

<hr />

<h3 id="apply-on-test">Apply on test</h3>

<p>```{r ,dependson=‚ÄùmodFit‚Äù}
testClusterPred &lt;- predict(modFit,testing) 
table(testClusterPred ,testing$Species)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Notes and further reading

* The cl_predict function in the clue package provides similar functionality
* Beware over-interpretation of clusters!
* This is one basic approach to [recommendation engines](http://en.wikipedia.org/wiki/Recommender_system)
* [Elements of statistical learning](http://www-stat.stanford.edu/~tibs/ElemStatLearn/)
* [Introduction to statistical learning](http://www-bcf.usc.edu/~gareth/ISL/)
## Forecasting (c8-w4)

### Time series data

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/GOOG.png height=450&gt;

[https://www.google.com/finance](https://www.google.com/finance)

---

### What is different?

* Data are dependent over time
* Specific pattern types
  * Trends - long term increase or decrease
  * Seasonal patterns - patterns related to time of week, month, year, etc.
  * Cycles - patterns that rise and fall periodically
* Subsampling into training/test is more complicated
* Similar issues arise in spatial data 
  * Dependency between nearby observations
  * Location specific effects
* Typically goal is to predict one or more observations into the future. 
* All standard predictions can be used (with caution!)

---

### Beware spurious correlations!


&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/spurious.jpg height=450&gt;

[http://www.google.com/trends/correlate](http://www.google.com/trends/correlate)

[http://www.newscientist.com/blogs/onepercent/2011/05/google-correlate-passes-our-we.html](http://www.newscientist.com/blogs/onepercent/2011/05/google-correlate-passes-our-we.html)

---

### Also common in geographic analyses

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/heatmap.png height=450&gt;

[http://xkcd.com/1138/](http://xkcd.com/1138/)


---

### Beware extrapolation!

&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/extrapolation.jpg height=450&gt;

[http://www.nature.com/nature/journal/v431/n7008/full/431525a.html](http://www.nature.com/nature/journal/v431/n7008/full/431525a.html)

---

### Google data


```{r loadGOOG}
library(quantmod)
from.dat &lt;- as.Date("01/01/08", format="%m/%d/%y")
to.dat &lt;- as.Date("12/31/13", format="%m/%d/%y")
getSymbols("GOOG", src="google", from = from.dat, to = to.dat)
head(GOOG)
</code></pre></div></div>

<hr />

<h3 id="summarize-monthly-and-store-as-time-series">Summarize monthly and store as time series</h3>

<p>```{r tseries,dependson=‚ÄùloadGOOG‚Äù,fig.height=4,fig.width=4}
mGoog &lt;- to.monthly(GOOG)
googOpen &lt;- Op(mGoog)
ts1 &lt;- ts(googOpen,frequency=12)
plot(ts1,xlab=‚ÄùYears+1‚Äù, ylab=‚ÄùGOOG‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Example time series decomposition

* __Trend__  - Consistently increasing pattern over time 
* __Seasonal__ -  When there is a pattern over a fixed period of time that recurs.
* __Cyclic__ -  When data rises and falls over non fixed periods

[https://www.otexts.org/fpp/6/1](https://www.otexts.org/fpp/6/1)


---

### Decompose a time series into parts

```{r ,dependson="tseries",fig.height=4.5,fig.width=4.5}
plot(decompose(ts1),xlab="Years+1")
</code></pre></div></div>

<hr />

<h3 id="training-and-test-sets">Training and test sets</h3>

<p>```{r trainingTest,dependson=‚Äùtseries‚Äù,fig.height=4.5,fig.width=4.5}
ts1Train &lt;- window(ts1,start=1,end=5)
ts1Test &lt;- window(ts1,start=5,end=(7-0.01))
ts1Train</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

### Simple moving average

$$ Y_{t}=\frac{1}{2*k+1}\sum_{j=-k}^k {y_{t+j}}$$

```{r ,dependson="trainingTest",fig.height=4.5,fig.width=4.5}
plot(ts1Train)
lines(ma(ts1Train,order=3),col="red")
</code></pre></div></div>

<hr />

<h3 id="exponential-smoothing">Exponential smoothing</h3>

<p><strong>Example - simple exponential smoothing</strong>
\(\hat{y}_{t+1} = \alpha y_t + (1-\alpha)\hat{y}_{t-1}\)</p>

<p>&lt;img class=center src=../../assets/img/08_PredictionAndMachineLearning/expsmooth.png height=300&gt;</p>

<p><a href="https://www.otexts.org/fpp/7/6">https://www.otexts.org/fpp/7/6</a></p>

<hr />

<h3 id="exponential-smoothing-1">Exponential smoothing</h3>

<p>```{r ets,dependson=‚ÄùtrainingTest‚Äù,fig.height=4.5,fig.width=4.5}
ets1 &lt;- ets(ts1Train,model=‚ÄùMMM‚Äù)
fcast &lt;- forecast(ets1)
plot(fcast); lines(ts1Test,col=‚Äùred‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

---

### Get the accuracy

```{r ,dependson="ets",fig.height=4.5,fig.width=4.5}
accuracy(fcast,ts1Test)
</code></pre></div></div>

<hr />

<h3 id="notes-and-further-resources-7">Notes and further resources</h3>

<ul>
  <li><a href="http://en.wikipedia.org/wiki/Forecasting">Forecasting and timeseries prediction</a> is an entire field</li>
  <li>Rob Hyndman‚Äôs <a href="https://www.otexts.org/fpp/">Forecasting: principles and practice</a> is a good place to start</li>
  <li>Cautions
    <ul>
      <li>Be wary of spurious correlations</li>
      <li>Be careful how far you predict (extrapolation)</li>
      <li>Be wary of dependencies over time</li>
    </ul>
  </li>
  <li>See <a href="http://cran.r-project.org/web/packages/quantmod/quantmod.pdf">quantmod</a> or <a href="http://www.quandl.com/help/packages/r">quandl</a> packages for finance-related problems.</li>
</ul>

<h2 id="quiz-c8-w4">Quiz c8-w4</h2>

<h3 id="question-1-1">Question 1</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">.Random.seed</span><span class="p">,</span><span class="w"> </span><span class="n">envir</span><span class="o">=</span><span class="nf">globalenv</span><span class="p">())</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ElemStatLearn</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">vowel.train</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">vowel.test</span><span class="p">)</span><span class="w">

</span><span class="n">vowel.train</span><span class="o">$</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">vowel.train</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">vowel.test</span><span class="o">$</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">vowel.test</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">33833</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">

</span><span class="n">rfFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">y</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"rf"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">vowel.train</span><span class="p">)</span><span class="w">

</span><span class="n">rfPred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">rfFit</span><span class="p">,</span><span class="n">vowel.test</span><span class="p">)</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">rfPred</span><span class="p">,</span><span class="n">vowel.test</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">

</span><span class="n">gbmFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">y</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s2">"gbm"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">vowel.train</span><span class="p">);</span><span class="w">

</span><span class="n">gbmPred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">gbmFit</span><span class="p">,</span><span class="n">vowel.test</span><span class="p">)</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">gbmFit</span><span class="p">,</span><span class="n">vowel.test</span><span class="p">),</span><span class="n">vowel.test</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">

</span><span class="c1">## combined model</span><span class="w">

</span><span class="n">predDF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">rfPred</span><span class="p">),</span><span class="n">as.factor</span><span class="p">(</span><span class="n">gbmPred</span><span class="p">),</span><span class="n">y</span><span class="o">=</span><span class="n">vowel.test</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">combModFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">y</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"gam"</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">predDF</span><span class="p">)</span><span class="w">

</span><span class="n">combPred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">combModFit</span><span class="p">,</span><span class="n">predDF</span><span class="p">)</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">combPred</span><span class="p">,</span><span class="n">vowel.test</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="w">

</span><span class="c1">## Agreement accuracy</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">gbmPred</span><span class="p">,</span><span class="w"> </span><span class="n">rfPred</span><span class="p">)</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="s1">'Accuracy'</span><span class="p">]</span><span class="w">

</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rfPred</span><span class="o">==</span><span class="n">gbmPrewd</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="nb">T</span><span class="p">)</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="question-2-1">Question 2</h3>

<p>Completely wrong answer but the way I have written the code is exactly
the same as rpubs versions here and also in the code below!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gbm</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">3433</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">AlzheimerDisease</span><span class="p">)</span><span class="w">
</span><span class="n">adData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">,</span><span class="n">predictors</span><span class="p">)</span><span class="w">
</span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">adData</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">

</span><span class="c1">##caleculation</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">62433</span><span class="p">)</span><span class="w">

</span><span class="n">rfFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"rf"</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">)</span><span class="w">
</span><span class="n">gbmFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"gbm"</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">)</span><span class="w">
</span><span class="n">ldaFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"lda"</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">)</span><span class="w">


</span><span class="n">rfPred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">rfFit</span><span class="p">,</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">rfPred</span><span class="p">,</span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="w">


</span><span class="n">gbmPred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">gbmFit</span><span class="p">,</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">gbmPred</span><span class="p">,</span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="s2">"Accuracy"</span><span class="p">]</span><span class="w">


</span><span class="n">ldaPred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">ldaFit</span><span class="p">,</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">ldaPred</span><span class="p">,</span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="s2">"Accuracy"</span><span class="p">]</span><span class="w">

</span><span class="n">predDF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="n">data.frame</span><span class="p">(</span><span class="n">rfPred</span><span class="p">,</span><span class="n">gbmPred</span><span class="p">,</span><span class="n">ldaPred</span><span class="p">,</span><span class="n">diagnosis</span><span class="o">=</span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="w">
</span><span class="n">combModFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"rf"</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">predDF</span><span class="p">)</span><span class="w">

</span><span class="n">combPred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">combModFit</span><span class="p">,</span><span class="n">predDF</span><span class="p">)</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">combPred</span><span class="p">,</span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="s2">"Accuracy"</span><span class="p">]</span><span class="w">

</span><span class="c1">### Comparing to others in rpubs!</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gbm</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">3433</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">AlzheimerDisease</span><span class="p">)</span><span class="w">
</span><span class="n">adData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">,</span><span class="n">predictors</span><span class="p">)</span><span class="w">
</span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">adData</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adData</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">62433</span><span class="p">)</span><span class="w">
</span><span class="n">modelFit_rf</span><span class="o">&lt;-</span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s2">"rf"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">)</span><span class="w">
</span><span class="n">modelFit_gbm</span><span class="o">&lt;-</span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s2">"gbm"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">modelFit_lda</span><span class="o">&lt;-</span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s2">"lda"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">)</span><span class="w">

</span><span class="n">predict_rf</span><span class="o">&lt;-</span><span class="n">predict</span><span class="p">(</span><span class="n">modelFit_rf</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span><span class="n">predict_gbm</span><span class="o">&lt;-</span><span class="n">predict</span><span class="p">(</span><span class="n">modelFit_gbm</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span><span class="n">predict_lda</span><span class="o">&lt;-</span><span class="n">predict</span><span class="p">(</span><span class="n">modelFit_lda</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">predict_rf</span><span class="p">,</span><span class="w"> </span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="s1">'Accuracy'</span><span class="p">]</span><span class="w">

</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">predict_gbm</span><span class="p">,</span><span class="w"> </span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="s1">'Accuracy'</span><span class="p">]</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">predict_lda</span><span class="p">,</span><span class="w"> </span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="s1">'Accuracy'</span><span class="p">]</span><span class="w">


</span><span class="c1">#create a new dataframe with the predictions</span><span class="w">
</span><span class="n">predDF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">predict_rf</span><span class="p">,</span><span class="w"> </span><span class="n">predict_gbm</span><span class="p">,</span><span class="w"> </span><span class="n">predict_lda</span><span class="p">,</span><span class="w"> </span><span class="n">diagnosis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="w">
</span><span class="c1">#create a new model using the new data frame and rf method</span><span class="w">
</span><span class="n">combModFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">diagnosis</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"rf"</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">predDF</span><span class="p">)</span><span class="w">

</span><span class="c1">#predict values and calculate the confusion matrix to check the accuracy</span><span class="w">
</span><span class="n">combPred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">combModFit</span><span class="p">,</span><span class="w"> </span><span class="n">predDF</span><span class="p">)</span><span class="w">
</span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">combPred</span><span class="p">,</span><span class="w"> </span><span class="n">testing</span><span class="o">$</span><span class="n">diagnosis</span><span class="p">)</span><span class="o">$</span><span class="n">overall</span><span class="p">[</span><span class="s1">'Accuracy'</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h3 id="question-3-1">Question 3</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">3523</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="p">(</span><span class="n">concrete</span><span class="p">)</span><span class="w">

</span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">concrete</span><span class="o">$</span><span class="n">CompressiveStrength</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">

</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">concrete</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">

</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">concrete</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">

</span><span class="c1">## Caleculation</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glmnetUtils</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">233</span><span class="p">)</span><span class="w">

</span><span class="n">cv.lasso</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">CompressiveStrength</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">cv.lasso</span><span class="o">$</span><span class="n">glmnet.fit</span><span class="p">,</span><span class="w"> </span><span class="s2">"lambda"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1">## Above seems to give the right answer as well!</span><span class="w">

</span><span class="c1">## modFit &lt;- glmnet(CompressiveStrength~.,data=training, alpha = 1,</span><span class="w">
</span><span class="c1">##                 lambda = cv.lasso$lambda.min) ## Not needed</span><span class="w">
</span><span class="c1">##                 apparently for the question!</span><span class="w">


</span><span class="c1">## Answer from Rpubs!</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">233</span><span class="p">)</span><span class="w">
</span><span class="n">trcontrol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="w">
</span><span class="n">modLasso</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">CompressiveStrength</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s2">"lasso"</span><span class="p">)</span><span class="w">
</span><span class="n">plot.enet</span><span class="p">(</span><span class="n">modLasso</span><span class="o">$</span><span class="n">finalModel</span><span class="p">,</span><span class="w">  </span><span class="n">xvar</span><span class="o">=</span><span class="s2">"penalty"</span><span class="p">,</span><span class="w"> </span><span class="n">use.color</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">


</span><span class="c1">## The below from</span><span class="w">
</span><span class="c1">## https://stackoverflow.com/questions/43852738/how-to-apply-lasso-logistic-regression-with-caret-and-glmnet</span><span class="w">
</span><span class="c1">## also gives similar result!</span><span class="w">

</span><span class="n">trainControl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">trainControl</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cv"</span><span class="p">,</span><span class="w">
                             </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">

</span><span class="n">modelFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">CompressiveStrength</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">training</span><span class="p">,</span><span class="w"> 
            </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lasso"</span><span class="p">,</span><span class="w"> 
            </span><span class="n">trControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainControl</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="question-4-1">Question 4</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w"> </span><span class="c1"># For year() function below</span><span class="w">
</span><span class="n">dat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"~/Desktop/gaData.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">[</span><span class="n">year</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">2012</span><span class="p">,]</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">[(</span><span class="n">year</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">date</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2011</span><span class="p">,]</span><span class="w">
</span><span class="n">tstrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ts</span><span class="p">(</span><span class="n">training</span><span class="o">$</span><span class="n">visitsTumblr</span><span class="p">)</span><span class="w">

</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bats</span><span class="p">(</span><span class="n">tstrain</span><span class="p">)</span><span class="w">
</span><span class="n">prediction</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="m">95</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="n">nrow</span><span class="p">(</span><span class="n">testing</span><span class="p">))</span><span class="w">

</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">testing</span><span class="o">$</span><span class="n">visitsTumblr</span><span class="o">&gt;</span><span class="n">prediction</span><span class="o">$</span><span class="n">lower</span><span class="w">
           </span><span class="o">&amp;</span><span class="n">testing</span><span class="o">$</span><span class="n">visitsTumblr</span><span class="o">&lt;</span><span class="n">prediction</span><span class="o">$</span><span class="n">upper</span><span class="p">)</span><span class="w">
</span><span class="n">pos</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">testing</span><span class="p">)</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">3523</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h3 id="question-5-1">Question 5</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">AppliedPredictiveModeling</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">concrete</span><span class="p">)</span><span class="w">
</span><span class="n">inTrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">concrete</span><span class="o">$</span><span class="n">CompressiveStrength</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">/</span><span class="m">4</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">concrete</span><span class="p">[</span><span class="w"> </span><span class="n">inTrain</span><span class="p">,]</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">concrete</span><span class="p">[</span><span class="o">-</span><span class="n">inTrain</span><span class="p">,]</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">325</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">e1071</span><span class="p">)</span><span class="w">

</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svm</span><span class="p">(</span><span class="n">CompressiveStrength</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">training</span><span class="p">)</span><span class="w">
</span><span class="n">prediction</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span><span class="n">accuracy</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="n">testing</span><span class="o">$</span><span class="n">CompressiveStrength</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<h2 id="statquest-bias-and-variance">Statquest Bias and Variance!</h2>

<p>Based on <a href="https://www.youtube.com/watch?v=EuBBz3bI-aA">this statquest</a>.</p>

<p>Think of straight line and a squiggly line fitting the test data.</p>

<p><strong>Bias</strong></p>

<p>So the squiggly line fits every single point and thus has ‚Äúvery little
bias‚Äù</p>

<p>The straight line aka least squares line has bias as it can never take
the shape of the points as done by the squiggly line!</p>

<p><strong>Variance</strong></p>

<p>If you use another dataset, you will have huge errors aka VARIANCE
WITH EVERY DATASET with the squiggly line fit. The squiggly line is
<strong>OverFit</strong>.</p>

<p>Where as the straight line will have not ‚Äúthat much‚Äù variance as
compared to squiggs!</p>

<p><strong>What do we want in ML</strong></p>

<p><em>Low Bias, and accurately modelling the true relationship with low
variance between different data sets!</em></p>

<p>find sweet spot between simple and complext model aka straight line
and squiggly line! aka, using regularization boosting and bagging!</p>

<h2 id="ridge-regression-from-stat-quest">Ridge regression from Stat quest</h2>

<p>Based on <a href="https://www.youtube.com/watch?v=Q81RR3yKn30">this statquest on ridge regression</a>.</p>

<p>So we start with say 2 points and fit a linear line. We can fit it
exactly. AKA, low BIAS. But resulting test on the test data will haev
high ass variance!</p>

<p>So we are fitting: sum of square residuals</p>

<p>Instead let‚Äôs fit: <strong>sum of square residuals + $\lambda$ x slope</strong></p>

<p>This way we look for a lambda by cross validation (10-fold) such that
the above value is the smallest.</p>

<p><strong>This introduces some bias in the training set for a reduced Variance
across test sets!</strong></p>

<p>So basically as lambda goes from 0 to 1, the slope will have to reduce
i.e., the y axis becomes less sensitive to changes in the x axis!</p>

<p>Same applies to logistic regression i.e., fit: <strong>max likelihood
+lambda x slope</strong></p>

<p><strong>Note</strong>: the y-intercept is not included!</p>

<h3 id="lasso-1">Lasso</h3>

<p>Ridge Regression: <strong>sum of square residuals + $\lambda$ x slope^2</strong></p>

<p>Lasso Regression: <strong>sum of square residuals + $\lambda$ x abs(slope)</strong></p>

<p>In Lasso the slopes can go all the way to 0. Let‚Äôs say the size of
mice is dependent on</p>

<ul>
  <li>astrology sign</li>
  <li>weight</li>
  <li>diet</li>
  <li>airspeed of a swallow.</li>
</ul>

<p>With Lasso the airspeed and astrology variables will go to absolute 0,
where as with ridge they will tend to 0, i.e., the variables will
still be in the equation. This way we get rid of parameters that are
useless in the training!</p>

<p>Roughly, when most variables are useful use ridge which will still
keep all variables and Lasso when most variables are not that useful!</p>

<h3 id="dealing-with-1000-variables-with-lesser-data-points">Dealing with 1000 variables with lesser data points!</h3>

<h3 id="elastic-net-regression">Elastic net regression</h3>

<p>We have elastic-net regression</p>

<p><strong>sum of square residuals + $\lambda1$ x abs(slope)</strong> +  $\lambda2$ x slope^2**</p>

<p>CLAIM: This is good to deal with correlated terms as Lasso tends to pick just
one of the correlated terms and eliminates the others and Whereas
Ridge shrinks all parameters of the correlated variables together!</p>

<h3 id="links">links</h3>

<p>R code on ridge lasso and other :
https://www4.stat.ncsu.edu/~post/josh/LASSO_Ridge_Elastic_Net_-_Examples.html</p>
<h2 id="final-assignment-c8-w4">Final Assignment: C8-w4</h2>

<p>```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, message=F, warning=F, cache=T)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Model explanation

With this assignment the goal is to predict classification of barbell
lifts into A,B,C,D,E. We start with exploring the data. We realize
that there are many NA's so we start cleaning the data by removing
high NA columns. We perform both Hold-out test as well as cross
validation based on this [stack answer](https://stats.stackexchange.com/questions/104713/hold-out-validation-vs-cross-validation) as we have 19 thousand Data
points! CV is used typically if the dataset is small. Both are used to
understand the Model Accuracy.

The initial plan is to start with decision trees and go from there on
if the accuracy is not good enough. As explained below we need a model
accuracy of 99% as I would like atleast a 90% accuracy on the
QUIZ/TEST!


#### Expected out of sample error calculation!

Based on [this](https://github.com/lgreski/datasciencectacontent/blob/master/markdown/pml-requiredModelAccuracy.md), we are able to calculate the following:

The following table illustrates the probability of predicting all 20
test cases right, given a particular model accuracy.


&lt;table&gt;
&lt;tr&gt;&lt;th&gt;&lt;br&gt;&lt;br&gt;Model&lt;br&gt;Accuracy&lt;/th&gt;&lt;th&gt;Probability&lt;br&gt;of Predicting &lt;br&gt;20 out of 20&lt;br&gt;Correctly&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td align=right&gt;0.800&lt;/td&gt;&lt;td align=right&gt;0.0115&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td align=right&gt;0.850&lt;/td&gt;&lt;td align=right&gt;0.0388&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td align=right&gt;0.900&lt;/td&gt;&lt;td align=right&gt;0.1216&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td align=right&gt;0.950&lt;/td&gt;&lt;td align=right&gt;0.3585&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td align=right&gt;0.990&lt;/td&gt;&lt;td align=right&gt;0.8179&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td align=right&gt;0.995&lt;/td&gt;&lt;td align=right&gt;0.9046&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;

We thus aim for a model accuracy of 99.5% atleast so that the expected
out of sample accuracy will be in the order of 90%.

---
### Start of R programming!

```{r }
library(caret,corrplot)
</code></pre></div></div>

<p>The training data for this project are available here:</p>

<p>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv</p>

<p>The test data are available here:</p>

<p>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv</p>

<p>```{r }
f.training &lt;- read.csv(‚Äú./pml-training.csv‚Äù)
f.testing &lt;- read.csv(‚Äú./pml-testing.csv‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Explore Data

```{r }
dim(f.training)
sum(is.na(f.training))
</code></pre></div></div>
<p>Other explorations were done with <code class="language-plaintext highlighter-rouge">head</code>, <code class="language-plaintext highlighter-rouge">names</code> etc‚Ä¶ but is not
showed here due to the large output. With the <code class="language-plaintext highlighter-rouge">sum</code> function we see
that there are a lot of NA‚Äôs, so we get into cleaning the data.</p>

<h3 id="cleaning-data-1">Cleaning DATA</h3>

<p>```{r }</p>

<h2 id="cleaning-removing-high-na-cols">Cleaning Removing high NA cols</h2>

<p>ncol(f.training)
nas &lt;- lapply(f.training,function(X) sum(is.na(X)))&gt; 0.90*nrow(f.training)
f.training &lt;- f.training[,!nas]
f.testing &lt;- f.testing[,!nas]
ncol(f.training)</p>

<h2 id="cleaning-removing-zero-var-cols">Cleaning Removing Zero Var Cols</h2>

<p>NZV &lt;- nearZeroVar(f.training)
f.training &lt;- f.training[,-NZV]
f.testing &lt;- f.testing[,-NZV]
ncol(f.training)</p>

<h2 id="cleaning-removing-meaningless-variables-such-as-name">cleaning removing meaningless variables such as name</h2>

<p>MLV &lt;- 1:5
f.training &lt;- f.training[,-MLV]
f.testing &lt;- f.testing[,-MLV]
ncol(f.training)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Partition the data

```{r partition }
inTrain &lt;- createDataPartition(y=f.training$classe,p=0.7,list=F)
training &lt;- f.training[inTrain,]
testing &lt;- f.training[-inTrain,]
</code></pre></div></div>

<h3 id="model-fit-decision-tree">Model fit Decision tree!</h3>

<p>We start with the Decision Tree as here we are primary interested in a
classification type of problem. Based on <a href="https://stats.stackexchange.com/questions/61783/bias-and-variance-in-leave-one-out-vs-k-fold-cross-validation">this</a> we choose a CV
K-fold of 10.</p>

<p>```{r LGOCV}
trControl &lt;- trainControl(method=‚Äùcv‚Äù,number=10)
modFitDT &lt;- train(classe~.,method=‚Äùrpart‚Äù,data=training,trControl=trControl)</p>

<p>predictionDT &lt;- predict(modFitDT,testing)
confusionMatrix(predictionDT,testing$classe)$overall[‚ÄòAccuracy‚Äô]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The accuracy of the decision tree seems to be really bad. Increasing
the CV number doesn't seem to help! The decision tree is shown below:

```{r DTplot}
library(rattle)
fancyRpartPlot(modFitDT$finalModel)
plot(confusionMatrix(predictionDT,testing$classe)$table)
</code></pre></div></div>

<h3 id="model-fit-random-forests">Model Fit Random Forests</h3>

<p>Next we try Random Forests. This following code uses 3 cores, and
allows running in parallel for a time of 5 mins instead of 20 mins, on
an 8gb ram system. The code is based off of : <a href="https://github.com/lgreski/datasciencectacontent/blob/master/markdown/pml-randomForestPerformance.md">Github link of Len</a>.</p>

<p>```{r RF}
library(parallel)
library(doParallel)
cluster &lt;- makeCluster(detectCores() - 1) # convention to leave 1 core for OS
registerDoParallel(cluster)</p>

<p>trControl &lt;- trainControl(method = ‚Äúcv‚Äù,
                           number = 5,
                          allowParallel = TRUE)</p>

<p>modFitRF &lt;- train(classe~.,data=training,method=‚Äùrf‚Äù, trControl=trControl)</p>

<p>stopCluster(cluster)
registerDoSEQ()</p>

<p>predictionRF &lt;- predict(modFitRF,testing)
confusionMatrix(predictionRF,testing$classe)$overall[‚ÄòAccuracy‚Äô]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```{r }
plot(confusionMatrix(predictionRF,testing$classe)$table)
</code></pre></div></div>

<h3 id="final-prediction">Final Prediction</h3>
<p>```{r }
prediction.finale &lt;- predict(modFitRF,f.testing)
prediction.finale</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This led to a 100% prediction on the Quiz! :)

### Appendix: Question copied from Coursera!

Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now
possible to collect a large amount of data about personal activity
relatively inexpensively. These type of devices are part of the
quantified self movement ‚Äì a group of enthusiasts who take
measurements about themselves regularly to improve their health, to
find patterns in their behavior, or because they are tech geeks. One
thing that people regularly do is quantify how much of a particular
activity they do, but they rarely quantify how well they do it. In
this project, your goal will be to use data from accelerometers on the
belt, forearm, arm, and dumbell of 6 participants. They were asked to
perform barbell lifts correctly and incorrectly in 5 different
ways. More information is available from the website here:
http://web.archive.org/w
eb/20161224072740/http:/groupware.les.inf.puc-rio.br/har
(see the section on the Weight Lifting Exercise Dataset).

The training data for this project are available here:

https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv

The test data are available here:

https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv

The data for this project come from this source:
http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har. If
you use the document you create for this class for any purpose please
cite them as they have been very generous in allowing their data to be
used for this kind of assignment.


The training data for this project are available here:

https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv

The test data are available here:

https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv

&gt; The data for this project come from this source:
&gt; http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har. If
&gt; you use the document you create for this class for any purpose
&gt; please cite them as they have been very generous in allowing their
&gt; data to be used for this kind of assignment. - from [website](http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har#weight_lifting_exercises)

&gt; Six young health participants were asked to perform one set of 10
&gt; repetitions of the Unilateral Dumbbell Biceps Curl in five different
&gt; fashions: exactly according to the specification (Class A), throwing
&gt; the elbows to the front (Class B), lifting the dumbbell only halfway
&gt; (Class C), lowering the dumbbell only halfway (Class D) and throwing
&gt; the hips to the front (Class E). - from [website](http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har#weight_lifting_exercises)


## C9 Developing DATA products!
https://github.com/DataScienceSpecialization/Developing_Data_Products
### Warning about shiny

&gt; Shinyapps.io Project - Read on GitHub Some people in this session
&gt; let us know that they are concerned about running up against the
&gt; 25-hour per month limit on the free tier of shinyapps.io.
&gt;
&gt; Should you hit the limit on the free plan, RStudio will send you a
&gt; message. If you receive the message and are more than a few days
&gt; from getting a fresh 25 hours on your monthly renewal, please send
&gt; an email to shinyapps-support@rstudio.com with the email address you
&gt; use on the service and the account name you are using (the first
&gt; part of the URL). RStudio will then increase your limit so you can
&gt; continue working on your project.
&gt;
&gt; Since there are a lot of folks in the class we‚Äôd appreciate if you
&gt; only emailed RStudio after you get the message and only if you feel
&gt; you‚Äôll need more time.


## Shiny Part 1 (c9-w1)
### What is Shiny?

- Shiny is a web application framework for R.
- Shiny allows you to create a graphical interface so that
users can interact with your visualizations, models, and 
algorithms without needed to know R themselves.
- Using Shiny, the time to create simple, yet powerful, 
web-based interactive data products in R is minimized.
- Shiny is made by the fine folks at R Studio.

### Some Mild Prerequisites 

Shiny doesn't really require it, but as with all web 
programming, a little knowledge of HTML, CSS and Javascript
is very helpful.

- HTML gives a web page structure and sectioning as well as markup instructions
- CSS gives the style
- Javscript for interactivity
  
Shiny uses [Bootstrap](http://getbootstrap.com/) (no relation to the statistics bootstrap)
style, which (to me) seems to look nice and renders well on mobile
platforms.

### Available Tutorials

If you're interested in learning more about HTML, CSS, and
Javascript we recommend any one of the following resources:

- [Mozilla Developer Network Tutorials](https://developer.mozilla.org/en-US/docs/Web/Tutorials)
- [HTML &amp; CSS from Khan Academy](https://www.khanacademy.org/computing/computer-programming/html-css)
- [Tutorials from Free Code Camp](https://www.freecodecamp.com/)

### Getting Started

- Make sure you have the latest release of R installed
- If on Windows, make sure that you have Rtools installed
- `install.packages("shiny")`
- `library(shiny)`
- Great tutorial at http://shiny.rstudio.com/tutorial/
- Basically, this lecture is walking through that tutorial 
offering some of our insights

### A Shiny project

A shiny project is a directory containing at least two files:

- `ui.R` (for user interface) controls how your app looks.
- `server.R` that controls what your app does.

### ui.R

```r
library(shiny)
shinyUI(fluidPage(
  titlePanel("Data science FTW!"),
  sidebarLayout(
    sidebarPanel(
      h3("Sidebar Text")
    ),
    mainPanel(
      h3("Main Panel Text")
    )
  )
))
</code></pre></div></div>

<h3 id="serverr">server.R</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h3 id="to-run-it">To run it</h3>
<ul>
  <li>In R, change to the directories with these files and type <code class="language-plaintext highlighter-rouge">runApp()</code></li>
  <li>or put the path to the directory as an argument</li>
  <li>It should open a browser window with the app running</li>
</ul>

<h3 id="your-first-shiny-app">Your First Shiny App</h3>

<p><img src="app1.png" alt="" /></p>

<h3 id="html-tags-in-shiny">HTML Tags in Shiny</h3>

<p>Shiny provides several wrapper functions for using
standard HTML tags in your <code class="language-plaintext highlighter-rouge">ui.R</code>, including <code class="language-plaintext highlighter-rouge">h1()</code> through
<code class="language-plaintext highlighter-rouge">h6()</code>, <code class="language-plaintext highlighter-rouge">p()</code>, <code class="language-plaintext highlighter-rouge">a()</code>, <code class="language-plaintext highlighter-rouge">div()</code>, and <code class="language-plaintext highlighter-rouge">span()</code>.</p>

<ul>
  <li>See <code class="language-plaintext highlighter-rouge">?builder</code> for more details.</li>
</ul>

<h3 id="r-wrappers-for-html-tags">R Wrappers for HTML Tags</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyUI</span><span class="p">(</span><span class="n">fluidPage</span><span class="p">(</span><span class="w">
  </span><span class="n">titlePanel</span><span class="p">(</span><span class="s2">"HTML Tags"</span><span class="p">),</span><span class="w">
  </span><span class="n">sidebarLayout</span><span class="p">(</span><span class="w">
    </span><span class="n">sidebarPanel</span><span class="p">(</span><span class="w">
      </span><span class="n">h1</span><span class="p">(</span><span class="s2">"H1 Text"</span><span class="p">),</span><span class="w">
      </span><span class="n">h3</span><span class="p">(</span><span class="s2">"H3 Text"</span><span class="p">),</span><span class="w">
      </span><span class="n">em</span><span class="p">(</span><span class="s2">"Emphasized Text"</span><span class="p">)</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">mainPanel</span><span class="p">(</span><span class="w">
      </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Main Panel Text"</span><span class="p">),</span><span class="w">
      </span><span class="n">code</span><span class="p">(</span><span class="s2">"Some Code!"</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h3 id="app-with-many-tags">App with Many Tags</h3>

<p><img src="app2.png" alt="" /></p>

<h3 id="app-with-inputs-and-outputs">App with Inputs and Outputs</h3>

<p>Now that you‚Äôve played around with customizing the look of
your app, let‚Äôs give it some functionality! Shiny provides
several types of inputs including buttons, checkboxes, text
boxes, and calendars. First let‚Äôs experiment with the slider
input. This simple app will display the number that is
selected with a slider.</p>

<h3 id="slider-app-uir">Slider App: ui.R</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyUI</span><span class="p">(</span><span class="n">fluidPage</span><span class="p">(</span><span class="w">
  </span><span class="n">titlePanel</span><span class="p">(</span><span class="s2">"Slider App"</span><span class="p">),</span><span class="w">
  </span><span class="n">sidebarLayout</span><span class="p">(</span><span class="w">
    </span><span class="n">sidebarPanel</span><span class="p">(</span><span class="w">
      </span><span class="n">h1</span><span class="p">(</span><span class="s2">"Move the Slider!"</span><span class="p">),</span><span class="w">
      </span><span class="n">sliderInput</span><span class="p">(</span><span class="s2">"slider1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Slide Me!"</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">mainPanel</span><span class="p">(</span><span class="w">
      </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Slider Value:"</span><span class="p">),</span><span class="w">
      </span><span class="n">textOutput</span><span class="p">(</span><span class="s2">"text"</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h3 id="slider-app-serverr">Slider App: server.R</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">output</span><span class="o">$</span><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">slider1</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h3 id="slider-app">Slider App</h3>

<p><img src="app3.png" alt="" /></p>

<h3 id="new-components-in-the-slider-app">New Components in the Slider App</h3>

<h4 id="uir">ui.R</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sliderInput()</code> specifies a slider that a user can manipulate</li>
  <li><code class="language-plaintext highlighter-rouge">testOutput()</code> displays text that is rendered in <code class="language-plaintext highlighter-rouge">server.R</code></li>
</ul>

<h4 id="serverr-1">server.R</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">renderText()</code> transforms UI input into text that can be displayed.</li>
</ul>

<h3 id="inputs-and-outputs">Inputs and Outputs</h3>

<p>Notice that in <code class="language-plaintext highlighter-rouge">ui.R</code> input and output names are assigned
with strings (<code class="language-plaintext highlighter-rouge">sliderInput("slider1",...</code>, <code class="language-plaintext highlighter-rouge">textOutput("text")</code>)
and in <code class="language-plaintext highlighter-rouge">server.R</code> those components can be accessed with the
<code class="language-plaintext highlighter-rouge">$</code> operator: <code class="language-plaintext highlighter-rouge">output$text &lt;- renderText(input$slider1)</code>.</p>

<h3 id="apps-with-plots">Apps with Plots</h3>

<p>Allowing users to manipulate data and to see the results of
their manipulations as a plot can be very useful. Shiny
provides the <code class="language-plaintext highlighter-rouge">plotOutput()</code> function for <code class="language-plaintext highlighter-rouge">ui.R</code> and the 
<code class="language-plaintext highlighter-rouge">renderPlot()</code> function for <code class="language-plaintext highlighter-rouge">sever.R</code> for taking user input 
and creating plots.</p>

<h3 id="plot-app-uir-part-1">Plot App: ui.R Part 1</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyUI</span><span class="p">(</span><span class="n">fluidPage</span><span class="p">(</span><span class="w">
  </span><span class="n">titlePanel</span><span class="p">(</span><span class="s2">"Plot Random Numbers"</span><span class="p">),</span><span class="w">
  </span><span class="n">sidebarLayout</span><span class="p">(</span><span class="w">
    </span><span class="n">sidebarPanel</span><span class="p">(</span><span class="w">
      </span><span class="n">numericInput</span><span class="p">(</span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="s2">"How Many Random Numbers Should be Plotted?"</span><span class="p">,</span><span class="w"> 
                   </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
      </span><span class="n">sliderInput</span><span class="p">(</span><span class="s2">"sliderX"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Pick Minimum and Maximum X Values"</span><span class="p">,</span><span class="w">
                  </span><span class="m">-100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-50</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">)),</span><span class="w">

      </span><span class="n">sliderInput</span><span class="p">(</span><span class="s2">"sliderY"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Pick Minimum and Maximum Y Values"</span><span class="p">,</span><span class="w">
                  </span><span class="m">-100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-50</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">)),</span><span class="w">
      </span><span class="n">checkboxInput</span><span class="p">(</span><span class="s2">"show_xlab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Show/Hide X Axis Label"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
      </span><span class="n">checkboxInput</span><span class="p">(</span><span class="s2">"show_ylab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Show/Hide Y Axis Label"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
      </span><span class="n">checkboxInput</span><span class="p">(</span><span class="s2">"show_title"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Show/Hide Title"</span><span class="p">)</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">mainPanel</span><span class="p">(</span><span class="w">
      </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Graph of Random Points"</span><span class="p">),</span><span class="w">
      </span><span class="n">plotOutput</span><span class="p">(</span><span class="s2">"plot1"</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h3 id="plot-app-serverr-part-1">Plot App: server.R Part 1</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">output</span><span class="o">$</span><span class="n">plot1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderPlot</span><span class="p">({</span><span class="w">
    </span><span class="n">set.seed</span><span class="p">(</span><span class="m">2016-05-25</span><span class="p">)</span><span class="w">
    </span><span class="n">number_of_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">numeric</span><span class="w">
    </span><span class="n">minX</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">sliderX</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
    </span><span class="n">maxX</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">sliderX</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
    </span><span class="n">minY</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">sliderY</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
    </span><span class="n">maxY</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">sliderY</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">

    </span><span class="n">dataX</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">,</span><span class="w"> </span><span class="n">minX</span><span class="p">,</span><span class="w"> </span><span class="n">maxX</span><span class="p">)</span><span class="w">
    </span><span class="n">dataY</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">,</span><span class="w"> </span><span class="n">minY</span><span class="p">,</span><span class="w"> </span><span class="n">maxY</span><span class="p">)</span><span class="w">
    </span><span class="n">xlab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">show_xlab</span><span class="p">,</span><span class="w"> </span><span class="s2">"X Axis"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
    </span><span class="n">ylab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">show_ylab</span><span class="p">,</span><span class="w"> </span><span class="s2">"Y Axis"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
    </span><span class="n">main</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">show_title</span><span class="p">,</span><span class="w"> </span><span class="s2">"Title"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
    </span><span class="n">plot</span><span class="p">(</span><span class="n">dataX</span><span class="p">,</span><span class="w"> </span><span class="n">dataY</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xlab</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ylab</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">main</span><span class="p">,</span><span class="w">
         </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h3 id="apps-with-plots-1">Apps with Plots</h3>

<h4 id="uir-1">ui.R</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">numericInput()</code> allows the user to enter any number</li>
  <li><code class="language-plaintext highlighter-rouge">checkboxInput()</code> creates boxes that can be checked</li>
  <li><code class="language-plaintext highlighter-rouge">plotOutput()</code> displays a plot</li>
</ul>

<h4 id="serverr-2">server.R</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">renderPlot()</code> wraps the creation of a plot so it can be displayed</li>
</ul>

<h3 id="next-lecture">Next Lecture</h3>

<ul>
  <li>Reactivity</li>
  <li>Advanced UI</li>
  <li>Interactive Graphics</li>
</ul>

<h3 id="more-about-r-and-the-web">More about R and the Web</h3>
<ul>
  <li><a href="https://public.opencpu.org/">OpenCPU</a> by Jerome Ooms, is a really neat project providing an API for calling R from web documents</li>
</ul>

<h2 id="shiny-revisited-shinier">Shiny revisited (shinier!)</h2>
<ul>
  <li>In the last lecture, we covered basic creation of 
Shiny applications</li>
  <li>If you tried it and are like most, you had an easy time with <code class="language-plaintext highlighter-rouge">ui.R</code>
but a harder time with <code class="language-plaintext highlighter-rouge">server.R</code></li>
  <li>In this lecture, we cover some more of the details of shiny</li>
  <li>Since writing the last lecture, a more detailed tutorial has
been created that is worth checking out
(http://shiny.rstudio.com/tutorial/)</li>
</ul>

<hr />

<h3 id="details">Details</h3>
<ul>
  <li>Code that you put before <code class="language-plaintext highlighter-rouge">shinyServer</code> in the <code class="language-plaintext highlighter-rouge">server.R</code> function gets
called once when you do <code class="language-plaintext highlighter-rouge">runApp()</code></li>
  <li>Code inside the unnamed function of <code class="language-plaintext highlighter-rouge">shinyServer(function(input, output){</code> but
not in a reactive statement will run once for every new user (or page refresh)</li>
  <li>Code in reactive functions of <code class="language-plaintext highlighter-rouge">shinyServer</code> get run repeatedly as needed
when new values are entered (reactive functions are those like <code class="language-plaintext highlighter-rouge">render*</code>)</li>
</ul>

<hr />
<h4 id="experiment-code-in-the-slidify-document">Experiment (code in the slidify document)</h4>
<p><code class="language-plaintext highlighter-rouge">ui.R</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shinyUI(pageWithSidebar(
  headerPanel("Hello Shiny!"),
  sidebarPanel(
      textInput(inputId="text1", label = "Input Text1"),
      textInput(inputId="text2", label = "Input Text2")
  ),
  mainPanel(
      p('Output text1'),
      textOutput('text1'),
      p('Output text2'),
      textOutput('text2'),
      p('Output text3'),
      textOutput('text3'),
      p('Outside text'),
      textOutput('text4'),
      p('Inside text, but non-reactive'),
      textOutput('text5')
  )
))

</code></pre></div></div>

<hr />
<p><code class="language-plaintext highlighter-rouge">server.R</code>
Set <code class="language-plaintext highlighter-rouge">x &lt;- 0</code> before running</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(shiny)
x &lt;&lt;- x + 1
y &lt;&lt;- 0

shinyServer(
  function(input, output) {
    y &lt;&lt;- y + 1
    output$text1 &lt;- renderText({input$text1})
    output$text2 &lt;- renderText({input$text2})
    output$text3 &lt;- renderText({as.numeric(input$text1)+1})
    output$text4 &lt;- renderText(y)
    output$text5 &lt;- renderText(x)
  }
)
</code></pre></div></div>

<hr />
<h3 id="try-it">Try it</h3>
<ul>
  <li>type <code class="language-plaintext highlighter-rouge">runApp()</code></li>
  <li>Notice hitting refresh incriments <code class="language-plaintext highlighter-rouge">y</code> but enterting values in the textbox does not</li>
  <li>Notice <code class="language-plaintext highlighter-rouge">x</code> is always 1</li>
  <li>Watch how it updated <code class="language-plaintext highlighter-rouge">text1</code> and <code class="language-plaintext highlighter-rouge">text2</code> as needed.</li>
  <li>Doesn‚Äôt add 1 to text1 every time a new <code class="language-plaintext highlighter-rouge">text2</code> is input.</li>
  <li><em>Important</em> try <code class="language-plaintext highlighter-rouge">runApp(display.mode='showcase')</code></li>
</ul>

<hr />
<h3 id="reactive-expressions">Reactive expressions</h3>
<ul>
  <li>Sometimes to speed up your app, you want reactive operations (those operations that depend on widget input values) to be performed outside of a <code class="language-plaintext highlighter-rouge">render*</code>1 statement</li>
  <li>For example, you want to do some code that gets reused in several 
<code class="language-plaintext highlighter-rouge">render*</code> statements and don‚Äôt want to recalculate it for each</li>
  <li>The <code class="language-plaintext highlighter-rouge">reactive</code> function is made for this purpose</li>
</ul>

<hr />
<h3 id="example-20">Example</h3>
<p><code class="language-plaintext highlighter-rouge">server.R</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shinyServer(
  function(input, output) {
    x &lt;- reactive({as.numeric(input$text1)+100})      
    output$text1 &lt;- renderText({x()                          })
    output$text2 &lt;- renderText({x() + as.numeric(input$text2)})
  }
)
</code></pre></div></div>

<hr />
<h3 id="as-opposed-to">As opposed to</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shinyServer(
  function(input, output) {
    output$text1 &lt;- renderText({as.numeric(input$text1)+100  })
    output$text2 &lt;- renderText({as.numeric(input$text1)+100 + 
        as.numeric(input$text2)})
  }
)
</code></pre></div></div>

<hr />
<h3 id="discussion-5">Discussion</h3>
<ul>
  <li>Do <code class="language-plaintext highlighter-rouge">runApp(display.mode='showcase')</code></li>
  <li>(While inconsequential) the second example has to add 100 twice every time
text1 is updated for the second set of code</li>
  <li>Also note the somewhat odd syntax for reactive variables</li>
</ul>

<hr />
<h3 id="non-reactive-reactivity-what">Non-reactive reactivity (what?)</h3>
<ul>
  <li>Sometimes you don‚Äôt want shiny to immediately perform reactive
calculations from widget inputs</li>
  <li>In other words, you want something like a submit button</li>
</ul>

<hr />
<h3 id="uir-2">ui.R</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shinyUI(pageWithSidebar(
  headerPanel("Hello Shiny!"),
  sidebarPanel(
      textInput(inputId="text1", label = "Input Text1"),
      textInput(inputId="text2", label = "Input Text2"),
      actionButton("goButton", "Go!")
  ),
  mainPanel(
      p('Output text1'),
      textOutput('text1'),
      p('Output text2'),
      textOutput('text2'),
      p('Output text3'),
      textOutput('text3')
  )
))
</code></pre></div></div>

<hr />
<h3 id="serverr-3">Server.R</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shinyServer(
  function(input, output) {
    output$text1 &lt;- renderText({input$text1})
    output$text2 &lt;- renderText({input$text2})
    output$text3 &lt;- renderText({
        input$goButton
        isolate(paste(input$text1, input$text2))
    })
  }
)
</code></pre></div></div>

<hr />
<h3 id="try-it-out">Try it out</h3>
<ul>
  <li>Notice it doesn‚Äôt display output <code class="language-plaintext highlighter-rouge">text3</code> until the go button is pressed</li>
  <li><code class="language-plaintext highlighter-rouge">input$goButton</code> (or whatever you named it) gets increased by one for every
time pushed</li>
  <li>So, when in reactive code (such as <code class="language-plaintext highlighter-rouge">render</code> or <code class="language-plaintext highlighter-rouge">reactive</code>) you can use conditional statements like below to only execute code on the first button press or to not execute code until the first or subsequent button press</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">if (input$goButton == 1){  Conditional statements }</code></p>

<hr />
<h2 id="example-21">Example</h2>
<p>Here‚Äôs some replaced code from our previous <code class="language-plaintext highlighter-rouge">server.R</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output</span><span class="o">$</span><span class="n">text3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">({</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">goButton</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="s2">"You have not pressed the button"</span><span class="w">
    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">goButton</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="s2">"you pressed it once"</span><span class="w">
    </span><span class="k">else</span><span class="w"> </span><span class="s2">"OK quit pressing it"</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<hr />

<h3 id="more-on-layouts">More on layouts</h3>
<ul>
  <li>The sidebar layout with a main panel is the easiest.</li>
  <li>Using <code class="language-plaintext highlighter-rouge">shinyUI(fluidpage(</code> is much more flexible and allows 
tighter access to the bootstrap styles</li>
  <li>Examples here (http://shiny.rstudio.com/articles/layout-guide.html)</li>
  <li><code class="language-plaintext highlighter-rouge">fluidRow</code> statements create rows and then the <code class="language-plaintext highlighter-rouge">column</code> function
from within it can create columns</li>
  <li>Tabsets, navlists and navbars can be created for more complex apps</li>
</ul>

<hr />
<h4 id="directly-using-html">Directly using html</h4>
<ul>
  <li>For more complex layouts, direct use of html is preferred
  (http://shiny.rstudio.com/articles/html-ui.html)</li>
  <li>Also, if you know web development well, you might find using
R to create web layouts kind of annoying</li>
  <li>Create a directory called <code class="language-plaintext highlighter-rouge">www</code> in the same directory with <code class="language-plaintext highlighter-rouge">server.R</code></li>
  <li>Have an <code class="language-plaintext highlighter-rouge">index.html</code> page in that directory</li>
  <li>Your named input variables will be passed to <code class="language-plaintext highlighter-rouge">server.R</code>
<code class="language-plaintext highlighter-rouge">&lt;input type="number" name="n" value="500" min="1" max="1000" /&gt;</code></li>
  <li>Your <code class="language-plaintext highlighter-rouge">server.R</code> output will have class definitions of the form <code class="language-plaintext highlighter-rouge">shiny-</code>
<code class="language-plaintext highlighter-rouge">&lt;pre id="summary" class="shiny-text-output"&gt;&lt;/pre&gt;</code></li>
</ul>

<hr />
<h3 id="debugging-techniques-for-shiny">Debugging techniques for Shiny</h3>
<ul>
  <li>Debugging shiny apps can be tricky</li>
  <li>We saw that <code class="language-plaintext highlighter-rouge">runApp(displayMode = 'showcase')</code> highlights execution while a 
shiny app runs</li>
  <li>Using <code class="language-plaintext highlighter-rouge">cat</code> in your code displays output to stdout (so R console)</li>
  <li>The <code class="language-plaintext highlighter-rouge">browser()</code> function can interupt execution and can be called conditionally
(http://shiny.rstudio.com/articles/debugging.html)</li>
</ul>

<h2 id="shiny-part-2-c9-w1">Shiny Part [2] (c9-w1)</h2>
<h3 id="reactivity">Reactivity</h3>

<p>A reactive expression is like a recipe that manipulates
inputs from Shiny and then returns a value. Reactivity
provides a way for your app to respond since inputs will 
change depending on how users interact with your user 
interface. Expressions wrapped by <code class="language-plaintext highlighter-rouge">reactive()</code> should be
expressions that are subject to change.</p>

<h3 id="reactivity-1">Reactivity</h3>

<p>Creating a reactive expression is just like creating a
function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calc_sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reactive</span><span class="p">({</span><span class="w">
  </span><span class="n">input</span><span class="o">$</span><span class="n">box1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">box2</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="c1"># ...</span><span class="w">
</span><span class="n">calc_sum</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<h3 id="your-first-reactive-app">Your First Reactive App</h3>

<p>```{r, echo=FALSE}
library(webshot)
appshot(‚Äúapp1‚Äù, ‚Äúapp1.png‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
This application predicts the horsepower of a car given
the fuel efficiency in miles per gallon for the car.

### Horsepower Prediction: ui.R Part 1

```r
library(shiny)
shinyUI(fluidPage(
  titlePanel("Predict Horsepower from MPG"),
  sidebarLayout(
    sidebarPanel(
      sliderInput("sliderMPG", "What is the MPG of the car?", 10, 35, value = 20),
      checkboxInput("showModel1", "Show/Hide Model 1", value = TRUE),
      checkboxInput("showModel2", "Show/Hide Model 2", value = TRUE)
    ),
# ...
</code></pre></div></div>

<h3 id="horsepower-prediction-uir-part-2">Horsepower Prediction: ui.R Part 2</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...</span><span class="w">
    </span><span class="n">mainPanel</span><span class="p">(</span><span class="w">
      </span><span class="n">plotOutput</span><span class="p">(</span><span class="s2">"plot1"</span><span class="p">),</span><span class="w">
      </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Predicted Horsepower from Model 1:"</span><span class="p">),</span><span class="w">
      </span><span class="n">textOutput</span><span class="p">(</span><span class="s2">"pred1"</span><span class="p">),</span><span class="w">
      </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Predicted Horsepower from Model 2:"</span><span class="p">),</span><span class="w">
      </span><span class="n">textOutput</span><span class="p">(</span><span class="s2">"pred2"</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h3 id="horsepower-prediction-serverr-part-1">Horsepower Prediction: server.R Part 1</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">mtcars</span><span class="o">$</span><span class="n">mpgsp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">mtcars</span><span class="o">$</span><span class="n">mpg</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">mtcars</span><span class="o">$</span><span class="n">mpg</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
  </span><span class="n">model1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">hp</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mtcars</span><span class="p">)</span><span class="w">
  </span><span class="n">model2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">hp</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">mpgsp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mtcars</span><span class="p">)</span><span class="w">
  
  </span><span class="n">model1pred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reactive</span><span class="p">({</span><span class="w">
    </span><span class="n">mpgInput</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">sliderMPG</span><span class="w">
    </span><span class="n">predict</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpgInput</span><span class="p">))</span><span class="w">
  </span><span class="p">})</span><span class="w">
  
  </span><span class="n">model2pred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reactive</span><span class="p">({</span><span class="w">
    </span><span class="n">mpgInput</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">sliderMPG</span><span class="w">
    </span><span class="n">predict</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> 
              </span><span class="n">data.frame</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpgInput</span><span class="p">,</span><span class="w">
                         </span><span class="n">mpgsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">mpgInput</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
                                        </span><span class="n">mpgInput</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)))</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span></code></pre></div></div>
<h3 id="horsepower-prediction-serverr-part-2">Horsepower Prediction: server.R Part 2</h3>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">output</span><span class="o">$</span><span class="n">plot1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderPlot</span><span class="p">({</span><span class="w">
    </span><span class="n">mpgInput</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">sliderMPG</span><span class="w">
    
    </span><span class="n">plot</span><span class="p">(</span><span class="n">mtcars</span><span class="o">$</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">mtcars</span><span class="o">$</span><span class="n">hp</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Miles Per Gallon"</span><span class="p">,</span><span class="w"> 
         </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Horsepower"</span><span class="p">,</span><span class="w"> </span><span class="n">bty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w">
         </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">35</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">350</span><span class="p">))</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">showModel1</span><span class="p">){</span><span class="w">
      </span><span class="n">abline</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">showModel2</span><span class="p">){</span><span class="w">
      </span><span class="n">model2lines</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
        </span><span class="n">mpg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="o">:</span><span class="m">35</span><span class="p">,</span><span class="w"> </span><span class="n">mpgsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="m">10</span><span class="o">:</span><span class="m">35</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="o">:</span><span class="m">35</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
      </span><span class="p">))</span><span class="w">
      </span><span class="n">lines</span><span class="p">(</span><span class="m">10</span><span class="o">:</span><span class="m">35</span><span class="p">,</span><span class="w"> </span><span class="n">model2lines</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h3 id="horsepower-prediction-serverr-part-3">Horsepower Prediction: server.R Part 3</h3>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">legend</span><span class="p">(</span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="m">250</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Model 1 Prediction"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Model 2 Prediction"</span><span class="p">),</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> 
           </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">),</span><span class="w"> </span><span class="n">bty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.2</span><span class="p">)</span><span class="w">
    </span><span class="n">points</span><span class="p">(</span><span class="n">mpgInput</span><span class="p">,</span><span class="w"> </span><span class="n">model1pred</span><span class="p">(),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
    </span><span class="n">points</span><span class="p">(</span><span class="n">mpgInput</span><span class="p">,</span><span class="w"> </span><span class="n">model2pred</span><span class="p">(),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="p">})</span><span class="w">
  
  </span><span class="n">output</span><span class="o">$</span><span class="n">pred1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">({</span><span class="w">
    </span><span class="n">model1pred</span><span class="p">()</span><span class="w">
  </span><span class="p">})</span><span class="w">
  
  </span><span class="n">output</span><span class="o">$</span><span class="n">pred2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">({</span><span class="w">
    </span><span class="n">model2pred</span><span class="p">()</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h3 id="horsepower-prediction">Horsepower Prediction</h3>

<p><img src="app1.png" alt="" /></p>

<h3 id="delayed-reactivity">Delayed Reactivity</h3>

<p>You might not want your app to immediately react to changes
in user input because of something like a long-running
calculation. In order to prevent reactive expressions from
reacting you can use a submit button in your app. Let‚Äôs take
a look at last app we created, but with a submit button
added to the app.</p>

<p>```{r, echo=FALSE}
library(webshot)
appshot(‚Äúapp2‚Äù, ‚Äúapp2.png‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Reactive Horsepower: ui.R

There's one new line added to the code from the last app:

```r
shinyUI(fluidPage(
  titlePanel("Predict Horsepower from MPG"),
  sidebarLayout(
    sidebarPanel(
      sliderInput("sliderMPG", "What is the MPG of the car?", 10, 35, value = 20),
      checkboxInput("showModel1", "Show/Hide Model 1", value = TRUE),
      checkboxInput("showModel2", "Show/Hide Model 2", value = TRUE),
      submitButton("Submit") # New!
    ),
</code></pre></div></div>

<h3 id="reactive-horsepower">Reactive Horsepower</h3>

<p><img src="app2.png" alt="" /></p>

<h3 id="advanced-ui">Advanced UI</h3>

<p>There are several other kinds of UI components that you can
mix into your app including tabs, navbars, and sidebars.
We‚Äôll show you an example of how to use tabs to give your app
multiple views. The <code class="language-plaintext highlighter-rouge">tabsetPanel()</code> function specifies a
group of tabs, and then the <code class="language-plaintext highlighter-rouge">tabPanel()</code> function specifies
the contents of an individual tab.</p>

<p>```{r, echo=FALSE}
library(webshot)
appshot(‚Äúapp3‚Äù, ‚Äúapp3.png‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Tabs: ui.R

```r
library(shiny)
shinyUI(fluidPage(
  titlePanel("Tabs!"),
  sidebarLayout(
    sidebarPanel(
      textInput("box1", "Enter Tab 1 Text:", value = "Tab 1!"),
      textInput("box2", "Enter Tab 2 Text:", value = "Tab 2!"),
      textInput("box3", "Enter Tab 3 Text:", value = "Tab 3!")
    ),
    mainPanel(
      tabsetPanel(type = "tabs", 
                  tabPanel("Tab 1", br(), textOutput("out1")), 
                  tabPanel("Tab 2", br(), textOutput("out2")), 
                  tabPanel("Tab 2", br(), textOutput("out3"))
      )
    )
  )
))
</code></pre></div></div>

<h3 id="tabs-serverr">Tabs: server.R</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">output</span><span class="o">$</span><span class="n">out1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">box1</span><span class="p">)</span><span class="w">
  </span><span class="n">output</span><span class="o">$</span><span class="n">out2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">box2</span><span class="p">)</span><span class="w">
  </span><span class="n">output</span><span class="o">$</span><span class="n">out3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">box3</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h3 id="tabs">Tabs</h3>

<p><img src="app3.png" alt="" /></p>

<h3 id="interactive-graphics">Interactive Graphics</h3>

<p>One of my favorite features of Shiny is the ability to create
graphics that a user can interact with. One method you can
use to select multiple data points on a graph is
by specifying the <code class="language-plaintext highlighter-rouge">brush</code> argument in <code class="language-plaintext highlighter-rouge">plotOutput()</code> on the
<code class="language-plaintext highlighter-rouge">ui.R</code> side, and then using the <code class="language-plaintext highlighter-rouge">brushedPoints()</code> function on
the <code class="language-plaintext highlighter-rouge">server.R</code> side. The following example app fits a
linear model for the selected points and then draws a line 
of best fit for the resulting model.</p>

<p>```{r, echo=FALSE}
library(webshot)
appshot(‚Äúapp4‚Äù, ‚Äúapp4.png‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Interactive Graphics: ui.R

```r
library(shiny)
shinyUI(fluidPage(
  titlePanel("Visualize Many Models"),
  sidebarLayout(
    sidebarPanel(
      h3("Slope"),
      textOutput("slopeOut"),
      h3("Intercept"),
      textOutput("intOut")
    ),
    mainPanel(
      plotOutput("plot1", brush = brushOpts(
        id = "brush1"
      ))
    )
  )
))
</code></pre></div></div>

<h3 id="interactive-graphics-serverr-part-1">Interactive Graphics: server.R Part 1</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reactive</span><span class="p">({</span><span class="w">
    </span><span class="n">brushed_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">brushedPoints</span><span class="p">(</span><span class="n">trees</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">brush1</span><span class="p">,</span><span class="w">
                            </span><span class="n">xvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Girth"</span><span class="p">,</span><span class="w"> </span><span class="n">yvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Volume"</span><span class="p">)</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">brushed_data</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">2</span><span class="p">){</span><span class="w">
      </span><span class="nf">return</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="n">lm</span><span class="p">(</span><span class="n">Volume</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Girth</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brushed_data</span><span class="p">)</span><span class="w">
  </span><span class="p">})</span><span class="w">
  </span><span class="n">output</span><span class="o">$</span><span class="n">slopeOut</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">({</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">model</span><span class="p">())){</span><span class="w">
      </span><span class="s2">"No Model Found"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">model</span><span class="p">()[[</span><span class="m">1</span><span class="p">]][</span><span class="m">2</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="c1"># ...</span><span class="w">
</span></code></pre></div></div>
<h3 id="interactive-graphics-serverr-part-2">Interactive Graphics: server.R Part 2</h3>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...</span><span class="w">
</span><span class="n">output</span><span class="o">$</span><span class="n">intOut</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">({</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">model</span><span class="p">())){</span><span class="w">
      </span><span class="s2">"No Model Found"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">model</span><span class="p">()[[</span><span class="m">1</span><span class="p">]][</span><span class="m">1</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w">
  </span><span class="n">output</span><span class="o">$</span><span class="n">plot1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderPlot</span><span class="p">({</span><span class="w">
    </span><span class="n">plot</span><span class="p">(</span><span class="n">trees</span><span class="o">$</span><span class="n">Girth</span><span class="p">,</span><span class="w"> </span><span class="n">trees</span><span class="o">$</span><span class="n">Volume</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Girth"</span><span class="p">,</span><span class="w">
         </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Volume"</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Tree Measurements"</span><span class="p">,</span><span class="w">
         </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">bty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">)</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">model</span><span class="p">())){</span><span class="w">
      </span><span class="n">abline</span><span class="p">(</span><span class="n">model</span><span class="p">(),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h3 id="interactive-graphics-1">Interactive Graphics</h3>

<p><img src="app4.png" alt="" /></p>

<h3 id="sharing-shiny-apps">Sharing Shiny Apps</h3>

<p>Once you‚Äôve created a Shiny app, there are several ways to
share your app. Using <a href="http://www.shinyapps.io/">shinyapps.io</a>
allows users to interact with your app through a web browser
without needing to have R or Shiny installed. Shinyapps.io
has a free tier, but if you want to use a Shiny app in your
business you may be interested in paying for the service. If
you‚Äôre sharing your app with an R user you can post your app
to GitHub and instruct the user to use the <code class="language-plaintext highlighter-rouge">runGist()</code> or 
<code class="language-plaintext highlighter-rouge">runGitHub()</code> function to launch your app.</p>

<h3 id="more-shiny-resources">More Shiny Resources</h3>

<ul>
  <li><a href="http://shiny.rstudio.com/tutorial/">The Official Shiny Tutorial</a></li>
  <li><a href="http://shiny.rstudio.com/gallery/">Gallery of Shiny Apps</a></li>
  <li><a href="http://www.showmeshiny.com/">Show Me Shiny: Gallery of R Web Apps</a></li>
  <li><a href="https://plot.ly/r/shiny-tutorial/">Integrating Shiny and Plotly</a></li>
  <li><a href="http://stackoverflow.com/questions/tagged/shiny">Shiny on Stack Overflow</a>
    <h2 id="shiny_gadgets-c9-w1">Shiny_Gadgets (c9-w1)</h2>
    <h3 id="introduction">Introduction</h3>
  </li>
</ul>

<p>Shiny Gadgets provide a way to use Shiny‚Äôs interactivity and
user interface tools as a part of a data analysis. With
Shiny Gadgets you can create a function that opens a small 
Shiny app. Since these apps are smaller we‚Äôll be using the
miniUI package for creating user interfaces.</p>

<h3 id="a-simple-gadget">A Simple Gadget</h3>

<p>At its core a Shiny Gadget is a function that launches a
small (single-page) Shiny application. Since Shiny Gadgets
are meant to be displayed in the RStudio viewer pane, the
miniUI package comes in handy for its smaller graphical
elements. Let‚Äôs construct a very simple Shiny Gadget.</p>

<h3 id="a-simple-gadget-code">A Simple Gadget: Code</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">miniUI</span><span class="p">)</span><span class="w">
</span><span class="n">myFirstGadget</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">ui</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">miniPage</span><span class="p">(</span><span class="w">
    </span><span class="n">gadgetTitleBar</span><span class="p">(</span><span class="s2">"My First Gadget"</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
  </span><span class="n">server</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># The Done button closes the app</span><span class="w">
    </span><span class="n">observeEvent</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">done</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">stopApp</span><span class="p">()</span><span class="w">
    </span><span class="p">})</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">runGadget</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="a-simple-gadget-image">A Simple Gadget: Image</h3>

<p><img src="myFirstGadget.png" alt="myFirstGadget" /></p>

<h3 id="a-simple-gadget-code-review">A Simple Gadget: Code Review</h3>

<p>Source the preceding code and run <code class="language-plaintext highlighter-rouge">myFirstGadget()</code> to see
a very basic Shiny Gadget. Just to review some of the new
functions in this Gadget:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">miniPage()</code> creates a small layout.</li>
  <li><code class="language-plaintext highlighter-rouge">gadgetTitleBar()</code> provides a title bar with Done and 
Cancel buttons.</li>
  <li><code class="language-plaintext highlighter-rouge">runGadget()</code> runs the Shiny Gadget, taking <code class="language-plaintext highlighter-rouge">ui</code> and
<code class="language-plaintext highlighter-rouge">server</code> as arguments.</li>
</ul>

<h3 id="gadgets-with-arguments">Gadgets with Arguments</h3>

<p>One of the advantages of Shiny Gadgets is that since Shiny
Gadgets are functions they can take values as arguments and
they can return values. Let‚Äôs take a look at a simple
example of a Shiny Gadget that takes arguments and returns
a value. The following Shiny Gadget takes two different
vectors of numbers as arguments and uses those vectors to
populate two <code class="language-plaintext highlighter-rouge">selectInput</code>s. The user can then choose two
numbers within the Gadget, and the product of those two
numbers will be returned.</p>

<h3 id="gadgets-with-arguments-code-part-1">Gadgets with Arguments: Code Part 1</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">miniUI</span><span class="p">)</span><span class="w">
</span><span class="n">multiplyNumbers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">numbers1</span><span class="p">,</span><span class="w"> </span><span class="n">numbers2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">ui</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">miniPage</span><span class="p">(</span><span class="w">
    </span><span class="n">gadgetTitleBar</span><span class="p">(</span><span class="s2">"Multiply Two Numbers"</span><span class="p">),</span><span class="w">
    </span><span class="n">miniContentPanel</span><span class="p">(</span><span class="w">
      </span><span class="n">selectInput</span><span class="p">(</span><span class="s2">"num1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"First Number"</span><span class="p">,</span><span class="w"> </span><span class="n">choices</span><span class="o">=</span><span class="n">numbers1</span><span class="p">),</span><span class="w">
      </span><span class="n">selectInput</span><span class="p">(</span><span class="s2">"num2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Second Number"</span><span class="p">,</span><span class="w"> </span><span class="n">choices</span><span class="o">=</span><span class="n">numbers2</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
  </span><span class="n">server</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">observeEvent</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">done</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">num1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">num1</span><span class="p">)</span><span class="w">
      </span><span class="n">num2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">num2</span><span class="p">)</span><span class="w">
      </span><span class="n">stopApp</span><span class="p">(</span><span class="n">num1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">num2</span><span class="p">)</span><span class="w">
    </span><span class="p">})</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">runGadget</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="gadgets-with-arguments-image">Gadgets with Arguments: Image</h3>

<p><img src="multiplyNumbers.png" alt="multiplyNumbers" /></p>

<h3 id="gadgets-with-arguments-code-review">Gadgets with Arguments: Code Review</h3>

<p>Source the preceding code and run 
<code class="language-plaintext highlighter-rouge">multiplyNumbers(1:5, 6:10)</code> so you
can get a sense of how this Gadget works. As you can see
this Gadget uses <code class="language-plaintext highlighter-rouge">selectInput()</code> so that the user can
select two different numbers. Clicking the Done button
multiplies the tow numbers together, which is returned as
the result of the <code class="language-plaintext highlighter-rouge">multiplyNumbers()</code> function.</p>

<h3 id="gadgets-with-interactive-graphics">Gadgets with Interactive Graphics</h3>

<p>Shiny Gadgets are particularly useful when a data analysis
needs a touch of human intervention. You can imagine
presenting an interactive data visualization through a
Gadget, where an analyst could manipulate data in the
Gadget, and then the Gadget would return the manipulated
data. Let‚Äôs walk though an example of how this could be done.</p>

<h3 id="gadgets-with-interactive-graphics-code-part-1">Gadgets with Interactive Graphics: Code Part 1</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">miniUI</span><span class="p">)</span><span class="w">
</span><span class="n">pickTrees</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">ui</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">miniPage</span><span class="p">(</span><span class="w">
    </span><span class="n">gadgetTitleBar</span><span class="p">(</span><span class="s2">"Select Points by Dragging your Mouse"</span><span class="p">),</span><span class="w">
    </span><span class="n">miniContentPanel</span><span class="p">(</span><span class="w">
      </span><span class="n">plotOutput</span><span class="p">(</span><span class="s2">"plot"</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"100%"</span><span class="p">,</span><span class="w"> </span><span class="n">brush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"brush"</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h3 id="gadgets-with-interactive-graphics-code-part-2">Gadgets with Interactive Graphics: Code Part 2</h3>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">server</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">output</span><span class="o">$</span><span class="n">plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderPlot</span><span class="p">({</span><span class="w">
      </span><span class="n">plot</span><span class="p">(</span><span class="n">trees</span><span class="o">$</span><span class="n">Girth</span><span class="p">,</span><span class="w"> </span><span class="n">trees</span><span class="o">$</span><span class="n">Volume</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Trees!"</span><span class="p">,</span><span class="w">
        </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Girth"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Volume"</span><span class="p">)</span><span class="w">
    </span><span class="p">})</span><span class="w">
    </span><span class="n">observeEvent</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">done</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">stopApp</span><span class="p">(</span><span class="n">brushedPoints</span><span class="p">(</span><span class="n">trees</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">brush</span><span class="p">,</span><span class="w">
        </span><span class="n">xvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Girth"</span><span class="p">,</span><span class="w"> </span><span class="n">yvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Volume"</span><span class="p">))</span><span class="w">
    </span><span class="p">})</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">runGadget</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="gadgets-with-interactive-graphics-image">Gadgets with Interactive Graphics: Image</h3>

<p><img src="pickTrees.png" alt="pickTrees" /></p>

<h3 id="gadgets-with-interactive-graphics-code-review">Gadgets with Interactive Graphics: Code Review</h3>

<p>Source the preceding code and run <code class="language-plaintext highlighter-rouge">pickTrees()</code>. Click and
drag a box over the graph. Once you‚Äôve drawn a box that
you‚Äôre satisfied with click the Done button and the points
that you selected will be returned to you as a data frame.
This functionality is made possible by the <code class="language-plaintext highlighter-rouge">brushedPoints()</code>
function, which is part of the <code class="language-plaintext highlighter-rouge">shiny</code> package. (See 
<code class="language-plaintext highlighter-rouge">?shiny::brushedPoints</code> for more information.)</p>

<h3 id="conclusion">Conclusion</h3>

<p>For more details about Shiny Gadgets visit the Shiny Gadgets
website:</p>

<ul>
  <li>http://shiny.rstudio.com/articles/gadgets.html</li>
  <li>http://shiny.rstudio.com/articles/gadget-ui.html
    <h2 id="deploy-shiny-app">Deploy Shiny APP</h2>
  </li>
</ul>

<h3 id="deploy-locally">deploy locally</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">runApp</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<h3 id="deploy-on-shinyappsio">deploy on shinyapps.io</h3>

<ul>
  <li>
    <p>Go to the website and make an account.</p>
  </li>
  <li>
    <p>Follow instructions on
http://shiny.rstudio.com/articles/shinyapps.html</p>
  </li>
</ul>

<p>You get the Token and secret in https://www.shinyapps.io/admin/#/tokens</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rsconnect</span><span class="p">)</span><span class="w">
</span><span class="n">rsconnect</span><span class="o">::</span><span class="n">setAccountInfo</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"&lt;ACCOUNT&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="o">=</span><span class="s2">"&lt;TOKEN&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">secret</span><span class="o">=</span><span class="s2">"&lt;SECRET&gt;"</span><span class="p">)</span><span class="w">
</span><span class="n">deployApp</span><span class="p">(</span><span class="n">appName</span><span class="o">=</span><span class="s2">"somethinggreaterthan4letters"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="regular-workflow-for-deployment">Regular workflow for deployment</h3>

<ol>
  <li>
    <p>go to website and get token</p>
  </li>
  <li>
    <p>make a separate folder with <code class="language-plaintext highlighter-rouge">server.r</code> and <code class="language-plaintext highlighter-rouge">ui.r</code></p>
  </li>
  <li>
    <p>go into that folder and then</p>
  </li>
  <li>
    <p>open R (<code class="language-plaintext highlighter-rouge">M-x R</code>)</p>
  </li>
  <li>
    <p>add the code.</p>
  </li>
</ol>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rsconnect</span><span class="p">)</span><span class="w">
</span><span class="n">rsconnect</span><span class="o">::</span><span class="n">setAccountInfo</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"&lt;ACCOUNT&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="o">=</span><span class="s2">"&lt;TOKEN&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">secret</span><span class="o">=</span><span class="s2">"&lt;SECRET&gt;"</span><span class="p">)</span><span class="w">
</span><span class="n">deployApp</span><span class="p">(</span><span class="n">appName</span><span class="o">=</span><span class="s2">"somethinggreaterthan4letters"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="trouble-shooting">Trouble shooting</h3>

<p>In case the above doesn‚Äôt work‚Ä¶</p>

<p>One work around seems to be to downgrade the rsconnect which currntly
has some issues related to python as documented in: https://stackoverflow.com/questions/54977188/problem-deploying-shiny-app-in-r-using-a-virtual-env-with-reticulate-to-run-pyt</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"rstudio/rsconnect"</span><span class="p">,</span><span class="w"> </span><span class="n">ref</span><span class="o">=</span><span class="s1">'737cd48'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="updating">Updating</h3>

<p>Just deploy again</p>
<h2 id="googlevis-c9-w1">GoogleVis (c9-w1)</h2>
<h3 id="google-vis-api">Google Vis API</h3>

<p><img class="center" src="googlecharts.png" height="250" /></p>

<p>https://developers.google.com/chart/interactive/docs/gallery</p>

<h3 id="basic-idea-2">Basic idea</h3>

<ul>
  <li>The R function creates an HTML page</li>
  <li>The HTML page calls Google Charts</li>
  <li>The result is an interactive HTML graphic</li>
</ul>

<h3 id="example-22">Example</h3>

<p>```{r gv, results=‚Äùasis‚Äù, cache=TRUE}
suppressPackageStartupMessages(library(googleVis))
M &lt;- gvisMotionChart(Fruits, ‚ÄúFruit‚Äù, ‚ÄúYear‚Äù,
                     options=list(width=600, height=400))
print(M,‚Äùchart‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Charts in googleVis

&lt;center&gt; "gvis + ChartType" &lt;/center&gt;

* Motion charts:  `gvisMotionChart`
* Interactive maps: `gvisGeoChart`
* Interactive tables: `gvisTable`
* Line charts: `gvisLineChart`
* Bar charts: `gvisColumnChart`
* Tree maps: `gvisTreeMap`

http://cran.r-project.org/web/packages/googleVis/googleVis.pdf

### Plots on maps

```{r,dependson="gv",results="asis", cache=TRUE}
G &lt;- gvisGeoChart(Exports, locationvar="Country",
                  colorvar="Profit",options=list(width=600, height=400))
print(G,"chart")
</code></pre></div></div>

<h3 id="specifying-a-region">Specifying a region</h3>

<p>```{r,dependson=‚Äùgv‚Äù,results=‚Äùasis‚Äù, cache=TRUE}
G2 &lt;- gvisGeoChart(Exports, locationvar=‚ÄùCountry‚Äù,
                  colorvar=‚ÄùProfit‚Äù,options=list(width=600, height=400,region=‚Äù150‚Äù))
print(G2,‚Äùchart‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Finding parameters to set under `options`


&lt;img class="center" src="configoptions.png" height=250&gt;

https://developers.google.com/chart/interactive/docs/gallery/geochart

### Setting more options

```{r linechart,dependson="gv",results="asis", cache=TRUE}
df &lt;- data.frame(label=c("US", "GB", "BR"), val1=c(1,3,4), val2=c(23,12,32))
Line &lt;- gvisLineChart(df, xvar="label", yvar=c("val1","val2"),
        options=list(title="Hello World", legend="bottom",
                titleTextStyle="{color:'red', fontSize:18}",                         
                vAxis="{gridlines:{color:'red', count:3}}",
                hAxis="{title:'My Label', titleTextStyle:{color:'blue'}}",
                series="[{color:'green', targetAxisIndex: 0}, 
                         {color: 'blue',targetAxisIndex:1}]",
                vAxes="[{title:'Value 1 (%)', format:'##,######%'}, 
                                  {title:'Value 2 (\U00A3)'}]",                          
                curveType="function", width=500, height=300                         
                ))
</code></pre></div></div>

<p>https://github.com/mages/Introduction_to_googleVis/blob/gh-pages/index.Rmd</p>

<h3 id="setting-more-options">Setting more options</h3>

<p>```{r ,dependson=‚Äùlinechart‚Äù,results=‚Äùasis‚Äù, cache=TRUE}
print(Line,‚Äùchart‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Combining multiple plots together

```{r multiplot,dependson="gv",results="asis", cache=TRUE}
G &lt;- gvisGeoChart(Exports, "Country", "Profit",options=list(width=200, height=100))
T1 &lt;- gvisTable(Exports,options=list(width=200, height=270))
M &lt;- gvisMotionChart(Fruits, "Fruit", "Year", options=list(width=400, height=370))
GT &lt;- gvisMerge(G,T1, horizontal=FALSE)
GTM &lt;- gvisMerge(GT, M, horizontal=TRUE,tableOptions="bgcolor=\"#CCCCCC\" cellspacing=10")
</code></pre></div></div>

<h3 id="combining-multiple-plots-together">Combining multiple plots together</h3>

<p>```{r,dependson=‚Äùmultiplot‚Äù,results=‚Äùasis‚Äù, cache=TRUE}
print(GTM,‚Äùchart‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Seeing the HTML code

```{r ,dependson="gv", cache=TRUE}
M &lt;- gvisMotionChart(Fruits, "Fruit", "Year", options=list(width=600, height=400))
print(M)
print(M, 'chart', file='myfilename.html')
</code></pre></div></div>

<h3 id="things-you-can-do-with-google-vis">Things you can do with Google Vis</h3>

<ul>
  <li>The visualizations can be embedded in websites with HTML code</li>
  <li>Dynamic visualizations can be built with Shiny, Rook, and R.rsp</li>
  <li>Embed them in <a href="http://www.rstudio.com/ide/docs/authoring/using_markdown">R markdown</a> based documents
    <ul>
      <li>Set <code class="language-plaintext highlighter-rouge">results="asis"</code> in the chunk options</li>
      <li>Can be used with <a href="http://cran.r-project.org/web/packages/knitr/index.html">knitr</a> and <a href="http://slidify.org/">slidify</a></li>
    </ul>
  </li>
</ul>

<h3 id="for-more-info">For more info</h3>

<pre><code class="language-{r,eval=FALSE}">demo(googleVis)
</code></pre>

<ul>
  <li>http://cran.r-project.org/web/packages/googleVis/vignettes/googleVis.pdf</li>
  <li>http://cran.r-project.org/web/packages/googleVis/googleVis.pdf</li>
  <li>https://developers.google.com/chart/interactive/docs/gallery</li>
  <li>https://developers.google.com/chart/interactive/faq
    <h2 id="plotly-c9-w1">plotly (c9-w1)</h2>
    <h3 id="what-is-plotly">What is Plotly?</h3>
  </li>
</ul>

<p>Plotly is a web application for creating and sharing data visualizations. Plotly
can work with several programming languages and applications including R,
Python, and Microsoft Excel. We‚Äôre going to concentrate on creating different
graphs with Plotly and sharing those graphs.</p>

<h3 id="installing-plotly">Installing Plotly</h3>

<p>Installing Plotly is easy:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"plotly"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If you want to share your visualizations on https://plot.ly/ you should make an
account on their site.</p>

<h3 id="basic-scatterplot">Basic Scatterplot</h3>

<p>A basic scatterplot is easy to make, with the added benefit of tooltips that
appear when your mouse hovers over each point. Specify a scatterplot by
indicating <code class="language-plaintext highlighter-rouge">type = "scatter"</code>. Notice that the arguments for the <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> 
variables as specified as formulas, with the tilde operator (<code class="language-plaintext highlighter-rouge">~</code>) preceding the
variable that you‚Äôre plotting.</p>

<p>```{r, eval=FALSE}
library(plotly)
plot_ly(mtcars, x = ~wt, y = ~mpg, type = ‚Äúscatter‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Basic Scatterplot

```{r, echo=FALSE, message=FALSE}
library(plotly)
plot_ly(mtcars, x = ~wt, y = ~mpg, type = "scatter")
</code></pre></div></div>

<h3 id="scatterplot-color">Scatterplot Color</h3>

<p>You can add color to your scatterplot points according to a categorical variable
in the data frame you use with <code class="language-plaintext highlighter-rouge">plot_ly()</code>.</p>

<p>```{r, eval=FALSE}
plot_ly(mtcars, x = ~wt, y = ~mpg, type = ‚Äúscatter‚Äù, color = ~factor(cyl))</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Scatterplot Color

```{r, echo=FALSE, message=FALSE}
plot_ly(mtcars, x = ~wt, y = ~mpg, type = "scatter", color = ~factor(cyl))
</code></pre></div></div>

<h3 id="continuous-color">Continuous Color</h3>

<p>You can also show continuous variables with color in scatterplots.</p>

<p>```{r, eval=FALSE}
plot_ly(mtcars, x = ~wt, y = ~mpg, type = ‚Äúscatter‚Äù, color = ~disp)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Continuous Color

```{r, echo=FALSE, message=FALSE}
plot_ly(mtcars, x = ~wt, y = ~mpg, type = "scatter", color = ~disp)
</code></pre></div></div>

<h3 id="scatterplot-sizing">Scatterplot Sizing</h3>

<p>By specifying the <code class="language-plaintext highlighter-rouge">size</code> argument you can make each point in your scatterplot a
different size.</p>

<p>```{r, eval=FALSE}
plot_ly(mtcars, x = ~wt, y = ~mpg, type = ‚Äúscatter‚Äù, 
        color = ~factor(cyl), size = ~hp)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Scatterplot Sizing

```{r, echo=FALSE, message=FALSE}
plot_ly(mtcars, x = ~wt, y = ~mpg, type = "scatter", 
        color = ~factor(cyl), size = ~hp)
</code></pre></div></div>

<h3 id="3d-scatterplot">3D Scatterplot</h3>

<p>You can create a three-dimensional scatterplot with the <code class="language-plaintext highlighter-rouge">type = "scatter3d"</code>
argument. If you click and drag these scatterplots you can view them from
different angles.</p>

<p>```{r, eval=FALSE}
set.seed(2016-07-21)
temp &lt;- rnorm(100, mean = 30, sd = 5)
pressue &lt;- rnorm(100)
dtime &lt;- 1:100
plot_ly(x = ~temp, y = ~pressue, z = ~dtime,
        type = ‚Äúscatter3d‚Äù, color = ~temp)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### 3D Scatterplot

```{r, echo=FALSE, message=FALSE}
set.seed(2016-07-21)
temp &lt;- rnorm(100, mean = 30, sd = 5)
pressue &lt;- rnorm(100)
dtime &lt;- 1:100
plot_ly(x = ~temp, y = ~pressue, z = ~dtime,
        type = "scatter3d", color = ~temp)
</code></pre></div></div>

<h3 id="line-graph">Line Graph</h3>

<p>Line graphs are the default graph for <code class="language-plaintext highlighter-rouge">plot_ly()</code>. They‚Äôre of course useful for
showing change over time:</p>

<p>```{r, eval=FALSE}
data(‚Äúairmiles‚Äù)
plot_ly(x = ~time(airmiles), y = ~airmiles, type = ‚Äúscatter‚Äù, mode = ‚Äúlines‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Line Graph

```{r, echo=FALSE, message=FALSE}
data("airmiles")
plot_ly(x = ~time(airmiles), y = ~airmiles, type = "scatter", mode = "lines")
</code></pre></div></div>

<h3 id="multi-line-graph">Multi Line Graph</h3>

<p>You can show multiple lines by specifying the column in the data frame that
separates the lines:</p>

<p>```{r, eval=FALSE}
library(plotly)
library(tidyr)
library(dplyr)
data(‚ÄúEuStockMarkets‚Äù)
stocks &lt;- as.data.frame(EuStockMarkets) %&gt;%
  gather(index, price) %&gt;%
  mutate(time = rep(time(EuStockMarkets), 4))
plot_ly(stocks, x = ~time, y = ~price, color = ~index, type = ‚Äúscatter‚Äù, mode = ‚Äúlines‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Multi Line Graph

```{r, echo=FALSE, message=FALSE}
library(plotly)
library(tidyr)
library(dplyr)
data("EuStockMarkets")
stocks &lt;- as.data.frame(EuStockMarkets) %&gt;%
  gather(index, price) %&gt;%
  mutate(time = rep(time(EuStockMarkets), 4))
plot_ly(stocks, x = ~time, y = ~price, color = ~index, type = "scatter", mode = "lines")
</code></pre></div></div>

<h3 id="histogram-1">Histogram</h3>

<p>A histogram is great for showing how counts of data are distributed. Use the
<code class="language-plaintext highlighter-rouge">type = "histogram"</code> argument.</p>

<p>```{r, eval=FALSE}
plot_ly(x = ~precip, type = ‚Äúhistogram‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Histogram

```{r, echo=FALSE, message=FALSE}
plot_ly(x = ~precip, type = "histogram")
</code></pre></div></div>

<h3 id="boxplot-1">Boxplot</h3>

<p>Boxplots are wonderful for comparing how different datasets are distributed.
Specify <code class="language-plaintext highlighter-rouge">type = "box"</code> to create a boxplot.</p>

<p>```{r, eval=FALSE}
plot_ly(iris, y = ~Petal.Length, color = ~Species, type = ‚Äúbox‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Boxplot

```{r, echo=FALSE, message=FALSE}
plot_ly(iris, y = ~Petal.Length, color = ~Species, type = "box")
</code></pre></div></div>

<h3 id="heatmap-1">Heatmap</h3>

<p>Heatmaps are useful for displaying three dimensional data in two dimensions,
using color for the third dimension. Create a heatmap by using the
<code class="language-plaintext highlighter-rouge">type = "heatmap"</code> argument.</p>

<p>```{r, eval=FALSE}
terrain1 &lt;- matrix(rnorm(100*100), nrow = 100, ncol = 100)
plot_ly(z = ~terrain1, type = ‚Äúheatmap‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Heatmap

```{r, echo=FALSE, message=FALSE}
terrain1 &lt;- matrix(rnorm(100*100), nrow = 100, ncol = 100)
plot_ly(z = ~terrain1, type = "heatmap")
</code></pre></div></div>

<h3 id="3d-surface">3D Surface</h3>

<p>Why limit yourself to two dimensions when you can render three dimensions on a
computer!? Create moveable 3D surfaces with <code class="language-plaintext highlighter-rouge">type = "surface"</code>.</p>

<p>```{r, eval=FALSE}
terrain2 &lt;- matrix(sort(rnorm(100*100)), nrow = 100, ncol = 100)
plot_ly(z = ~terrain2, type = ‚Äúsurface‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### 3D Surface

```{r, echo=FALSE, message=FALSE}
terrain2 &lt;- matrix(sort(rnorm(100*100)), nrow = 100, ncol = 100)
plot_ly(z = ~terrain2, type = "surface")
</code></pre></div></div>

<h3 id="choropleth-maps-setup">Choropleth Maps: Setup</h3>

<p>Choropleth maps illustrate data across geographic areas by shading regions with
different colors. Choropleth maps are easy to make with Plotly though they
require more setup compared to other Plotly graphics.</p>

<p>```{r, eval=FALSE}</p>
<h1 id="create-data-frame">Create data frame</h1>
<p>state_pop &lt;- data.frame(State = state.abb, Pop = as.vector(state.x77[,1]))</p>
<h1 id="create-hover-text">Create hover text</h1>
<p>state_pop$hover &lt;- with(state_pop, paste(State, ‚Äò<br />‚Äô, ‚ÄúPopulation:‚Äù, Pop))</p>
<h1 id="make-state-borders-white">Make state borders white</h1>
<p>borders &lt;- list(color = toRGB(‚Äúred‚Äù))</p>
<h1 id="set-up-some-mapping-options">Set up some mapping options</h1>
<p>map_options &lt;- list(
  scope = ‚Äòusa‚Äô,
  projection = list(type = ‚Äòalbers usa‚Äô),
  showlakes = TRUE,
  lakecolor = toRGB(‚Äòwhite‚Äô)
)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Choropleth Maps: Mapping

```{r, eval=FALSE}
plot_ly(z = ~state_pop$Pop, text = ~state_pop$hover, locations = ~state_pop$State, 
        type = 'choropleth', locationmode = 'USA-states', 
        color = state_pop$Pop, colors = 'Blues', marker = list(line = borders)) %&gt;%
  layout(title = 'US Population in 1975', geo = map_options)
</code></pre></div></div>

<h3 id="choropleth-maps">Choropleth Maps</h3>

<p>```{r, echo=FALSE, message=FALSE}</p>
<h1 id="create-data-frame-1">Create data frame</h1>
<p>state_pop &lt;- data.frame(State = state.abb, Pop = as.vector(state.x77[,1]))</p>
<h1 id="create-hover-text-1">Create hover text</h1>
<p>state_pop$hover &lt;- with(state_pop, paste(State, ‚Äò<br />‚Äô, ‚ÄúPopulation:‚Äù, Pop))</p>
<h1 id="make-state-borders-white-1">Make state borders white</h1>
<p>borders &lt;- list(color = toRGB(‚Äúred‚Äù))</p>
<h1 id="set-up-some-mapping-options-1">Set up some mapping options</h1>
<p>map_options &lt;- list(
  scope = ‚Äòusa‚Äô,
  projection = list(type = ‚Äòalbers usa‚Äô),
  showlakes = TRUE,
  lakecolor = toRGB(‚Äòwhite‚Äô)
)
plot_ly(z = ~state_pop$Pop, text = ~state_pop$hover, locations = ~state_pop$State, 
        type = ‚Äòchoropleth‚Äô, locationmode = ‚ÄòUSA-states‚Äô, 
        color = state_pop$Pop, colors = ‚ÄòBlues‚Äô, marker = list(line = borders)) %&gt;%
  layout(title = ‚ÄòUS Population in 1975‚Äô, geo = map_options)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### More Resources

- [The Plolty Website](https://plot.ly/)
- [The Plotly R API](https://plot.ly/r/)
- [The Plotly R Package on GitHub](https://github.com/ropensci/plotly)
- [The Plotly R Cheatsheet](https://images.plot.ly/plotly-documentation/images/r_cheat_sheet.pdf)
- ["Plotly for R" book by Carson Sievert](https://cpsievert.github.io/plotly_book/)


## R_markdown (c9-w2)
### Introduction

R Markdown is built into RStudio and allows you to create documents like HTML, PDF, and Word documents from R. With R Markdown, you can embed R code into your documents. 

#### Why use R Markdown?
- Turn work in R into more accessible formats
- Incorporate R code and R plots into documents
- R Markdown documents are reproducible -- the source code gets rerun every time a document is generated, so if data change or source code changes, the output in the document will change with it. 

### Getting Started

- Create a new R Markdown file in RStudio by going to  
File &gt; New File &gt; R Markdown...
- Click the "presentation" tab
- Enter a title, author, and select what kind of slideshow you ultimately want (this can all be changed later)

### Getting Started
The beginning of an R Markdown file looks like this:&lt;br&gt;&lt;br&gt;
`---`  
`title: "Air Quality"`  
`author: "JHU"`  
`date: "May 17, 2016"`  
`output: html_document`  
`---`&lt;br&gt;&lt;br&gt;
The new document you've created will contain example text and code below this -- delete it for a fresh start.

### Making Your First Slide
- Title your first slide using two # signs: &lt;br&gt; `## Insert Title Here`
- To make a slide without a title, use three asterisks:&lt;br&gt; `***`
- You can add subheadings with more # signs: &lt;br&gt;
`### Subheading` or `#### Smaller Subheading`
- To add a new slide, just add another Title: &lt;br&gt; `## New Slide Title`

### Adding Text
- Add bullet points to a slide using a hyphen followed by a space: &lt;br&gt;
`- bullet point`
- Add sub-points using four spaces and a plus sign:&lt;br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`+ sub-point`
- Add an ordered list by typing the number/letter: &lt;br&gt;
`1. first point`&lt;br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`a) sub-sub-point`
- Add bullet points that appear one by one (on click) with:&lt;br&gt;
`&gt;- iterated bullet point`

### Formatting Text
              Text                               Code in R Markdown
----------------------------------    ----------------------------------------
           plain text                              `plain text`  
           *italics*                               `*italics*`  
           **bold**                                `**bold**` 
  [link](http://www.jhsph.edu)          `[link](http://www.jhsph.edu)`  
          `verbatim code`                          ` `code here` `
 
### Embedding R Code
This is a chunk of R code in R Markdown:&lt;br&gt;&lt;br&gt;
\`\`\`{r} &lt;br&gt;
`head(airquality)`&lt;br&gt;
\`\`\`  
The code gets run, and both the input and output are displayed.
```{r}
head(airquality)
</code></pre></div></div>

<h3 id="embedding-r-code">Embedding R Code</h3>
<p>To hide the input code, use <code class="language-plaintext highlighter-rouge">echo=FALSE</code>.<br /><br />
```{r, echo=FALSE} <br />
<code class="language-plaintext highlighter-rouge">head(airquality)</code><br />
```
```{r, echo=FALSE}
head(airquality)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This can be useful for showing plots.

### Embedding R Code
To show the input code only, use `eval=FALSE`.&lt;br&gt;&lt;br&gt;
\`\`\`{r, eval=FALSE} &lt;br&gt;
`head(airquality)`&lt;br&gt;
\`\`\` 
```{r, eval=FALSE}
head(airquality)
</code></pre></div></div>

<h3 id="embedding-r-code-1">Embedding R Code</h3>
<p>To run the code without showing input or output, use <code class="language-plaintext highlighter-rouge">include=FALSE</code>. <br /><br />
```{r, include=FALSE} <br />
<code class="language-plaintext highlighter-rouge">library(ggplot2)</code><br />
```</p>

<h3 id="generating-slideshows">Generating Slideshows</h3>
<ul>
  <li>Click the <strong>Knit</strong> button at the top of the R Markdown document to generate your new document.
    <ul>
      <li>You may be asked to install required packages if you don‚Äôt already have them installed ‚Äì hit ‚ÄúYes‚Äù and RStudio will install them for you</li>
    </ul>
  </li>
  <li>You can change the type of document generated by changing the <code class="language-plaintext highlighter-rouge">output</code> line in the header, or by selecting an output from the <strong>Knit</strong> button‚Äôs pull-down menu.</li>
</ul>

<h3 id="generating-slideshows-1">Generating Slideshows</h3>
<ul>
  <li>HTML: two options with different looks
    <ul>
      <li><code class="language-plaintext highlighter-rouge">output: ioslides_presentation</code> This is available in my emacs
knitr framework</li>
      <li><code class="language-plaintext highlighter-rouge">output: slidy_presentation</code></li>
    </ul>
  </li>
  <li>PDF: <code class="language-plaintext highlighter-rouge">output: beamer_presentation</code></li>
  <li>Note: You can specify multiple outputs at the beginning of the R Markdown file if you will need to generate multiple filetypes.</li>
</ul>

<h3 id="pdfs-and-latex">PDFs and LaTeX</h3>
<ul>
  <li>To <strong>knit</strong> a PDF slideshow, you will need to install <strong>LaTeX</strong> on your computer</li>
  <li>LaTeX is a typesetting system that is needed to convert R Markdown into formatted text for PDFs</li>
</ul>

<h4 id="downloading-and-installing-latex">Downloading and Installing LaTeX</h4>
<ul>
  <li><em>LaTeX</em> is free</li>
  <li>LaTeX takes up a lot of space (almost ~2.6 GB download and takes up ~5 GB when installed)</li>
  <li>Visit <a href="https://www.tug.org/begin.html">https://www.tug.org/begin.html</a> to download LaTeX for your operating system</li>
  <li>Depending on your internet connection, it may take a while to download due to its size</li>
</ul>

<h3 id="conclusion-1">Conclusion</h3>

<p>For more information about R Markdown visit http://rmarkdown.rstudio.com/</p>
<h2 id="leaflet-c9-w2">leaflet (c9-w2)</h2>
<h3 id="introduction-1">Introduction</h3>

<p>Leaflet is one of the most popular Javascript libraries for
creating interactive maps. The leaflet R package allows you
to create your own leaflet maps without needing to know any
Javascript!</p>

<h4 id="installation">Installation</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"leaflet"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="your-first-map">Your First Map</h3>

<p>Getting started with leaflet is easy. The <code class="language-plaintext highlighter-rouge">leaflet()</code>
function creates a map widget that you can store in a
variable so that you can modify the map later on. You can
add features to the map using the pipe operator (<code class="language-plaintext highlighter-rouge">%&gt;%</code>) just
like in dplyr. The <code class="language-plaintext highlighter-rouge">addTiles()</code> function adds mapping data
from <a href="http://www.openstreetmap.org/">Open Street Map</a>.</p>

<p>```{r, eval=FALSE}
library(leaflet)
my_map &lt;- leaflet() %&gt;% 
  addTiles()
my_map</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Your First Map

```{r, echo=FALSE}
library(leaflet)
my_map &lt;- leaflet() %&gt;% 
  addTiles()
my_map
</code></pre></div></div>

<h3 id="adding-markers">Adding Markers</h3>

<p>You can add markers to your map one at a time using the
<code class="language-plaintext highlighter-rouge">addMarkers()</code> function by specifying the longitude and
latitude. (<a href="https://twitter.com/drob/status/719927537330040832">Here‚Äôs</a>
a tip if you tend to mix them up.) You can specify popup
text for when you click on the marker with the <code class="language-plaintext highlighter-rouge">popup</code> 
argument.</p>

<p>```{r, eval=FALSE}
library(leaflet)
my_map &lt;- my_map %&gt;%
  addMarkers(lat=39.2980803, lng=-76.5898801, 
             popup=‚ÄùJeff Leek‚Äôs Office‚Äù)
my_map</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Adding Markers

```{r, echo=FALSE}
library(leaflet)
my_map &lt;- my_map %&gt;%
  addMarkers(lat=39.2980803, lng=-76.5898801, 
             popup="Jeff Leek's Office")
my_map
</code></pre></div></div>

<h3 id="adding-many-markers">Adding Many Markers</h3>

<p>Adding one marker at a time is often not practical if you
want to display many markers. If you have a data frame with
columns <code class="language-plaintext highlighter-rouge">lat</code> and <code class="language-plaintext highlighter-rouge">lng</code> you can pipe that data frame into
<code class="language-plaintext highlighter-rouge">leaflet()</code> to add all the points at once.</p>

<p>```{r, eval=FALSE}
set.seed(2016-04-25)
df &lt;- data.frame(lat = runif(20, min = 39.2, max = 39.3),
                 lng = runif(20, min = -76.6, max = -76.5))
df %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers()</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Adding Many Markers

```{r, echo=FALSE}
set.seed(2016-04-25)
df &lt;- data.frame(lat = runif(20, min = 39.2, max = 39.3),
                 lng = runif(20, min = -76.6, max = -76.5))
df %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers()
</code></pre></div></div>

<h3 id="making-custom-markers">Making Custom Markers</h3>

<p>The blue markers that leaflet comes packaged with may not be
enough depending on what you‚Äôre mapping. Thankfully you can
make your own markers from <code class="language-plaintext highlighter-rouge">.png</code> files.</p>

<p>```{r, eval=FALSE}
hopkinsIcon &lt;- makeIcon(
  iconUrl = ‚Äúhttp://brand.jhu.edu/content/uploads/2014/06/university.shield.small_.blue_.png‚Äù,
  iconWidth = 31<em>215/230, iconHeight = 31,
  iconAnchorX = 31</em>215/230/2, iconAnchorY = 16
)
hopkinsLatLong &lt;- data.frame(
  lat = c(39.2973166, 39.3288851, 39.2906617),
  lng = c(-76.5929798, -76.6206598, -76.5469683))
hopkinsLatLong %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers(icon = hopkinsIcon)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Making Custom Markers

```{r, echo=FALSE}
hopkinsIcon &lt;- makeIcon(
  iconUrl = "http://brand.jhu.edu/content/uploads/2014/06/university.shield.small_.blue_.png",
  iconWidth = 31*215/230, iconHeight = 31,
  iconAnchorX = 31*215/230/2, iconAnchorY = 16
)
hopkinsLatLong &lt;- data.frame(
  lat = c(39.2973166, 39.3288851, 39.2906617, 39.2970681, 39.2824806),
  lng = c(-76.5929798, -76.6206598, -76.5469683, -76.6150537, -76.6016766))
hopkinsLatLong %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers(icon = hopkinsIcon)
</code></pre></div></div>

<h3 id="adding-multiple-popups">Adding Multiple Popups</h3>

<p>When adding multiple markers to a map, you may want to add
popups for each marker. You can specify a string of plain
text for each popup, or you can provide HTML which will be
rendered inside of each popup.</p>

<p>```{r, eval=FALSE}
hopkinsSites &lt;- c(
  ‚Äú<a href="http://www.jhsph.edu/">East Baltimore Campus</a>‚Äù,
  ‚Äú<a href="https://apply.jhu.edu/visit/homewood/">Homewood Campus</a>‚Äù,
  ‚Äú<a href="http://www.hopkinsmedicine.org/johns_hopkins_bayview/">Bayview Medical Center</a>‚Äù,
  ‚Äú<a href="http://www.peabody.jhu.edu/">Peabody Institute</a>‚Äù,
  ‚Äú<a href="http://carey.jhu.edu/">Carey Business School</a>‚Äù
)
hopkinsLatLong %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers(icon = hopkinsIcon, popup = hopkinsSites)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Adding Multiple Popups

```{r, echo=FALSE}
hopkinsSites &lt;- c(
  "&lt;a href='http://www.jhsph.edu/'&gt;East Baltimore Campus&lt;/a&gt;",
  "&lt;a href='https://apply.jhu.edu/visit/homewood/'&gt;Homewood Campus&lt;/a&gt;",
  "&lt;a href='http://www.hopkinsmedicine.org/johns_hopkins_bayview/'&gt;Bayview Medical Center&lt;/a&gt;",
  "&lt;a href='http://www.peabody.jhu.edu/'&gt;Peabody Institute&lt;/a&gt;",
  "&lt;a href='http://carey.jhu.edu/'&gt;Carey Business School&lt;/a&gt;"
)
hopkinsLatLong %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers(icon = hopkinsIcon, popup = hopkinsSites)
</code></pre></div></div>

<h3 id="mapping-clusters">Mapping Clusters</h3>

<p>Sometimes you might have so many points on a map that it
doesn‚Äôt make sense to plot every marker. In these situations
leaflet allows you to plot clusters of markers using
<code class="language-plaintext highlighter-rouge">addMarkers(clusterOptions = markerClusterOptions())</code>. When
you zoom in to each cluster, the clusters will separate until
you can see the individual markers.</p>

<p>```{r, eval=FALSE}
df &lt;- data.frame(lat = runif(500, min = 39.25, max = 39.35),
                 lng = runif(500, min = -76.65, max = -76.55))
df %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers(clusterOptions = markerClusterOptions())</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Mapping Clusters

```{r, echo=FALSE}
df &lt;- data.frame(lat = runif(500, min = 39.25, max = 39.35),
                 lng = runif(500, min = -76.65, max = -76.55))
df %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers(clusterOptions = markerClusterOptions())
</code></pre></div></div>

<h3 id="mapping-circle-markers">Mapping Circle Markers</h3>

<p>Instead of adding markers or clusters you can easily add
circle markers using <code class="language-plaintext highlighter-rouge">addCircleMarkers()</code>.</p>

<p>```{r, eval=FALSE}
df &lt;- data.frame(lat = runif(20, min = 39.25, max = 39.35),
                 lng = runif(20, min = -76.65, max = -76.55))
df %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addCircleMarkers()</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Mapping Circle Markers

```{r, echo=FALSE}
df &lt;- data.frame(lat = runif(20, min = 39.25, max = 39.35),
                 lng = runif(20, min = -76.65, max = -76.55))
df %&gt;% 
  leaflet() %&gt;%
  addTiles() %&gt;%
  addCircleMarkers()
</code></pre></div></div>

<h3 id="drawing-circles">Drawing Circles</h3>

<p>You can draw arbitrary shapes on the maps you create,
including circles and squares. The code below draws a map
where the circle on each city is proportional to the
population of that city.</p>

<p>```{r, eval=FALSE}
md_cities &lt;- data.frame(name = c(‚ÄúBaltimore‚Äù, ‚ÄúFrederick‚Äù, ‚ÄúRockville‚Äù, ‚ÄúGaithersburg‚Äù, 
                                 ‚ÄúBowie‚Äù, ‚ÄúHagerstown‚Äù, ‚ÄúAnnapolis‚Äù, ‚ÄúCollege Park‚Äù, ‚ÄúSalisbury‚Äù, ‚ÄúLaurel‚Äù),
                        pop = c(619493, 66169, 62334, 61045, 55232,
                                39890, 38880, 30587, 30484, 25346),
                        lat = c(39.2920592, 39.4143921, 39.0840, 39.1434, 39.0068, 39.6418, 38.9784, 38.9897, 38.3607, 39.0993),
                        lng = c(-76.6077852, -77.4204875, -77.1528, -77.2014, -76.7791, -77.7200, -76.4922, -76.9378, -75.5994, -76.8483))
md_cities %&gt;%
  leaflet() %&gt;%
  addTiles() %&gt;%
  addCircles(weight = 1, radius = sqrt(md_cities$pop) * 30)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Drawing Circles

```{r, echo=FALSE}
md_cities &lt;- data.frame(name = c("Baltimore", "Frederick", "Rockville", "Gaithersburg", 
                                 "Bowie", "Hagerstown", "Annapolis", "College Park", "Salisbury", "Laurel"),
                        pop = c(619493, 66169, 62334, 61045, 55232,
                                39890, 38880, 30587, 30484, 25346),
                        lat = c(39.2920592, 39.4143921, 39.0840, 39.1434, 39.0068, 39.6418, 38.9784, 38.9897, 38.3607, 39.0993),
                        lng = c(-76.6077852, -77.4204875, -77.1528, -77.2014, -76.7791, -77.7200, -76.4922, -76.9378, -75.5994, -76.8483))
md_cities %&gt;%
  leaflet() %&gt;%
  addTiles() %&gt;%
  addCircles(weight = 1, radius = sqrt(md_cities$pop) * 30)
</code></pre></div></div>

<h3 id="drawing-rectangles">Drawing Rectangles</h3>

<p>You can add rectangles on leaflet maps as well:</p>

<p>```{r, eval=FALSE}
leaflet() %&gt;%
  addTiles() %&gt;%
  addRectangles(lat1 = 37.3858, lng1 = -122.0595, 
                lat2 = 37.3890, lng2 = -122.0625)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Drawing Rectangles

```{r, echo=FALSE}
leaflet() %&gt;%
  addTiles() %&gt;%
  addRectangles(lat1 = 37.3858, lng1 = -122.0595, 
                lat2 = 37.3890, lng2 = -122.0625)
</code></pre></div></div>

<h3 id="adding-legends">Adding Legends</h3>

<p>Adding a legend can be useful if you have markers on your
map with different colors:</p>

<p>```{r, eval=FALSE}
df &lt;- data.frame(lat = runif(20, min = 39.25, max = 39.35),
                 lng = runif(20, min = -76.65, max = -76.55),
                 col = sample(c(‚Äúred‚Äù, ‚Äúblue‚Äù, ‚Äúgreen‚Äù), 20, replace = TRUE),
                 stringsAsFactors = FALSE)
df %&gt;%
  leaflet() %&gt;%
  addTiles() %&gt;%
  addCircleMarkers(color = df$col) %&gt;%
  addLegend(labels = LETTERS[1:3], colors = c(‚Äúblue‚Äù, ‚Äúred‚Äù, ‚Äúgreen‚Äù))</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Adding Legends

```{r, echo=FALSE, message=FALSE}
df &lt;- data.frame(lat = runif(20, min = 39.25, max = 39.35),
                 lng = runif(20, min = -76.65, max = -76.55),
                 col = sample(c("red", "blue", "green"), 20, replace = TRUE),
                 stringsAsFactors = FALSE)
df %&gt;%
  leaflet() %&gt;%
  addTiles() %&gt;%
  addCircleMarkers(color = df$col) %&gt;%
  addLegend(labels = LETTERS[1:3], colors = c("blue", "red", "green"))
</code></pre></div></div>

<h3 id="conclusion-2">Conclusion</h3>

<p>For more details about the leaflet package for R 
visit http://rstudio.github.io/leaflet/.</p>
<h2 id="assignment-2-c9-w2">Assignment 2, c9-w2</h2>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">knitr</span><span class="w"> </span><span class="n">yaml</span><span class="o">!</span><span class="w">

</span><span class="o">---</span><span class="w">

</span><span class="n">title</span><span class="o">:</span><span class="w"> </span><span class="s2">"Rmarkdown with Maps"</span><span class="w">
</span><span class="n">date</span><span class="o">:</span><span class="w"> </span><span class="s2">"June 6, 2019"</span><span class="w">
</span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="n">html</span><span class="w">

</span><span class="o">---</span><span class="w">


</span></code></pre></div></div>

<p>```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, message=F, warning=F, cache=T)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

### Maps: Library and Station and TU Delft building of my City

```{r, echo=F }
library(leaflet)

df &lt;- data.frame(lat = c(52.002901,52.007517,51.990961), lng = 
c( 4.375342, 4.357094,4.375575),
popup=c("library","station","aerospace building"),col=c("red","green","black"),stringsAsFactors = FALSE)
df %&gt;% leaflet() %&gt;% addTiles() %&gt;% addCircleMarkers(color=df$col) %&gt;%
    addLegend(labels=c("library","station","Aerospace building"),colors=c("red","green","black"))

</code></pre></div></div>

<h2 id="rpackages-c9-">Rpackages (c9-)</h2>
<h3 id="what-is-an-r-package">What is an R Package?</h3>

<ul>
  <li>A mechanism for extending the basic functionality of R</li>
  <li>A collection of R functions, or other (data) objects</li>
  <li>Organized in a systematic fashion to provide a minimal amount of consistency</li>
  <li>Written by users/developers everywhere</li>
</ul>

<h3 id="where-are-these-r-packages">Where are These R Packages?</h3>

<ul>
  <li>
    <p>Primarily available from CRAN and Bioconductor</p>
  </li>
  <li>
    <p>Also available from GitHub, Bitbucket, Gitorious, etc. (and elsewhere)</p>
  </li>
  <li>
    <p>Packages from CRAN/Bioconductor can be installed with <code class="language-plaintext highlighter-rouge">install.packages()</code></p>
  </li>
  <li>
    <p>Packages from GitHub can be installed using <code class="language-plaintext highlighter-rouge">install_github()</code> from
the <b>devtools</b> package</p>
  </li>
</ul>

<p>You do not have to put a package on a central repository, but doing so
makes it easier for others to install your package.</p>

<h3 id="whats-the-point">What‚Äôs the Point?</h3>

<ul>
  <li>‚ÄúWhy not just make some code available?‚Äù</li>
  <li>Documentation / vignettes</li>
  <li>Centralized resources like CRAN</li>
  <li>Minimal standards for reliability and robustness</li>
  <li>Maintainability / extension</li>
  <li>Interface definition / clear API</li>
  <li>Users know that it will at least load properly</li>
</ul>

<h3 id="package-development-process">Package Development Process</h3>

<ul>
  <li>Write some code in an R script file (.R)</li>
  <li>Want to make code available to others</li>
  <li>Incorporate R script file into R package structure</li>
  <li>Write documentation for user functions</li>
  <li>Include some other material (examples, demos, datasets, tutorials)</li>
  <li>Package it up!</li>
</ul>

<h3 id="package-development-process-1">Package Development Process</h3>

<ul>
  <li>Submit package to CRAN or Bioconductor</li>
  <li>Push source code repository to GitHub or other source code sharing web site</li>
  <li>People find all kinds of problems with your code
    <ul>
      <li>Scenario #1: They tell you about those problems and expect you to fix it</li>
      <li>Scenario #2: They fix the problem for you and show you the changes</li>
    </ul>
  </li>
  <li>You incorporate the changes and release a new version</li>
</ul>

<h3 id="r-package-essentials">R Package Essentials</h3>

<ul>
  <li>An R package is started by creating a directory with the name of the R package</li>
  <li>A DESCRIPTION file which has info about the package</li>
  <li>R code! (in the R/ sub-directory)</li>
  <li>Documentation (in the man/ sub-directory)</li>
  <li>NAMESPACE</li>
  <li>Full requirements in Writing R Extensions</li>
</ul>

<h3 id="the-description-file">The DESCRIPTION File</h3>

<ul>
  <li><b>Package</b>: Name of package (e.g. library(name))</li>
  <li><b>Title</b>: Full name of package</li>
  <li><b>Description</b>: Longer description of package in one sentence (usually)</li>
  <li><b>Version</b>: Version number (usually M.m-p format)</li>
  <li><b>Author</b>, <b>Authors@R</b>: Name of the original author(s)</li>
  <li><b>Maintainer</b>: Name + email of person who fixes problems</li>
  <li><b>License</b>: License for the source code</li>
</ul>

<h3 id="the-description-file-1">The DESCRIPTION File</h3>

<p>These fields are optional but commonly used</p>

<ul>
  <li><b>Depends</b>: R packages that your package depends on</li>
  <li><b>Suggests</b>: Optional R packages that users may want to have installed</li>
  <li><b>Date</b>: Release date in YYYY-MM-DD format</li>
  <li><b>URL</b>: Package home page</li>
  <li><b>Other</b> fields can be added</li>
</ul>

<h3 id="description-file-gpclib">DESCRIPTION File: <code class="language-plaintext highlighter-rouge">gpclib</code></h3>

<p><b>Package</b>:  gpclib<br />
<b>Title</b>:  General Polygon Clipping Library for R<br />
<b>Description</b>:  General polygon clipping routines for R based on Alan Murta‚Äôs C library.<br />
<b>Version</b>:  1.5-5<br />
<b>Author</b>:  Roger D. Peng <a href="mailto:rpeng@jhsph.edu">rpeng@jhsph.edu</a> with contributions from Duncan Murdoch and Barry Rowlingson; GPC library by Alan Murta<br />
<b>Maintainer</b>:  Roger D. Peng <a href="mailto:rpeng@jhsph.edu">rpeng@jhsph.edu</a><br />
<b>License</b>:  file LICENSE<br />
<b>Depends</b>:  R (&gt;= 2.14.0), methods<br />
<b>Imports</b>:  graphics<br />
<b>Date</b>:  2013-04-01<br />
<b>URL</b>:  http://www.cs.man.ac.uk/~toby/gpc/, http://github.com/rdpeng/gpclib</p>

<h3 id="r-code-1">R Code</h3>

<ul>
  <li>Copy R code into the R/ sub-directory</li>
  <li>There can be any number of files in this directory</li>
  <li>Usually separate out files into logical groups</li>
  <li>Code for all functions should be included here and not anywhere else in the package</li>
</ul>

<h3 id="the-namespace-file">The NAMESPACE File</h3>

<ul>
  <li>Used to indicate which functions are <b>exported</b></li>
  <li>Exported functions can be called by the user and are considered the public API</li>
  <li>Non-exported functions cannot be called directly by the user (but the code can be viewed)</li>
  <li>Hides implementation details from users and makes a cleaner package interface</li>
</ul>

<h3 id="the-namespace-file-1">The NAMESPACE File</h3>

<ul>
  <li>You can also indicate what functions you <b>import</b> from other packages</li>
  <li>This allows for your package to use other packages without making other packages visible to the user</li>
  <li>Importing a function loads the package but does not attach it to the search list</li>
</ul>

<h3 id="the-namespace-file-2">The NAMESPACE File</h3>

<p>Key directives</p>

<ul>
  <li>export(‚Äú&lt;function&gt;‚Äù)</li>
  <li>import(‚Äú&lt;package&gt;‚Äù)</li>
  <li>importFrom(‚Äú&lt;package&gt;‚Äù, ‚Äú&lt;function&gt;‚Äù)</li>
</ul>

<p>Also important</p>

<ul>
  <li>exportClasses(‚Äú&lt;class&gt;‚Äù)</li>
  <li>exportMethods(‚Äú&lt;generic&gt;‚Äù)</li>
</ul>

<h3 id="namespace-file-mvtsplot-package">NAMESPACE File: <code class="language-plaintext highlighter-rouge">mvtsplot</code> package</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">export</span><span class="p">(</span><span class="s2">"mvtsplot"</span><span class="p">)</span><span class="w">
</span><span class="n">import</span><span class="p">(</span><span class="n">splines</span><span class="p">)</span><span class="w">
</span><span class="n">import</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">
</span><span class="n">importFrom</span><span class="p">(</span><span class="s2">"grDevices"</span><span class="p">,</span><span class="w"> </span><span class="s2">"colorRampPalette"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gray"</span><span class="p">)</span><span class="w">
</span><span class="n">importFrom</span><span class="p">(</span><span class="s2">"graphics"</span><span class="p">,</span><span class="w"> </span><span class="s2">"abline"</span><span class="p">,</span><span class="w"> </span><span class="s2">"axis"</span><span class="p">,</span><span class="w"> </span><span class="s2">"box"</span><span class="p">,</span><span class="w"> </span><span class="s2">"image"</span><span class="p">,</span><span class="w"> 
           </span><span class="s2">"layout"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lines"</span><span class="p">,</span><span class="w"> </span><span class="s2">"par"</span><span class="p">,</span><span class="w"> </span><span class="s2">"plot"</span><span class="p">,</span><span class="w"> </span><span class="s2">"points"</span><span class="p">,</span><span class="w"> 
           </span><span class="s2">"segments"</span><span class="p">,</span><span class="w"> </span><span class="s2">"strwidth"</span><span class="p">,</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Axis"</span><span class="p">)</span><span class="w">
</span><span class="n">importFrom</span><span class="p">(</span><span class="s2">"stats"</span><span class="p">,</span><span class="w"> </span><span class="s2">"complete.cases"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na.exclude"</span><span class="p">,</span><span class="w"> 
           </span><span class="s2">"predict"</span><span class="p">,</span><span class="w"> </span><span class="s2">"quantile"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="namespace-file-gpclib-package">NAMESPACE File: <code class="language-plaintext highlighter-rouge">gpclib</code> package</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">export</span><span class="p">(</span><span class="s2">"read.polyfile"</span><span class="p">,</span><span class="w"> </span><span class="s2">"write.polyfile"</span><span class="p">)</span><span class="w">
</span><span class="n">importFrom</span><span class="p">(</span><span class="n">graphics</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">)</span><span class="w">
</span><span class="n">exportClasses</span><span class="p">(</span><span class="s2">"gpc.poly"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gpc.poly.nohole"</span><span class="p">)</span><span class="w">
</span><span class="n">exportMethods</span><span class="p">(</span><span class="s2">"show"</span><span class="p">,</span><span class="w"> </span><span class="s2">"get.bbox"</span><span class="p">,</span><span class="w"> </span><span class="s2">"plot"</span><span class="p">,</span><span class="w"> </span><span class="s2">"intersect"</span><span class="p">,</span><span class="w"> </span><span class="s2">"union"</span><span class="p">,</span><span class="w"> 
              </span><span class="s2">"setdiff"</span><span class="p">,</span><span class="w"> </span><span class="s2">"["</span><span class="p">,</span><span class="w"> </span><span class="s2">"append.poly"</span><span class="p">,</span><span class="w"> </span><span class="s2">"scale.poly"</span><span class="p">,</span><span class="w"> 
              </span><span class="s2">"area.poly"</span><span class="p">,</span><span class="w"> </span><span class="s2">"get.pts"</span><span class="p">,</span><span class="w"> </span><span class="s2">"coerce"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tristrip"</span><span class="p">,</span><span class="w"> 
              </span><span class="s2">"triangulate"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="documentation">Documentation</h3>

<ul>
  <li>Documentation files (.Rd) placed in man/ sub-directory</li>
  <li>Written in a specific markup language</li>
  <li>Required for every exported function
    <ul>
      <li>Another reason to limit exported functions</li>
    </ul>
  </li>
  <li>You can document other things like concepts, package overview</li>
</ul>

<h3 id="help-file-example-line-function">Help File Example: <code class="language-plaintext highlighter-rouge">line</code> Function</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\name{line}
\alias{line}
\alias{residuals.tukeyline}
\title{Robust Line Fitting}
\description{
  Fit a line robustly as recommended in \emph{Exploratory Data Analysis}.
}
</code></pre></div></div>

<h3 id="help-file-example-line-function-1">Help File Example: <code class="language-plaintext highlighter-rouge">line</code> Function</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\usage{
line(x, y)
}
\arguments{
  \item{x, y}{the arguments can be any way of specifying x-y pairs.  See
    \code{\link{xy.coords}}.}
}
</code></pre></div></div>

<h3 id="help-file-example-line-function-2">Help File Example: <code class="language-plaintext highlighter-rouge">line</code> Function</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\details{
  Cases with missing values are omitted.
  Long vectors are not supported.
}
\value{
  An object of class \code{"tukeyline"}.
  Methods are available for the generic functions \code{coef},
  \code{residuals}, \code{fitted}, and \code{print}.
}
</code></pre></div></div>

<h3 id="help-file-example-line-function-3">Help File Example: <code class="language-plaintext highlighter-rouge">line</code> Function</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\references{
  Tukey, J. W. (1977).
  \emph{Exploratory Data Analysis},
  Reading Massachusetts: Addison-Wesley.
}
</code></pre></div></div>

<h3 id="building-and-checking">Building and Checking</h3>

<ul>
  <li>
    <p>R CMD build is a command-line program that creates a package archive
file (<code class="language-plaintext highlighter-rouge">.tar.gz</code>)</p>
  </li>
  <li>
    <p>R CMD check runs a battery of tests on the package</p>
  </li>
  <li>
    <p>You can run R CMD build or R CMD check from the command-line using a
terminal or command-shell application</p>
  </li>
  <li>
    <p>You can also run them from R using the system() function</p>
  </li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">system</span><span class="p">(</span><span class="s2">"R CMD build newpackage"</span><span class="p">)</span><span class="w">
</span><span class="n">system</span><span class="p">(</span><span class="s2">"R CMD check newpackage"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="checking">Checking</h3>

<ul>
  <li>R CMD check runs a battery tests</li>
  <li>Documentation exists</li>
  <li>Code can be loaded, no major coding problems or errors</li>
  <li>Run examples in documentation</li>
  <li>Check docs match code</li>
  <li>All tests must pass to put package on CRAN</li>
</ul>

<h3 id="getting-started">Getting Started</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">package.skeleton()</code> function in the utils package creates a ‚Äúskeleton‚Äù R package</li>
  <li>Directory structure (R/, man/), DESCRIPTION file, NAMESPACE file, documentation files</li>
  <li>If there are functions visible in your workspace, it writes R code files to the R/ directory</li>
  <li>Documentation stubs are created in man/</li>
  <li>You need to fill in the rest!</li>
</ul>

<h3 id="summary-11">Summary</h3>

<ul>
  <li>R packages provide a systematic way to make R code available to others</li>
  <li>Standards ensure that packages have a minimal amount of documentation and robustness</li>
  <li>Obtained from CRAN, Bioconductor, Github, etc.</li>
</ul>

<h3 id="summary-12">Summary</h3>

<ul>
  <li>Create a new directory with R/ and man/ sub-directories (or just use package.skeleton())</li>
  <li>Write a DESCRIPTION file</li>
  <li>Copy R code into the R/ sub-directory</li>
  <li>Write documentation files in man/ sub-directory</li>
  <li>Write a NAMESPACE file with exports/imports</li>
  <li>Build and check</li>
</ul>

<h3 id="agent">Agent</h3>

<p>There is a lecture demo on making R package! in week 3 of course 9
:https://www.coursera.org/learn/data-products/lecture/t8FX1/building-r-packages-demo</p>

<p>2 things that they do with rstudio and needs an alternative in emacs
is : building documentation and checking code worthiness for cran and
loading a package! We can figure it out later as needed!</p>

<h2 id="classes-and-methods-c9-w1">Classes and Methods (c9-w1)</h2>
<h3 id="classes-and-methods">Classes and Methods</h3>

<ul>
  <li>A system for doing object oriented programming</li>
  <li>R was originally quite interesting because it is both interactive <em>and</em> has a system for object orientation.
    <ul>
      <li>Other languages which support OOP (C++, Java, Lisp, Python, Perl) generally speaking are not interactive languages</li>
    </ul>
  </li>
</ul>

<h3 id="classes-and-methods-1">Classes and Methods</h3>

<ul>
  <li>In R much of the code for supporting classes/methods is written by John Chambers himself (the creator of the original S language) and documented in the book <em>Programming with Data: A Guide to the S Language</em></li>
  <li>A natural extension of Chambers‚Äô idea of allowing someone to cross the user -&gt; programmer spectrum</li>
  <li>Object oriented programming is a bit different in R than it is in most languages - even if you are familiar with the idea, you may want to pay attention to the details</li>
</ul>

<h3 id="two-styles-of-classes-and-methods">Two styles of classes and methods</h3>

<p>S3 classes/methods</p>
<ul>
  <li>Included with version 3 of the S language.</li>
  <li>Informal, a little kludgey</li>
  <li>Sometimes called <em>old-style</em> classes/methods</li>
</ul>

<p>S4 classes/methods</p>
<ul>
  <li>more formal and rigorous</li>
  <li>Included with S-PLUS 6 and R 1.4.0 (December 2001)</li>
  <li>Also called <em>new-style</em> classes/methods</li>
</ul>

<h3 id="two-worlds-living-side-by-side">Two worlds living side by side</h3>

<ul>
  <li>For now (and the forseeable future), S3 classes/methods and S4 classes/methods are separate systems (but they can be mixed to some degree).</li>
  <li>Each system can be used fairly independently of the other.</li>
  <li>Developers of new projects (you!) are encouraged to use the S4 style classes/methods.
    <ul>
      <li>Used extensively in the Bioconductor project</li>
    </ul>
  </li>
  <li>But many developers still use S3 classes/methods because they are ‚Äúquick and dirty‚Äù (and easier).</li>
  <li>In this lecture we will focus primarily on S4 classes/methods</li>
  <li>The code for implementing S4 classes/methods in R is in the <em>methods</em> package, which is usually loaded by default (but you can load it with <code class="language-plaintext highlighter-rouge">library(methods)</code> if for some reason it is not loaded)</li>
</ul>

<h3 id="object-oriented-programming-in-r">Object Oriented Programming in R</h3>

<ul>
  <li>A class is a description of a thing. A class can be defined using <code class="language-plaintext highlighter-rouge">setClass()</code> in the <em>methods</em> package.</li>
  <li>An <em>object</em> is an instance of a class. Objects can be created using <code class="language-plaintext highlighter-rouge">new()</code>.</li>
  <li>A <em>method</em> is a function that only operates on a certain class of objects.</li>
  <li>A generic function is an R function which dispatches methods. A generic function typically encapsulates a ‚Äúgeneric‚Äù concept (e.g. <code class="language-plaintext highlighter-rouge">plot</code>, <code class="language-plaintext highlighter-rouge">mean</code>, <code class="language-plaintext highlighter-rouge">predict</code>, ‚Ä¶)
    <ul>
      <li>The generic function does not actually do any computation.</li>
    </ul>
  </li>
  <li>A <em>method</em> is the implementation of a generic function for an object of a particular class.</li>
</ul>

<h3 id="things-to-look-up">Things to look up</h3>

<ul>
  <li>The help files for the ‚Äòmethods‚Äô package are extensive - do read them as they are the primary documentation</li>
  <li>You may want to start with <code class="language-plaintext highlighter-rouge">?Classes</code> and <code class="language-plaintext highlighter-rouge">?Methods</code></li>
  <li>Check out <code class="language-plaintext highlighter-rouge">?setClass</code>, <code class="language-plaintext highlighter-rouge">?setMethod</code>, and <code class="language-plaintext highlighter-rouge">?setGeneric</code></li>
  <li>Some of it gets technical, but try your best for now-it will make sense in the future as you keep using it.</li>
  <li>Most of the documentation in the <em>methods</em> package is oriented towards developers/programmers as these are the primary people using classes/methods</li>
</ul>

<h3 id="classes">Classes</h3>

<p>All objects in R have a class which can be determined by the class function</p>

<pre><code class="language-{r}">class(1)
class(TRUE)
</code></pre>

<h3 id="classes-1">Classes</h3>

<pre><code class="language-{r}">class(rnorm(100))
class(NA)
class("foo")
</code></pre>

<h3 id="classes-contd">Classes (cont‚Äôd)</h3>

<p>Data classes go beyond the atomic classes</p>

<pre><code class="language-{r}">x &lt;- rnorm(100)
y &lt;- x + rnorm(100)
fit &lt;- lm(y ~ x)  ## linear regression model
class(fit)
</code></pre>

<h3 id="genericsmethods-in-r">Generics/Methods in R</h3>

<ul>
  <li>S4 and S3 style generic functions look different but conceptually, they are the same (they play the same role).</li>
  <li>When you program you can write new methods for an existing generic OR create your own generics and associated methods.</li>
  <li>Of course, if a data type does not exist in R that matches your needs, you can always define a new class along with generics/methods that go with it.</li>
</ul>

<h3 id="an-s3-generic-function-in-the-base-package">An S3 generic function (in the ‚Äòbase‚Äô package)</h3>

<p>The <code class="language-plaintext highlighter-rouge">mean</code> and <code class="language-plaintext highlighter-rouge">print</code> functions are generic</p>
<pre><code class="language-{r}">mean
</code></pre>

<h3 id="an-s3-generic-function-in-the-base-package-1">An S3 generic function (in the ‚Äòbase‚Äô package)</h3>

<pre><code class="language-{r}">print
</code></pre>

<h3 id="s3-methods">S3 methods</h3>

<p>The <code class="language-plaintext highlighter-rouge">mean</code> generic function has a number of methods associated with it.</p>

<pre><code class="language-{r}">methods("mean")
</code></pre>

<h3 id="an-s4-generic-function">An S4 generic function</h3>

<p>The <code class="language-plaintext highlighter-rouge">show</code> function is from the <b>methods</b> package and is the S4
equivalent of <code class="language-plaintext highlighter-rouge">print</code></p>
<pre><code class="language-{r}">library(methods)
show
</code></pre>
<p>The <code class="language-plaintext highlighter-rouge">show</code> function is usually not called directly (much like <code class="language-plaintext highlighter-rouge">print</code>)
because objects are auto-printed.</p>

<h3 id="s4-methods">S4 methods</h3>

<pre><code class="language-{r}">showMethods("show")
</code></pre>

<h3 id="genericmethod-mechanism">Generic/method mechanism</h3>

<p>The first argument of a generic function is an object of a particular class (there may be other arguments)</p>

<ol>
  <li>The generic function checks the class of the object.</li>
  <li>A search is done to see if there is an appropriate method for that class.</li>
  <li>If there exists a method for that class, then that method is called on the object and we‚Äôre done.</li>
  <li>If a method for that class does not exist, a search is done to see if there is a default method for the generic. If a default exists, then the default method is called.</li>
  <li>If a default method doesn‚Äôt exist, then an error is thrown.</li>
</ol>

<h3 id="examining-code-for-methods">Examining Code for Methods</h3>

<ul>
  <li>You cannot just print the code for a method like other functions because the code for the method is usually hidden.</li>
  <li>If you want to see the code for an S3 method, you can use the function <code class="language-plaintext highlighter-rouge">getS3method</code>.</li>
  <li>The call is <code class="language-plaintext highlighter-rouge">getS3method(&lt;generic&gt;, &lt;class&gt;)</code></li>
  <li>For S4 methods you can use the function <code class="language-plaintext highlighter-rouge">getMethod</code></li>
  <li>The call is <code class="language-plaintext highlighter-rouge">getMethod(&lt;generic&gt;, &lt;signature&gt;)</code> (more details later)</li>
</ul>

<h3 id="s3-classmethod-example-1">S3 Class/Method: Example 1</h3>

<p>What‚Äôs happening here?</p>

<pre><code class="language-{r}">set.seed(2)
x &lt;- rnorm(100)
mean(x)
</code></pre>

<ol>
  <li>The class of x is ‚Äúnumeric‚Äù</li>
  <li>But there is no mean method for ‚Äúnumeric‚Äù objects!</li>
  <li>So we call the default function for <code class="language-plaintext highlighter-rouge">mean</code>.</li>
</ol>

<h3 id="s3-classmethod-example-1-1">S3 Class/Method: Example 1</h3>

<pre><code class="language-{r}">head(getS3method("mean", "default"), 10)
</code></pre>

<h3 id="s3-classmethod-example-1-2">S3 Class/Method: Example 1</h3>

<pre><code class="language-{r}">tail(getS3method("mean", "default"), 10)
</code></pre>

<h3 id="s3-classmethod-example-2">S3 Class/Method: Example 2</h3>

<p>What happens here?</p>

<pre><code class="language-{r}">set.seed(3)
df &lt;- data.frame(x = rnorm(100), y = 1:100)
sapply(df, mean)
</code></pre>

<h3 id="s3-classmethod-example-2-1">S3 Class/Method: Example 2</h3>

<ol>
  <li>
    <p>The class of <code class="language-plaintext highlighter-rouge">df</code> is ‚Äúdata.frame‚Äù; each column can be an object of
a different class</p>
  </li>
  <li>
    <p>We <code class="language-plaintext highlighter-rouge">sapply</code> over the columns and call the <code class="language-plaintext highlighter-rouge">mean</code> function</p>
  </li>
  <li>
    <p>In each column, <code class="language-plaintext highlighter-rouge">mean</code> checks the class of the object and dispatches the
appropriate method.</p>
  </li>
  <li>
    <p>We have a <code class="language-plaintext highlighter-rouge">numeric</code> column and an <code class="language-plaintext highlighter-rouge">integer</code> column; <code class="language-plaintext highlighter-rouge">mean</code> calls the default method for both</p>
  </li>
</ol>

<h3 id="calling-methods-directly">Calling Methods Directly</h3>

<ul>
  <li>
    <p>Some S3 methods are visible to the user (i.e. <code class="language-plaintext highlighter-rouge">mean.default</code>),</p>
  </li>
  <li>
    <p><b>Never</b> call methods directly</p>
  </li>
  <li>
    <p>Use the generic function and let the method be dispatched
automatically.</p>
  </li>
  <li>
    <p>With S4 methods you cannot call them directly at all</p>
  </li>
</ul>

<h3 id="s3-classmethod-example-3">S3 Class/Method: Example 3</h3>

<p>The <code class="language-plaintext highlighter-rouge">plot</code> function is generic and its behavior depends on the object being plotted.</p>

<p>```{r ex3_1,eval=FALSE}
set.seed(10)
x &lt;- rnorm(100)
plot(x)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### S3 Class/Method: Example 3

```{r tenPlot, echo=FALSE}
set.seed(10)
x &lt;- rnorm(100)
plot(x)
</code></pre></div></div>

<h3 id="s3-classmethod-example-3-1">S3 Class/Method: Example 3</h3>

<p>For time series objects, <code class="language-plaintext highlighter-rouge">plot</code> connects the dots</p>

<p>```{r ex3_3,eval=FALSE}
set.seed(10)
x &lt;- rnorm(100)
x &lt;- as.ts(x) ## Convert to a time series object 
plot(x)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### S3 Class/Method: Example 3

```{r ex3_4,echo=FALSE}
set.seed(10)
x &lt;- rnorm(100)
x &lt;- as.ts(x) ## Convert to a time series object 
plot(x)
</code></pre></div></div>

<h3 id="write-your-own-methods">Write your own methods!</h3>

<p>If you write new methods for new classes, you‚Äôll probably end up writing methods for the following generics:</p>
<ul>
  <li>print/show</li>
  <li>summary</li>
  <li>plot</li>
</ul>

<p>There are two ways that you can extend the R system via classes/methods</p>
<ul>
  <li>Write a method for a new class but for an existing generic function (i.e. like
<code class="language-plaintext highlighter-rouge">print</code>)</li>
  <li>Write new generic functions and new methods for those generics</li>
</ul>

<h3 id="s4-classes">S4 Classes</h3>

<p>Why would you want to create a new class?</p>
<ul>
  <li>To represent new types of data (e.g. gene expression, space-time, hierarchical, sparse matrices)</li>
  <li>New concepts/ideas that haven‚Äôt been thought of yet (e.g. a fitted point process model, mixed-effects model, a sparse matrix)</li>
  <li>To abstract/hide implementation details from the user
I say things are ‚Äúnew‚Äù meaning that R does not know about them (not that they are new to the statistical community).</li>
</ul>

<h3 id="s4-classmethod-creating-a-new-class">S4 Class/Method: Creating a New Class</h3>

<p>A new class can be defined using the <code class="language-plaintext highlighter-rouge">setClass</code> function</p>
<ul>
  <li>At a minimum you need to specify the name of the class</li>
  <li>You can also specify data elements that are called <em>slots</em></li>
  <li>You can then define methods for the class with the <code class="language-plaintext highlighter-rouge">setMethod</code> function</li>
  <li>Information about a class definition can be obtained with the <code class="language-plaintext highlighter-rouge">showClass</code> function</li>
</ul>

<h3 id="s4-classmethod-polygon-class">S4 Class/Method: Polygon Class</h3>

<p>Creating new classes/methods is usually not something done at the console; you likely want to save the code in a separate file</p>

<p>```{r polygon_1, tidy = FALSE}
library(methods)
setClass(‚Äúpolygon‚Äù,
         representation(x = ‚Äúnumeric‚Äù,
                        y = ‚Äúnumeric‚Äù))</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
- The slots for this class are `x` and `y`

- The slots for an S4 object can be accessed with the `@` operator.

### S4 Class/Method: Polygon Class

A plot method can be created with the `setMethod` function.

- For `setMethod` you need to specify a generic function (`plot`), and
  a _signature_.

- A signature is a character vector indicating the classes of objects
  that are accepted by the method.

- In this case, the `plot` method will take one type of object, a
  `polygon` object.

### S4 Class/Method: Polygon Class

Creating a `plot` method with `setMethod`.

```{r polygon_2, tidy = FALSE}
setMethod("plot", "polygon",
          function(x, y, ...) {
                  plot(x@x, x@y, type = "n", ...)
                  xp &lt;- c(x@x, x@x[1])
                  yp &lt;- c(x@y, x@y[1])
                  lines(xp, yp)
	  })
</code></pre></div></div>

<ul>
  <li>Notice that the slots of the polygon (the x- and y-coordinates) are
accessed with the <code class="language-plaintext highlighter-rouge">@</code> operator.</li>
</ul>

<h3 id="s4-classmethod-polygon-class-1">S4 Class/Method: Polygon Class</h3>

<p>After calling <code class="language-plaintext highlighter-rouge">setMethod</code> the new <code class="language-plaintext highlighter-rouge">plot</code> method will be added to the list of methods for <code class="language-plaintext highlighter-rouge">plot</code>.</p>

<p>```{r polygon_3}
library(methods)
showMethods(‚Äúplot‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Notice that the signature for class `polygon` is listed. The method for `ANY` is the default method and it is what is called when now other signature matches

### S4 Class/Method: Polygon class

```{r polygon_4}
p &lt;- new("polygon", x = c(1, 2, 3, 4), y = c(1, 2, 3, 1))
plot(p)
</code></pre></div></div>

<h3 id="summary-13">Summary</h3>

<ul>
  <li>
    <p>Developing classes and associated methods is a powerful way to
extend the functionality of R</p>
  </li>
  <li>
    <p><b>Classes</b> define new data types</p>
  </li>
  <li>
    <p><b>Methods</b> extend <b>generic functions</b> to specify the behavior
  of generic functions on new classes</p>
  </li>
  <li>
    <p>As new data types and concepts are created, classes/methods provide
a way for you to develop an intuitive interface to those
data/concepts for users</p>
  </li>
</ul>

<h3 id="where-to-look-places-to-start">Where to Look, Places to Start</h3>

<ul>
  <li>
    <p>The best way to learn this stuff is to look at examples</p>
  </li>
  <li>
    <p>There are quite a few examples on CRAN which use S4
classes/methods. You can usually tell if they use S4 classes/methods
if the <b>methods</b> package is listed in the <code class="language-plaintext highlighter-rouge">Depends:</code> field</p>
  </li>
  <li>
    <p>Bioconductor (http://www.bioconductor.org) - a rich resource, even
if you know nothing about bioinformatics</p>
  </li>
  <li>
    <p>Some packages on CRAN (as far as I know) - SparseM, gpclib, flexmix,
its, lme4, orientlib, filehash</p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">stats4</code> package (comes with R) has a bunch of classes/methods
for doing maximum likelihood analysis.</p>
  </li>
</ul>

<h2 id="swirl-c9-">swirl (c9-)</h2>
<h3 id="what-is-swirl-part-1">What is swirl? Part 1</h3>

<ul>
  <li>Swirl is an R package that turns the R console into an interactive learning
evironment.</li>
  <li>Students are guided through R programming exercises where they
can answer questions in the R console.</li>
  <li>There is no separation between where a student learns to use R, and where 
they go on to use R for thier own creative purposes.</li>
</ul>

<p>If you‚Äôve never used swirl before you shoud try swirl out for yourself:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"swirl"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">swirl</span><span class="p">)</span><span class="w">
</span><span class="n">swirl</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<h3 id="what-is-swirl-part-2">What is swirl? Part 2</h3>

<ul>
  <li>Anyone can create and distribute their own swirl course!</li>
  <li>Creating a swirl course can allow you scale R and data science education
within your company or school.</li>
  <li>If you‚Äôre interested in getting involved in the open source education
community you can release your swirl course online and Team swirl will promote
it for you!</li>
  <li>There‚Äôs a package called swirlify which is designed to help you write a swirl
course. We‚Äôll look into swirlify later.</li>
</ul>

<h3 id="what-is-a-swirl-course">What is a swirl course?</h3>

<ul>
  <li>A swirl course is a directory that contains all of the files, folders, and 
lessons associated with the course you are developing.</li>
  <li>Lessons contain most of the content that students interact with, and the 
course sequentially organizes these lessons.</li>
  <li>A course should conceptually encapsulate a broad concept that you want to 
teach. For example: ‚ÄúPlotting in R‚Äù or ‚ÄúStatistics for Engineers‚Äù are broad 
enough topics that they could be broken down further (into lessons which we‚Äôll 
talk about next).</li>
  <li>When a student start swirl, they will prompted to choose from a list of 
courses, and then they can choose a lesson within the course they selected.</li>
  <li>Once the student selects a lesson, swirl will start asking the student 
questions in the R console.</li>
</ul>

<h3 id="what-is-a-lesson">What is a lesson?</h3>

<ul>
  <li>A lesson is a directory that contains all of the files required to execute one
unit of instruction inside of swirl.</li>
  <li>For example a ‚ÄúPlotting in R‚Äù course might contain the lessons: ‚ÄúPlotting 
with Base Graphics‚Äù, ‚ÄúPlotting with Lattice‚Äù, and ‚ÄúPlotting with ggplot2.‚Äù</li>
  <li>Every lesson must contain one <code class="language-plaintext highlighter-rouge">lesson.yaml</code>
file which structures the text that the student will see inside the R console
while they are using swirl.</li>
  <li>The <code class="language-plaintext highlighter-rouge">lesson.yaml</code> file contains a sequence of questions that students will 
be prompted with.</li>
</ul>

<h3 id="writing-swirl-courses-setting-up-the-app">Writing swirl Courses: Setting up the App</h3>

<p>First install swirlify:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"swirlify"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">swirlify</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Then set your working directory to wherever you want to create your course and
start the Shiny lesson authoring app:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setwd</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="s2">"~"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Desktop"</span><span class="p">))</span><span class="w">
</span><span class="n">swirlify</span><span class="p">(</span><span class="s2">"Lesson 1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"My First Course"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="writing-swirl-courses-using-the-app">Writing swirl Courses: Using the App</h3>

<p>For a demo about how to use the Shiny authoring app see the following video:
https://youtu.be/UPL_W-Umgjs</p>

<h3 id="writing-swirl-courses-using-the-r-console">Writing swirl Courses: Using the R Console</h3>

<ul>
  <li>Alternatively you can use the R console and a text editor to write swirl
lessons.</li>
  <li>We highly recommend using
<a href="https://www.rstudio.com/products/rstudio/download/">RStudio</a> 
for writing swirl lessons since RStudio provides this editor and console setup 
by default.</li>
</ul>

<p>To start a new lesson from the R console set your working directory to where
you want to create the course, and then use the <code class="language-plaintext highlighter-rouge">new_lesson()</code> function to
create the course:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setwd</span><span class="p">(</span><span class="s2">"/Users/sean/"</span><span class="p">)</span><span class="w">
</span><span class="n">new_lesson</span><span class="p">(</span><span class="s2">"My First Lesson"</span><span class="p">,</span><span class="w"> </span><span class="s2">"My First Course"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="writing-lessons-part-1">Writing Lessons: Part 1</h3>

<p>The <code class="language-plaintext highlighter-rouge">new_lesson()</code> function will create a file and folder structure like this
in your working directory:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">My_New_Course</span><span class="w">
</span><span class="o">-</span><span class="w"> </span><span class="n">My_First_Lesson</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="n">lesson.yaml</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="n">initLesson.R</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="n">dependson.txt</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="n">customTests.R</span><span class="w">
</span></code></pre></div></div>

<h3 id="writing-lessons-part-2">Writing Lessons: Part 2</h3>

<p>To review, the <code class="language-plaintext highlighter-rouge">new_lesson()</code> function did the following:</p>

<ol>
  <li>A new directory was created in <code class="language-plaintext highlighter-rouge">/Users/sean/</code> called <code class="language-plaintext highlighter-rouge">My_New_Course</code>.</li>
  <li>A new directory was created in <code class="language-plaintext highlighter-rouge">/Users/sean/My_New_Course</code> called <code class="language-plaintext highlighter-rouge">My_First_Lesson</code>.</li>
</ol>

<h3 id="writing-lessons-part-25">Writing Lessons: Part 2.5</h3>

<ul>
  <li>Several files were created inside of <code class="language-plaintext highlighter-rouge">/Users/sean/My_New_Course/My_First_Lesson</code>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">lesson.yaml</code> is where you will write all of the questions for this lesson. (<a href="https://github.com/seankross/Test_Course/blob/master/Test_Lesson/lesson.yaml">Example</a>)</li>
      <li><code class="language-plaintext highlighter-rouge">initLesson.R</code> is an R script that is run before the lesson starts which is
  usually used to load data or set up environmental variables. (<a href="https://github.com/seankross/Test_Course/blob/master/Test_Lesson/initLesson.R">Example</a>)</li>
      <li><code class="language-plaintext highlighter-rouge">dependson.txt</code> is the list of R packages your lesson will require. swirl
  will install these packages if the user doesn‚Äôt already have them installed. (<a href="https://github.com/seankross/Test_Course/blob/master/Test_Lesson/dependson.txt">Example</a>)</li>
      <li><code class="language-plaintext highlighter-rouge">customTests.R</code> is where you can write your own tests for student‚Äôs answers.
(<a href="https://github.com/seankross/Test_Course/blob/master/Test_Lesson/customTests.R">Example</a>)</li>
    </ul>
  </li>
</ul>

<h3 id="writing-lessons-part-3">Writing Lessons: Part 3</h3>

<p>If everything is set up correctly then <code class="language-plaintext highlighter-rouge">new_lesson()</code> should have opened up the
new <code class="language-plaintext highlighter-rouge">lesson.yaml</code> file in a text editor. You can now start adding questions to
the <code class="language-plaintext highlighter-rouge">lesson.yaml</code> by using functions that start with <code class="language-plaintext highlighter-rouge">wq_</code> (write question).</p>

<h3 id="writing-lessons-types-of-questions">Writing Lessons: Types of Questions</h3>

<p>Lessons are sequences of questions that have the following general structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Class: [type of question]
  Key1: [value1]
  Key2: [value2]
- Class: [type of question]
  Key1: [value1]
  Key2: [value2]
...
</code></pre></div></div>

<p>The example above shows the high-level structure for two questions.</p>

<h3 id="writing-lessons-types-of-questions-1">Writing Lessons: Types of Questions</h3>

<ul>
  <li>Each question is demarcated with a hyphen.</li>
  <li>Every question starts with a <code class="language-plaintext highlighter-rouge">Class</code> that specifies that question‚Äôs behavior
inside of swirl.</li>
  <li>What follows the class is a set of key-value pairs that will be used to render
the question when a student is using swirl.</li>
</ul>

<h3 id="writing-lessons-the-meta-question">Writing Lessons: The Meta Question</h3>

<p>The first question in every <code class="language-plaintext highlighter-rouge">lesson.yaml</code> is always the meta question which
contains general information about the course. Below is an example of the meta
question:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Class: meta
  Course: My Course
  Lesson: My Lesson
  Author: Dr. Jennifer Bryan
  Type: Standard
  Organization: The University of British Columbia
  Version: 2.5
</code></pre></div></div>
<p>The meta question will not be displayed to a student. The only fields you should
modify are <code class="language-plaintext highlighter-rouge">Author</code> and <code class="language-plaintext highlighter-rouge">Organization</code> fields.</p>

<h3 id="writing-lessons-message-questions">Writing Lessons: Message Questions</h3>

<p>Message questions display a string of text in the R console for the student to 
read. Once the student presses enter, swirl will move on to the next question.</p>

<p>Add a message question using <code class="language-plaintext highlighter-rouge">wq_message()</code>.</p>

<p>Here‚Äôs an example message question:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Class: text
  Output: Welcome to my first swirl course!
</code></pre></div></div>

<p>The student will see the following in the R console:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| Welcome to my first swirl course!
...
</code></pre></div></div>

<h3 id="writing-lessons-command-questions">Writing Lessons: Command Questions</h3>

<p>Command questions prompt the student to type an expression into the R console.</p>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">CorrectAnswer</code> is entered into the console if the student uses the <code class="language-plaintext highlighter-rouge">skip()</code>
function.</li>
  <li>The <code class="language-plaintext highlighter-rouge">Hint</code> is displayed to the student if they don‚Äôt get the question right.</li>
  <li>The <code class="language-plaintext highlighter-rouge">AnswerTests</code> determine whether or not the student answered the question
correctly. See the answer testing section for more information.</li>
</ul>

<p>Add a message question using <code class="language-plaintext highlighter-rouge">wq_command()</code>.</p>

<h3 id="writing-lessons-command-questions-1">Writing Lessons: Command Questions</h3>

<p>Here‚Äôs an example command question:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Class: cmd_question
  Output: Add 2 and 2 together using the addition operator.
  CorrectAnswer: 2 + 2
  AnswerTests: omnitest(correctExpr='2 + 2')
  Hint: Just type 2 + 2.
</code></pre></div></div>

<p>The student will see the following in the R console:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| Add 2 and 2 together using the addition operator.
&gt;
</code></pre></div></div>

<h3 id="multiple-choice-questions">Multiple Choice Questions</h3>

<p>Multiple choice questions present a selection of options to the student. These
options are presented in a different order every time the question is seen.</p>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">AnswerChoices</code> should be a semicolon separated string of choices that
the student will have to choose from.</li>
</ul>

<p>Add a message question using <code class="language-plaintext highlighter-rouge">wq_multiple()</code>.</p>

<p>Here‚Äôs an example multiple choice question:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Class: mult_question
  Output: What is the capital of Canada?
  AnswerChoices: Toronto;Montreal;Ottawa;Vancouver
  CorrectAnswer: Ottawa
  AnswerTests: omnitest(correctVal='Ottawa')
  Hint: This city contains the Rideau Canal.
</code></pre></div></div>

<h3 id="multiple-choice-questions-1">Multiple Choice Questions</h3>

<p>The student will see the following in the R console:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| What is the capital of Canada?
1: Toronto
2: Montreal
3: Ottawa
4: Vancouver
</code></pre></div></div>

<h3 id="other-question-types">Other Question Types</h3>

<p>For complete documentation about writing swirl courses and lessons see the
swirlify website: http://swirlstats.com/swirlify/</p>

<h3 id="organizing-lessons-part-1">Organizing Lessons: Part 1</h3>

<p>Let‚Äôs revisit the general structure of a swirl course. This is the structure of
a course with two lessons:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>My_New_Course
- My_First_Lesson
  - lesson.yaml
  - initLesson.R
  - dependson.txt
  - customTests.R
- My_Second_Lesson
  - lesson.yaml
  - initLesson.R
  - dependson.txt
  - customTests.R
</code></pre></div></div>

<h3 id="organizing-lessons-part-2">Organizing Lessons: Part 2</h3>

<ul>
  <li>By default each folder in <code class="language-plaintext highlighter-rouge">My_New_Course</code> will be displayed to the student 
as a lesson they can select.</li>
  <li>If you want to explicitly specify the order in which lessons are displayed 
you will need to add a <code class="language-plaintext highlighter-rouge">MANIFEST</code> file to your course.</li>
  <li>You can do this with the <code class="language-plaintext highlighter-rouge">add_to_manifest()</code> function, which will add 
the lesson you are currently working on to the <code class="language-plaintext highlighter-rouge">MANIFEST</code>. You can also edit
the <code class="language-plaintext highlighter-rouge">MANIFEST</code> yourself in a text editor.</li>
</ul>

<h3 id="organizing-lessons-part-3">Organizing Lessons: Part 3</h3>

<p>The (abridged) <code class="language-plaintext highlighter-rouge">MANIFEST</code> file below belongs to Team swirl‚Äôs
R Programming course:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Basic_Building_Blocks
Workspace_and_Files
Sequences_of_Numbers
Vectors
Missing_Values
Subsetting_Vectors
Matrices_and_Data_Frames
</code></pre></div></div>

<h3 id="sharing-your-course">Sharing Your Course</h3>

<p>Swirlify makes sharing a swirl course easy. We recommend three different methods
for sharing a swirl course.</p>

<h3 id="sharing-your-course-as-a-file">Sharing Your Course as a File</h3>

<p>We‚Äôve developed the <code class="language-plaintext highlighter-rouge">.swc</code> file type so that you can share your course as a
single file. Creating an <code class="language-plaintext highlighter-rouge">.swc</code> file for your course is easy:</p>

<ol>
  <li>Set any lesson in the course you want to share as the current lesson using
<code class="language-plaintext highlighter-rouge">set_lesson()</code>.</li>
  <li>Create an <code class="language-plaintext highlighter-rouge">.swc</code> file using the <code class="language-plaintext highlighter-rouge">pack_course()</code> function. Your <code class="language-plaintext highlighter-rouge">.swc</code> file
will appear in the same directory as the directory that contains the course
folder. You also have the option to export the <code class="language-plaintext highlighter-rouge">.swc</code> file to another directory
by specifying the <code class="language-plaintext highlighter-rouge">export_path</code> argument.</li>
</ol>

<h3 id="sharing-your-course-as-a-file-1">Sharing Your Course as a File</h3>

<ul>
  <li>You can now share your <code class="language-plaintext highlighter-rouge">.swc</code> file like you would any other file (through email, file sharing services, etc).</li>
  <li>Students can install your course from the <code class="language-plaintext highlighter-rouge">.swc</code> file by downloading the 
file and then using the <code class="language-plaintext highlighter-rouge">install_course()</code> function in swirl, which will 
prompt them to interactively select the file they downloaded.</li>
</ul>

<h3 id="sharing-your-course-on-github">Sharing Your Course on GitHub</h3>

<ul>
  <li>We highly encourage you to develop your course on 
<a href="https://github.com/">GitHub</a> so that we can better support you if you 
have questions or need assistance while developing your course.</li>
  <li>Developing your course on GitHub provides the added
benefit that your course will be instantly ready to distribute.</li>
  <li>Students can install your course from swirl using the <code class="language-plaintext highlighter-rouge">install_course_github()</code> function.</li>
  <li>Make sure that your course directory is the root folder of your 
git repository. For examples of courses that have been shared on GitHub 
you can browse some of the courses on 
the <a href="http://swirlstats.com/scn/">Swirl Course Network</a>.</li>
</ul>

<h3 id="sharing-your-course-on-the-swirl-course-network">Sharing Your Course on The Swirl Course Network</h3>

<p>The goal of the Swirl Course Network is to list and organize all publicly
available swirl courses. Visit the <a href="http://swirlstats.com/scn/">homepage</a> of the
SCN for more information.</p>

<p>After adding your course to the SCN students will be able to install your course
using <code class="language-plaintext highlighter-rouge">install_course("[Name of Your Course]")</code> in swirl.</p>

<h3 id="sharing-your-course-on-the-swirl-course-network-1">Sharing Your Course on The Swirl Course Network</h3>

<p>In order to add your course to the SCN:</p>

<ol>
  <li>Create an <code class="language-plaintext highlighter-rouge">.swc</code> file for your course.</li>
  <li>Fork https://github.com/swirldev/scn on GitHub.</li>
  <li>Add the <code class="language-plaintext highlighter-rouge">.swc</code> file to your fork.</li>
  <li>Add an Rmd file to your fork like 
<a href="https://raw.githubusercontent.com/swirldev/scn/gh-pages/rprog.Rmd">this one</a>.
You can include a description of your course, authors, a course website, and
how to install your course.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">rmarkdown::render_site()</code> when your current directory is set to your
fork.</li>
  <li>Add, commit, and push your changes to GitHub, then send us a Pull Request.</li>
</ol>

<h3 id="more-help--resources">More Help &amp; Resources</h3>

<ul>
  <li><a href="http://swirlstats.com/">The swirl Website</a></li>
  <li><a href="http://swirlstats.com/swirlify/">The swirlify Documentation</a></li>
  <li><a href="http://swirlstats.com/scn/">The swirl Course Network</a></li>
</ul>

<p>Feel free to get in touch with Team swirl:</p>

<ul>
  <li>Via email: info@swirlstats.com</li>
  <li>On Twitter: @<a href="https://twitter.com/swirlstats">swirlstats</a></li>
</ul>

<h2 id="c9-w4-assignment-making-a-shiny-app">c9-w4 assignment: Making a shiny app</h2>

<h3 id="uir-3">ui.R</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">shinyUI</span><span class="p">(</span><span class="n">fluidPage</span><span class="p">(</span><span class="w">
  </span><span class="n">titlePanel</span><span class="p">(</span><span class="s2">"Confidence intervals Simulation based on Khan Academy"</span><span class="p">),</span><span class="w">
  </span><span class="n">sidebarLayout</span><span class="p">(</span><span class="w">
    </span><span class="n">sidebarPanel</span><span class="p">(</span><span class="w">
        </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Move the Sliders to see the plot change"</span><span class="p">),</span><span class="w">
        </span><span class="n">sliderInput</span><span class="p">(</span><span class="s2">"n"</span><span class="p">,</span><span class="s2">"Sample size(n)"</span><span class="p">,</span><span class="m">20</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">20</span><span class="p">),</span><span class="w">
        </span><span class="n">sliderInput</span><span class="p">(</span><span class="s2">"p"</span><span class="p">,</span><span class="s2">"Probability of Population (p)"</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0.5</span><span class="p">),</span><span class="w">
        </span><span class="n">sliderInput</span><span class="p">(</span><span class="s2">"CI"</span><span class="p">,</span><span class="s2">"Confindence Interval(CI%)"</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">95</span><span class="p">),</span><span class="w">
        </span><span class="n">sliderInput</span><span class="p">(</span><span class="s2">"N"</span><span class="p">,</span><span class="s2">"Number of samples (N)"</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">150</span><span class="p">,</span><span class="m">30</span><span class="p">)</span><span class="w">
        </span><span class="c1">#actionButton("reset","Click to resample")</span><span class="w">
             
    </span><span class="p">),</span><span class="w">
    </span><span class="n">mainPanel</span><span class="p">(</span><span class="w">
        </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Results and Plot"</span><span class="p">),</span><span class="w">
        </span><span class="n">textOutput</span><span class="p">(</span><span class="s2">"hits"</span><span class="p">),</span><span class="w">
        </span><span class="n">plotOutput</span><span class="p">(</span><span class="s2">"plot1"</span><span class="p">),</span><span class="w">
        </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Plot Explanation"</span><span class="p">),</span><span class="w">
        </span><span class="n">textOutput</span><span class="p">(</span><span class="s2">"plot2"</span><span class="p">),</span><span class="w">
        </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Instructions and documentation"</span><span class="p">),</span><span class="w">
        </span><span class="n">textOutput</span><span class="p">(</span><span class="s2">"docu"</span><span class="p">),</span><span class="w">
        </span><span class="n">h4</span><span class="p">(</span><span class="s2">"Expected output"</span><span class="p">),</span><span class="w">
        </span><span class="n">textOutput</span><span class="p">(</span><span class="s2">"docu2"</span><span class="p">),</span><span class="w">
        </span><span class="n">h4</span><span class="p">(</span><span class="s2">"Inspiration"</span><span class="p">),</span><span class="w">
        </span><span class="n">textOutput</span><span class="p">(</span><span class="s2">"insp"</span><span class="p">),</span><span class="w">
        </span><span class="n">h3</span><span class="p">(</span><span class="s2">"Code and calulations of Server and UI"</span><span class="p">),</span><span class="w">
        </span><span class="n">textOutput</span><span class="p">(</span><span class="s2">"code"</span><span class="p">)</span><span class="w">

        
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">))</span><span class="w">

</span></code></pre></div></div>
<h3 id="serverr-4">server.R</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">r4ss</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">shinyServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

    </span><span class="n">calc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reactive</span><span class="p">({</span><span class="w">
        </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="w">
        </span><span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w">
        </span><span class="n">CI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">CI</span><span class="p">)</span><span class="w">
        </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">p</span><span class="p">)</span><span class="w">

        </span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="n">N</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="m">6</span><span class="p">))</span><span class="w">
        </span><span class="n">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"hits"</span><span class="p">,</span><span class="s2">"pHat"</span><span class="p">,</span><span class="s2">"pSD"</span><span class="p">,</span><span class="s2">"pHatMax"</span><span class="p">,</span><span class="s2">"pHatMin"</span><span class="p">,</span><span class="s2">"no.sample"</span><span class="p">)</span><span class="w">
        
        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">){</span><span class="w">
            </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">prob</span><span class="o">=</span><span class="n">p</span><span class="p">)</span><span class="w">
            </span><span class="n">pHat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
            </span><span class="n">pSD</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">pHat</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">pHat</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="w">
            </span><span class="n">CI.corrected</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">((</span><span class="m">100</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="o">+</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="m">100</span><span class="w">
            </span><span class="n">q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="n">CI.corrected</span><span class="p">)</span><span class="w">
            </span><span class="n">pHatMax</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">pHat</span><span class="o">+</span><span class="n">q</span><span class="o">*</span><span class="n">pSD</span><span class="p">)</span><span class="w">
            </span><span class="n">pHatMin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">pHat</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">pSD</span><span class="p">)</span><span class="w">
            </span><span class="n">hits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pHatMax</span><span class="o">&gt;</span><span class="n">p</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pHatMin</span><span class="o">&lt;</span><span class="n">p</span><span class="w">
            </span><span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span><span class="n">pHat</span><span class="p">,</span><span class="n">pSD</span><span class="p">,</span><span class="n">pHatMax</span><span class="p">,</span><span class="n">pHatMin</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w">
           
        </span><span class="p">}</span><span class="w">
        </span><span class="n">df</span><span class="w">
    </span><span class="p">})</span><span class="w">

    </span><span class="n">hits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reactive</span><span class="p">({</span><span class="w">
        </span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">calc</span><span class="p">()</span><span class="w">
        </span><span class="nf">sum</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">*</span><span class="m">100</span><span class="w">
        
    </span><span class="p">})</span><span class="w">
        

    </span><span class="n">output</span><span class="o">$</span><span class="n">hits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Actual Percentage of number of samples containing population probability within their confidence bands of "</span><span class="p">,</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">CI</span><span class="p">),</span><span class="s2">"% is ="</span><span class="p">,</span><span class="nf">round</span><span class="p">(</span><span class="n">hits</span><span class="p">(),</span><span class="n">digits</span><span class="o">=</span><span class="m">2</span><span class="p">)))</span><span class="w">

    </span><span class="n">output</span><span class="o">$</span><span class="n">plot1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderPlot</span><span class="p">({</span><span class="w">
        </span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">calc</span><span class="p">()</span><span class="w">
        </span><span class="n">df</span><span class="o">$</span><span class="n">hits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">hits</span><span class="p">)</span><span class="w">
        </span><span class="n">df</span><span class="o">$</span><span class="n">hits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">relevel</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">hits</span><span class="p">,</span><span class="s2">"TRUE"</span><span class="p">)</span><span class="w">
        </span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">no.sample</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">pHat</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">hits</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
        </span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">pHatMin</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">pHatMax</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
        </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w">
        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
        </span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"TRUE"</span><span class="p">,</span><span class="s2">"FALSE"</span><span class="p">),</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">))</span><span class="o">+</span><span class="w">
            </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> 
        
    </span><span class="p">})</span><span class="w">


    </span><span class="n">output</span><span class="o">$</span><span class="n">plot2</span><span class="w">  </span><span class="o">&lt;-</span><span class="w">
        </span><span class="n">renderText</span><span class="p">(</span><span class="s2">"The X axis denotes the sample probability, and the y axis denotes the number of samples (N). The red vertical line is the population probability. Green confidence bands contain the population probability. Red confidence bands are NOT containing the population probability."</span><span class="p">)</span><span class="w">
    
    </span><span class="n">output</span><span class="o">$</span><span class="n">docu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
        </span><span class="n">renderText</span><span class="p">(</span><span class="s2">"Change the sliders to see the change in the plots. The above plots inform if it is a reasonable approximation to take the SE (standard error) of the sample as a ssubstitute for the population standard deviation."</span><span class="p">)</span><span class="w">

    </span><span class="n">output</span><span class="o">$</span><span class="n">docu2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">(</span><span class="s2">"We compute the number of times a 'mean of a random sample' is within 'X' Standard errors of population probability. This number is shown above the plot and is very close to the Confidence interval."</span><span class="p">)</span><span class="w">

    </span><span class="n">output</span><span class="o">$</span><span class="n">insp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderText</span><span class="p">(</span><span class="s2">"https://www.khanacademy.org/math/ap-
statistics/estimating-confidence-ap/introduction-confidence-intervals/
v/confidence-interval-simulation"</span><span class="p">)</span><span class="w">

    </span><span class="n">output</span><span class="o">$</span><span class="n">code</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
        </span><span class="n">renderText</span><span class="p">(</span><span class="s2">"The Code and calculations are shown in presentation of this assignment."</span><span class="p">)</span><span class="w">

    

</span><span class="p">})</span><span class="w">

</span></code></pre></div></div>

<h3 id="how-to-use-it">how to use it?</h3>

<p>Type <code class="language-plaintext highlighter-rouge">runApp()</code> in the R console within the folder.</p>

<p>So,</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">
</span><span class="n">runApp</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>Opens stuff in browser</p>

<h2 id="c10-w1">C10-w1</h2>

<p><a href="http://www.jstatsoft.org/v25/i05/">Text mining infrastucture in R</a>
<a href="http://cran.r-project.org/web/views/NaturalLanguageProcessing.html">CRAN Task View: Natural Language Processing</a>
<a href="https://www.youtube.com/user/OpenCourseOnline/search?query=NLP">Videos</a> and <a href="https://web.stanford.edu/~jurafsky/NLPCourseraSlides.html">Slides</a> from Stanford Natural Language Processing course</p>

<p>Course Tasks:</p>

<p>This course will be separated into 8 different tasks that cover the
range of activities encountered by a practicing data scientist. They
mirror many of the skills you have developed in the data science
specialization. The tasks are:</p>

<p>Understanding the problem
Data acquisition and cleaning
Exploratory analysis
Statistical modeling
Predictive modeling
Creative exploration
Creating a data product
Creating a short slide deck pitching your product</p>

<p>Assessements and Grading To successfully complete the capstone
project, you must receive a passing grade on all of the following
assignments:</p>

<p>Quiz 1: Getting Started
Milestone Report: exploratory analysis of the data set + evaluation of at least three classmate submissions
Quiz 2: Natural Language Processing I
Quiz 3: Natural Language Processing II
Final Project: your data product and a presentation describing your final data product + evaluation of at least three classmate submissions
The quizzes will be standard multiple choice quizzes. The other components are graded by peer evaluation.</p>

<p>Your final grade will be calculated as follows</p>

<p>Quiz 1 - 5%
Milestone Report - 20%
Quiz 2 - 10%
Quiz 3 -10%
Final Project -55%</p>

<p>Course dataset This is the training data to get you started that will
be the basis for most of the capstone. You must download the data from
the link below and not from external websites to start.</p>

<p>https://d396qusza40orc.cloudfront.net/dsscapstone/dataset/Coursera-SwiftKey.zip
Later in the course you may use external data sets to augment your
model as you see fit.</p>

<h3 id="understanding-the-problem">Understanding the problem</h3>

<p>The first step in analyzing any new data set is figuring out: (a) what
data you have and (b) what are the standard tools and models used for
that type of data. Make sure you have downloaded the data from
Coursera before heading for the exercises. This exercise uses the
files named LOCALE.blogs.txt where LOCALE is the each of the four
locales en_US, de_DE, ru_RU and fi_FI. The data is from a corpus
called HC Corpora. See the About the Corpora reading for more
details. The files have been language filtered but may still contain
some foreign text.</p>

<p>In this capstone we will be applying data science in the area of
natural language processing. As a first step toward working on this
project, you should familiarize yourself with Natural Language
Processing, Text Mining, and the associated tools in R. Here are some
resources that may be helpful to you.</p>

<p><a href="https://en.wikipedia.org/wiki/Natural_language_processing">Natural language processing Wikipedia page</a>
<a href="http://www.jstatsoft.org/v25/i05/">Text mining infrastructure in R</a>
<a href="http://cran.r-project.org/web/views/NaturalLanguageProcessing.html">CRAN Task View: Natural Language Processing</a>
<a href="https://www.coursera.org/course/nlp">Coursera course on NLP (not in R)</a></p>

<p><strong>Dataset</strong></p>

<p>This is the training data to get you started that will be the basis
for most of the capstone. You must download the data from the Coursera
site and not from external websites to start.</p>

<p><strong>Capstone Dataset:</strong></p>

<p>Your original exploration of the data and modeling steps will be
performed on this data set. Later in the capstone, if you find
additional data sets that may be useful for building your model you
may use them.</p>

<p><strong>Tasks to accomplish</strong></p>

<p>Obtaining the data - Can you download the data and load/manipulate it in R?
Familiarizing yourself with NLP and text mining - Learn about the
basics of natural language processing and how it relates to the data
science process you have learned in the Data Science Specialization.</p>

<p><strong>Questions to consider</strong></p>

<p>What do the data look like?
Where do the data come from?
Can you think of any other data sources that might help you in this project?
What are the common steps in natural language processing?
What are some common issues in the analysis of text data?
What is the relationship between NLP and the concepts you have learned
in the Specialization?</p>

<h3 id="corpora">corpora</h3>

<p>The corpora are collected from publicly available sources by a web
crawler. The crawler checks for language, so as to mainly get texts
consisting of the desired language*.</p>

<p>Each entry is tagged with it‚Äôs date of publication. Where user
comments are included they will be tagged with the date of the main
entry.</p>

<p>Each entry is tagged with the type of entry, based on the type of
website it is collected from (e.g. newspaper or personal blog) If
possible, each entry is tagged with one or more subjects based on the
title or keywords of the entry (e.g. if the entry comes from the
sports section of a newspaper it will be tagged with ‚Äúsports‚Äù
subject).In many cases it‚Äôs not feasible to tag the entries (for
example, it‚Äôs not really practical to tag each individual Twitter
entry, though I‚Äôve got some ideas which might be implemented in the
future) or no subject is found by the automated process, in which case
the entry is tagged with a ‚Äò0‚Äô.</p>

<p>To save space, the subject and type is given as a numerical code.</p>

<p>Once the raw corpus has been collected, it is parsed further, to
remove duplicate entries and split into individual
lines. Approximately 50% of each entry is then deleted. Since you
cannot fully recreate any entries, the entries are anonymised and this
is a non-profit venture I believe that it would fall under Fair Use.</p>

<p>Corpus Sample tagesspiegel.de 2010/12/03 1 7 Er ist weder ein Abzocker
noch ein Ausbeuter, er ist kein Betrger, er haut niemanden in die
Pfanne oder betrgt ihn um seinen gerechten Anteil, er steht zu seinem
Wort und erfllt seine Vertrge sinngem und feilscht nicht wegen
irgendwelcher Lcken im Maschendraht des Kleingedruckten der
Vertrge.spiegel.de 2010/11/30 1 1,6 Diplomaten sehen Clintons
Direktive als Besttigung einer alten Regel: Diezeit.de 2009/10/22 1
2,10 Warum schaffen wir nicht eine Whrung, die diese Aufgaben erfllt
anstatt den Forderungen der Geldwirtschaft hinterherzuhecheln, die
niemals erfllt werden knnen?</p>

<ul>
  <li>You may still find lines of entirely different languages in the
corpus. There are 2 main reasons for that:1. Similar languages. Some
languages are very similar, and the automatic language checker could
therefore erroneously accept the foreign language text.2. ‚ÄúEmbedded‚Äù
foreign languages. While a text may be mainly in the desired
language there may be parts of it in another language. Since the
text is then split up into individual lines, it is possible to see
entire lines written in a foreign language.Whereas number 1 is just
an out-and-out error, I think number 2 is actually desirable, as it
will give a picture of when foreign language is used within the main
language.</li>
</ul>

<p>Content archived from heliohost.org on September 30, 2016 and
retrieved via Wayback Machine on April
24, 207. https://web-beta.archive.org/web/20160930083655/http://www.corpora.heliohost.org/aboutcorpus.html</p>

<h3 id="getting-an-cleaning-data">getting an cleaning data</h3>

<ol>
  <li>
    <p>tokenization and profanity filtering!</p>
  </li>
  <li>
    <p>punctutaion, capitalization, typos etc‚Ä¶</p>
  </li>
</ol>

<p>Large databases comprising of text in a target language are commonly
used when generating language models for various purposes. In this
exercise, you will use the English database but may consider three
other databases in German, Russian and Finnish.</p>

<p>The goal of this task is to get familiar with the databases and do the
necessary cleaning. After this exercise, you should understand what
real data looks like and how much effort you need to put into cleaning
the data. When you commence on developing a new language, the first
thing is to understand the language and its peculiarities with respect
to your target. You can learn to read, speak and write the
language. Alternatively, you can study data and learn from existing
information about the language through literature and the internet. At
the very least, you need to understand how the language is written:
writing script, existing input methods, some phonetic knowledge, etc.</p>

<p>Note that the data contain words of offensive and profane
meaning. They are left there intentionally to highlight the fact that
the developer has to work on them.</p>

<p><strong>Tasks to accomplish</strong></p>

<p><strong>Tokenization</strong> - identifying appropriate tokens such as words,
punctuation, and numbers. Writing a function that takes a file as
input and returns a tokenized version of it. Profanity filtering -
removing profanity and other words you do not want to predict.</p>

<p><strong>Tips, tricks, and hints</strong></p>

<p><strong>Loading the data in</strong>. This dataset is fairly large. We emphasize
that you <strong>don‚Äôt necessarily need to load the entire dataset in to build
your algorithms (see point 2 below)</strong>. At least initially, you might
want to use a smaller subset of the data. Reading in chunks or lines
using R‚Äôs readLines or scan functions can be useful. You can also loop
over each line of text by embedding readLines within a for/while loop,
but this may be slower than reading in large chunks at a time. Reading
pieces of the file at a time will require the use of a file connection
in R. For example, the following code could be used to read the first
few lines of the English Twitter dataset:con &lt;-
file(‚Äúen_US.twitter.txt‚Äù, ‚Äúr‚Äù) readLines(con, 1) ## Read the first
line of text readLines(con, 1) ## Read the next line of text
readLines(con, 5) ## Read in the next 5 lines of text close(con) ##
It‚Äôs important to close the connection when you are done See the
?connections help page for more information.</p>

<p><strong>Sampling</strong>. To reiterate, to build models you don‚Äôt need to load in
and use all of the data. Often relatively few randomly selected rows
or chunks need to be included to get an accurate approximation to
results that would be obtained using all the data. Remember your
inference class and how a representative sample can be used to infer
facts about a population. You might want to create a separate
sub-sample dataset by reading in a random subset of the original data
and writing it out to a separate file. That way, you can store the
sample and not have to recreate it every time. You can use the rbinom
function to ‚Äúflip a biased coin‚Äù to determine whether you sample a
line of text or not.</p>

<h2 id="c10-w1-quiz">c10-w1 quiz</h2>

<p>1.The \verb| en_US.blogs.txt |en_US.blogs.txt file is how many
megabytes</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Do \verb| ls -alh|ls-alh in the
\verb|Coursera-Swiftkey/final/en_US|Coursera-Swiftkey/final/en_US
directory.
</code></pre></div></div>

<ol>
  <li>
    <p>The \verb|en_US.twitter.txt|en_US.twitter.txt has how many lines of
text?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Do \verb|wc -l en_US.twitter.txt|wc-len_US.twitter.txt at the
 prompt (or git bash on windows) or
 \verb|length(readLines("en_US.twitter.txt"))
 |length(readLines("en_US.twitter.txt")) in R
</code></pre></div>    </div>
  </li>
  <li>
    <p>What is the length of the longest line seen in any of the three
en_US data sets?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Again a simple wc command suffices \verb|wc -L *.txt|wc-L*.txt
 inthe directory with the three files. Note, we had a small
 discrepancy between doing thin in R versus WC.
</code></pre></div>    </div>
  </li>
  <li>
    <p>In the en_US twitter data set, if you divide the number of lines
where the word ‚Äúlove‚Äù (all lowercase) occurs by the number of lines
the word ‚Äúhate‚Äù (all lowercase) occurs, about what do you get?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> grep"love"en_US.twitterwc‚àíl‚à£ and
</code></pre></div>    </div>
  </li>
</ol>

<table>
  <tbody>
    <tr>
      <td>\verb</td>
      <td>grep ‚Äúhate‚Äù en_US.twitter</td>
      <td>wc -l</td>
      <td>grep‚Äùhate‚Äùen_US.twitterwc‚àíl‚à£ gives you the counts. Then you could divide in whatever. If you never want to leave the console, you can use bc (not present on gitbash in windows). You could also read into R (\verb</td>
      <td>readLines</td>
      <td>readLines) and use character search.</td>
    </tr>
  </tbody>
</table>

<p>This worked on gitbash</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\verb| love=$(grep "love" en_US.twitter.txt | wc -l) |love=$(grep"love"en_US.twitter.txtwc‚àíl)‚à£ then

\verb| hate=$(grep "hate" en_US.twitter.txt | wc -l) |hate=$(grep"hate"en_US.twitter.txtwc‚àíl)‚à£ then

\verb| let m=love/hate|letm=love/hate then

\verb| echo $m |echo$m
</code></pre></div></div>

<ol>
  <li>
    <p>The one tweet in the en_US twitter data set that matches the word
‚Äúbiostats‚Äù says what?</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> grep-i"biostat"en_US.twitter.txt (note the -i doesn't matter since there's only one line ignoring case).
</code></pre></div>    </div>
  </li>
  <li>
    <p>How many tweets have the exact characters ‚ÄúA computer once beat me
at chess, but it was no match for me at kickboxing‚Äù. (I.e. the line
matches those characters exactly.)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> grep-x"Acomputeroncebeatmeatchess,butitwasnomatchformeatkickboxing"en_US.twitter.txtwc‚àíl‚à£
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="also-my-answer">Also my answer</h2>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"./final/en_US/en_US.twitter.txt"</span><span class="w">
</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readLines</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">

</span><span class="nf">length</span><span class="p">(</span><span class="n">readLines</span><span class="p">(</span><span class="n">file</span><span class="p">))</span><span class="w">

</span><span class="n">sres</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nchar</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w">

</span><span class="nf">max</span><span class="p">(</span><span class="n">sres</span><span class="p">)</span><span class="w">
</span><span class="n">which.max</span><span class="p">(</span><span class="n">sres</span><span class="p">)</span><span class="w">


</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"./final/en_US/en_US.twitter.txt"</span><span class="w">
</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readLines</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">

</span><span class="n">gr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grepl</span><span class="p">(</span><span class="s2">".love"</span><span class="p">,</span><span class="n">res</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">gr</span><span class="p">])</span><span class="w">

</span><span class="n">br</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grepl</span><span class="p">(</span><span class="s2">".hate"</span><span class="p">,</span><span class="n">res</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">br</span><span class="p">])</span><span class="w">

</span><span class="nf">length</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">gr</span><span class="p">])</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">br</span><span class="p">])</span><span class="w">


</span><span class="n">ot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grepl</span><span class="p">(</span><span class="s2">".biostats"</span><span class="p">,</span><span class="n">res</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">ot</span><span class="p">])</span><span class="w">

</span><span class="n">tt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="n">grepl</span><span class="p">(</span><span class="s2">". computer once beat me at chess, but it was no match for me at kickboxing"</span><span class="p">,</span><span class="w">
          </span><span class="n">res</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">tt</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<h2 id="c10-w2">c10-w2</h2>
<h3 id="exploration">exploration</h3>

<p>The first step in building a predictive model for text is
understanding the distribution and relationship between the words,
tokens, and phrases in the text. The goal of this task is to
understand the basic relationships you observe in the data and prepare
to build your first linguistic models.</p>

<p><strong>Tasks to accomplish</strong></p>

<p><strong>Exploratory analysis</strong> - perform a thorough exploratory analysis of
the data, understanding the distribution of words and relationship
between the words in the corpora.</p>

<p><strong>Understand frequencies of words and word pairs</strong> - build figures and
tables to understand variation in the frequencies of words and word
pairs in the data.</p>

<p><strong>Questions to consider</strong></p>

<p>Some words are more frequent than others - what are the distributions
of word frequencies?  What are the frequencies of 2-grams and 3-grams
in the dataset?</p>

<p>How many unique words do you need in a frequency sorted dictionary to
cover 50% of all word instances in the language? 90%?</p>

<p>How do you evaluate how many of the words come from foreign languages?</p>

<p>Can you think of a way to increase the coverage ‚Äì identifying words
that may not be in the corpora or using a smaller number of words in
the dictionary to cover the same number of phrases?</p>

<h3 id="modeling">Modeling</h3>

<p>The goal here is to build your first simple model for the relationship
between words. This is the first step in building a predictive text
mining application. You will explore simple models and discover more
complicated modeling techniques.</p>

<p><strong>Tasks to accomplish</strong></p>

<ol>
  <li>
    <p>Build basic n-gram model - using the exploratory analysis you
performed, build a basic n-gram model for predicting the next word
based on the previous 1, 2, or 3 words.</p>
  </li>
  <li>
    <p>Build a model to handle unseen n-grams - in some cases people will
want to type a combination of words that does not appear in the
corpora. Build a model to handle cases where a particular n-gram isn‚Äôt
observed.</p>
  </li>
</ol>

<p><strong>Questions to consider</strong></p>

<ol>
  <li>How can you efficiently store an n-gram model (think Markov
Chains)?</li>
  <li>How can you use the knowledge about word frequencies to make your
model smaller and more efficient?</li>
  <li>How many parameters do you need (i.e. how big is n in your n-gram model)?</li>
  <li>Can you think of simple ways to ‚Äúsmooth‚Äù the probabilities (think
about giving all n-grams a non-zero probability even if they aren‚Äôt
observed in the data) ?</li>
  <li>How do you evaluate whether your model is any good?</li>
  <li>How can you use backoff models to estimate the probability of
unobserved n-grams?</li>
</ol>

<p><strong>Hints, tips, and tricks</strong></p>

<p>As you develop your prediction model, two key aspects that you will
have to keep in mind are the size and runtime of the algorithm. These
are defined as:</p>

<p><strong>Size:</strong> the amount of memory (physical RAM) required to run the
model in R</p>

<p><strong>Runtime:</strong> The amount of time the algorithm takes to make
a prediction given the acceptable input</p>

<p>Your goal for this prediction model is to minimize both the size and
runtime of the model in order to provide a reasonable experience to
the user.</p>

<p>Keep in mind that currently available predictive text models can run
on mobile phones, which typically have limited memory and processing
power compared to desktop computers. Therefore, you should consider
very carefully (1) how much memory is being used by the objects in
your workspace; and (2) how much time it is taking to run your
model. Ultimately, your model will need to run in a Shiny app that
runs on the shinyapps.io server.</p>

<p><strong>Tips, tricks, and hints</strong></p>

<p>Here are a few tools that may be of use to you as you work on their
algorithm:</p>

<ul>
  <li>object.size(): this function reports the number of bytes that an R
object occupies in memory</li>
  <li>Rprof(): this function runs the profiler in R that can be used to
determine where bottlenecks in your function may exist. The profr
package (available on CRAN) provides some additional tools for
visualizing and summarizing profiling data.</li>
  <li>gc(): this function runs the garbage collector to retrieve unused
RAM for R. In the process it tells you how much memory is currently
being used by R.</li>
</ul>

<p>There will likely be a tradeoff that you have to make in between size
and runtime. For example, an algorithm that requires a lot of memory,
may run faster, while a slower algorithm may- require less memory. You
will have to find the right balance between the two in order to
provide a good experience to the user.</p>

<h2 id="c10-w2-assy">c10-w2 assy</h2>

<blockquote>
  <p>The goal of this project is just to display that you‚Äôve gotten used
to working with the data and that you are on track to create your
prediction algorithm. Please submit a report on R Pubs
(http://rpubs.com/) that explains your exploratory analysis and your
goals for the eventual app and algorithm. This document should be
concise and explain only the major features of the data you have
identified and briefly summarize your plans for creating the
prediction algorithm and Shiny app in a way that would be
understandable to a non-data scientist manager. You should make use
of tables and plots to illustrate important summaries of the data
set. The motivation for this project is to: 1. Demonstrate that
you‚Äôve downloaded the data and have successfully loaded it
in.2. Create a basic report of summary statistics about the data
sets.3. Report any interesting findings that you amassed so
far.4. Get feedback on your plans for creating a prediction
algorithm and Shiny app.</p>
</blockquote>

<p>The <strong>goal</strong> of this project is just to display that you‚Äôve gotten
used to working with the data and that you are on track to create your
prediction algorithm. Please submit a <strong>report</strong> on R Pubs
(http://rpubs.com/) that <strong>explains</strong> your <strong>exploratory analysis and
your goals for the eventual app and algorithm</strong>.</p>

<ul>
  <li>
    <p>This document should be concise and explain only the <strong>major
features of the data you have identified</strong></p>
  </li>
  <li>
    <p>and <strong>briefly summarize your plans for creating the prediction
algorithm and Shiny app</strong> in a way that would be understandable to a
non-data scientist manager.</p>
  </li>
</ul>

<p>You should make use of <strong>tables and plots</strong> to illustrate important
summaries of the data set. The motivation for this project is
to:</p>

<ol>
  <li>
    <p>~~Demonstrate that you‚Äôve downloaded the data and have
successfully loaded it in. ~~</p>
  </li>
  <li>
    <p><del>Create a basic report of summary statistics about the data sets.</del></p>
  </li>
  <li>
    <p><del>Report any interesting findings that you amassed so far.</del></p>
  </li>
  <li>
    <p>Get feedback on your plans for creating a prediction algorithm and
Shiny app.</p>
  </li>
</ol>

<h2 id="c10-w3">c10-w3</h2>
<h3 id="prediction-model">Prediction model</h3>
<p>The goal of this exercise is to build and evaluate your first
predictive model. You will use the n-gram and backoff models you built
in previous tasks to build and evaluate your predictive model. The
goal is to make the model efficient and accurate.</p>

<p>Tasks to accomplish</p>

<ol>
  <li>
    <p>Build a predictive model based on the previous data modeling
steps - you may combine the models in any way you think is
appropriate.</p>
  </li>
  <li>
    <p>Evaluate the model for efficiency and accuracy - use timing
software to evaluate the computational complexity of your
model. Evaluate the model accuracy using different metrics like
perplexity, accuracy at the first word, second word, and third word.</p>
  </li>
</ol>

<p><strong>Questions to consider</strong></p>

<ul>
  <li>How does the model perform for different choices of the parameters
and size of the model?</li>
  <li>How much does the model slow down for the performance you gain?</li>
  <li>Does perplexity correlate with the other measures of accuracy?</li>
  <li>Can you reduce the size of the model (number of parameters) without
reducing performance?</li>
</ul>

<h2 id="c10-w4">c10-w4</h2>
<h3 id="creative-exploration">Creative exploration</h3>

<p>So far you have used basic models to understand and predict words. In
this next task, your goal is to use all the resources you have
available to you (from the Data Science Specialization, resources on
the web, or your own creativity) to improve the predictive accuracy
while reducing computational runtime and model complexity (if you
can). Be sure to hold out a test set to evaluate the new, more
creative models you are building.</p>

<p><strong>Tasks to accomplish</strong></p>

<p>Explore new models and data to improve your predictive model.
Evaluate your new predictions on both accuracy and efficiency.
Questions to consider</p>

<p>What are some alternative data sets you could consider using?
What are ways in which the n-gram model may be inefficient?
What are the most commonly missed n-grams? Can you think of a reason why they would be missed and fix that?
What are some other things that other people have tried to improve their model?
Can you estimate how uncertain you are about the words you are predicting?</p>

<h2 id="c10-w5">c10-w5</h2>

<p>The goal of this exercise is to create a product to highlight the
prediction algorithm that you have built and to provide an interface
that can be accessed by others via a Shiny app..</p>

<p><strong>Tasks to accomplish</strong></p>

<ol>
  <li>Create a data product to show off your prediction algorithm You should
create a Shiny app that accepts an n-gram and predicts the next word.</li>
</ol>

<p><strong>Questions to consider</strong></p>

<ol>
  <li>
    <p>What are the most interesting ways you could show off your algorithm?</p>
  </li>
  <li>
    <p>Are there any data visualizations you think might be helpful (look at
the Swiftkey data dashboard if you have it loaded on your phone)?</p>
  </li>
  <li>
    <p>How should you document the use of your data product (separately
from how you created it) so that others can rapidly deploy your
algorithm?</p>
  </li>
</ol>

<p><strong>Tips, tricks, and hints</strong></p>

<ol>
  <li>Consider the size of the predictive model you have developed. You may
have to sacrifice some accuracy to have a fast enough/small enough
model to load into Shiny.
    <h2 id="cleaning-data-resources-with-quanteda">Cleaning data resources with quanteda</h2>
  </li>
</ol>

<p>https://data.library.virginia.edu/a-beginners-guide-to-text-analysis-with-quanteda/</p>

<p>https://stackoverflow.com/a/55447821/5986651 cleaning the text instead
of corpus</p>

<p>https://stackoverflow.com/a/55447821/5986651 using <code class="language-plaintext highlighter-rouge">texts(corpus)</code> to
extract text and clean the corpus</p>

<p>And this one:
https://tutorials.quanteda.io/basic-operations/tokens/tokens_ngrams/
for ngramming a tokenized text</p>

<p>and working on DFM:
https://data.library.virginia.edu/a-beginners-guide-to-text-analysis-with-quanteda/</p>

<p>displaying output of DFM:
https://cran.r-project.org/web/packages/quanteda/vignettes/quickstart.html</p>

<p>displaying DFM as df:
https://stackoverflow.com/questions/36181361/convert-dfmsparse-from-quanteda-package-to-data-frame-or-data-table-in-r</p>

<p>ggplot rotate axis:
https://www.datanovia.com/en/blog/ggplot-axis-ticks-set-and-rotate-text-labels/</p>

<p>language modelling:
https://web.stanford.edu/class/cs124/lec/languagemodeling.pdf</p>

<p>ken benoits masterclass on quanteda:
https://kenbenoit.net/pdfs/text_analysis_in_R.pdf</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Remove some special characters </span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"‚Äô"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"‚Äò"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"¬¥"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"`"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"'"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">" -"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"p.m"</span><span class="p">,</span><span class="s2">"pm"</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"a.m"</span><span class="p">,</span><span class="s2">"am"</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"A&amp;M"</span><span class="p">,</span><span class="s2">"AandM"</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"[Uu][.][Ss][. ]"</span><span class="p">,</span><span class="s2">"US"</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w">

</span><span class="c1">### Remove other special chatacters</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"[^[:alnum:][:blank:]+?&amp;/\\-]-*"</span><span class="p">,</span><span class="s2">" "</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"\r"</span><span class="p">,</span><span class="s2">" "</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">,</span><span class="s2">" "</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span><span class="s2">" "</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">

</span><span class="c1">### remove stray characters</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">" [A-Za-z] "</span><span class="p">,</span><span class="s2">" "</span><span class="p">,</span><span class="n">string</span><span class="p">)</span><span class="w">

</span><span class="c1">### remove numbers</span><span class="w">
</span><span class="n">gsub</span><span class="p">(</span><span class="s1">'[0-9]+'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w">

</span><span class="c1">### remove stop words</span><span class="w">
</span><span class="n">string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">removeWords</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="n">stopwords</span><span class="p">)</span><span class="w">
</span><span class="n">string</span><span class="w">
</span></code></pre></div></div>
<h2 id="key-bindings-necessary-to-handle-large-data">Key bindings necessary to handle large data</h2>

<p><code class="language-plaintext highlighter-rouge">C-c C-e C-r</code> to restart R kernel</p>

<p>Chrome kill all tabs</p>

<p><code class="language-plaintext highlighter-rouge">sudo killall chrome</code></p>

<p>Chrome get memory usage</p>

<pre><code class="language-Terminal"># detailed output, in kB apparently
smem -t -P chrom
# just the total PSS, with automatic unit:
smem -t -k -c pss -P chrom | tail -n 1
</code></pre>

<p>Remove everything except this‚Ä¶</p>
<h2 id="bench-marking-tool">Bench marking tool</h2>

<p>https://github.com/hfoffani/dsci-benchmark</p>

<h1 id="next-word-prediction-benchmark">Next word prediction benchmark</h1>

<p>A simple R script for benchmarking a next word prediction algorithm.</p>

<h2 id="usage">Usage:</h2>

<ol>
  <li>Download the repository</li>
  <li>Extract data.zip into the current folder (password is provided in the Coursera forum)</li>
  <li>Open benchmark.R and run the code up to section 03</li>
  <li>(optional) create a wrapper function for your prediction function (section 03)</li>
  <li>Perform the benchmark (section 04)</li>
  <li>Report your results in the <a href="https://class.coursera.org/dsscapstone-004/forum/thread?thread_id=218">Coursera Forum</a></li>
</ol>

<h2 id="file-description">File description:</h2>

<ul>
  <li><strong>data.zip</strong> Archive containing the benchmark datasets.</li>
  <li><strong>benchmark.R</strong> Script needed to perform the benchmark (see above).</li>
  <li><strong>generate_dataset.R</strong> Script used to generate the benchmark datasets (this should not be re-run and is provided for reference only)</li>
</ul>
:ET